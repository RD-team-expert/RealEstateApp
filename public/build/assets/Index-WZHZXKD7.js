import{r as s,u as T,j as r,H as _,a as l}from"./app-p7g_f0wo.js";import{C as $,b as L}from"./card-BzYl35PS.js";import{u as R}from"./usePermissions-CJLv3dp-.js";import{A as U}from"./app-layout-DPClFEfr.js";import H from"./VendorCreateDrawer-D3s0oUDQ.js";import B from"./VendorEditDrawer-B9N2ZiHp.js";import M from"./FlashMessages-BH73ylcB.js";import q from"./PageHeader-DAgTIFGE.js";import z from"./VendorFilters-BQarlvrX.js";import G from"./VendorTable-DhfI8fMb.js";import J from"./VendorPagination-DCMUAJIV.js";import"./app-D9ss4c-j.js";import"./utils-CBfrqCZ4.js";import"./index-6lgmZUbB.js";import"./index-CdJFUDDL.js";import"./button-CgWb-OwV.js";import"./index-C9RY0Fne.js";import"./index-H5dANVBP.js";import"./index-DkhO7hde.js";import"./index-soOnB7Xl.js";import"./index-CiElmmUH.js";import"./index-DqXNBRMy.js";import"./x-CLgUf5rt.js";import"./createLucideIcon-DCkjgf37.js";import"./index-Dc_FVRD7.js";import"./index-DBAs5r5h.js";import"./index-DbQ0MNsB.js";import"./index-BFObTlUk.js";import"./index-BUWKjyuJ.js";import"./collapsible-D-5VlHH9.js";import"./chevron-right-DVrPLLPg.js";import"./index-BxQHv4UU.js";import"./log-out-DolkPHtZ.js";import"./chevrons-up-down-KkSb8Z31.js";import"./app-logo-icon-CpLLQQyo.js";import"./house-DG1cwSyn.js";import"./building-Dsvg2gBa.js";import"./users-DUIlRejs.js";import"./wrench-CShl7EQD.js";import"./credit-card-DD1qylaU.js";import"./dollar-sign-BuRVt3W_.js";import"./file-text-CmxpgnvI.js";import"./triangle-alert-BvRY_CAH.js";import"./bell-ZeWLA2EG.js";import"./drawer-BG8f08dK.js";import"./CityField-Dilz3Gut.js";import"./label-DYy2JzQ2.js";import"./select-CfH1ySLB.js";import"./index-BAfRhOcu.js";import"./chevron-down-QjJMMFQo.js";import"./check-Cfkty5Qk.js";import"./chevron-up-DNYJO-3s.js";import"./VendorNameField-BbtWcZE8.js";import"./input-DiaYLKYe.js";import"./PhoneNumberField-BN2MKF2v.js";import"./plus-Su-bBcUY.js";import"./trash-2-B0CH3TAF.js";import"./EmailField-BsuaMjE6.js";import"./ServiceTypeField-DFI8RP42.js";import"./CityField-DfcnIltz.js";import"./VendorNameField-Dex55TiP.js";import"./PhoneNumberField-CFjXJFGe.js";import"./EmailField-DK8KcLkh.js";import"./ServiceTypeField-BM1mmiin.js";import"./download-B86n1ynC.js";import"./search-BU1dLuL3.js";import"./table-Cs4vzKKx.js";import"./VendorTableRow-CEQaAn8S.js";import"./square-pen-Cwnx6pJj.js";const K=(i,a="vendors.csv")=>{const p=["ID","City","Vendor Name","Number","Email","Service Type"],n=t=>!t||!Array.isArray(t)||t.length===0?"":t.join("; "),h=[p.join(","),...i.map(t=>[t.id,`"${t.city?.city||"N/A"}"`,`"${t.vendor_name}"`,`"${n(t.number)}"`,`"${n(t.email)}"`,`"${n(t.service_type)}"`].join(","))].join(`
`),d=new Blob([h],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),m=URL.createObjectURL(d);o.setAttribute("href",m),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m)};function lt({vendors:i,filters:a,cities:p}){const[,n]=s.useState(a),[h,d]=s.useState(!1),[o,m]=s.useState(!1),[t,y]=s.useState(!1),[g,j]=s.useState(null),{flash:w}=T().props,{hasPermission:f,hasAllPermissions:v}=R(),[C,S]=s.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[E,c]=s.useState(!1),x=(e,u)=>{S(N=>({...N,[e]:u}))},D=e=>{const u=e.target.value;x("city",u),c(u.length>0)},b=e=>{x("city",e.city),c(!1)},V=()=>{const e={...C};n(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},F=()=>{const e={city:"",vendor_name:""};S(e),n(e),c(!1),l.get(route("vendors.index"),{},{preserveState:!0,preserveScroll:!0})},A=()=>{if(i.data.length===0){alert("No data to export");return}d(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;K(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{d(!1)}},P=e=>{confirm("Are you sure you want to delete this vendor?")&&l.delete(route("vendors.destroy",e.id))},O=()=>{l.reload()},I=e=>{j(e),y(!0)},k=()=>{l.reload()};return r.jsxs(U,{children:[r.jsx(_,{title:"Vendors"}),r.jsx("div",{className:"py-12",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(M,{flash:w}),r.jsx(q,{hasExportPermission:f("vendor.export"),hasCreatePermissions:v(["vendors.create","vendors.store"]),isExporting:h,onExport:A,onAddVendor:()=>m(!0)}),r.jsx($,{children:r.jsxs(L,{className:"p-6",children:[r.jsx(z,{tempFilters:C,cities:p,showCityDropdown:E,onTempFilterChange:x,onCityInputChange:D,onCitySelect:b,onSearchClick:V,onClearFilters:F,setShowCityDropdown:c}),r.jsx(G,{vendors:i.data,hasEditPermissions:v(["vendors.edit","vendors.update"]),hasDeletePermission:f("vendors.destroy"),onEditVendor:I,onDeleteVendor:P}),r.jsx(J,{links:i.links})]})})]})}),r.jsx(H,{cities:p,open:o,onOpenChange:m,onSuccess:O}),r.jsx(B,{cities:p,open:t,onOpenChange:y,vendor:g,onSuccess:k})]})}export{lt as default};
