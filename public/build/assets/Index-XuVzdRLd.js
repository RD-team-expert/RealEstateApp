import{r as b,j as e,H as C,L as p,b as y}from"./app-BM6QPhCs.js";import{u as k,A as P}from"./app-layout-CFtgqb2g.js";import{B as l}from"./app-logo-icon-_BgUcEZ_.js";import{I as E}from"./input-DxItmhPy.js";import{C as D,a as T,b as L,c as A}from"./card-CBl_kNDF.js";import{P as _,T as U,a as $,b as v,c as a,d as B,e as n,f as R}from"./table-BtCT9Bdr.js";import{B as c}from"./badge-BHzBvDls.js";import{D as I}from"./download-DPRof4Hp.js";import{S as H}from"./search-CUAuS6p0.js";import{E as O}from"./eye-pC2j2P_R.js";import{S as z}from"./square-pen-DMp9Pa9u.js";import"./app-EMhG3jeb.js";import"./index-_PhYekxG.js";import"./index-DSqKqkft.js";const V=(s,f="payments.csv")=>{try{const o=r=>r==null||isNaN(r)?"0.00":Number(r).toFixed(2),d=r=>r==null?"":String(r).replace(/"/g,'""'),x=r=>{if(!r)return"";try{return new Date(r).toLocaleDateString()}catch{return r||""}},j=[["ID","Date","City","Unit Name","Owes","Paid","Left to Pay","Status","Notes","Reversed Payments","Permanent"].join(","),...s.map(r=>{try{return[r.id||"",`"${x(r.date)}"`,`"${d(r.city)}"`,`"${d(r.unit_name)}"`,o(r.owes),o(r.paid),o(r.left_to_pay),`"${d(r.status)}"`,`"${d(r.notes)}"`,`"${d(r.reversed_payments)}"`,`"${d(r.permanent)}"`].join(",")}catch(h){return console.error("Error processing payment row:",r,h),""}}).filter(r=>r!=="")].join(`
`),m=new Blob([j],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),u=URL.createObjectURL(m);return i.setAttribute("href",u),i.setAttribute("download",f),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u),!0}catch(o){throw console.error("CSV Export Error:",o),o}};function se({payments:s,search:f}){const{hasPermission:o,hasAnyPermission:d,hasAllPermissions:x}=k(),[g,j]=b.useState(f||""),[m,i]=b.useState(!1),u=t=>{t.preventDefault(),y.get(route("payments.index"),{search:g},{preserveState:!0})},r=t=>{confirm("Are you sure you want to delete this payment?")&&y.delete(route("payments.destroy",t.id))},h=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}i(!0);try{console.log("Exporting payments data:",s.data);const t=`payments-${new Date().toISOString().split("T")[0]}.csv`;V(s.data,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t.message||"Unknown error"}. Please check the console for details.`)}finally{i(!1)}},N=t=>t==null||isNaN(t)?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),w=t=>t?t.toLowerCase().includes("paid")?e.jsx(c,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:t}):t.toLowerCase().includes("pending")?e.jsx(c,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:t}):e.jsx(c,{variant:"outline",children:t}):e.jsx(c,{variant:"outline",children:"N/A"}),S=t=>t?e.jsx(c,{variant:t==="Yes"?"default":"secondary",className:t==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t}):e.jsx(c,{variant:"outline",children:"N/A"});return e.jsxs(P,{children:[e.jsx(C,{title:"Payments"}),e.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs(D,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsxs(T,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{className:"text-2xl",children:"Payments Management"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:h,disabled:m||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),m?"Exporting...":"Export CSV"]}),x(["payments.create","payments.store"])&&e.jsx(p,{href:route("payments.create"),children:e.jsxs(l,{children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Payment"]})})]})]}),e.jsxs("form",{onSubmit:u,className:"flex gap-2 mt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(E,{type:"text",placeholder:"Search payments by city, unit, status, or notes...",value:g,onChange:t=>j(t.target.value),className:"bg-input text-input-foreground"})}),e.jsx(l,{type:"submit",children:e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsxs(A,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(U,{children:[e.jsx($,{children:e.jsxs(v,{className:"border-border",children:[e.jsx(a,{className:"text-muted-foreground",children:"Date"}),e.jsx(a,{className:"text-muted-foreground",children:"City"}),e.jsx(a,{className:"text-muted-foreground",children:"Unit Name"}),e.jsx(a,{className:"text-right text-muted-foreground",children:"Owes"}),e.jsx(a,{className:"text-right text-muted-foreground",children:"Paid"}),e.jsx(a,{className:"text-right text-muted-foreground",children:"Left to Pay"}),e.jsx(a,{className:"text-muted-foreground",children:"Status"}),e.jsx(a,{className:"text-muted-foreground",children:"Note"}),e.jsx(a,{className:"text-muted-foreground",children:"Reversed Payments"}),e.jsx(a,{className:"text-muted-foreground",children:"Permanent"}),d(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(a,{className:"text-muted-foreground",children:"Actions"})]})}),e.jsx(B,{children:s.data.map(t=>e.jsxs(v,{className:"hover:bg-muted/50 border-border",children:[e.jsx(n,{className:"text-foreground",children:new Date(t.date).toLocaleDateString()}),e.jsx(n,{className:"font-medium text-foreground",children:t.city}),e.jsx(n,{className:"text-foreground",children:t.unit_name}),e.jsx(n,{className:"text-right font-medium text-red-600 dark:text-red-400",children:N(t.owes)}),e.jsx(n,{className:"text-right text-green-600 dark:text-green-400",children:N(t.paid)}),e.jsx(n,{className:"text-right font-medium text-blue-600 dark:text-blue-400",children:N(t.left_to_pay)}),e.jsx(n,{children:w(t.status)}),e.jsx(n,{className:"text-foreground",children:t.notes}),e.jsx(n,{className:"text-foreground",children:t.reversed_payments}),e.jsx(n,{children:S(t.permanent)}),d(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(n,{children:e.jsxs("div",{className:"flex gap-1",children:[o("payments.show")&&e.jsx(p,{href:route("payments.show",t.id),children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(O,{className:"h-4 w-4"})})}),x(["payments.edit","payments.update"])&&e.jsx(p,{href:route("payments.edit",t.id),children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(z,{className:"h-4 w-4"})})}),o("payments.destroy")&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(R,{className:"h-4 w-4"})})]})})]},t.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No payments found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex justify-between items-center border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})})})]})}export{se as default};
