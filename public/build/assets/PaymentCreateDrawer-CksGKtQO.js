import{r as a,b as de,j as e}from"./app-BkyZySAt.js";import{B as E}from"./button-DOkiOPMq.js";import{P as ce,a as me,p as H,b as ue,C as pe}from"./popover-D_YIvH1C.js";import{D as he,a as xe,b as fe}from"./drawer-BQHCt03g.js";import{I as V}from"./input-nS05NghJ.js";import{L as d}from"./label-BCoYkVMj.js";import{R as be}from"./radioGroup-DeV4OTT4.js";import{S as F,a as R,b as D,c as I,d as U}from"./select-RK3poDcU.js";import{C as je}from"./calendar-5wwCpl_0.js";import{f as J}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-D3eUMA-Y.js";import"./chevron-right-Dq99BrXh.js";import"./chevron-down-BKwinLVR.js";import"./index-D86DOQfL.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-Zsm6T9Ra.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-DBw3aPE3.js";import"./index-DzIcFn8W.js";import"./x-B9Nlqjs5.js";import"./index-DvetPajZ.js";import"./index-DsMWzC3p.js";import"./index-DEy3YO5y.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";function Xe({units:k,cities:K,unitsByCity:Q,propertiesByCity:W,open:X,onOpenChange:w,onSuccess:Z}){const j=a.useRef(null),v=a.useRef(null),y=a.useRef(null),g=a.useRef(null),N=a.useRef(null),[M,p]=a.useState(""),[O,u]=a.useState(""),[A,c]=a.useState(""),[z,h]=a.useState(""),[B,x]=a.useState(""),[ee,L]=a.useState(!1),[r,C]=a.useState(""),[o,f]=a.useState(""),[b,m]=a.useState(""),{data:s,setData:i,post:te,processing:P,errors:l,reset:T}=de({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No"}),Y=()=>r?W[r]||[]:[],$=()=>r?o?k.filter(t=>t.city===r&&t.property_name===o).map(t=>t.unit_name):Q[r]||[]:[],re=(t,n,S)=>{const q=k.find(_=>_.city===t&&_.property_name===n&&_.unit_name===S);return q?q.id:null};a.useEffect(()=>{r&&o&&(Y().includes(o)||(f(""),m(""),i("unit_id","")))},[r]),a.useEffect(()=>{o&&b&&($().includes(b)||(m(""),i("unit_id","")))},[r,o]);const se=t=>{C(t),f(""),m(""),i("unit_id",""),p(""),u(""),c("")},ae=t=>{f(t),m(""),i("unit_id",""),u(""),c("")},le=t=>{if(m(t),c(""),r&&o&&t){const n=re(r,o,t);n&&i("unit_id",n.toString())}},ne=t=>{t&&(i("date",J(t,"yyyy-MM-dd")),h(""),L(!1))},oe=t=>{i("owes",t.target.value),x("")},G=t=>{t.preventDefault(),p(""),u(""),c(""),h(""),x("");let n=!1;(!s.date||s.date.trim()==="")&&(h("Please select a date before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!r||r.trim()==="")&&(p("Please select a city before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!o||o.trim()==="")&&(u("Please select a property before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!b||b.trim()==="")&&(c("Please select a unit before submitting the form."),y.current&&(y.current.focus(),y.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!s.owes||s.owes.trim()==="")&&(x("Please enter the amount owed before submitting the form."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!s.unit_id||s.unit_id.trim()==="")&&(c("Unable to identify the selected unit. Please try selecting again."),n=!0),!n&&te(route("payments.store"),{onSuccess:()=>{T(),C(""),f(""),m(""),p(""),u(""),c(""),h(""),x(""),w(!1),Z?.()},onError:S=>{console.error("Form submission errors:",S)}})},ie=()=>{T(),C(""),f(""),m(""),p(""),u(""),c(""),h(""),x(""),w(!1)};return e.jsx(he,{open:X,onOpenChange:w,modal:!1,children:e.jsx(xe,{size:"half",title:"Create New Payment",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(F,{onValueChange:se,value:r,children:[e.jsx(R,{ref:j,children:e.jsx(D,{placeholder:"Select city"})}),e.jsx(I,{children:K?.map(t=>e.jsx(U,{value:t,children:t},t))||[]})]}),l.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.unit_id}),M&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:M})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"property_name",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(F,{onValueChange:ae,value:o,disabled:!r,children:[e.jsx(R,{ref:v,children:e.jsx(D,{placeholder:r?"Select property":"Select city first"})}),e.jsx(I,{children:Y().map(t=>e.jsx(U,{value:t,children:t},t))})]}),O&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:O})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"unit_name",className:"text-base font-semibold",children:"Unit Name *"})}),e.jsxs(F,{onValueChange:le,value:b,disabled:!r,children:[e.jsx(R,{ref:y,children:e.jsx(D,{placeholder:r?"Select unit":"Select city first"})}),e.jsx(I,{children:$().map(t=>e.jsx(U,{value:t,children:t},t))})]}),A&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:A})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"date",className:"text-base font-semibold",children:"Date *"})}),e.jsxs(ce,{open:ee,onOpenChange:L,modal:!1,children:[e.jsx(me,{asChild:!0,children:e.jsxs(E,{ref:g,variant:"outline",className:`w-full justify-start text-left font-normal ${!s.date&&"text-muted-foreground"}`,children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),s.date?J(H(s.date,"yyyy-MM-dd",new Date),"PPP"):"Pick a date"]})}),e.jsx(ue,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(pe,{mode:"single",selected:s.date?H(s.date,"yyyy-MM-dd",new Date):void 0,onSelect:ne,initialFocus:!0})})]}),l.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date}),z&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:z})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"owes",className:"text-base font-semibold",children:"Owes *"})}),e.jsx(V,{ref:N,id:"owes",type:"number",step:"0.01",min:"0",value:s.owes,onChange:oe,placeholder:"Enter amount owed"}),l.owes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.owes}),B&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:B})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"paid",className:"text-base font-semibold",children:"Paid"})}),e.jsx(V,{id:"paid",type:"number",step:"0.01",min:"0",value:s.paid,onChange:t=>i("paid",t.target.value),placeholder:"Enter amount paid"}),l.paid&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.paid})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"permanent",className:"text-base font-semibold",children:"Permanent *"})}),e.jsx(be,{value:s.permanent,onValueChange:t=>i("permanent",t),name:"permanent",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),l.permanent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.permanent})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"reversed_payments",className:"text-base font-semibold",children:"Reversed Payments?"})}),e.jsx(V,{id:"reversed_payments",value:s.reversed_payments,onChange:t=>i("reversed_payments",t.target.value),placeholder:"Enter reversed payments information"}),l.reversed_payments&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.reversed_payments})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none",value:s.notes,onChange:t=>i("notes",t.target.value),rows:3,placeholder:"Enter any additional notes..."}),l.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notes})]}),!1]})}),e.jsx(fe,{className:"border-t bg-muted/50 p-4",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:ie,disabled:P,children:"Cancel"}),e.jsx(E,{type:"submit",onClick:G,disabled:P,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:P?"Creating...":"Create Payment"})]})})]})})})}export{Xe as default};
