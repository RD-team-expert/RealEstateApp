import{r as m,u as F,j as r,H as I,a as c}from"./app-DYme-6ST.js";import{C as U,a as L,b as R}from"./card-CWWVdt52.js";import{u as H}from"./usePermissions-Bu-R0dRn.js";import{A as V}from"./app-layout-H-O_MzQ8.js";import T from"./ApplicationCreateDrawer-B184-Yv1.js";import B from"./ApplicationEditDrawer-XdVKOO76.js";import M from"./ApplicationsTable-DMKkjP7b.js";import q from"./EmptyState-BOBaqRky.js";import z from"./FilterBar-B8xMXMtl.js";import G from"./FlashMessages-CIF6xLjt.js";import J from"./PageHeader-ByXHsf1z.js";import K from"./Pagination-DI8oPWoX.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./button-DygVteL_.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CityPropertyUnitSelector-BiTNH-ZK.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./ApplicantInformationSection-Cy28vpa5.js";import"./input-pR7fOcUW.js";import"./StatusAndDateSection-DYTcqUT-.js";import"./calendar-BWK2M4JP.js";import"./format-PYUiRpxY.js";import"./chevron-left-C0SnhLPd.js";import"./popover-iS5_0AtM.js";import"./radioGroup-F0AlgpLY.js";import"./calendar-Bw6k_ssZ.js";import"./AdditionalDetailsSection-w2aFUxbR.js";import"./CityPropertyUnitSelector-B3oz4Guq.js";import"./ApplicantInformationFields-cxC2sfnX.js";import"./StatusAndDateFields-KUL9YdCd.js";import"./StageAndNotesFields-Dg_7KFrM.js";import"./AttachmentField-BEYWsHDu.js";import"./CurrentSelectionDisplay-hm75S6_K.js";import"./table-NBJhLnC1.js";import"./ApplicationsTableRow-BpLHG5qI.js";import"./badge-DkU7s25L.js";import"./eye-aSD_-4Al.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";import"./search-1yu5M8Yr.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";const Q=(s,a="applications.csv")=>{try{const e=t=>t==null?"":String(t).replace(/"/g,'""'),n=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),l=[["ID","City","Property","Unit","Name","Co-signer","Status","Date","Stage in Progress","Notes","Attachment Name"].join(","),...s.map(t=>{try{return[t.id||"",`"${e(t.city)}"`,`"${e(t.property)}"`,`"${e(t.unit_name)}"`,`"${e(t.name)}"`,`"${e(t.co_signer)}"`,`"${e(t.status)}"`,`"${n(t.date)}"`,`"${e(t.stage_in_progress)}"`,`"${e(t.notes)}"`,`"${e(t.attachment_name)}"`].join(",")}catch(d){return console.error("Error processing application row:",t,d),""}}).filter(t=>t!=="")].join(`
`),u=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),p=URL.createObjectURL(u);return i.setAttribute("href",p),i.setAttribute("download",a),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(p),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Er({applications:s,cities:a,properties:e,units:n}){const[h,l]=m.useState(!1),[u,i]=m.useState(!1),[p,t]=m.useState(null),[d,x]=m.useState(!1),{flash:f}=F().props,{hasPermission:g,hasAnyPermission:S,hasAllPermissions:j}=H(),[y,E]=m.useState({city:"",property:"",unit:"",name:""}),w=o=>{E(o),c.get(route("applications.index"),o,{preserveState:!0,preserveScroll:!0})},C=()=>{E({city:"",property:"",unit:"",name:""}),c.get(route("applications.index"),{},{preserveState:!1})},A=o=>{confirm("Are you sure you want to delete this application?")&&c.delete(route("applications.destroy",o.id))},D=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}x(!0);try{const o=`applications-${new Date().toISOString().split("T")[0]}.csv`;Q(s.data,o),console.log("Export completed successfully")}catch(o){console.error("Export failed:",o),alert(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}finally{x(!1)}},b=()=>{c.get(route("applications.index"),y,{preserveState:!0,preserveScroll:!0})},P=()=>{c.get(route("applications.index"),y,{preserveState:!0,preserveScroll:!0}),i(!1),t(null)},v=o=>{t(o),i(!0)},$=j(["applications.create","applications.store"]),O=g("applications.show"),k=S(["applications.edit","applications.update"]),N=g("applications.destroy"),_=S(["applications.show","applications.edit","applications.update","applications.destroy"]);return r.jsxs(V,{children:[r.jsx(I,{title:"Applications"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(G,{success:f?.success,error:f?.error}),r.jsx(J,{onExport:D,onAddNew:()=>l(!0),isExporting:d,hasExportData:!!(s?.data&&s.data.length>0),hasCreatePermission:$}),r.jsxs(U,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(L,{children:r.jsx(z,{cities:a,properties:e,units:n,onSearch:w,onClear:C})}),r.jsx(R,{children:s.data.length>0?r.jsxs(r.Fragment,{children:[r.jsx(M,{applications:s.data,onEdit:v,onDelete:A,hasViewPermission:O,hasEditPermission:k,hasDeletePermission:N,hasAnyActionPermission:_}),r.jsx(K,{links:s.links,lastPage:s.last_page})]}):r.jsx(q,{})})]})]})}),r.jsx(T,{cities:a,properties:e,units:n,open:h,onOpenChange:l,onSuccess:b}),p&&r.jsx(B,{application:p,cities:a,properties:e,units:n,open:u,onOpenChange:i,onSuccess:P})]})}export{Er as default};
