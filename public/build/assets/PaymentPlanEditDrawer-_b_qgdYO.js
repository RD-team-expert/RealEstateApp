import{r,b as K,j as a}from"./app-DIEWn7Ix.js";import{D as L,a as Q,b as W}from"./drawer-fqLIckn8.js";import{B as G}from"./button-C0qpziZb.js";import{OriginalPaymentInfo as X}from"./OriginalPaymentInfo-B34Fxtw_.js";import{CascadingSelectionFields as Y}from"./CascadingSelectionFields-BwFPg-RC.js";import{PaymentDetailsFields as Z}from"./PaymentDetailsFields-Cu0uJdSe.js";import{NotesField as $}from"./NotesField-BSN7y1mE.js";import"./app-ChTVGdbA.js";import"./index-DKA-WKms.js";import"./index-Bt0zfGgm.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./circle-alert-BKK80Ky4.js";import"./SelectionField-DddDUWZi.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-Dc_FVRD7.js";import"./index-Bp33PYYw.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./DateField-41ovzeYb.js";import"./calendar-A7iFafDy.js";import"./format-PYUiRpxY.js";import"./chevron-left-CWUKElF8.js";import"./chevron-right-lBI-HPj1.js";import"./popover-BTBKKAKu.js";import"./calendar-BV4TAGR8.js";import"./AmountField-CrrCK9lZ.js";import"./input-Dp80VBC1.js";import"./PaidField-C0T0LALI.js";import"./textarea-DmwE5RE4.js";function B({cities:E,properties:y,propertiesByCityId:C,unitsByPropertyId:v,tenantsByUnitId:x,allUnits:N,tenantsData:F,paymentPlan:t,setData:S}){const[V,T]=r.useState(null),[U,u]=r.useState(null),[j,c]=r.useState(null),[_,o]=r.useState(null),[d,w]=r.useState([]),[k,m]=r.useState([]),[R,f]=r.useState([]),[A,p]=r.useState({city:"",property:"",unit:"",tenant:""});return r.useEffect(()=>{if(t&&N){const i=N.find(e=>e.unit_name===t.unit);if(i){const e=E.find(s=>s.city===t.city_name),n=y.find(s=>s.property_name===t.property);e&&(T(e.id),C[e.id]&&w(C[e.id])),n&&(u(n.id),v[n.id]&&m(v[n.id])),c(i.id),x[i.id]&&f(x[i.id]);const h=F.find(s=>s.full_name===t.tenant);h&&(o(h.id),S("tenant_id",h.id))}}},[t,N,E,y,C,v,x,F]),{selectedCity:V,selectedProperty:U,selectedUnit:j,selectedTenant:_,availableProperties:d,availableUnits:k,availableTenants:R,validationErrors:A,handleCityChange:i=>{const e=parseInt(i);T(e),u(null),c(null),o(null),S("tenant_id",null),p(n=>({...n,city:"",property:"",unit:"",tenant:""})),e&&C[e]?w(C[e]):w([]),m([]),f([])},handlePropertyChange:i=>{const e=parseInt(i);u(e),c(null),o(null),S("tenant_id",null),p(n=>({...n,property:"",unit:"",tenant:""})),e&&v[e]?m(v[e]):m([]),f([])},handleUnitChange:i=>{const e=parseInt(i);c(e),o(null),S("tenant_id",null),p(n=>({...n,unit:"",tenant:""})),e&&x[e]?f(x[e]):f([])},handleTenantChange:i=>{const e=parseInt(i),n=R.find(h=>h.id===e);n&&(o(e),S("tenant_id",n.id),p(h=>({...h,tenant:""})))},resetSelections:()=>{T(null),u(null),c(null),o(null),w([]),m([]),f([]),p({city:"",property:"",unit:"",tenant:""})},setValidationErrors:p}}function He({cities:E,properties:y,propertiesByCityId:C,unitsByPropertyId:v,tenantsByUnitId:x,allUnits:N,tenantsData:F,paymentPlan:t,open:S,onOpenChange:V,onSuccess:T}){const[U]=r.useState(t.paid),u=r.useRef(null),j=r.useRef(null),c=r.useRef(null),_=r.useRef(null),{data:o,setData:d,put:w,processing:k,errors:m}=K({tenant_id:t.tenant_id,amount:t.amount,dates:t.dates,paid:t.paid,notes:t.notes||""}),{selectedCity:R,selectedProperty:f,selectedUnit:A,selectedTenant:p,availableProperties:D,availableUnits:P,availableTenants:O,validationErrors:I,handleCityChange:z,handlePropertyChange:i,handleUnitChange:e,handleTenantChange:n,resetSelections:h,setValidationErrors:s}=B({cities:E,properties:y,propertiesByCityId:C,unitsByPropertyId:v,tenantsByUnitId:x,allUnits:N,tenantsData:F,paymentPlan:t,setData:d}),M=b=>{b.preventDefault(),s({city:"",property:"",unit:"",tenant:""});let l=!1;R||(s(g=>({...g,city:"Please select a city before submitting the form."})),u.current&&(u.current.focus(),u.current.scrollIntoView({behavior:"smooth",block:"center"})),l=!0),f||(s(g=>({...g,property:"Please select a property before submitting the form."})),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),l=!0),A||(s(g=>({...g,unit:"Please select a unit before submitting the form."})),c.current&&(c.current.focus(),c.current.scrollIntoView({behavior:"smooth",block:"center"})),l=!0),(!p||!o.tenant_id)&&(s(g=>({...g,tenant:"Please select a tenant before submitting the form."})),_.current&&(_.current.focus(),_.current.scrollIntoView({behavior:"smooth",block:"center"})),l=!0),!l&&w(route("payment-plans.update",t.id),{onSuccess:()=>{q(),T?.()}})},q=()=>{d({tenant_id:t.tenant_id,amount:t.amount,dates:t.dates,paid:t.paid,notes:t.notes||""}),h(),V(!1)},H=b=>{const l=parseFloat(b.target.value)||0;d("amount",l),o.paid>l&&d("paid",l)},J=b=>{const l=parseFloat(b.target.value)||0,g=Math.min(l,o.amount||0);d("paid",g)};return a.jsx(L,{open:S,onOpenChange:V,modal:!1,children:a.jsx(Q,{size:"half",title:"Edit Payment Plan",children:a.jsxs("div",{className:"flex h-full flex-col",children:[a.jsx("div",{className:"flex-1 overflow-auto p-6",children:a.jsxs("form",{onSubmit:M,className:"space-y-4",children:[a.jsx(X,{paymentPlan:t}),a.jsx(Y,{cities:E,selectedCity:R,selectedProperty:f,selectedUnit:A,selectedTenant:p,availableProperties:D,availableUnits:P,availableTenants:O,validationErrors:I,formErrors:m,onCityChange:z,onPropertyChange:i,onUnitChange:e,onTenantChange:n,cityRef:u,propertyRef:j,unitRef:c,tenantRef:_}),a.jsx(Z,{dates:o.dates,amount:o.amount,paid:o.paid,originalPaidAmount:U,errors:m,onDateChange:b=>d("dates",b),onAmountChange:H,onPaidChange:J}),a.jsx($,{notes:o.notes,error:m.notes,onChange:b=>d("notes",b)})]})}),a.jsx(W,{children:a.jsxs("div",{className:"flex gap-2 w-full",children:[a.jsx(G,{type:"button",variant:"outline",onClick:q,className:"flex-1",children:"Cancel"}),a.jsx(G,{type:"submit",onClick:M,disabled:k,className:"flex-1",children:k?"Updating...":"Update Payment Plan"})]})})]})})})}export{He as default};
