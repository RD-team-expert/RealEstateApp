import{r as c,u as T,j as o,H as R,a as m}from"./app-B8FMPvUf.js";import{A as k}from"./app-layout-HHYyJByv.js";import{C as H,a as U,b as M}from"./card-EXxUjTX3.js";import{u as V}from"./usePermissions-DDZJFyXm.js";import B from"./PropertyCreateDrawer-cflrM5TQ.js";import Q from"./PropertyEditDrawer-Cbw4EhFo.js";import q from"./PropertyPageHeader-ByLXf_wc.js";import z from"./PropertyFilters-DLvjmcLh.js";import G from"./PropertyTable-Ibu8_u4f.js";import J from"./PropertyEmptyState-Bw5yyylO.js";import K from"./FlashMessages-CXp9aBoO.js";import W from"./PropertyPagination-CJ5fHCnb.js";import"./app-BrEbHAEe.js";import"./index-C_zQ9kkn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-DIZZiQM7.js";import"./index-fZywndxp.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./drawer-By-qy253.js";import"./CitySelectionSection-BQCdAbU7.js";import"./label-mSIjHkAE.js";import"./popover-BMQC-RgO.js";import"./command-Byz7UfAg.js";import"./search-CLz9Z_Gu.js";import"./map-pin-C_zln3MQ.js";import"./check-BVaiT64F.js";import"./PropertySelectionSection-moPQdi19.js";import"./alert-DJb7k5qd.js";import"./building-2-Sicn5JLt.js";import"./circle-alert-Bo6rghsy.js";import"./InsuranceCompanySection-nYV3F4G3.js";import"./input-DGLwPUn8.js";import"./shield-Df-uqMAT.js";import"./AmountPolicySection-BgFzvrBe.js";import"./DatesSection-j583II8k.js";import"./calendar-DesMu7qT.js";import"./NotesSection-DnO5vqFL.js";import"./textarea-fJ4locy1.js";import"./InsuranceCompanyField-DS487Qvi.js";import"./AmountPolicyFields-DO3jZD8S.js";import"./DateFields-CKP7fpm4.js";import"./NotesField-DCHSEHoP.js";import"./download-v-3Aavkk.js";import"./plus-C7KcOOhZ.js";import"./table-CzYBox4s.js";import"./PropertyTableRow-BNxrMMbh.js";import"./PropertyStatusBadge-DnyYZx3a.js";import"./badge-BGMBzjbn.js";import"./PropertyDaysLeftBadge-DEHct455.js";import"./eye-DzrUIE3a.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";import"./pagination-yroiR-i4.js";import"./chevron-left-nbVEm8OA.js";import"./select-CfQzsWP6.js";import"./index-BlkGWg27.js";import"./chevron-down-C7VOkDBv.js";import"./chevron-up-AmVQJwmd.js";const X=(t,l="properties.csv")=>{const d=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],u=i=>{const h=new Date,x=new Date(i).getTime()-h.getTime();return Math.ceil(x/(1e3*60*60*24))},f=[d.join(","),...t.map(i=>[i.id,`"${i.property?.property_name||"N/A"}"`,`"${i.insurance_company_name}"`,`"${i.formatted_amount}"`,`"${i.effective_date}"`,`"${i.policy_number}"`,`"${i.expiration_date}"`,u(i.expiration_date),`"${i.status}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),r=URL.createObjectURL(g);p.setAttribute("href",r),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r)};function vt({properties:t,filters:l,cities:d=[],availableProperties:u=[]}){const{hasPermission:f,hasAnyPermission:g,hasAllPermissions:p}=V(),[r,i]=c.useState(l),[h,y]=c.useState(!1),[x,_]=c.useState(!1),[b,S]=c.useState(!1),[D,w]=c.useState(null),{flash:j}=T().props,n=l?.per_page??t.per_page,P=()=>{const e={};return t.current_page&&t.current_page>1&&(e.page=t.current_page.toString()),n&&(e.per_page=n.toString()),Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),e},E=()=>{const e={};return r.property_name&&(e.filter_property_name=String(r.property_name)),r.insurance_company_name&&(e.filter_insurance_company_name=String(r.insurance_company_name)),r.policy_number&&(e.filter_policy_number=String(r.policy_number)),typeof r.status<"u"&&r.status!==null&&(e.filter_status=String(r.status)),n&&(e.filter_per_page=String(n)),t.current_page&&t.current_page>1&&(e.filter_page=String(t.current_page)),e},C=(e,a)=>{const s={...r,[e]:a};i(s)},v=()=>{const e={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),n&&(e.per_page=n.toString()),m.get(route("properties-info.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{i({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};n&&(a.per_page=n.toString()),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},F=e=>{confirm("Are you sure you want to delete this property?")&&m.delete(route("properties-info.destroy",e.id),{data:E(),preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}y(!0);try{const e=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;X(t.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{y(!1)}},I=()=>{S(!1),m.get(route("properties-info.index"),P(),{preserveState:!0,preserveScroll:!0})},N=e=>{w(e),S(!0)},$=e=>{const a=P();delete a.page,a.per_page=e.toString(),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=e=>{const a=P();m.get(route("properties-info.show",e.id),a,{preserveState:!1})};return o.jsxs(k,{children:[o.jsx(R,{title:"Properties Insurance"}),o.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:o.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o.jsx(K,{success:j?.success,error:j?.error}),o.jsx(q,{onExport:O,onAddProperty:()=>_(!0),isExporting:h,hasExportData:t.data.length>0,canCreate:p(["properties.create","properties.store"])}),o.jsxs(H,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(U,{children:o.jsx(z,{filters:r,onFilterChange:C,onSearch:v,onClear:A})}),o.jsxs(M,{children:[o.jsx(G,{properties:t.data,onEdit:N,onDelete:F,onShow:L,canEdit:p(["properties.update","properties.edit"]),canDelete:f("properties.destroy"),canShow:f("properties.show"),hasAnyActionPermission:g(["properties.destroy","properties.update","properties.edit","properties.show"])}),t.data.length===0&&o.jsx(J,{}),t.data.length>0&&o.jsx(W,{paginatedData:t,currentPerPage:n||15,onPerPageChange:$})]})]})]})}),o.jsx(B,{open:x,onOpenChange:_,cities:d,availableProperties:u,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15}),D&&o.jsx(Q,{open:b,onOpenChange:S,property:D,availableProperties:u,onSuccess:I,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15,cities:d})]})}export{vt as default};
