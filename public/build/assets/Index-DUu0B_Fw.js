import{r as f,j as r,H as F,a as u}from"./app-C2rmVmHv.js";import{C as U,a as L,b as R}from"./card-BCawuU56.js";import{u as H}from"./usePermissions-DlQTT3jc.js";import{A as q}from"./app-layout-CcTM2koj.js";import z from"./EmptyState-CoYeL-kp.js";import G from"./FilterBar-BujUK4jA.js";import J from"./PageHeader-WyCyvpI2.js";import K from"./PaginationInfo-CdWRhpiy.js";import M from"./TaskTable-C5Y6Rt7W.js";import Q from"./VendorTaskTrackerCreateDrawer-C72yihA_.js";import W from"./VendorTaskTrackerEditDrawer-VRbnxZ5H.js";import{f as X}from"./format-PYUiRpxY.js";import"./app-Ofegqgfz.js";import"./utils-CBfrqCZ4.js";import"./index-DjZQUolQ.js";import"./index-CdJFUDDL.js";import"./button-VjjEP6Vi.js";import"./index-Bbv7bqK3.js";import"./index-ChVvoAJ-.js";import"./index-DzsQSqwg.js";import"./index-C3pxZEMX.js";import"./index-B-E9P7_A.js";import"./index-_JNlNNro.js";import"./x-C2ppUAbT.js";import"./createLucideIcon-vG7_p-6g.js";import"./index-Dc_FVRD7.js";import"./index-CZcEh-_6.js";import"./index-CZ2k1_vM.js";import"./index-Dbu0mFfF.js";import"./collapsible-CZ_3skeY.js";import"./chevron-right-472QvEjp.js";import"./index-B1jceYVp.js";import"./log-out-Bl9yuoNL.js";import"./chevrons-up-down-9pvtZBV3.js";import"./app-logo-icon-I1Arm2U_.js";import"./house-Cu6g9NGV.js";import"./building-DnGM2oyN.js";import"./users-y_2O2ydA.js";import"./wrench-Bi6BgLf8.js";import"./credit-card-CJlpjKtZ.js";import"./dollar-sign-e0dBpTUR.js";import"./file-text-CSwIlsvU.js";import"./triangle-alert-CpQEc8Ny.js";import"./bell-y7p10Xnz.js";import"./input-DlixSfKS.js";import"./chevron-down-CfuMUa4e.js";import"./search-D28ecmXm.js";import"./download-RRPPoM3D.js";import"./plus-Dp6PyI5R.js";import"./table-DkXsjxFg.js";import"./TaskTableRow-DuQrkJOj.js";import"./badge--CFw3i9B.js";import"./eye-Bujvh-o-.js";import"./square-pen-Bv68EyOt.js";import"./trash-2-CCcs6h2C.js";import"./drawer-D0-Vx3W3.js";import"./CitySection-B3uilsZx.js";import"./label-Ck9md-qZ.js";import"./select-CZv-Yj7g.js";import"./index-kc4RGjFa.js";import"./check-DMxaY1KP.js";import"./chevron-up-BB7v6AqZ.js";import"./PropertySection-DnSCe1wJ.js";import"./UnitSection-B_dMf7DK.js";import"./VendorSection-DwgEzgPE.js";import"./TaskSubmissionDateSection-B3aBmrAu.js";import"./calendar-BcRRCGMf.js";import"./chevron-left-D-ktVm-a.js";import"./popover-BkIdV067.js";import"./calendar-BwHYHWG9.js";import"./ScheduledVisitsSection-CcaeoT7G.js";import"./TaskEndingDateSection-B9yO9Y3m.js";import"./AssignedTasksSection-Cy88Ep0c.js";import"./NotesSection-DqTF0rac.js";import"./StatusSection-DMV5_Hqj.js";import"./radioGroup-D5Ix6zMl.js";import"./UrgencySection-Cm6r2x0A.js";import"./CitySelector-K3_IamcY.js";import"./FormSection-xeZKU5no.js";import"./PropertySelector-7wtAiye0.js";import"./UnitSelector-Bm9szYsz.js";import"./VendorSelector-Cbp6wMSq.js";import"./DatePickerField-D88_TNxd.js";import"./TextAreaField-Cf7SQF9K.js";import"./StatusRadioGroup-Ri9-v-CP.js";import"./UrgencyRadioGroup-ojugXy8h.js";const h=(s,a="-")=>{if(!s)return a;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return a;const[,p,c,i]=l,d=new Date(Number(p),Number(c)-1,Number(i));return X(d,"P")},Y=(s,a="vendor-tasks.csv")=>{const p=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...s.map(t=>[t.id,`"${t.city||""}"`,`"${t.property_name||""}"`,`"${t.unit_name||""}"`,`"${t.vendor_name||""}"`,`"${h(t.task_submission_date,"")}"`,`"${(t.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(t.any_scheduled_visits,"")}"`,`"${h(t.task_ending_date,"")}"`,`"${(t.notes||"").replace(/"/g,'""')}"`,`"${t.status||""}"`,`"${t.urgent}"`].join(","))].join(`
`),c=new Blob([p],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),d=URL.createObjectURL(c);i.setAttribute("href",d),i.setAttribute("download",a),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(d)};function $t({tasks:s,filters:a,units:l,cities:p,properties:c,unitsByCity:i,propertiesByCity:d,unitsByProperty:t,vendorsByCity:S,vendors:x}){const{hasPermission:v,hasAnyPermission:w,hasAllPermissions:j}=H(),[y,b]=f.useState(!1),[T,k]=f.useState(!1),[O,g]=f.useState(!1),[E,D]=f.useState(null),C=()=>{const e={};Object.entries(a).forEach(([n,o])=>{o!=null&&o!==""&&(e[n]=String(o))}),u.get(route("vendor-task-tracker.index"),e,{preserveState:!1,preserveScroll:!0}),k(!1)},$=()=>{const e={};Object.entries(a).forEach(([n,o])=>{o!=null&&o!==""&&(e[n]=String(o))}),u.get(route("vendor-task-tracker.index"),e,{preserveState:!1,preserveScroll:!0}),g(!1),D(null)},_=e=>{D(e),g(!0)},A=e=>{if(confirm("Are you sure you want to archive this task?")){const n={};Object.entries(a).forEach(([o,m])=>{m!=null&&m!==""&&(n[o]=String(m))}),u.delete(route("vendor-task-tracker.destroy",e.id),{onSuccess:()=>{u.get(route("vendor-task-tracker.index"),n,{preserveState:!1,preserveScroll:!0})}})}},N=()=>{if(s.data.length===0){alert("No data to export");return}b(!0);try{const e=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Y(s.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{b(!1)}},P=e=>{const n={};Object.entries(e).forEach(([o,m])=>{m!=null&&m!==""&&(n[o]=String(m))}),u.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},V=()=>{u.get(route("vendor-task-tracker.index"),{},{preserveState:!0,preserveScroll:!0})},I={canView:v("vendor-task-tracker.show"),canEdit:j(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:v("vendor-task-tracker.destroy"),hasAnyPermission:w(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return r.jsxs(q,{children:[r.jsx(F,{title:"Vendor Task Tracker"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(J,{onExport:N,onAddTask:()=>k(!0),isExporting:y,hasExportData:s.data.length>0,canCreate:j(["vendor-task-tracker.create","vendor-task-tracker.store"])}),r.jsxs(U,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(L,{children:r.jsx(G,{filters:a,cities:p,properties:c,vendors:x,onSearch:P,onClear:V})}),r.jsx(R,{children:s.data.length>0?r.jsxs(r.Fragment,{children:[r.jsx(M,{tasks:s.data,formatDateOnly:h,onEdit:_,onDelete:A,permissions:I}),r.jsx(K,{meta:s.meta})]}):r.jsx(z,{})})]})]})}),r.jsx(Q,{cities:p,properties:c,units:l,vendors:x,unitsByCity:i,propertiesByCity:d,unitsByProperty:t,vendorsByCity:S,open:T,onOpenChange:k,onSuccess:C}),E&&r.jsx(W,{task:E,cities:p,properties:c,units:l,vendors:x,unitsByCity:i,propertiesByCity:d,unitsByProperty:t,vendorsByCity:S,open:O,onOpenChange:g,onSuccess:$})]})}export{$t as default};
