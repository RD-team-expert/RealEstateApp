import{r as l,b as $,j as i}from"./app-BkyZySAt.js";import{B as E}from"./button-DOkiOPMq.js";import{D as q,a as z,b as G}from"./drawer-BQHCt03g.js";import H from"./CitySelector-CUPPIDD6.js";import J from"./PropertySelector-m6qvpeQy.js";import Q from"./UnitSelector-Xj71R7FK.js";import W from"./TenantSelector-CiKpWI4j.js";import m from"./DatePickerField-CXU-Bz8W.js";import y from"./RadioGroupField-EFnotDac.js";import X from"./TextAreaField-Btu4n1lC.js";import Z from"./DateOfDeclineSectionEdit-DrkuqV6m.js";import{p as ee}from"./popover-D_YIvH1C.js";import{f as te,i as ne}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-D86DOQfL.js";import"./index-Zsm6T9Ra.js";import"./index-DBw3aPE3.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-DzIcFn8W.js";import"./x-B9Nlqjs5.js";import"./createLucideIcon-D3eUMA-Y.js";import"./label-BCoYkVMj.js";import"./select-RK3poDcU.js";import"./index-DvetPajZ.js";import"./index-DEy3YO5y.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./index-DsMWzC3p.js";import"./chevron-down-BKwinLVR.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";import"./input-nS05NghJ.js";import"./calendar-5wwCpl_0.js";import"./radioGroup-DeV4OTT4.js";import"./chevron-right-Dq99BrXh.js";const s=t=>{if(!t)return"";const u=t.slice(0,10),h=ee(u,"yyyy-MM-dd",new Date);return ne(h)?te(h,"yyyy-MM-dd"):""};function $e({offer:t,hierarchicalData:u,open:h,onOpenChange:S,onSuccess:R}){const b=l.useRef(null),f=l.useRef(null),C=l.useRef(null),v=l.useRef(null),[g,_]=l.useState({}),[c,N]=l.useState({date_sent_offer:!1,date_of_acceptance:!1,date_of_decline:!1,last_notice_sent:!1,date_sent_lease:!1,date_signed:!1,last_notice_sent_2:!1}),p=(e,a)=>{N(d=>({...d,[e]:a}))},x=()=>{if(!t.tenant_id)return{cityId:"",propertyId:"",unitId:"",tenantId:""};for(const e of u)for(const a of e.properties)for(const d of a.units){const D=d.tenants.find(Y=>Y.id===t.tenant_id);if(D)return{cityId:e.id.toString(),propertyId:a.id.toString(),unitId:d.id.toString(),tenantId:D.id.toString()}}return{cityId:"",propertyId:"",unitId:"",tenantId:""}},j=x(),{data:n,setData:o,put:M,processing:O,errors:r}=$({tenant_id:t.tenant_id?.toString()||"",city_id:j.cityId,property_id:j.propertyId,unit_id:j.unitId,other_tenants:t.other_tenants||"",date_sent_offer:s(t.date_sent_offer),status:t.status||"",date_of_acceptance:s(t.date_of_acceptance),date_of_decline:s(t.date_of_decline),last_notice_sent:s(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:s(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:s(t.date_signed),last_notice_sent_2:s(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""});l.useEffect(()=>{if(t){const e=x();o({tenant_id:t.tenant_id?.toString()||"",city_id:e.cityId,property_id:e.propertyId,unit_id:e.unitId,other_tenants:t.other_tenants||"",date_sent_offer:s(t.date_sent_offer),status:t.status||"",date_of_acceptance:s(t.date_of_acceptance),date_of_decline:s(t.date_of_decline),last_notice_sent:s(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:s(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:s(t.date_signed),last_notice_sent_2:s(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""})}},[t]);const k=l.useMemo(()=>{if(!n.city_id)return[];const e=u.find(a=>a.id.toString()===n.city_id);return e?e.properties:[]},[u,n.city_id]),I=l.useMemo(()=>{if(!n.property_id)return[];const e=k.find(a=>a.id.toString()===n.property_id);return e?e.units:[]},[k,n.property_id]),P=l.useMemo(()=>{if(!n.unit_id)return[];const e=I.find(a=>a.id.toString()===n.unit_id);return e?e.tenants:[]},[I,n.unit_id]),A=e=>{o({...n,city_id:e,property_id:"",unit_id:"",tenant_id:""}),_(a=>({...a,city:void 0}))},U=e=>{o({...n,property_id:e,unit_id:"",tenant_id:""}),_(a=>({...a,property:void 0}))},V=e=>{o({...n,unit_id:e,tenant_id:""}),_(a=>({...a,unit:void 0}))},T=e=>{o("tenant_id",e),_(a=>({...a,tenant:void 0}))},F=e=>{o("other_tenants",e)},L=e=>{o("date_sent_offer",e),_(a=>({...a,date_sent_offer:void 0}))},B=e=>{o("date_of_decline",e)},w=e=>{e.preventDefault(),_({});let a=!1;const d={};if((!n.city_id||n.city_id.trim()==="")&&(d.city="Please select a city before submitting the form.",b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.property_id||n.property_id.trim()==="")&&(d.property="Please select a property before submitting the form.",f.current&&!a&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.unit_id||n.unit_id.trim()==="")&&(d.unit="Please select a unit before submitting the form.",C.current&&!a&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.tenant_id||n.tenant_id.trim()==="")&&(d.tenant="Please select a tenant before submitting the form.",v.current&&!a&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),a){_(d);return}M(`/offers_and_renewals/${t.id}`,{onSuccess:()=>{_({}),S(!1),R?.()}})},K=()=>{const e=x();o({tenant_id:t.tenant_id?.toString()||"",city_id:e.cityId,property_id:e.propertyId,unit_id:e.unitId,other_tenants:t.other_tenants||"",date_sent_offer:s(t.date_sent_offer),status:t.status||"",date_of_acceptance:s(t.date_of_acceptance),date_of_decline:s(t.date_of_decline),last_notice_sent:s(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:s(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:s(t.date_signed),last_notice_sent_2:s(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""}),_({}),S(!1)};return i.jsx(q,{open:h,onOpenChange:S,modal:!1,children:i.jsx(z,{size:"half",title:`Edit Offer/Renewal (ID: ${t.id})`,children:i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx("div",{className:"flex-1 overflow-auto p-6",children:i.jsxs("form",{onSubmit:w,className:"space-y-4",children:[i.jsx(H,{cities:u,value:n.city_id,onChange:A,error:r.city_id,validationError:g.city,cityRef:b}),i.jsx(J,{properties:k,value:n.property_id,onChange:U,error:r.property_id,validationError:g.property,propertyRef:f,citySelected:!!n.city_id}),i.jsx(Q,{units:I,value:n.unit_id,onChange:V,error:r.unit_id,validationError:g.unit,unitRef:C,propertySelected:!!n.property_id}),i.jsx(W,{tenants:P,value:n.tenant_id,onChange:T,error:r.tenant_id,validationError:g.tenant,tenantRef:v,unitSelected:!!n.unit_id,otherTenants:n.other_tenants,onOtherTenantsChange:F}),i.jsx(m,{label:"Date Sent Offer",value:n.date_sent_offer,onChange:L,error:r.date_sent_offer,validationError:g.date_sent_offer,required:!0,borderColor:"border-l-orange-500",isOpen:c.date_sent_offer,onOpenChange:e=>p("date_sent_offer",e)}),i.jsx(y,{label:"Status",name:"status",value:n.status,onChange:e=>o("status",e),options:[{value:"Accepted",label:"Accepted"},{value:"Didn't Accept",label:"Didn't Accept"},{value:"Didn't respond",label:"Didn't respond"}],error:r.status,borderColor:"border-l-emerald-500"}),n.status==="Didn't Accept"?i.jsx(Z,{value:n.date_of_decline,onChange:B,error:r.date_of_decline,isOpen:c.date_of_decline,onOpenChange:e=>p("date_of_decline",e)}):i.jsxs(i.Fragment,{children:[i.jsx(m,{label:"Date of Acceptance",value:n.date_of_acceptance,onChange:e=>o("date_of_acceptance",e),error:r.date_of_acceptance,borderColor:"border-l-teal-500",isOpen:c.date_of_acceptance,onOpenChange:e=>p("date_of_acceptance",e)}),i.jsx(m,{label:"Offer Last Notice Sent",value:n.last_notice_sent,onChange:e=>o("last_notice_sent",e),error:r.last_notice_sent,borderColor:"border-l-indigo-500",isOpen:c.last_notice_sent,onOpenChange:e=>p("last_notice_sent",e)}),i.jsx(y,{label:"Offer Notice Kind",name:"notice_kind",value:n.notice_kind,onChange:e=>o("notice_kind",e),options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"},{value:"Messages",label:"Messages"}],error:r.notice_kind,borderColor:"border-l-pink-500"}),i.jsx(y,{label:"Lease Sent?",name:"lease_sent",value:n.lease_sent,onChange:e=>o("lease_sent",e),options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],error:r.lease_sent,borderColor:"border-l-red-500"}),i.jsx(m,{label:"Date Sent Lease",value:n.date_sent_lease,onChange:e=>o("date_sent_lease",e),error:r.date_sent_lease,borderColor:"border-l-yellow-500",isOpen:c.date_sent_lease,onOpenChange:e=>p("date_sent_lease",e)}),i.jsx(y,{label:"Lease Signed?",name:"lease_signed",value:n.lease_signed,onChange:e=>o("lease_signed",e),options:[{value:"Signed",label:"Signed"},{value:"Unsigned",label:"Unsigned"}],error:r.lease_signed,borderColor:"border-l-cyan-500"}),i.jsx(m,{label:"Date Signed",value:n.date_signed,onChange:e=>o("date_signed",e),error:r.date_signed,borderColor:"border-l-violet-500",isOpen:c.date_signed,onOpenChange:e=>p("date_signed",e)}),i.jsx(m,{label:"Renewal Last Notice Sent",value:n.last_notice_sent_2,onChange:e=>o("last_notice_sent_2",e),error:r.last_notice_sent_2,borderColor:"border-l-rose-500",isOpen:c.last_notice_sent_2,onOpenChange:e=>p("last_notice_sent_2",e)}),i.jsx(y,{label:"Renewal Notice Kind",name:"notice_kind_2",value:n.notice_kind_2,onChange:e=>o("notice_kind_2",e),options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"},{value:"Messages",label:"Messages"}],error:r.notice_kind_2,borderColor:"border-l-amber-500"}),i.jsx(X,{label:"Notes",value:n.notes,onChange:e=>o("notes",e),error:r.notes,borderColor:"border-l-slate-500",placeholder:"Add any additional notes...",rows:3})]})]})}),i.jsx(G,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(E,{onClick:K,variant:"outline",className:"flex-1",children:"Cancel"}),i.jsx(E,{onClick:w,disabled:O,className:"flex-1",children:O?"Updating...":"Update Offer"})]})})]})})})}export{$e as default};
