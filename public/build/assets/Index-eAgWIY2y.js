import{r as l,j as e,H as I,a as _}from"./app-BkyZySAt.js";import{B as L}from"./badge-tV_scfVa.js";import{B as b}from"./button-DOkiOPMq.js";import{C as ee,a as re,b as te}from"./card-BSlFV5gi.js";import{I as T}from"./input-nS05NghJ.js";import{T as oe,a as se,b as A,c as a,d as ae,e as d}from"./table-DsKiQ4vI.js";import{u as de,A as ne}from"./app-layout-CUDU1EFq.js";import ie from"./MoveInCreateDrawer-gAmybU81.js";import ce from"./MoveInEditDrawer-CLcrHKtj.js";import{D as le}from"./download-DxNOAkY-.js";import{P as me}from"./plus-DTSW7Jno.js";import{S as ue}from"./search-BY45Y726.js";import{X as pe}from"./x-B9Nlqjs5.js";import{S as xe}from"./square-pen-ChyjgJxS.js";import{T as be}from"./trash-2-ChJ1J_da.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-D86DOQfL.js";import"./index-Zsm6T9Ra.js";import"./index-DBw3aPE3.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-DzIcFn8W.js";import"./index-DEy3YO5y.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./createLucideIcon-D3eUMA-Y.js";import"./collapsible-Dttt_w3O.js";import"./chevron-right-Dq99BrXh.js";import"./index-DvetPajZ.js";import"./log-out-B7H3SWOF.js";import"./app-logo-icon-BSvCg9K3.js";import"./house-TX0f6Zqy.js";import"./building-BbJM-Q5U.js";import"./users-C8GbH6-0.js";import"./wrench-BBOVsUgY.js";import"./credit-card-DEc-A8LR.js";import"./dollar-sign-jUoIv82C.js";import"./file-text-Bx2ai-5c.js";import"./triangle-alert-BMumWF7Z.js";import"./bell-hSdBu80X.js";import"./popover-D_YIvH1C.js";import"./format-PYUiRpxY.js";import"./chevron-down-BKwinLVR.js";import"./drawer-BQHCt03g.js";import"./label-BCoYkVMj.js";import"./radioGroup-DeV4OTT4.js";import"./index-DsMWzC3p.js";import"./select-RK3poDcU.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";import"./calendar-5wwCpl_0.js";const he=(s,p="move-ins.csv")=>{try{const o=t=>{if(!t)return"";try{const u=new Date(t);return isNaN(u.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(u)}catch{return t||""}},c=t=>t==null?"":String(t).replace(/"/g,'""'),h=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...s.map(t=>{try{return[t.id||"",`"${c(t.city_name)}"`,`"${c(t.property_name)}"`,`"${c(t.unit_name)}"`,`"${c(t.signed_lease)}"`,`"${o(t.lease_signing_date)}"`,`"${o(t.move_in_date)}"`,`"${c(t.paid_security_deposit_first_month_rent)}"`,`"${o(t.scheduled_paid_time)}"`,`"${c(t.handled_keys)}"`,`"${o(t.move_in_form_sent_date)}"`,`"${c(t.filled_move_in_form)}"`,`"${o(t.date_of_move_in_form_filled)}"`,`"${c(t.submitted_insurance)}"`,`"${o(t.date_of_insurance_expiration)}"`].join(",")}catch(u){return console.error("Error processing move-in row:",t,u),""}}).filter(t=>t!=="")].join(`
`),w=new Blob([h],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),f=URL.createObjectURL(w);return m.setAttribute("href",f),m.setAttribute("download",p),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(f),!0}catch(o){throw console.error("CSV Export Error:",o),o}};function yr({moveIns:s,search:p,filters:o,units:c,cities:v,properties:h,unitsByProperty:w}){const[m,f]=l.useState(!1),[t,u]=l.useState(!1),[O,F]=l.useState(!1),[M,R]=l.useState(null),[n,C]=l.useState({city:o?.city||"",property:o?.property||"",search:o?.search||p||""}),[D,k]=l.useState({city:o?.city||"",property:o?.property||"",search:o?.search||p||""}),[U,g]=l.useState(!1),[B,y]=l.useState(!1),H=l.useRef(null),V=l.useRef(null);l.useEffect(()=>{C({city:o?.city||"",property:o?.property||"",search:o?.search||p||""}),k({city:o?.city||"",property:o?.property||"",search:o?.search||p||""})},[o,p]);const $=v.filter(r=>r.city.toLowerCase().includes(n.city.toLowerCase())),P=h.filter(r=>r.property_name.toLowerCase().includes(n.property.toLowerCase())),j=(r,i)=>{C(W=>({...W,[r]:i}))},Y=()=>{k(n);const r={};n.search?.trim()&&(r.search=n.search.trim()),n.city?.trim()&&(r.city=n.city.trim()),n.property?.trim()&&(r.property=n.property.trim()),_.get(route("move-in.index"),r,{preserveState:!0,preserveScroll:!0})},K=()=>{const r={city:"",property:"",search:""};C(r),k(r),g(!1),y(!1),_.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},Z=r=>{r.preventDefault(),Y()},{hasPermission:E,hasAnyPermission:z}=de(),q=r=>{confirm("Are you sure you want to delete this move-in record?")&&_.delete(route("move-in.destroy",r.id))},X=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}f(!0);try{console.log("Exporting move-in data:",s.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;he(s.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const i=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${i}. Please check the console for details.`)}finally{f(!1)}},G=()=>{_.reload()},J=()=>{_.reload()},Q=r=>{R(r),F(!0)},x=r=>{if(!r)return"N/A";const i=new Date(r);return isNaN(i.getTime())?"N/A":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(i)},N=r=>r===null?e.jsx(L,{variant:"outline",children:"N/A"}):e.jsx(L,{variant:r==="Yes"?"default":"secondary",className:r==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:r}),S=D.search||D.city||D.property;return e.jsxs(ne,{children:[e.jsx(I,{title:"Move-In Management"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Move-In Management"}),S&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Showing filtered results"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:X,disabled:m||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),m?"Exporting...":"Export CSV"]}),E("move-in.store")&&e.jsxs(b,{onClick:()=>u(!0),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Add Move-In Record"]})]})]}),e.jsxs(ee,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(re,{children:e.jsx("form",{onSubmit:Z,children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{ref:H,type:"text",placeholder:"Filter by city...",value:n.city,onChange:r=>{const i=r.target.value;j("city",i),g(i.length>0)},onFocus:()=>g(n.city.length>0),onBlur:()=>setTimeout(()=>g(!1),200),className:"text-input-foreground bg-input"}),U&&$.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mb-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:$.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>{j("city",r.city),g(!1)},children:r.city},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{ref:V,type:"text",placeholder:"Filter by property...",value:n.property,onChange:r=>{const i=r.target.value;j("property",i),y(i.length>0)},onFocus:()=>y(n.property.length>0),onBlur:()=>setTimeout(()=>y(!1),200),className:"text-input-foreground bg-input"}),B&&P.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mb-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:P.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>{j("property",r.property_name),y(!1)},children:r.property_name},r.id))})]}),e.jsxs("div",{className:"flex gap-2 md:col-span-2",children:[e.jsx(T,{type:"text",placeholder:"Search by unit name...",value:n.search,onChange:r=>j("search",r.target.value),className:"text-input-foreground flex-1 bg-input"}),e.jsx(b,{type:"submit",size:"sm",children:e.jsx(ue,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(b,{type:"button",variant:"outline",onClick:K,size:"sm",className:"flex items-center",disabled:!S,children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Clear"]})})]})})}),e.jsxs(te,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(oe,{className:"border-collapse rounded-md border border-border",children:[e.jsx(se,{children:e.jsxs(A,{className:"border-border",children:[e.jsx(a,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(a,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(a,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Signed Lease"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Signing Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Move-In Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Paid Security & First Month"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Scheduled Payment Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Handled Keys"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Move in form sent On"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Filled Move-In Form"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Date of move in form filled in"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Submitted Insurance"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Date of Insurance expiration"}),z(["move-in.show","move-in.edit","move-in.update","move-in.destroy"])&&e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(ae,{children:s.data.map(r=>e.jsxs(A,{className:"border-border hover:bg-muted/50",children:[e.jsx(d,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city_name}),e.jsx(d,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property_name}),e.jsx(d,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.unit_name}),e.jsx(d,{className:"border border-border text-center",children:N(r.signed_lease)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.lease_signing_date)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.move_in_date)}),e.jsx(d,{className:"border border-border text-center",children:N(r.paid_security_deposit_first_month_rent)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.scheduled_paid_time)}),e.jsx(d,{className:"border border-border text-center",children:N(r.handled_keys)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.move_in_form_sent_date)}),e.jsx(d,{className:"border border-border text-center",children:N(r.filled_move_in_form)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.date_of_move_in_form_filled)}),e.jsx(d,{className:"border border-border text-center",children:N(r.submitted_insurance)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:x(r.date_of_insurance_expiration)}),z(["move-in.show","move-in.edit","move-in.update","move-in.destroy"])&&e.jsx(d,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[E("move-in.update")&&e.jsx(b,{variant:"outline",size:"sm",onClick:()=>Q(r),children:e.jsx(xe,{className:"h-4 w-4"})}),E("move-in.destroy")&&e.jsx(b,{variant:"outline",size:"sm",onClick:()=>q(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(be,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No move-in records found."}),e.jsx("p",{className:"text-sm",children:S?"Try adjusting your search criteria.":"Create your first move-in record to get started."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results",S&&e.jsx("span",{className:"ml-2 text-xs",children:"(filtered)"})]})})]})]})]})}),e.jsx(ie,{units:c,cities:v,properties:h,unitsByProperty:w,open:t,onOpenChange:u,onSuccess:G}),M&&e.jsx(ce,{moveIn:M,units:c,cities:v,properties:h,unitsByProperty:w,open:O,onOpenChange:F,onSuccess:J})]})}export{yr as default};
