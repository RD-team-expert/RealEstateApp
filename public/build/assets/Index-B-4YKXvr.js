import{r as s,u as T,j as r,H as _,a as l}from"./app-B8ebXpyL.js";import{C as $,b as L}from"./card-I5kwi667.js";import{u as R}from"./usePermissions-s98nhEDu.js";import{A as U}from"./app-layout-DmWdmcS1.js";import H from"./VendorCreateDrawer-BGfr0ewK.js";import B from"./VendorEditDrawer-zB_QtH5O.js";import M from"./FlashMessages-DUxe9Fh-.js";import q from"./PageHeader-BoFSMXfG.js";import z from"./VendorFilters-DBRTA0pB.js";import G from"./VendorTable-BM3koM-T.js";import J from"./VendorPagination-DELBhMHI.js";import"./app-DzAncQ8Z.js";import"./utils-CBfrqCZ4.js";import"./index-BvTxALZe.js";import"./index-CdJFUDDL.js";import"./button-CPgLtvIU.js";import"./index-D1eOqOTZ.js";import"./index-DAWwAdgX.js";import"./index-D-HIh1V3.js";import"./index-D14oVES4.js";import"./index-B1T6AYU9.js";import"./index-Ck7g32ef.js";import"./x-DoFGuxfS.js";import"./createLucideIcon-B4WReUhf.js";import"./index-Dc_FVRD7.js";import"./index-7ugTB-P5.js";import"./index-Z2oIQlZU.js";import"./index-BGNXafUJ.js";import"./collapsible-D48RZtcV.js";import"./chevron-right-g-fM4TgC.js";import"./index-B2KxWlhD.js";import"./log-out-CxyPaRj9.js";import"./chevrons-up-down-CIZQ0EQ8.js";import"./app-logo-icon-BiqGLCxP.js";import"./house-BviqJpCK.js";import"./building-W9cmgTVn.js";import"./users-BK0LvTD0.js";import"./wrench-4e_DbURg.js";import"./credit-card-D3gmHRKt.js";import"./dollar-sign-8AMWFOh2.js";import"./file-text-CFwiw5Hy.js";import"./triangle-alert-Cc4FkIFs.js";import"./bell-B34QRIOc.js";import"./drawer-BGYUKi-8.js";import"./CityField-JHA7ZdNZ.js";import"./label-nhRupGpP.js";import"./select-B8s2DExj.js";import"./index-BCMuVr1f.js";import"./chevron-down-CWVENDnU.js";import"./check-BsIcLAQ3.js";import"./chevron-up-LAfsrV3l.js";import"./VendorNameField-DR7P3k2h.js";import"./input-C70n0jI8.js";import"./PhoneNumberField-Ch_5Bngo.js";import"./plus-WII3wxe5.js";import"./trash-2-CKQv4Lrc.js";import"./EmailField-6JA9SyAA.js";import"./ServiceTypeField-uLXFcZvp.js";import"./CityField-DxMOCvt_.js";import"./VendorNameField-LM7XxfIR.js";import"./PhoneNumberField-ByYGN2Pj.js";import"./EmailField-CMM_75NP.js";import"./ServiceTypeField-IFVqGQ18.js";import"./download-CP3NEa-C.js";import"./search-B07AvWR6.js";import"./table-DhCWrlNv.js";import"./VendorTableRow-CvqmqLAc.js";import"./square-pen-CTNwHmLR.js";const K=(i,a="vendors.csv")=>{const p=["ID","City","Vendor Name","Number","Email","Service Type"],n=t=>!t||!Array.isArray(t)||t.length===0?"":t.join("; "),h=[p.join(","),...i.map(t=>[t.id,`"${t.city?.city||"N/A"}"`,`"${t.vendor_name}"`,`"${n(t.number)}"`,`"${n(t.email)}"`,`"${n(t.service_type)}"`].join(","))].join(`
`),d=new Blob([h],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),m=URL.createObjectURL(d);o.setAttribute("href",m),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m)};function mt({vendors:i,filters:a,cities:p}){const[,n]=s.useState(a),[h,d]=s.useState(!1),[o,m]=s.useState(!1),[t,y]=s.useState(!1),[g,j]=s.useState(null),{flash:w}=T().props,{hasPermission:f,hasAllPermissions:v}=R(),[C,S]=s.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[E,c]=s.useState(!1),x=(e,u)=>{S(N=>({...N,[e]:u}))},D=e=>{const u=e.target.value;x("city",u),c(u.length>0)},b=e=>{x("city",e.city),c(!1)},V=()=>{const e={...C};n(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},F=()=>{const e={city:"",vendor_name:""};S(e),n(e),c(!1),l.get(route("vendors.index"),{},{preserveState:!0,preserveScroll:!0})},A=()=>{if(i.data.length===0){alert("No data to export");return}d(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;K(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{d(!1)}},P=e=>{confirm("Are you sure you want to delete this vendor?")&&l.delete(route("vendors.destroy",e.id))},O=()=>{l.reload()},I=e=>{j(e),y(!0)},k=()=>{l.reload()};return r.jsxs(U,{children:[r.jsx(_,{title:"Vendors"}),r.jsx("div",{className:"py-12",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(M,{flash:w}),r.jsx(q,{hasExportPermission:f("vendor.export"),hasCreatePermissions:v(["vendors.create","vendors.store"]),isExporting:h,onExport:A,onAddVendor:()=>m(!0)}),r.jsx($,{children:r.jsxs(L,{className:"p-6",children:[r.jsx(z,{tempFilters:C,cities:p,showCityDropdown:E,onTempFilterChange:x,onCityInputChange:D,onCitySelect:b,onSearchClick:V,onClearFilters:F,setShowCityDropdown:c}),r.jsx(G,{vendors:i.data,hasEditPermissions:v(["vendors.edit","vendors.update"]),hasDeletePermission:f("vendors.destroy"),onEditVendor:I,onDeleteVendor:P}),r.jsx(J,{links:i.links})]})})]})}),r.jsx(H,{cities:p,open:o,onOpenChange:m,onSuccess:O}),r.jsx(B,{cities:p,open:t,onOpenChange:y,vendor:g,onSuccess:k})]})}export{mt as default};
