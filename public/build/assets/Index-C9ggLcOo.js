import{r as c,u as T,j as o,H as R,a as m}from"./app-BBH7zvDr.js";import{A as k}from"./app-layout-Dyrs0MhC.js";import{C as H,a as U,b as M}from"./card-nXNWfAGy.js";import{u as V}from"./usePermissions-9xbEqhTW.js";import B from"./PropertyCreateDrawer-BFovkPLO.js";import Q from"./PropertyEditDrawer-sSRyoLqP.js";import q from"./PropertyPageHeader-DfgwRcaK.js";import z from"./PropertyFilters-Cd0HqieB.js";import G from"./PropertyTable-CHpHSV37.js";import J from"./PropertyEmptyState-CLim43lM.js";import K from"./FlashMessages-CsxRy82v.js";import W from"./PropertyPagination-jXjGVWnl.js";import"./app-B1OP9MFD.js";import"./index-B4JvrASg.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-kQLvnJYc.js";import"./index-CKW8D5J0.js";import"./index-BWJ0fZlj.js";import"./index-df1YLpcl.js";import"./index-wsGo_tiU.js";import"./index-LvlgiWdi.js";import"./index-D7NAAONM.js";import"./x-CW_SbUiO.js";import"./createLucideIcon-7kSuh4z9.js";import"./index-Dc_FVRD7.js";import"./index-CnOa-MOf.js";import"./index-5ce13En_.js";import"./index-D69JG4aD.js";import"./collapsible-BKCek11j.js";import"./chevron-right-pfan_4Jt.js";import"./index-Uin3X5ek.js";import"./log-out-BzPI9mBJ.js";import"./chevrons-up-down-CfF2yZbR.js";import"./app-logo-icon-CAoiBjM8.js";import"./house-TZOfA7LO.js";import"./building-DsEtYnfD.js";import"./users-BLlpWDgX.js";import"./wrench-CT0OfqLx.js";import"./credit-card-CH7bmEPL.js";import"./dollar-sign-BHC8XRqH.js";import"./file-text-BtoeH6mv.js";import"./triangle-alert-BiELoiYx.js";import"./bell-BaWZy_Rc.js";import"./drawer-vn5In2pd.js";import"./CitySelectionSection-B58GKDSw.js";import"./label-DwnzeD4h.js";import"./popover-BEQRNvy0.js";import"./command-BsAkKql8.js";import"./search-Bh1y_imo.js";import"./map-pin-D1id6YWL.js";import"./check-Xlj0_DVN.js";import"./PropertySelectionSection-CUfKyXXC.js";import"./alert-B5G5vRlE.js";import"./building-2-Xawr6Web.js";import"./circle-alert-CIAs1HED.js";import"./InsuranceCompanySection-DHj7s-yA.js";import"./input-BCr8ZI70.js";import"./shield-COjS6_jx.js";import"./AmountPolicySection-C8_nHH3Q.js";import"./DatesSection-DFxsGCr3.js";import"./calendar-BfOPHJgp.js";import"./NotesSection-BYaOTCw6.js";import"./textarea-CZoZ6jFB.js";import"./InsuranceCompanyField-DnR_ctNr.js";import"./AmountPolicyFields-EyIwJVxq.js";import"./DateFields-Dj3c_9VH.js";import"./NotesField-CAjfki8r.js";import"./download-BISvIJJV.js";import"./plus-Dr8pi5nE.js";import"./table-D8H1Mca3.js";import"./PropertyTableRow-jegb2cym.js";import"./PropertyStatusBadge-CumfUBpp.js";import"./badge-_xk2rKPu.js";import"./PropertyDaysLeftBadge-79NBWBMO.js";import"./eye-Be7dMFsT.js";import"./square-pen-ByTUf2-8.js";import"./trash-2-Dnt6KKQ0.js";import"./pagination-BTJsyy76.js";import"./chevron-left-BaC6T1ID.js";import"./select-IIwc6umI.js";import"./index-SVWUaHiW.js";import"./chevron-down-DZk5AEb3.js";import"./chevron-up-eAQBr70u.js";const X=(t,l="properties.csv")=>{const d=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],u=i=>{const h=new Date,x=new Date(i).getTime()-h.getTime();return Math.ceil(x/(1e3*60*60*24))},f=[d.join(","),...t.map(i=>[i.id,`"${i.property?.property_name||"N/A"}"`,`"${i.insurance_company_name}"`,`"${i.formatted_amount}"`,`"${i.effective_date}"`,`"${i.policy_number}"`,`"${i.expiration_date}"`,u(i.expiration_date),`"${i.status}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),r=URL.createObjectURL(g);p.setAttribute("href",r),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r)};function vt({properties:t,filters:l,cities:d=[],availableProperties:u=[]}){const{hasPermission:f,hasAnyPermission:g,hasAllPermissions:p}=V(),[r,i]=c.useState(l),[h,y]=c.useState(!1),[x,_]=c.useState(!1),[b,S]=c.useState(!1),[D,w]=c.useState(null),{flash:j}=T().props,n=l?.per_page??t.per_page,P=()=>{const e={};return t.current_page&&t.current_page>1&&(e.page=t.current_page.toString()),n&&(e.per_page=n.toString()),Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),e},E=()=>{const e={};return r.property_name&&(e.filter_property_name=String(r.property_name)),r.insurance_company_name&&(e.filter_insurance_company_name=String(r.insurance_company_name)),r.policy_number&&(e.filter_policy_number=String(r.policy_number)),typeof r.status<"u"&&r.status!==null&&(e.filter_status=String(r.status)),n&&(e.filter_per_page=String(n)),t.current_page&&t.current_page>1&&(e.filter_page=String(t.current_page)),e},C=(e,a)=>{const s={...r,[e]:a};i(s)},v=()=>{const e={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),n&&(e.per_page=n.toString()),m.get(route("properties-info.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{i({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};n&&(a.per_page=n.toString()),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},F=e=>{confirm("Are you sure you want to delete this property?")&&m.delete(route("properties-info.destroy",e.id),{data:E(),preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}y(!0);try{const e=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;X(t.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{y(!1)}},I=()=>{S(!1),m.get(route("properties-info.index"),P(),{preserveState:!0,preserveScroll:!0})},N=e=>{w(e),S(!0)},$=e=>{const a=P();delete a.page,a.per_page=e.toString(),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=e=>{const a=P();m.get(route("properties-info.show",e.id),a,{preserveState:!1})};return o.jsxs(k,{children:[o.jsx(R,{title:"Properties Insurance"}),o.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:o.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o.jsx(K,{success:j?.success,error:j?.error}),o.jsx(q,{onExport:O,onAddProperty:()=>_(!0),isExporting:h,hasExportData:t.data.length>0,canCreate:p(["properties.create","properties.store"])}),o.jsxs(H,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(U,{children:o.jsx(z,{filters:r,onFilterChange:C,onSearch:v,onClear:A})}),o.jsxs(M,{children:[o.jsx(G,{properties:t.data,onEdit:N,onDelete:F,onShow:L,canEdit:p(["properties.update","properties.edit"]),canDelete:f("properties.destroy"),canShow:f("properties.show"),hasAnyActionPermission:g(["properties.destroy","properties.update","properties.edit","properties.show"])}),t.data.length===0&&o.jsx(J,{}),t.data.length>0&&o.jsx(W,{paginatedData:t,currentPerPage:n||15,onPerPageChange:$})]})]})]})}),o.jsx(B,{open:x,onOpenChange:_,cities:d,availableProperties:u,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15}),D&&o.jsx(Q,{open:b,onOpenChange:S,property:D,availableProperties:u,onSuccess:I,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15,cities:d})]})}export{vt as default};
