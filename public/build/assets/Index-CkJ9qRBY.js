import{r as o,j as e,H as ie,L as le,a as C}from"./app-DVDXdM1j.js";import{B as h}from"./badge-DTS1K3_X.js";import{B as p}from"./createLucideIcon-f9blZpYt.js";import{C as ce,a as me,b as ue}from"./card-Bwe2NU3A.js";import{I as L}from"./input-CAZvlv5n.js";import{P as xe,T as pe,a as be,b as Y,c as i,d as fe,e as l,f as he}from"./table-0dU4KNKP.js";import{u as ge,A as je}from"./app-layout-BgOFzUm7.js";import Ne from"./PaymentCreateDrawer-CDEyCZik.js";import ve from"./PaymentEditDrawer-Cocwa1F1.js";import{D as we}from"./download-wHB0yVVw.js";import{C as O}from"./chevron-up-BWfV-rK5.js";import{S as ye}from"./search-Cj-1Tgsr.js";import{E as Se}from"./eye-CmmvMCNK.js";import{S as Ce}from"./square-pen-Gduccuzo.js";import{f as ke}from"./format-PYUiRpxY.js";import"./app-CjmCCaLt.js";import"./index-u4YCQuA6.js";import"./index-CgivZZgh.js";import"./index-DdPbNFmK.js";import"./index-B6MCHojI.js";import"./index-r4aKh8Jv.js";import"./index-Bh7wV6bP.js";import"./index-CgpEdb5b.js";import"./collapsible-C9LSRdIZ.js";import"./chevron-right-Jq5zNY5a.js";import"./log-out-CclgnUl6.js";import"./app-logo-icon-BKweUuHy.js";import"./house-AQu3AgIJ.js";import"./building-BHVhuuix.js";import"./users-BcbQvnsY.js";import"./wrench-DEIL3bF0.js";import"./credit-card-DCM1AG9P.js";import"./dollar-sign-BHdix2xf.js";import"./file-text-BqsQ4w8u.js";import"./triangle-alert-D9ulod1h.js";import"./bell-BaW5Lw9J.js";import"./popover-GGagVvOt.js";import"./drawer-xioPoqbP.js";import"./label-Bq1y09-X.js";import"./radioGroup-Cj9qUiCJ.js";import"./index-DWj7wjkv.js";import"./select-TGrDkT3T.js";import"./calendar-UWhjVqRM.js";const M=(s,u="-")=>{if(!s)return u;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return u;const[,d,b,g]=n,f=new Date(Number(d),Number(b)-1,Number(g));return ke(f,"P")},Pe=(s,u="payments.csv")=>{try{const n=t=>t==null||isNaN(t)?"0.00":Number(t).toFixed(2),d=t=>t==null?"":String(t).replace(/"/g,'""'),b=t=>{if(!t)return"";try{return M(t,"")}catch{return t||""}},f=[["ID","Date","City","Property Name","Unit Name","Owes","Paid","Left to Pay","Status","Notes","Reversed Payments","Permanent"].join(","),...s.map(t=>{try{return[t.id||"",`"${b(t.date)}"`,`"${d(t.city)}"`,`"${d(t.property_name)}"`,`"${d(t.unit_name)}"`,n(t.owes),n(t.paid),n(t.left_to_pay),`"${d(t.status)}"`,`"${d(t.notes)}"`,`"${d(t.reversed_payments)}"`,`"${d(t.permanent)}"`].join(",")}catch(N){return console.error("Error processing payment row:",t,N),""}}).filter(t=>t!=="")].join(`
`),j=new Blob([f],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),y=URL.createObjectURL(j);return x.setAttribute("href",y),x.setAttribute("download",u),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(y),!0}catch(n){throw console.error("CSV Export Error:",n),n}};function hr({payments:s,filters:u,units:n,cities:d,properties:b,unitsByCity:g,unitsByProperty:f,propertiesByCity:j,allCities:x,allProperties:y}){const{hasPermission:t,hasAnyPermission:N,hasAllPermissions:T}=ge(),[$,I]=o.useState(!1),[G,H]=o.useState(!1),[J,B]=o.useState(!1),[V,K]=o.useState(null),[c,k]=o.useState(u?.city||""),[m,S]=o.useState(u?.property||""),[v,w]=o.useState(u?.unit||""),[Q,P]=o.useState(!1),[W,D]=o.useState(!1),[X,E]=o.useState(!1),F=o.useRef(null),U=o.useRef(null),z=o.useRef(null),q=x||[],Z=y||[],R=()=>{let r=n;return c&&(r=r.filter(a=>a.city===c)),m&&(r=r.filter(a=>a.property_name===m)),[...new Set(r.map(a=>a.unit_name))].sort()},_=()=>c?j[c]||[]:Z;o.useEffect(()=>{const r=a=>{F.current&&!F.current.contains(a.target)&&P(!1),U.current&&!U.current.contains(a.target)&&D(!1),z.current&&!z.current.contains(a.target)&&E(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),o.useEffect(()=>{c&&m&&(_().includes(m)||(S(""),w("")))},[c]),o.useEffect(()=>{m&&v&&(R().includes(v)||w(""))},[c,m]);const ee=r=>{r.preventDefault();const a={};c&&(a.city=c),m&&(a.property=m),v&&(a.unit=v),C.get(route("payments.index"),a,{preserveState:!0,preserveScroll:!0})},re=()=>{k(""),S(""),w(""),C.get(route("payments.index"),{},{preserveState:!0,preserveScroll:!0})},te=r=>{confirm("Are you sure you want to delete this payment?")&&C.delete(route("payments.destroy",r.id))},se=r=>{K(r),B(!0)},oe=()=>{C.reload()},ae=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}I(!0);try{console.log("Exporting payments data:",s.data);const r=`payments-${new Date().toISOString().split("T")[0]}.csv`;Pe(s.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}. Please check the console for details.`)}finally{I(!1)}},A=r=>r==null||isNaN(r)?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),ne=r=>r?r.toLowerCase().includes("paid")?e.jsx(h,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:r}):r.toLowerCase().includes("pending")?e.jsx(h,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:r}):e.jsx(h,{variant:"outline",children:r}):e.jsx(h,{variant:"outline",children:"N/A"}),de=r=>r?e.jsx(h,{variant:r==="Yes"?"default":"secondary",className:r==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:r}):e.jsx(h,{variant:"outline",children:"N/A"});return e.jsxs(je,{children:[e.jsx(ie,{title:"Payments"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Payments Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:ae,disabled:$||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),$?"Exporting...":"Export CSV"]}),T(["payments.create","payments.store"])&&e.jsxs(p,{onClick:()=>H(!0),className:"bg-primary text-background",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Add Payment"]})]})]}),e.jsxs(ce,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(me,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-5",children:[e.jsxs("div",{className:"relative",ref:F,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by city...",value:c,onChange:r=>k(r.target.value),onFocus:()=>P(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),Q&&q.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:q.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{k(r),P(!1)},children:r},r))})]}),e.jsxs("div",{className:"relative",ref:U,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by property...",value:m,onChange:r=>S(r.target.value),onFocus:()=>D(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),W&&_().length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:_().map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{S(r),D(!1)},children:r},r))})]}),e.jsxs("div",{className:"relative",ref:z,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by unit...",value:v,onChange:r=>w(r.target.value),onFocus:()=>E(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),X&&R().length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:R().map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{w(r),E(!1)},children:r},r))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:ee,variant:"default",className:"flex-1",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsx(p,{onClick:re,variant:"outline",size:"sm",className:"whitespace-nowrap",children:"Clear"})]})]})}),e.jsxs(ue,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(pe,{className:"border-collapse rounded-md border border-border",children:[e.jsx(be,{children:e.jsxs(Y,{className:"border-border",children:[e.jsx(i,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(i,{className:"sticky left-[120px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(i,{className:"sticky left-[240px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Date"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Owes"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Paid"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Left to Pay"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Note"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Reversed Payments"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Permanent"}),N(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(fe,{children:s.data.map(r=>e.jsxs(Y,{className:"border-border hover:bg-muted/50",children:[e.jsx(l,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.city}),e.jsx(l,{className:"sticky left-[120px] z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.property_name||"N/A"}),e.jsx(l,{className:"sticky left-[240px] z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.unit_name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:M(r.date)}),e.jsx(l,{className:"border border-border text-center font-medium text-red-600 dark:text-red-400",children:A(r.owes)}),e.jsx(l,{className:"border border-border text-center text-green-600 dark:text-green-400",children:A(r.paid)}),e.jsx(l,{className:"border border-border text-center font-medium text-blue-600 dark:text-blue-400",children:A(r.left_to_pay)}),e.jsx(l,{className:"border border-border text-center",children:ne(r.status)}),e.jsx(l,{className:"border border-border text-center text-foreground max-w-32 truncate",children:r.notes}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.reversed_payments}),e.jsx(l,{className:"border border-border text-center",children:de(r.permanent)}),N(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[t("payments.show")&&e.jsx(le,{href:route("payments.show",r.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(Se,{className:"h-4 w-4"})})}),T(["payments.edit","payments.update"])&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>se(r),children:e.jsx(Ce,{className:"h-4 w-4"})}),t("payments.destroy")&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(he,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No payments found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})]})}),e.jsx(Ne,{open:G,onOpenChange:H,units:n,cities:d,properties:b,unitsByCity:g,unitsByProperty:f,propertiesByCity:j}),V&&e.jsx(ve,{payment:V,units:n,cities:d,properties:b,unitsByCity:g,unitsByProperty:f,propertiesByCity:j,open:J,onOpenChange:B,onSuccess:oe})]})}export{hr as default};
