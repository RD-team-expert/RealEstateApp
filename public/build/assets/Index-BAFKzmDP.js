import{r as p,j as i,H as O,a as u}from"./app-DYme-6ST.js";import{C as P,b as k}from"./card-CWWVdt52.js";import{u as N}from"./usePermissions-Bu-R0dRn.js";import{A as L}from"./app-layout-H-O_MzQ8.js";import U from"./MoveInCreateDrawer-D2LiIbud.js";import T from"./MoveInEditDrawer-Bzr9wSkj.js";import R from"./PageHeader-CHhhBkgO.js";import H from"./MoveInFilters-Bv3aP3pz.js";import V from"./MoveInTable-CIk-pGBI.js";import K from"./EmptyState-BRbLsY7O.js";import Z from"./PaginationInfo-Duru8No0.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./button-DygVteL_.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CityPropertyUnitSelector-dFJcFAmK.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./LeaseInformationFields-CJpT2Onf.js";import"./radioGroup-F0AlgpLY.js";import"./DatePickerField-D-BhRJQW.js";import"./calendar-BWK2M4JP.js";import"./format-PYUiRpxY.js";import"./chevron-left-C0SnhLPd.js";import"./popover-iS5_0AtM.js";import"./calendar-Bw6k_ssZ.js";import"./PaymentInformationFields-C-5pV1V6.js";import"./KeysAndFormsFields-FGX1tMAR.js";import"./InsuranceInformationFields-CLEVwOBg.js";import"./CitySelector-2ZkxNQqZ.js";import"./FormSection-BavvcaHY.js";import"./PropertySelector-H9qZ97bC.js";import"./UnitSelector-D-0rim7Y.js";import"./LeaseSigningSection-BDb8yZoZ.js";import"./RadioGroupField-Cv50Sifa.js";import"./DatePickerField-CPDOvHfF.js";import"./MoveInDetailsSection-BpRqj-zE.js";import"./PaymentSection-D9HFd8RQ.js";import"./KeysAndFormsSection-DdeskiYs.js";import"./InsuranceSection-DFTzoB5M.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";import"./input-pR7fOcUW.js";import"./search-1yu5M8Yr.js";import"./table-NBJhLnC1.js";import"./MoveInTableRow-CqU8ARWM.js";import"./badge-DkU7s25L.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";const q=(o,c="move-ins.csv")=>{try{const e=t=>{if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(s)}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),d=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...o.map(t=>{try{return[t.id||"",`"${a(t.city_name)}"`,`"${a(t.property_name)}"`,`"${a(t.unit_name)}"`,`"${a(t.signed_lease)}"`,`"${e(t.lease_signing_date)}"`,`"${e(t.move_in_date)}"`,`"${a(t.paid_security_deposit_first_month_rent)}"`,`"${e(t.scheduled_paid_time)}"`,`"${a(t.handled_keys)}"`,`"${e(t.move_in_form_sent_date)}"`,`"${a(t.filled_move_in_form)}"`,`"${e(t.date_of_move_in_form_filled)}"`,`"${a(t.submitted_insurance)}"`,`"${e(t.date_of_insurance_expiration)}"`].join(",")}catch(s){return console.error("Error processing move-in row:",t,s),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([d],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(f);return n.setAttribute("href",l),n.setAttribute("download",c),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Sr({moveIns:o,search:c,filters:e,units:a,cities:h,properties:d,unitsByProperty:f}){const[n,l]=p.useState(!1),[t,s]=p.useState(!1),[v,S]=p.useState(!1),[E,D]=p.useState(null),[y,g]=p.useState({city:e?.city||"",property:e?.property||"",search:e?.search||c||""});p.useEffect(()=>{g({city:e?.city||"",property:e?.property||"",search:e?.search||c||""})},[e,c]);const{hasPermission:_,hasAnyPermission:j}=N(),C=r=>{g(r);const m={};r.search?.trim()&&(m.search=r.search.trim()),r.city?.trim()&&(m.city=r.city.trim()),r.property?.trim()&&(m.property=r.property.trim()),u.get(route("move-in.index"),m,{preserveState:!0,preserveScroll:!0})},b=()=>{g({city:"",property:"",search:""}),u.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},w=r=>{confirm("Are you sure you want to delete this move-in record?")&&u.delete(route("move-in.destroy",r.id))},$=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}l(!0);try{console.log("Exporting move-in data:",o.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;q(o.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const m=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${m}. Please check the console for details.`)}finally{l(!1)}},M=()=>{u.reload()},A=()=>{u.reload()},F=r=>{D(r),S(!0)},x=y.search||y.city||y.property;return i.jsxs(L,{children:[i.jsx(O,{title:"Move-In Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(R,{hasActiveFilters:!!x,isExporting:n,hasData:o?.data&&o.data.length>0,hasCreatePermission:_("move-in.store"),onExport:$,onCreateClick:()=>s(!0)}),i.jsxs(P,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(H,{cities:h,properties:d,initialFilters:y,onSearch:C,onClear:b,hasActiveFilters:!!x}),i.jsxs(k,{children:[i.jsx(V,{moveIns:o.data,canEdit:_("move-in.update"),canDelete:_("move-in.destroy"),showActions:j(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:F,onDelete:w}),o.data.length===0&&i.jsx(K,{hasActiveFilters:!!x}),o.meta&&i.jsx(Z,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})]})]})}),i.jsx(U,{units:a,cities:h,properties:d,unitsByProperty:f,open:t,onOpenChange:s,onSuccess:M}),E&&i.jsx(T,{moveIn:E,units:a,cities:h,properties:d,unitsByProperty:f,open:v,onOpenChange:S,onSuccess:A})]})}export{Sr as default};
