import{r as a,u as R,b as V,a as u,j as e,H as q}from"./app-DYme-6ST.js";import{C as B,a as z,b as G}from"./card-CWWVdt52.js";import{u as J}from"./usePermissions-Bu-R0dRn.js";import{A as K}from"./app-layout-H-O_MzQ8.js";import Q from"./TenantCreateDrawer-C4HDygTH.js";import W from"./TenantEditDrawer-B_c-0D4y.js";import{FlashMessages as X}from"./FlashMessages-DboT75tr.js";import{ImportModal as Y}from"./ImportModal-DdCOwaV4.js";import{ImportStatsCard as Z}from"./ImportStatsCard-BzRuws_E.js";import{Notification as ee}from"./Notification-eSqWLj71.js";import{TenantFilters as te}from"./TenantFilters-9op3LcR_.js";import{TenantPageHeader as re}from"./TenantPageHeader-DJdi64l2.js";import{TenantTable as oe}from"./TenantTable-BYYofsCE.js";import{useNotification as se}from"./useNotification-B3k60zwM.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./button-DygVteL_.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CitySelectionSection-C3mKorpR.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./PropertySelectionSection-BoVucEUl.js";import"./UnitSelectionSection-DTHNKhaD.js";import"./PersonalInformationSection-DE5pcjUQ.js";import"./FormField-C-SSowaa.js";import"./input-pR7fOcUW.js";import"./ContactInformationSection-C9XeiX-S.js";import"./PaymentAndPreferencesSection-C22mSFkS.js";import"./RadioGroupField-CaKOoYcy.js";import"./radioGroup-F0AlgpLY.js";import"./AssistanceSection-uBnPw2Bq.js";import"./LocationSection-BqQZZ_7s.js";import"./PersonalInfoSection-DR7XDhLe.js";import"./ContactInfoSection-CS5Esfld.js";import"./PreferencesSection-R3UjdGCk.js";import"./AssistanceSection-BNEyYsV6.js";import"./file-spreadsheet-CoM_uR0w.js";import"./upload-CTxlt19N.js";import"./loader-circle-CI1dGh9D.js";import"./circle-check-big-cvblO7g-.js";import"./circle-alert-jsi0zk16.js";import"./circle-x-Cg5j1MdR.js";import"./search-1yu5M8Yr.js";import"./rotate-ccw-DyqJ29_i.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";import"./badge-DkU7s25L.js";import"./table-NBJhLnC1.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";const ie=(o,n="tenants.csv")=>{const m=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...o.map(t=>[t.id,`"${t.city_name||""}"`,`"${t.property_name||""}"`,`"${t.unit_number||""}"`,`"${t.first_name||""}"`,`"${t.last_name||""}"`,`"${(t.street_address_line||"").replace(/"/g,'""')}"`,`"${t.login_email||""}"`,`"${t.alternate_email||""}"`,`"${t.mobile||""}"`,`"${t.emergency_phone||""}"`,`"${t.cash_or_check||""}"`,`"${t.has_insurance||""}"`,`"${t.sensitive_communication||""}"`,`"${t.has_assistance||""}"`,`"${t.assistance_amount||""}"`,`"${(t.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),d=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),c=URL.createObjectURL(d);s.setAttribute("href",c),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};function Lt({tenants:o,search:n,cities:l,properties:m,unitsByProperty:d,importStats:s}){const{hasPermission:c,hasAnyPermission:t,hasAllPermissions:g}=J(),[E,y]=a.useState(!1),[N,h]=a.useState(!1),[v,$]=a.useState(!!s),[A,S]=a.useState(!1),[T,j]=a.useState(!1),[b,f]=a.useState(null),{flash:w}=R().props,{notification:x,showNotification:i,hideNotification:D}=se(),p=V({file:null,skip_duplicates:!1}),I=r=>{u.get(route("tenants.index"),{search:r.search,city:r.city,property:r.property,unit_name:r.unitName},{preserveState:!0})},F=()=>{u.get(route("tenants.index"),{},{preserveState:!1,replace:!0})},P=r=>{confirm(`Are you sure you want to archive ${r.first_name} ${r.last_name}? This will hide them from the main list but they can be restored later.`)&&u.patch(route("tenants.archive",r.id),{},{onSuccess:()=>{i("success","Tenant archived successfully!")},onError:()=>{i("error","Failed to archive tenant. Please try again.")}})},k=r=>{f(r),j(!0)},L=()=>{i("success","Tenant updated successfully!"),f(null)},M=()=>{if(o.length===0){alert("No data to export");return}y(!0);try{const r=`tenants-${new Date().toISOString().split("T")[0]}.csv`;ie(o,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},H=a.useCallback((r,C)=>{p.setData({file:r,skip_duplicates:C}),u.post(route("tenants.import.process"),{file:r,skip_duplicates:C},{forceFormData:!0,onSuccess:()=>{h(!1),p.reset(),i("success","CSV file imported successfully!")},onError:_=>{const U=_.file||_.import||"Failed to import CSV file. Please try again.";i("error",U)},onFinish:()=>{p.clearErrors()}})},[p,i]),O=Array.from(new Set(o.map(r=>r.unit_number).filter(Boolean)));return e.jsxs(K,{children:[e.jsx(q,{title:"Tenants"}),x&&e.jsx(ee,{type:x.type,message:x.message,onClose:D}),e.jsx(Y,{isOpen:N,onClose:()=>h(!1),onSubmit:H,isLoading:p.processing}),e.jsx(Q,{open:A,onOpenChange:()=>S(!1),cities:l,properties:m,unitsByProperty:d,onSuccess:()=>i("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(X,{success:w?.success,error:w?.error}),v&&s&&e.jsx(Z,{stats:s,onClose:()=>$(!1)}),e.jsx(re,{onExport:M,onImport:()=>h(!0),onAddNew:()=>S(!0),isExporting:E,hasExportData:o.length>0,canImport:c("tenants.import"),canCreate:g(["tenants.create","tenants.store"])}),e.jsxs(B,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(te,{cities:l,properties:m,uniqueUnitNames:O,onSearch:I,onClear:F,initialFilters:{city:"",property:"",unitName:"",search:n||""}})}),e.jsxs(G,{className:"p-6",children:[e.jsx(oe,{tenants:o,onEdit:k,onDelete:P,canEdit:g(["tenants.edit","tenants.update"]),canDelete:c("tenants.destroy"),showActions:t(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),o.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length," tenant",o.length!==1?"s":"",n&&` matching "${n}"`]})})]})]})]})}),b&&e.jsx(W,{open:T,onOpenChange:()=>{j(!1),f(null)},tenant:b,cities:l,properties:m,unitsByProperty:d,onSuccess:L})]})}export{Lt as default};
