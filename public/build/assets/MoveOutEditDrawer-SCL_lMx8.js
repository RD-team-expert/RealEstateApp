import{r as a,b as H,j as r}from"./app-ouZqxB1_.js";import{D as I,a as J,b as K}from"./drawer-By3Utn4a.js";import{B as F}from"./button-Dwk07ddD.js";import{LocationSelectionFields as Q}from"./LocationSelectionFields-pKSyP-Io.js";import{MoveOutDateFields as W}from"./MoveOutDateFields-BGjAQPzv.js";import{MoveOutDetailsFields as X}from"./MoveOutDetailsFields-GnA5p89p.js";import{MoveOutStatusFields as Y}from"./MoveOutStatusFields-PkVofF-S.js";import"./app-CsCti_B1.js";import"./index-D_5cRLds.js";import"./index-ChCgVrQ9.js";import"./index-CBrQgTKF.js";import"./index-DZ6Q_eM6.js";import"./index-B409lPMy.js";import"./index-Cw-58lmC.js";import"./index-L_KZmfdx.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-C6lwu6z7.js";import"./createLucideIcon-D2D4_K7R.js";import"./label-DuRYAP1m.js";import"./input-Be-glciT.js";import"./select-CiYdqFJh.js";import"./index-Dc_FVRD7.js";import"./index-XAL2DKQ_.js";import"./index-BMcOUver.js";import"./index-D8RbbIhn.js";import"./index-DfGrYlP0.js";import"./chevron-down-DJ1Ff5Fx.js";import"./check-Ef_HP5Pc.js";import"./chevron-up-BPU5s7__.js";import"./calendar-CiekVgOK.js";import"./format-PYUiRpxY.js";import"./chevron-left-B6urspn_.js";import"./chevron-right-DK0aPss0.js";import"./popover-HByMxBFn.js";import"./calendar-Bep_gocc.js";import"./radioGroup-CiiMMFfa.js";import"./textarea-DhBPhXm2.js";function Pt({cities:c,properties:g,propertiesByCityId:l,unitsByPropertyId:u,allUnits:d,moveOut:t,open:M,onOpenChange:C,onSuccess:P}){const p=a.useRef(null),f=a.useRef(null),m=a.useRef(null),[U,o]=a.useState({city:"",property:"",unit:""}),[w,S]=a.useState(null),[D,x]=a.useState(null),[E,h]=a.useState(null),[V,j]=a.useState([]),[z,y]=a.useState([]),{data:_,setData:s,put:L,processing:N,errors:b}=H({unit_id:t.unit_id||null,tenants:t.tenants||"",move_out_date:t.move_out_date||"",lease_status:t.lease_status||"",date_lease_ending_on_buildium:t.date_lease_ending_on_buildium||"",keys_location:t.keys_location||"",utilities_under_our_name:t.utilities_under_our_name||"",date_utility_put_under_our_name:t.date_utility_put_under_our_name||"",walkthrough:t.walkthrough||"",repairs:t.repairs||"",send_back_security_deposit:t.send_back_security_deposit||"",notes:t.notes||"",cleaning:t.cleaning||"",list_the_unit:t.list_the_unit||"",move_out_form:t.move_out_form||"",utility_type:t.utility_type||""});a.useEffect(()=>{if(t&&d&&Array.isArray(d)&&Array.isArray(c)&&Array.isArray(g)){const n=d.find(e=>e.unit_name===t.unit_name);if(n){const e=c.find(k=>k.city===t.city_name),i=g.find(k=>k.property_name===t.property_name);e&&(S(e.id),l&&l[e.id]&&j(l[e.id])),i&&(x(i.id),u&&u[i.id]&&y(u[i.id])),h(n.id),s("unit_id",n.id)}}},[t,d,c,g,l,u]);const T=n=>{const e=parseInt(n);S(e),x(null),h(null),s("unit_id",null),o(i=>({...i,city:"",property:"",unit:""})),e&&l[e]?j(l[e]):j([]),y([])},q=n=>{const e=parseInt(n);x(e),h(null),s("unit_id",null),o(i=>({...i,property:"",unit:""})),e&&u[e]?y(u[e]):y([])},G=n=>{const e=parseInt(n);h(e),s("unit_id",e),o(i=>({...i,unit:""}))},R=n=>{n.preventDefault(),o({city:"",property:"",unit:""});let e=!1;w||(o(i=>({...i,city:"Please select a city before submitting the form."})),p.current&&(p.current.focus(),p.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),D||(o(i=>({...i,property:"Please select a property before submitting the form."})),f.current&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!E||!_.unit_id)&&(o(i=>({...i,unit:"Please select a unit before submitting the form."})),m.current&&(m.current.focus(),m.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),!e&&L(route("move-out.update",t.id),{onSuccess:()=>{A(),P?.()}})},A=()=>{s({unit_id:t.unit_id||null,tenants:t.tenants||"",move_out_date:t.move_out_date||"",lease_status:t.lease_status||"",date_lease_ending_on_buildium:t.date_lease_ending_on_buildium||"",keys_location:t.keys_location||"",utilities_under_our_name:t.utilities_under_our_name||"",date_utility_put_under_our_name:t.date_utility_put_under_our_name||"",walkthrough:t.walkthrough||"",repairs:t.repairs||"",send_back_security_deposit:t.send_back_security_deposit||"",notes:t.notes||"",cleaning:t.cleaning||"",list_the_unit:t.list_the_unit||"",move_out_form:t.move_out_form||"",utility_type:t.utility_type||""}),o({city:"",property:"",unit:""}),C(!1)};return r.jsx(I,{open:M,onOpenChange:C,modal:!1,children:r.jsx(J,{size:"half",title:"Edit Move-Out Record",children:r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"flex-1 overflow-auto p-6",children:r.jsxs("form",{onSubmit:R,className:"space-y-4",children:[r.jsx(Q,{cities:c,availableProperties:V,availableUnits:z,selectedCity:w,selectedProperty:D,selectedUnit:E,validationErrors:U,cityRef:p,propertyRef:f,unitRef:m,onCityChange:T,onPropertyChange:q,onUnitChange:G,tenants:_.tenants,tenantsError:b.tenants,onTenantsChange:n=>s("tenants",n)}),r.jsx(W,{data:_,errors:b,onDataChange:s}),r.jsx(X,{data:_,errors:b,onDataChange:s}),r.jsx(Y,{data:_,errors:b,onDataChange:s})]})}),r.jsx(K,{children:r.jsxs("div",{className:"flex gap-2 w-full",children:[r.jsx(F,{type:"button",variant:"outline",onClick:A,className:"flex-1",children:"Cancel"}),r.jsx(F,{type:"submit",onClick:R,disabled:N,className:"flex-1",children:N?"Updating...":"Update Move-Out Record"})]})})]})})})}export{Pt as default};
