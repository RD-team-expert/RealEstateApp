import{r as x,j as e,H as L,a as g}from"./app-B8FMPvUf.js";import{C as R,a as F,b as H}from"./card-EXxUjTX3.js";import{u as q}from"./usePermissions-DDZJFyXm.js";import{A as z}from"./app-layout-HHYyJByv.js";import G from"./EmptyState-Bll0p_T-.js";import J from"./FilterBar-Cnz_xWKn.js";import K from"./PageHeader-Edii79Yh.js";import M from"./PaginationInfo-DA4oabG3.js";import Q from"./TaskTable-CI0HDtcz.js";import W from"./VendorTaskTrackerCreateDrawer-Df4-m5j4.js";import X from"./VendorTaskTrackerEditDrawer-CMuc_Na1.js";import{f as Y}from"./format-PYUiRpxY.js";import"./app-BrEbHAEe.js";import"./utils-CBfrqCZ4.js";import"./index-C_zQ9kkn.js";import"./index-CdJFUDDL.js";import"./button-DIZZiQM7.js";import"./index-fZywndxp.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./input-DGLwPUn8.js";import"./chevron-down-C7VOkDBv.js";import"./search-CLz9Z_Gu.js";import"./download-v-3Aavkk.js";import"./plus-C7KcOOhZ.js";import"./table-CzYBox4s.js";import"./TaskTableRow-BmI8P6SZ.js";import"./badge-BGMBzjbn.js";import"./eye-DzrUIE3a.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";import"./drawer-By-qy253.js";import"./CitySection-BeC9amuj.js";import"./label-mSIjHkAE.js";import"./popover-BMQC-RgO.js";import"./command-Byz7UfAg.js";import"./check-BVaiT64F.js";import"./PropertySection-CCXXCWay.js";import"./UnitSection-B5Yx5bVR.js";import"./VendorSection-CAM8BLlr.js";import"./TaskSubmissionDateSection-aSDhAU5z.js";import"./calendar-CzDWs5lf.js";import"./chevron-left-nbVEm8OA.js";import"./calendar-DesMu7qT.js";import"./ScheduledVisitsSection-8XM7pAn7.js";import"./TaskEndingDateSection-B7fyCNay.js";import"./AssignedTasksSection-CFy7tkkR.js";import"./NotesSection-wH5PEr24.js";import"./StatusSection-BEE9xDtJ.js";import"./radioGroup-CuIQOkQ9.js";import"./index-BlkGWg27.js";import"./UrgencySection-DP7lVbb7.js";import"./CitySelector-Bpre0i_T.js";import"./FormSection-BvGEjKLt.js";import"./PropertySelector-DXQP2hzE.js";import"./UnitSelector-B1Mr6zta.js";import"./VendorSelector-tDitV4t5.js";import"./DatePickerField-d2GhEUN5.js";import"./TextAreaField-TVB7i0Kp.js";import"./StatusRadioGroup-X5HEnrpC.js";import"./UrgencyRadioGroup-CKpZELnD.js";const h=(t,r="-")=>{if(!t)return r;const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!c)return r;const[,d,l,m]=c,u=new Date(Number(d),Number(l)-1,Number(m));return Y(u,"P")},Z=(t,r="vendor-tasks.csv")=>{const d=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(n=>[n.id,`"${n.city||""}"`,`"${n.property_name||""}"`,`"${n.unit_name||""}"`,`"${n.vendor_name||""}"`,`"${h(n.task_submission_date,"")}"`,`"${(n.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(n.any_scheduled_visits,"")}"`,`"${h(n.task_ending_date,"")}"`,`"${(n.notes||"").replace(/"/g,'""')}"`,`"${n.status||""}"`,`"${n.urgent}"`].join(","))].join(`
`),l=new Blob([d],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),u=URL.createObjectURL(l);m.setAttribute("href",u),m.setAttribute("download",r),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)};function Tr({tasks:t,filters:r,units:c,cities:d,properties:l,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,vendors:b}){const{hasPermission:v,hasAnyPermission:y,hasAllPermissions:k}=q(),[w,_]=x.useState(!1),[D,f]=x.useState(!1),[C,j]=x.useState(!1),[E,N]=x.useState(null),T=()=>{f(!1)},O=()=>{j(!1),N(null)},P=o=>{N(o),j(!0)},$=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),g.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},A=()=>{if(t.data.length===0){alert("No data to export");return}_(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Z(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{_(!1)}},V=o=>{const p={};Object.entries(o).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",g.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},I=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",g.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},U={canView:v("vendor-task-tracker.show"),canEdit:k(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:v("vendor-task-tracker.destroy"),hasAnyPermission:y(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(z,{children:[e.jsx(L,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(K,{onExport:A,onAddTask:()=>f(!0),isExporting:w,hasExportData:t.data.length>0,canCreate:k(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(R,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(F,{children:e.jsx(J,{filters:r,cities:d,properties:l,units:c,vendors:b,onSearch:V,onClear:I})}),e.jsx(H,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Q,{tasks:t.data,formatDateOnly:h,onEdit:P,onDelete:$,permissions:U,filters:r}),e.jsx(M,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.per_page=p,a.page="1",g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(G,{})})]})]})}),e.jsx(W,{cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:D,onOpenChange:f,onSuccess:T}),E&&e.jsx(X,{task:E,cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:C,onOpenChange:j,onSuccess:O})]})}export{Tr as default};
