import{r as c,u as N,j as r,H as T,a as p}from"./app-mUrH0ynJ.js";import{A as R}from"./app-layout-CXK9X9au.js";import{C as k,a as H,b as U}from"./card-D_RIkHPn.js";import{u as M}from"./usePermissions-BawB_cjI.js";import V from"./PropertyCreateDrawer-JzgQ88T_.js";import B from"./PropertyEditDrawer-nCiAtWYD.js";import Q from"./PropertyPageHeader-DEa9d2Bg.js";import q from"./PropertyFilters-CgLs-9XX.js";import z from"./PropertyTable-DaVeIBP-.js";import G from"./PropertyEmptyState-BV7zdkAd.js";import J from"./FlashMessages-BIYUCFxz.js";import K from"./PropertyPagination-BGRIhgki.js";import"./app-BxoA0TtB.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-BFBNYzQ-.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./index-Dc_FVRD7.js";import"./index-CXBw7cFo.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./index-I5U3wwZt.js";import"./collapsible-DR70Hr7v.js";import"./chevron-right-o746ehSI.js";import"./index-DK4fbPLM.js";import"./log-out-CXDwqi9T.js";import"./chevrons-up-down-FHN_82j5.js";import"./app-logo-icon-afD3Sqey.js";import"./house-Bx2Ik4FM.js";import"./building-uSWxfBdk.js";import"./users-C2kYwBw2.js";import"./wrench-Cq_dpeQy.js";import"./credit-card-Bcb_2PMm.js";import"./dollar-sign-BB476t67.js";import"./file-text-CjfNfFxM.js";import"./triangle-alert-Dr9RWMLY.js";import"./bell-ch4AgGU_.js";import"./drawer-B7FkQmZP.js";import"./CitySelectionSection-DDcqLDf9.js";import"./label-DmNL2-zA.js";import"./select-NL-VGbzo.js";import"./index-p6YNWFgp.js";import"./chevron-down-CcniYHCH.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./map-pin-ARbkH6Q0.js";import"./PropertySelectionSection-B29gJ6ZU.js";import"./alert-BOgXJt12.js";import"./building-2-BuyWVU5H.js";import"./circle-alert-B4oHAxZv.js";import"./InsuranceCompanySection-BxBIctEl.js";import"./input-Bo52L6_R.js";import"./shield-DtSX21DX.js";import"./AmountPolicySection-B_4igh7P.js";import"./DatesSection-C1jNYhKp.js";import"./calendar-e6qKYHCo.js";import"./NotesSection-DsPqkobY.js";import"./textarea-_9m8vmUo.js";import"./PropertySelectField-DqQDFC3E.js";import"./InsuranceCompanyField-D1fJfZ_M.js";import"./AmountPolicyFields-C_tibIAc.js";import"./DateFields-DI0XHy9v.js";import"./NotesField-CF6wwGqz.js";import"./download-tURfbWWG.js";import"./plus-Vhp6TgB7.js";import"./search-BHqZNlG5.js";import"./table-DpihfFkM.js";import"./PropertyTableRow-BDTjy2-6.js";import"./PropertyStatusBadge-CsmWQKc1.js";import"./badge-CXaZ35ua.js";import"./PropertyDaysLeftBadge-xX3sFNrH.js";import"./eye-sD0tKuKR.js";import"./square-pen-3gz5SX3m.js";import"./trash-2-PUmSVtRb.js";import"./chevron-left-Bx0Sy0a0.js";const W=(e,g="properties.csv")=>{const f=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],l=o=>{const x=new Date,y=new Date(o).getTime()-x.getTime();return Math.ceil(y/(1e3*60*60*24))},d=[f.join(","),...e.map(o=>[o.id,`"${o.property?.property_name||"N/A"}"`,`"${o.insurance_company_name}"`,`"${o.formatted_amount}"`,`"${o.effective_date}"`,`"${o.policy_number}"`,`"${o.expiration_date}"`,l(o.expiration_date),`"${o.status}"`].join(","))].join(`
`),h=new Blob([d],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(h);s.setAttribute("href",n),s.setAttribute("download",g),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)};function Ct({properties:e,filters:g,cities:f=[],availableProperties:l=[]}){const{hasPermission:d,hasAnyPermission:h,hasAllPermissions:s}=M(),[n,o]=c.useState(g),[x,S]=c.useState(!1),[y,u]=c.useState(!1),[j,P]=c.useState(!1),[_,w]=c.useState(null),{flash:D}=N().props,m=()=>{const t={};return e.current_page&&e.current_page>1&&(t.page=e.current_page.toString()),e.per_page&&(t.per_page=e.per_page.toString()),Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),t},E=(t,a)=>{const i={...n,[t]:a};o(i)},C=()=>{const t={};Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),e.per_page&&(t.per_page=e.per_page.toString()),p.get(route("properties-info.index"),t,{preserveState:!0,preserveScroll:!0})},v=()=>{o({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};e.per_page&&(a.per_page=e.per_page.toString()),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},b=t=>{confirm("Are you sure you want to delete this property?")&&p.delete(route("properties-info.destroy",t.id),{data:m(),preserveState:!0,preserveScroll:!0})},A=()=>{if(e.data.length===0){alert("No data to export");return}S(!0);try{const t=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;W(e.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{S(!1)}},F=()=>{u(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},O=()=>{P(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},I=t=>{w(t),P(!0)},$=t=>{const a=m();delete a.page,a.per_page=t.toString(),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=t=>{const a=m();p.get(route("properties-info.show",t.id),a,{preserveState:!1})};return r.jsxs(R,{children:[r.jsx(T,{title:"Properties Insurance"}),r.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:r.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[r.jsx(J,{success:D?.success,error:D?.error}),r.jsx(Q,{onExport:A,onAddProperty:()=>u(!0),isExporting:x,hasExportData:e.data.length>0,canCreate:s(["properties.create","properties.store"])}),r.jsxs(k,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(H,{children:r.jsx(q,{filters:n,onFilterChange:E,onSearch:C,onClear:v})}),r.jsxs(U,{children:[r.jsx(z,{properties:e.data,onEdit:I,onDelete:b,onShow:L,canEdit:s(["properties.update","properties.edit"]),canDelete:d("properties.destroy"),canShow:d("properties.show"),hasAnyActionPermission:h(["properties.destroy","properties.update","properties.edit","properties.show"])}),e.data.length===0&&r.jsx(G,{}),e.data.length>0&&r.jsx(K,{paginatedData:e,currentPerPage:e.per_page||15,onPerPageChange:$})]})]})]})}),r.jsx(V,{open:y,onOpenChange:u,cities:f,availableProperties:l,onSuccess:F,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15}),_&&r.jsx(B,{open:j,onOpenChange:P,property:_,availableProperties:l,onSuccess:O,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15})]})}export{Ct as default};
