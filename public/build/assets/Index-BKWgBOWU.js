import{r as i,u as tt,b as et,a as h,j as e,H as rt}from"./app-DYme-6ST.js";import{B as w}from"./button-DygVteL_.js";import{C as st,a as ot,b as it}from"./card-CWWVdt52.js";import{u as at}from"./usePermissions-Bu-R0dRn.js";import{A as nt}from"./app-layout-H-O_MzQ8.js";import mt from"./UnitCreateDrawer-Bu27mikF.js";import pt from"./UnitEditDrawer-DzHDBkkP.js";import ct from"./Notification-BrE76Wdu.js";import lt from"./ImportStatsCard-DCESu0NO.js";import dt from"./ImportModal-FBYJVgpp.js";import $ from"./FlashMessage-CRXMJspj.js";import ut from"./UnitsFilter-GiwVML9g.js";import ht from"./UnitsTable-DSNdDjzt.js";import ft from"./Pagination-CLPaS9XL.js";import{useNotification as xt}from"./useNotification-FqFDFzbX.js";import{f as yt}from"./format-PYUiRpxY.js";import{D as gt}from"./download-DZI0PhHC.js";import{U as St}from"./upload-CTxlt19N.js";import{P as Ct}from"./plus-CCWmusQ4.js";import"./app-BxoA0TtB.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CitySelection-DpZ76iaq.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./PropertySelection-Cl1ZNPO_.js";import"./UnitDetails-BWMMmEbK.js";import"./input-pR7fOcUW.js";import"./TenantDetails-DRP731Gj.js";import"./LeaseDates-CWJ18npv.js";import"./calendar-BWK2M4JP.js";import"./chevron-left-C0SnhLPd.js";import"./popover-iS5_0AtM.js";import"./calendar-Bw6k_ssZ.js";import"./UnitSpecifications-DUO-Q4oU.js";import"./LeaseStatus-BVTMhi-j.js";import"./radioGroup-F0AlgpLY.js";import"./FinancialInformation-C5BqEl7E.js";import"./UtilityInformation-9aF_fB0t.js";import"./InsuranceInformation-BfYSrwqH.js";import"./CityPropertySelector-b1FcgcaA.js";import"./FormSection-C2KYDOer.js";import"./UnitDetailsFields-C8TjiNlE.js";import"./LeaseInformationFields-CI7tmNwz.js";import"./DatePickerField-u3m0-sG8.js";import"./FinancialFields-3U3f3IuS.js";import"./UtilitiesFields-DYsTMheu.js";import"./InsuranceFields-Dskgv4BM.js";import"./CalculatedValuesDisplay-BtUuwUoG.js";import"./circle-alert-jsi0zk16.js";import"./circle-x-Cg5j1MdR.js";import"./circle-check-big-cvblO7g-.js";import"./file-spreadsheet-CoM_uR0w.js";import"./loader-circle-CI1dGh9D.js";import"./CityAutocomplete-VQeWnQwF.js";import"./PropertyAutocomplete-D4y9GPyf.js";import"./search-1yu5M8Yr.js";import"./badge-DkU7s25L.js";import"./table-NBJhLnC1.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";const N=(s,a="-")=>{if(!s)return a;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return a;const[,m,p,o]=n,l=new Date(Number(m),Number(p)-1,Number(o));return yt(l,"P")},jt=(s,a="units.csv")=>{const m=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(p);o.setAttribute("href",l),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)};function pr({units:s,filters:a,cities:n,properties:m,importStats:p}){const{hasPermission:o,hasAnyPermission:l,hasAllPermissions:r}=at(),[,_]=i.useState(a),[d,E]=i.useState(a),[P,I]=i.useState(!1),[F,g]=i.useState(!1),[k,L]=i.useState(!!p),[A,D]=i.useState(!1),[O,U]=i.useState(!1),[v,T]=i.useState(null),{flash:y}=tt().props,[R,S]=i.useState(d.city||""),[V,C]=i.useState(d.property||""),{notification:j,showNotification:b,hideNotification:M}=xt(),c=et({file:null,skip_duplicates:!0,update_existing:!1}),f=(t,x)=>{E({...d,[t]:x})},B=t=>{S(t),f("city",t)},H=t=>{S(t),f("city",t)},z=t=>{C(t),f("property",t)},q=t=>{C(t.property_name),f("property",t.property_name)},G=()=>{_(d);const t={};Object.entries(d).forEach(([x,u])=>{u!=null&&u!==""&&(t[x]=String(u))}),h.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},J=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:""};E(t),_(t),S(""),C(""),h.get(route("units.index"),{},{preserveState:!0,preserveScroll:!0})},K=t=>{confirm("Are you sure you want to delete this unit?")&&h.delete(route("units.destroy",t.id))},Q=t=>{T(t),U(!0)},W=()=>{h.reload({only:["units","statistics"]})},X=()=>{h.reload({only:["units","statistics"]})},Y=()=>{if(s.data.length===0){alert("No data to export");return}I(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;jt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{I(!1)}},Z=i.useCallback(t=>{c.setData("file",t),h.post(route("units.import"),{file:t,skip_duplicates:c.data.skip_duplicates,update_existing:c.data.update_existing},{forceFormData:!0,onSuccess:()=>{g(!1),c.reset(),b("success","CSV file imported successfully!")},onError:x=>{const u=x.file||"Failed to import CSV file. Please try again.";b("error",u)},onFinish:()=>{c.clearErrors()}})},[c,b]);return e.jsxs(nt,{children:[e.jsx(rt,{title:"Units"}),j&&e.jsx(ct,{type:j.type,message:j.message,onClose:M}),e.jsx(dt,{isOpen:F,onClose:()=>g(!1),onSubmit:Z,isLoading:c.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx($,{type:"success",message:y?.success}),y?.error&&e.jsx($,{type:"error",message:y?.error}),k&&p&&e.jsx(lt,{stats:p,onClose:()=>L(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:Y,disabled:P||s.data.length===0,className:"flex items-center",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),P?"Exporting...":"Export CSV"]}),o("units.import")&&e.jsxs(w,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),l(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>D(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(st,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ot,{children:e.jsx(ut,{filters:d,cities:n||[],properties:m||[],cityInput:R,propertyInput:V,onFilterChange:f,onCityInputChange:B,onCitySelect:H,onPropertyInputChange:z,onPropertySelect:q,onSearch:G,onClear:J})}),e.jsxs(it,{children:[e.jsx(ht,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:o("units.destroy"),onEdit:Q,onDelete:K}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(ft,{links:s.links,currentPage:s.current_page,lastPage:s.last_page}),e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total||0," units"]})]})]})]})}),e.jsx(mt,{open:A,onOpenChange:D,cities:n||[],properties:m||[],onSuccess:X}),v&&e.jsx(pt,{unit:v,cities:n||[],properties:m||[],open:O,onOpenChange:U,onSuccess:W})]})}export{pr as default};
