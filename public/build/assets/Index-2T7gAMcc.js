import{r as i,u as tt,b as et,a as h,j as e,H as rt}from"./app-DfhMz46N.js";import{B as w}from"./button-D70ZdTAE.js";import{C as st,a as ot,b as it}from"./card-DnYtlxUS.js";import{u as at}from"./usePermissions-CxLN4YG6.js";import{A as nt}from"./app-layout-CkBdeP0R.js";import mt from"./UnitCreateDrawer-IJwytclC.js";import pt from"./UnitEditDrawer-BfNM2ji8.js";import ct from"./Notification-CXYU0vQt.js";import lt from"./ImportStatsCard-3WfKrOOE.js";import dt from"./ImportModal-_Qn5tqti.js";import $ from"./FlashMessage-8uvBQYYr.js";import ut from"./UnitsFilter-DYzxk8dy.js";import ht from"./UnitsTable-BxnSzUh5.js";import ft from"./Pagination-BwQsDd_T.js";import{useNotification as xt}from"./useNotification-Bp8bnNZa.js";import{f as yt}from"./format-PYUiRpxY.js";import{D as gt}from"./download-Dlz0wQ4J.js";import{U as St}from"./upload-CvdiTnKd.js";import{P as Ct}from"./plus-CSmAj_IW.js";import"./app-B7C1jyr3.js";import"./index-DCi-Xv1e.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-BQKCx-PJ.js";import"./index-CBYZjZBF.js";import"./index-Be_qgOKl.js";import"./index-Bd9tPrb_.js";import"./index-DV6UInPh.js";import"./index-BTxfuEuk.js";import"./x-DZ3FO5Wj.js";import"./createLucideIcon-DgVEEFYv.js";import"./index-Dc_FVRD7.js";import"./index-Ct5EcCoK.js";import"./index-CubYnoId.js";import"./index-DLswfCi4.js";import"./collapsible-CxKi9m-H.js";import"./chevron-right-BW9owo_I.js";import"./index-PkKgVJHn.js";import"./log-out-wHczke_X.js";import"./chevrons-up-down-JgGBqF6F.js";import"./app-logo-icon-5xx7lIbL.js";import"./house-C6-1wI8m.js";import"./building-Dgb3xTR3.js";import"./users-ejwhL9u9.js";import"./wrench-BBDdmO44.js";import"./credit-card-muz8icID.js";import"./dollar-sign-CLLUuUfb.js";import"./file-text-jifTgd3g.js";import"./triangle-alert-DYFGciiD.js";import"./bell-C7uwicu3.js";import"./drawer-DfcxSr7r.js";import"./CitySelection-BJw-7mOY.js";import"./label-DcH_3_W8.js";import"./select-CjXVIajk.js";import"./index-DbgZyH5A.js";import"./chevron-down-VWfm6OW2.js";import"./check-CordmqsZ.js";import"./chevron-up-dLBEGKat.js";import"./PropertySelection-ke1p1pyl.js";import"./UnitDetails-BEZLfa8U.js";import"./input-BxpY_ptm.js";import"./TenantDetails-L1vrht8j.js";import"./LeaseDates-DXi9-gAw.js";import"./calendar-MDrvGB0M.js";import"./chevron-left-DiUZGSRN.js";import"./popover-CAZC23Eq.js";import"./calendar-Rkx4ksc5.js";import"./UnitSpecifications-D7EgtwXF.js";import"./LeaseStatus-DXgsa8h3.js";import"./radioGroup-D6vUyOHk.js";import"./FinancialInformation-C9sSSSHa.js";import"./UtilityInformation-BMz29w04.js";import"./InsuranceInformation-BJnGOtSu.js";import"./CityPropertySelector-B4b_VO0x.js";import"./FormSection-2pv1eVyc.js";import"./UnitDetailsFields-C6MLIjeh.js";import"./LeaseInformationFields--jsfuqDi.js";import"./DatePickerField-WAMwzJ5A.js";import"./FinancialFields-BoblzxPn.js";import"./UtilitiesFields-vcrM8oEa.js";import"./InsuranceFields-CD_zW2KG.js";import"./CalculatedValuesDisplay-BVCbMk4c.js";import"./circle-alert-u84mWAtk.js";import"./circle-x-R3mfJh4j.js";import"./circle-check-big-j4XPXzuB.js";import"./file-spreadsheet-BMLvGVWN.js";import"./loader-circle-DI3wdvg7.js";import"./CityAutocomplete-D-qFrK7o.js";import"./PropertyAutocomplete-DdOjJoZE.js";import"./search-DDQcn7AF.js";import"./badge-CLj8v7wz.js";import"./table-Cv3zQ3q1.js";import"./square-pen-k3KPWcNg.js";import"./trash-2-CEOusBqN.js";const N=(s,a="-")=>{if(!s)return a;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return a;const[,m,p,o]=n,l=new Date(Number(m),Number(p)-1,Number(o));return yt(l,"P")},jt=(s,a="units.csv")=>{const m=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(p);o.setAttribute("href",l),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)};function mr({units:s,filters:a,cities:n,properties:m,importStats:p}){const{hasPermission:o,hasAnyPermission:l,hasAllPermissions:r}=at(),[,_]=i.useState(a),[d,E]=i.useState(a),[P,I]=i.useState(!1),[F,g]=i.useState(!1),[k,L]=i.useState(!!p),[A,D]=i.useState(!1),[O,U]=i.useState(!1),[v,T]=i.useState(null),{flash:y}=tt().props,[R,S]=i.useState(d.city||""),[V,C]=i.useState(d.property||""),{notification:j,showNotification:b,hideNotification:M}=xt(),c=et({file:null,skip_duplicates:!0,update_existing:!1}),f=(t,x)=>{E({...d,[t]:x})},B=t=>{S(t),f("city",t)},H=t=>{S(t),f("city",t)},z=t=>{C(t),f("property",t)},q=t=>{C(t.property_name),f("property",t.property_name)},G=()=>{_(d);const t={};Object.entries(d).forEach(([x,u])=>{u!=null&&u!==""&&(t[x]=String(u))}),h.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},J=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:""};E(t),_(t),S(""),C(""),h.get(route("units.index"),{},{preserveState:!0,preserveScroll:!0})},K=t=>{confirm("Are you sure you want to delete this unit?")&&h.delete(route("units.destroy",t.id))},Q=t=>{T(t),U(!0)},W=()=>{h.reload({only:["units","statistics"]})},X=()=>{h.reload({only:["units","statistics"]})},Y=()=>{if(s.data.length===0){alert("No data to export");return}I(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;jt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{I(!1)}},Z=i.useCallback(t=>{c.setData("file",t),h.post(route("units.import"),{file:t,skip_duplicates:c.data.skip_duplicates,update_existing:c.data.update_existing},{forceFormData:!0,onSuccess:()=>{g(!1),c.reset(),b("success","CSV file imported successfully!")},onError:x=>{const u=x.file||"Failed to import CSV file. Please try again.";b("error",u)},onFinish:()=>{c.clearErrors()}})},[c,b]);return e.jsxs(nt,{children:[e.jsx(rt,{title:"Units"}),j&&e.jsx(ct,{type:j.type,message:j.message,onClose:M}),e.jsx(dt,{isOpen:F,onClose:()=>g(!1),onSubmit:Z,isLoading:c.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx($,{type:"success",message:y?.success}),y?.error&&e.jsx($,{type:"error",message:y?.error}),k&&p&&e.jsx(lt,{stats:p,onClose:()=>L(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:Y,disabled:P||s.data.length===0,className:"flex items-center",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),P?"Exporting...":"Export CSV"]}),o("units.import")&&e.jsxs(w,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),l(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>D(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(st,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ot,{children:e.jsx(ut,{filters:d,cities:n||[],properties:m||[],cityInput:R,propertyInput:V,onFilterChange:f,onCityInputChange:B,onCitySelect:H,onPropertyInputChange:z,onPropertySelect:q,onSearch:G,onClear:J})}),e.jsxs(it,{children:[e.jsx(ht,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:o("units.destroy"),onEdit:Q,onDelete:K}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(ft,{links:s.links,currentPage:s.current_page,lastPage:s.last_page}),e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total||0," units"]})]})]})]})}),e.jsx(mt,{open:A,onOpenChange:D,cities:n||[],properties:m||[],onSuccess:X}),v&&e.jsx(pt,{unit:v,cities:n||[],properties:m||[],open:O,onOpenChange:U,onSuccess:W})]})}export{mr as default};
