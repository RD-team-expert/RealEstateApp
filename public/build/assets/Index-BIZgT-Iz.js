import{r as a,j as e,H as ve,L as Ce,a as _}from"./app-BkyZySAt.js";import{B as g}from"./badge-tV_scfVa.js";import{B as f}from"./button-DOkiOPMq.js";import{C as ke,a as Se,b as De}from"./card-BSlFV5gi.js";import{I as D}from"./input-nS05NghJ.js";import{T as Ee,a as Le,b as Q,c as d,d as Re,e as i}from"./table-DsKiQ4vI.js";import{u as Ae,A as Te}from"./app-layout-CUDU1EFq.js";import $e from"./MoveOutCreateDrawer-C2mqRVgf.js";import Ue from"./MoveOutEditDrawer-jtmeRCBe.js";import{D as Pe}from"./download-DxNOAkY-.js";import{P as ze}from"./plus-DTSW7Jno.js";import{C as E}from"./chevron-down-BKwinLVR.js";import{S as Ie}from"./search-BY45Y726.js";import{X as Fe}from"./x-B9Nlqjs5.js";import{E as Me}from"./eye-BbU7eR48.js";import{S as Be}from"./square-pen-ChyjgJxS.js";import{T as He}from"./trash-2-ChJ1J_da.js";import{f as Ve}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-D86DOQfL.js";import"./index-Zsm6T9Ra.js";import"./index-DBw3aPE3.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-DzIcFn8W.js";import"./index-DEy3YO5y.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./createLucideIcon-D3eUMA-Y.js";import"./collapsible-Dttt_w3O.js";import"./chevron-right-Dq99BrXh.js";import"./index-DvetPajZ.js";import"./log-out-B7H3SWOF.js";import"./app-logo-icon-BSvCg9K3.js";import"./house-TX0f6Zqy.js";import"./building-BbJM-Q5U.js";import"./users-C8GbH6-0.js";import"./wrench-BBOVsUgY.js";import"./credit-card-DEc-A8LR.js";import"./dollar-sign-jUoIv82C.js";import"./file-text-Bx2ai-5c.js";import"./triangle-alert-BMumWF7Z.js";import"./bell-hSdBu80X.js";import"./popover-D_YIvH1C.js";import"./drawer-BQHCt03g.js";import"./label-BCoYkVMj.js";import"./select-RK3poDcU.js";import"./index-DsMWzC3p.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";import"./textarea-IK-KWYhM.js";import"./radioGroup-DeV4OTT4.js";import"./calendar-5wwCpl_0.js";const j=(s,c="-")=>{if(!s)return c;const o=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!o)return c;const[,p,m,N]=o,u=new Date(Number(p),Number(m)-1,Number(N));return Ve(u,"P")},F=s=>{if(!s)return"";const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!c)return"";const[,o,p,m]=c;return`${o}-${p}-${m}`},Ye=(s,c="move-outs.csv")=>{try{const o=t=>t==null?"":String(t).replace(/"/g,'""'),m=[["ID","City Name","Property Name","Unit Name","Tenant Name","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Move Out Form"].join(","),...s.map(t=>{try{return[t.id||"",`"${o(t.city_name)}"`,`"${o(t.property_name)}"`,`"${o(t.units_name)}"`,`"${o(t.tenants_name)}"`,`"${j(t.move_out_date,"")}"`,`"${o(t.lease_status)}"`,`"${j(t.date_lease_ending_on_buildium,"")}"`,`"${o(t.keys_location)}"`,`"${o(t.utilities_under_our_name)}"`,`"${j(t.date_utility_put_under_our_name,"")}"`,`"${o(t.walkthrough)}"`,`"${o(t.repairs)}"`,`"${o(t.send_back_security_deposit)}"`,`"${o(t.notes)}"`,`"${o(t.cleaning)}"`,`"${o(t.list_the_unit)}"`,`"${o(t.move_out_form)}"`].join(",")}catch(w){return console.error("Error processing move-out row:",t,w),""}}).filter(t=>t!=="")].join(`
`),N=new Blob([m],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),h=URL.createObjectURL(N);return u.setAttribute("href",h),u.setAttribute("download",c),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h),!0}catch(o){throw console.error("CSV Export Error:",o),o}};function Gr({moveOuts:s,cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,allUnits:u,tenantsData:h}){const[t,w]=a.useState(!1),[Z,M]=a.useState(!1),[O,B]=a.useState(!1),[y,ee]=a.useState(null),[l,H]=a.useState({city:"",property:"",unit:"",tenant:""}),[,V]=a.useState({city:"",property:"",unit:"",tenant:""}),[re,v]=a.useState(!1),[te,C]=a.useState(!1),[oe,k]=a.useState(!1),[ne,S]=a.useState(!1),L=a.useRef(null),R=a.useRef(null),A=a.useRef(null),T=a.useRef(null),$=a.useRef(null),U=a.useRef(null),P=a.useRef(null),z=a.useRef(null);a.useEffect(()=>{const r=n=>{L.current&&!L.current.contains(n.target)&&$.current&&!$.current.contains(n.target)&&v(!1),R.current&&!R.current.contains(n.target)&&U.current&&!U.current.contains(n.target)&&C(!1),A.current&&!A.current.contains(n.target)&&P.current&&!P.current.contains(n.target)&&k(!1),T.current&&!T.current.contains(n.target)&&z.current&&!z.current.contains(n.target)&&S(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const x=(r,n)=>{H(I=>({...I,[r]:n}))},se=r=>{x("city",r.city),v(!1)},ae=r=>{const n=r.target.value;x("city",n),v(n.length>0)},de=r=>{const n=r.target.value;x("property",n),C(n.length>0)},ie=r=>{x("property",r.property_name),C(!1)},le=r=>{const n=r.target.value;x("unit",n),k(n.length>0)},ce=r=>{x("unit",r.unit_name),k(!1)},ue=r=>{const n=r.target.value;x("tenant",n),S(n.length>0)},me=r=>{x("tenant",r.full_name),S(!1)},xe=()=>{V(l);const r=c.find(b=>b.city===l.city),n=o.find(b=>b.property_name===l.property),I=u.find(b=>b.unit_name===l.unit),we=h.find(b=>b.full_name===l.tenant);_.get(route("move-out.index"),{city_id:r?.id||null,property_id:n?.id||null,unit_id:I?.id||null,tenant_id:we?.id||null},{preserveState:!0})},pe=()=>{H({city:"",property:"",unit:"",tenant:""}),V({city:"",property:"",unit:"",tenant:""}),_.get(route("move-out.index"),{},{preserveState:!1})},he=r=>{confirm("Are you sure you want to delete this move-out record?")&&_.delete(route("move-out.destroy",r.id))},be=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}w(!0);try{console.log("Exporting move-out data:",s.data);const r=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;Ye(s.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}. Please check the console for details.`)}finally{w(!1)}},ge=()=>{_.reload()},fe=()=>{_.reload()},Ne=r=>{ee(r),B(!0)},je=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="Yes"?"default":"secondary",className:r==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:r}),ye=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="cleaned"?"default":"secondary",className:r==="cleaned"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",children:r}),_e=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="filled"?"default":"secondary",className:r==="filled"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:r}),{hasPermission:Y,hasAnyPermission:K,hasAllPermissions:W}=Ae(),q=c.filter(r=>r.city.toLowerCase().includes(l.city.toLowerCase())),X=o.filter(r=>r.property_name.toLowerCase().includes(l.property.toLowerCase())),G=u.filter(r=>r.unit_name.toLowerCase().includes(l.unit.toLowerCase())),J=h.filter(r=>r.full_name.toLowerCase().includes(l.tenant.toLowerCase()));return e.jsxs(Te,{children:[e.jsx(ve,{title:"Move-Out Management"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Move-Out Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:be,disabled:t||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),t?"Exporting...":"Export CSV"]}),W(["move-out.create","move-out.store"])&&e.jsxs(f,{onClick:()=>M(!0),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Add Move-Out Record"]})]})]}),e.jsxs(ke,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(Se,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:$,type:"text",placeholder:"City",value:l.city,onChange:ae,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),re&&q.length>0&&e.jsx("div",{ref:L,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:q.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>se(r),children:r.city},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:U,type:"text",placeholder:"Property",value:l.property,onChange:de,onFocus:()=>C(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),te&&X.length>0&&e.jsx("div",{ref:R,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:X.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ie(r),children:r.property_name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:P,type:"text",placeholder:"Unit",value:l.unit,onChange:le,onFocus:()=>k(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&G.length>0&&e.jsx("div",{ref:A,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:G.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(r),children:r.unit_name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:z,type:"text",placeholder:"Tenant",value:l.tenant,onChange:ue,onFocus:()=>S(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&J.length>0&&e.jsx("div",{ref:T,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>me(r),children:r.full_name},r.id))})]}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:xe,variant:"default",className:"flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(f,{onClick:pe,variant:"outline",className:"flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(De,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(Ee,{className:"border-collapse rounded-md border border-border",children:[e.jsx(Le,{children:e.jsxs(Q,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Tenant Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Move Out Date"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Status"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Ending on Buildium"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Keys Location"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Utilities Under Our Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date Utility Put Under Our Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Walkthrough"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Repairs"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Send Back Security Deposit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Notes"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Cleaning"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"List the Unit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Move Out Form"}),K(["move-out.show","move-out.edit","move-out.update","move-out.destroy"])&&e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(Re,{children:s.data.map(r=>e.jsxs(Q,{className:"border-border hover:bg-muted/50",children:[e.jsx(i,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city_name||"N/A"}),e.jsx(i,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property_name||"N/A"}),e.jsx(i,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.units_name||"N/A"}),e.jsx(i,{className:"border border-border text-center text-foreground",children:r.tenants_name||"N/A"}),e.jsx(i,{className:"border border-border text-center text-foreground",children:j(r.move_out_date)}),e.jsx(i,{className:"border border-border text-center",children:r.lease_status?e.jsx(g,{variant:"outline",children:r.lease_status}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center text-foreground",children:j(r.date_lease_ending_on_buildium)}),e.jsx(i,{className:"border border-border text-center text-foreground",children:r.keys_location||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center",children:je(r.utilities_under_our_name)}),e.jsx(i,{className:"border border-border text-center text-foreground",children:j(r.date_utility_put_under_our_name)}),e.jsx(i,{className:"border border-border text-center",children:r.walkthrough?e.jsx("div",{className:"max-w-32 truncate",title:r.walkthrough,children:r.walkthrough}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center",children:r.repairs?e.jsx("div",{className:"max-w-24 truncate",title:r.repairs,children:r.repairs}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center text-foreground",children:r.send_back_security_deposit||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center",children:r.notes?e.jsx("div",{className:"max-w-24 truncate",title:r.notes,children:r.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center",children:ye(r.cleaning)}),e.jsx(i,{className:"border border-border text-center text-foreground",children:r.list_the_unit||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(i,{className:"border border-border text-center",children:_e(r.move_out_form)}),K(["move-out.show","move-out.edit","move-out.update","move-out.destroy"])&&e.jsx(i,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[Y("move-out.show")&&e.jsx(Ce,{href:route("move-out.show",r.id),children:e.jsx(f,{variant:"outline",size:"sm",children:e.jsx(Me,{className:"h-4 w-4"})})}),W(["move-out.edit","move-out.update"])&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Ne(r),children:e.jsx(Be,{className:"h-4 w-4"})}),Y("move-out.destroy")&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>he(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(He,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No move-out records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})]})}),e.jsx($e,{cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,tenantsData:h,open:Z,onOpenChange:M,onSuccess:ge}),y&&e.jsx(Ue,{cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,allUnits:u,tenantsData:h,moveOut:{...y,move_out_date:F(y.move_out_date),date_lease_ending_on_buildium:F(y.date_lease_ending_on_buildium),date_utility_put_under_our_name:F(y.date_utility_put_under_our_name)},open:O,onOpenChange:B,onSuccess:fe})]})}export{Gr as default};
