import{r as a,j as e,H as _e,L as Ce,a as _}from"./app-C79wt3tX.js";import{u as Se,A as Ie}from"./app-layout-CQQyJnHK.js";import{B as j}from"./createLucideIcon-C1z_f29J.js";import{I as L}from"./input-BS89LrTW.js";import{C as ke,a as De,b as Le}from"./card-AzpDVrLx.js";import{P as Re,T as Ae,a as Te,b as te,c as d,d as Ee,e as l,f as Oe}from"./table-BkCbQJPV.js";import{B as h}from"./badge-BxLpr-IS.js";import Pe from"./OffersAndRenewalsCreateDrawer-8EbZXXco.js";import Ue from"./OffersAndRenewalsEditDrawer-BeqMlZLw.js";import{D as $e}from"./download-B7Wdzj8e.js";import{C as R}from"./select-4_arDXlR.js";import{S as ze}from"./search-BTrBOoaV.js";import{X as Fe}from"./index-DkjncacZ.js";import{E as He}from"./eye-CitTXmBB.js";import{S as Be}from"./square-pen-C2yNsVP7.js";import{f as Ke}from"./popover-EABh-nYt.js";import"./app-Do7cDRzv.js";import"./index-DMpLQi-Z.js";import"./index-CkXl1I8e.js";import"./index-ChhieIKn.js";import"./index-DLJGb8q0.js";import"./chevron-right-CkaRxpST.js";import"./app-logo-icon-CJ6cgBSF.js";import"./file-text-DtifDZmy.js";import"./drawer-wgoO6h1K.js";import"./label-CArU7ATR.js";import"./radioGroup-4V0hsG5D.js";import"./index-BUbw163t.js";import"./calendar-DZOiGQZc.js";const b=(i,c="-")=>{if(!i)return c;const N=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!N)return c;const[,o,m,y]=N,v=new Date(Number(o),Number(m)-1,Number(y));return Ke(v,"P")},Me=(i,c,N="offers-renewals.csv")=>{try{const o=n=>n==null?"":String(n).replace(/"/g,'""');let m=["ID","City","Property","Unit","Tenant"];(c==="offers"||c==="both")&&(m=m.concat(["Date Sent Offer","Status","Date of Acceptance","Offer Last Notice Sent","Offer Notice Kind"])),(c==="renewals"||c==="both")&&(m=m.concat(["Lease Sent","Date Sent Lease","Lease Signed","Date Signed","Renewal Last Notice Sent","Renewal Notice Kind","Notes"])),m=m.concat(["How Many Days Left","Expired"]);const y=[m.join(","),...i.map(n=>{try{let x=[n.id||"",`"${o(n.city_name)}"`,`"${o(n.property)}"`,`"${o(n.unit)}"`,`"${o(n.tenant)}"`];return(c==="offers"||c==="both")&&(x=x.concat([`"${b(n.date_sent_offer,"")}"`,`"${o(n.status)}"`,`"${b(n.date_of_acceptance,"")}"`,`"${b(n.last_notice_sent,"")}"`,`"${o(n.notice_kind)}"`])),(c==="renewals"||c==="both")&&(x=x.concat([`"${o(n.lease_sent)}"`,`"${b(n.date_sent_lease,"")}"`,`"${o(n.lease_signed)}"`,`"${b(n.date_signed,"")}"`,`"${b(n.last_notice_sent_2,"")}"`,`"${o(n.notice_kind_2)}"`,`"${o(n.notes)}"`])),x=x.concat([`"${o(String(n.how_many_days_left))}"`,`"${o(n.expired)}"`]),x.join(",")}catch(x){return console.error("Error processing offer row:",n,x),""}}).filter(n=>n!=="")].join(`
`),v=new Blob([y],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),u=URL.createObjectURL(v);return w.setAttribute("href",u),w.setAttribute("download",N),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(u),!0}catch(o){throw console.error("CSV Export Error:",o),o}},Ve=[{label:"Offers",value:"offers"},{label:"Renewals",value:"renewals"},{label:"Both",value:"both"}],yt=({offers:i,cities:c,properties:N,propertiesByCityId:o,unitsByPropertyId:m,tenantsByUnitId:y,allUnits:v,tenantsData:w})=>{const[u,n]=a.useState("offers"),[x,F]=a.useState(!1),[re,H]=a.useState(!1),[ne,B]=a.useState(!1),[K,se]=a.useState(null),[s,f]=a.useState({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),[,M]=a.useState({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),[ae,C]=a.useState(!1),[oe,S]=a.useState(!1),[de,I]=a.useState(!1),[le,k]=a.useState(!1),A=a.useRef(null),T=a.useRef(null),E=a.useRef(null),O=a.useRef(null),P=a.useRef(null),U=a.useRef(null),$=a.useRef(null),z=a.useRef(null);a.useEffect(()=>{const t=r=>{A.current&&!A.current.contains(r.target)&&P.current&&!P.current.contains(r.target)&&C(!1),T.current&&!T.current.contains(r.target)&&U.current&&!U.current.contains(r.target)&&S(!1),E.current&&!E.current.contains(r.target)&&$.current&&!$.current.contains(r.target)&&I(!1),O.current&&!O.current.contains(r.target)&&z.current&&!z.current.contains(r.target)&&k(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const V=a.useMemo(()=>i?typeof i=="object"&&"data"in i&&Array.isArray(i.data)?i.data:Array.isArray(i)?i:(console.warn("Offers data is in unexpected format:",i),[]):[],[i]),Y=a.useMemo(()=>c.map(t=>({id:t.id,name:t.city,properties:(o[t.id]||[]).map(r=>({id:r.id,name:r.property_name,city_id:t.id,units:(m[r.id]||[]).map(p=>({id:p.id,name:p.unit_name,property_id:r.id,tenants:(y[p.id]||[]).map(D=>({id:D.id,name:D.full_name,first_name:D.full_name.split(" ")[0]||"",last_name:D.full_name.split(" ").slice(1).join(" ")||"",unit_id:p.id}))}))}))})),[c,o,m,y]),g=V,ce=t=>{f(r=>({...r,city:t.city,selectedCityId:t.id,property:"",selectedPropertyId:null,unit:"",selectedUnitId:null,tenant:"",selectedTenantId:null})),C(!1)},ie=t=>{const r=t.target.value;f(p=>({...p,city:r,selectedCityId:null,property:"",selectedPropertyId:null,unit:"",selectedUnitId:null,tenant:"",selectedTenantId:null})),C(r.length>0)},ue=t=>{const r=t.target.value;f(p=>({...p,property:r,selectedPropertyId:null,unit:"",selectedUnitId:null,tenant:"",selectedTenantId:null})),S(r.length>0)},me=t=>{f(r=>({...r,property:t.property_name,selectedPropertyId:t.id,unit:"",selectedUnitId:null,tenant:"",selectedTenantId:null})),S(!1)},xe=t=>{const r=t.target.value;f(p=>({...p,unit:r,selectedUnitId:null,tenant:"",selectedTenantId:null})),I(r.length>0)},pe=t=>{f(r=>({...r,unit:t.unit_name,selectedUnitId:t.id,tenant:"",selectedTenantId:null})),I(!1)},he=t=>{const r=t.target.value;f(p=>({...p,tenant:r,selectedTenantId:null})),k(r.length>0)},be=t=>{f(r=>({...r,tenant:t.full_name,selectedTenantId:t.id})),k(!1)},fe=()=>{M(s),_.get(route("offers_and_renewals.index"),{city_name:s.city||null,property_name:s.property||null,unit_name:s.unit||null,tenant_name:s.tenant||null},{preserveState:!0})},ge=()=>{f({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),M({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),_.get(route("offers_and_renewals.index"),{},{preserveState:!1})},we=t=>{window.confirm("Are you sure you want to delete this offer? This action cannot be undone.")&&_.delete(`/offers_and_renewals/${t.id}`)},je=t=>{se(t),B(!0)},ye=()=>{if(!g||g.length===0){alert("No data to export");return}F(!0);try{console.log("Exporting offers and renewals data:",g);const t=`offers-renewals-${u}-${new Date().toISOString().split("T")[0]}.csv`;Me(g,u,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t instanceof Error?t.message:"Unknown error"}. Please check the console for details.`)}finally{F(!1)}},Ne=t=>{if(!t)return e.jsx(h,{variant:"outline",children:"N/A"});switch(t.toLowerCase()){case"accepted":return e.jsx(h,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:t});case"pending":return e.jsx(h,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:t});case"rejected":return e.jsx(h,{variant:"destructive",children:t});default:return e.jsx(h,{variant:"default",children:t})}},q=t=>!t||t==="-"?e.jsx(h,{variant:"outline",children:"N/A"}):e.jsx(h,{variant:t==="Yes"?"default":"secondary",className:t==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t}),ve=t=>{if(!t&&t!==0)return e.jsx(h,{variant:"outline",children:"N/A"});const r=typeof t=="string"?parseInt(t):t;return r<=7?e.jsxs(h,{variant:"destructive",children:[t," days"]}):r<=30?e.jsxs(h,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[t," days"]}):e.jsxs(h,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[t," days"]})},{hasPermission:X,hasAnyPermission:G,hasAllPermissions:J}=Se(),Q=c.filter(t=>t?.city?.toLowerCase().includes(s.city.toLowerCase())),W=s.selectedCityId?(o[s.selectedCityId]||[]).filter(t=>t?.property_name?.toLowerCase().includes(s.property.toLowerCase())):N.filter(t=>t?.property_name?.toLowerCase().includes(s.property.toLowerCase())),Z=s.selectedPropertyId?(m[s.selectedPropertyId]||[]).filter(t=>t?.unit_name?.toLowerCase().includes(s.unit.toLowerCase())):v.filter(t=>t?.unit_name?.toLowerCase().includes(s.unit.toLowerCase())),ee=s.selectedUnitId?(y[s.selectedUnitId]||[]).filter(t=>t?.full_name?.toLowerCase().includes(s.tenant.toLowerCase())):w.filter(t=>t?.full_name?.toLowerCase().includes(s.tenant.toLowerCase()));return e.jsxs(Ie,{children:[e.jsx(_e,{title:"Offers and Renewals"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Offers and Renewals"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:ye,disabled:x||!g||g.length===0,className:"flex items-center",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),x?"Exporting...":"Export CSV"]}),J(["offers-and-renewals.create","offers-and-renewals.store"])&&e.jsxs(j,{onClick:()=>H(!0),children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Add New"]})]})]}),e.jsxs(ke,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsxs(De,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{ref:P,type:"text",placeholder:"City",value:s.city,onChange:ie,onFocus:()=>C(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(R,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ae&&Q.length>0&&e.jsx("div",{ref:A,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Q.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(t),children:t.city},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{ref:U,type:"text",placeholder:"Property",value:s.property,onChange:ue,onFocus:()=>S(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(R,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&W.length>0&&e.jsx("div",{ref:T,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:W.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>me(t),children:t.property_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{ref:$,type:"text",placeholder:"Unit",value:s.unit,onChange:xe,onFocus:()=>I(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(R,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),de&&Z.length>0&&e.jsx("div",{ref:E,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Z.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>pe(t),children:t.unit_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{ref:z,type:"text",placeholder:"Tenant",value:s.tenant,onChange:he,onFocus:()=>k(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(R,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),le&&ee.length>0&&e.jsx("div",{ref:O,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:ee.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>be(t),children:t.full_name},t.id))})]}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:fe,variant:"default",className:"flex items-center",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(j,{onClick:ge,variant:"outline",className:"flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:Ve.map(t=>e.jsx(j,{variant:u===t.value?"default":"outline",onClick:()=>n(t.value),children:t.label},t.value))})]}),e.jsxs(Le,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(Ae,{className:"border-collapse rounded-md border border-border",children:[e.jsx(Te,{children:e.jsxs(te,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit"}),e.jsx(d,{className:"sticky left-[390px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Tenant"}),(u==="offers"||u==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date Sent Offer"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date of Acceptance"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Offer Last Notice Sent"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Offer Notice Kind"})]}),(u==="renewals"||u==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Sent?"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date Sent Lease"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Signed?"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date Signed"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Renewal Last Notice Sent"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Renewal Notice Kind"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Notes"})]}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"How Many Days Left"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Expired"}),G(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])&&e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(Ee,{children:g.map(t=>e.jsxs(te,{className:"hover:bg-muted/50 border-border",children:[e.jsx(l,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.city_name||"N/A"}),e.jsx(l,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.property||"N/A"}),e.jsx(l,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.unit||"N/A"}),e.jsx(l,{className:"sticky left-[390px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.tenant||"N/A"}),(u==="offers"||u==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.date_sent_offer)}),e.jsx(l,{className:"border border-border text-center",children:Ne(t.status??null)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.date_of_acceptance)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.last_notice_sent)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:t.notice_kind||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})})]}),(u==="renewals"||u==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"border border-border text-center",children:q(t.lease_sent??null)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.date_sent_lease)}),e.jsx(l,{className:"border border-border text-center",children:q(t.lease_signed??null)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.date_signed)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:b(t.last_notice_sent_2)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:t.notice_kind_2||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:t.notes?e.jsx("div",{className:"max-w-24 truncate",title:t.notes,children:t.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})})]}),e.jsx(l,{className:"border border-border text-center",children:ve(t.how_many_days_left??null)}),e.jsx(l,{className:"border border-border text-center",children:e.jsx(h,{variant:t.expired==="expired"?"destructive":"default",children:t.expired??"N/A"})}),G(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[X("offers-and-renewals.show")&&e.jsx(Ce,{href:`/offers_and_renewals/${t.id}`,children:e.jsx(j,{variant:"outline",size:"sm",children:e.jsx(He,{className:"h-4 w-4"})})}),J(["offers-and-renewals.edit","offers-and-renewals.update"])&&e.jsx(j,{variant:"outline",size:"sm",onClick:()=>je(t),children:e.jsx(Be,{className:"h-4 w-4"})}),X("offers-and-renewals.destroy")&&e.jsx(j,{variant:"outline",size:"sm",onClick:()=>we(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(Oe,{className:"h-4 w-4"})})]})})]},t.id))})]})}),g.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No offers found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex justify-between items-center border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",g.length," of ",V.length," offers"]})})]})]})]})}),e.jsx(Pe,{hierarchicalData:Y,open:re,onOpenChange:H,onSuccess:()=>{_.reload()}}),K&&e.jsx(Ue,{offer:K,hierarchicalData:Y,open:ne,onOpenChange:B,onSuccess:()=>{_.reload()}})]})};export{yt as default};
