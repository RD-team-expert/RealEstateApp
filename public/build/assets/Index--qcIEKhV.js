import{r as c,u as N,j as r,H as T,a as p}from"./app-DYme-6ST.js";import{A as R}from"./app-layout-H-O_MzQ8.js";import{C as k,a as H,b as U}from"./card-CWWVdt52.js";import{u as M}from"./usePermissions-Bu-R0dRn.js";import V from"./PropertyCreateDrawer-Ctqvh8GF.js";import B from"./PropertyEditDrawer-DMStKxOb.js";import Q from"./PropertyPageHeader-5ruUQLcO.js";import q from"./PropertyFilters-DNC7IMiX.js";import z from"./PropertyTable-BbJtFNIm.js";import G from"./PropertyEmptyState-BwcJR5DN.js";import J from"./FlashMessages-DvkRaHFr.js";import K from"./PropertyPagination-OPJsptHE.js";import"./app-BxoA0TtB.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-DygVteL_.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CitySelectionSection-DmrZhpqH.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./map-pin-yvAuql9R.js";import"./PropertySelectionSection-DV3Zsw02.js";import"./alert-BkgVQNRR.js";import"./building-2-CrM-EXSd.js";import"./circle-alert-jsi0zk16.js";import"./InsuranceCompanySection-DZzRT3Tc.js";import"./input-pR7fOcUW.js";import"./shield-Bj8dj4yD.js";import"./AmountPolicySection-D0FmvvAI.js";import"./DatesSection-DTZiOXGE.js";import"./calendar-Bw6k_ssZ.js";import"./NotesSection-zlXVBzov.js";import"./textarea-CICftYaV.js";import"./PropertySelectField-BLnxnZNS.js";import"./InsuranceCompanyField-uwxiskev.js";import"./AmountPolicyFields-NZrN8bXF.js";import"./DateFields-eYFQWJ58.js";import"./NotesField-BlTKmsVt.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";import"./search-1yu5M8Yr.js";import"./table-NBJhLnC1.js";import"./PropertyTableRow-B6bCqfvO.js";import"./PropertyStatusBadge-BTti04u2.js";import"./badge-DkU7s25L.js";import"./PropertyDaysLeftBadge-rKqwfRd9.js";import"./eye-aSD_-4Al.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";import"./chevron-left-C0SnhLPd.js";const W=(e,g="properties.csv")=>{const f=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],l=o=>{const x=new Date,y=new Date(o).getTime()-x.getTime();return Math.ceil(y/(1e3*60*60*24))},d=[f.join(","),...e.map(o=>[o.id,`"${o.property?.property_name||"N/A"}"`,`"${o.insurance_company_name}"`,`"${o.formatted_amount}"`,`"${o.effective_date}"`,`"${o.policy_number}"`,`"${o.expiration_date}"`,l(o.expiration_date),`"${o.status}"`].join(","))].join(`
`),h=new Blob([d],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(h);s.setAttribute("href",n),s.setAttribute("download",g),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)};function Ct({properties:e,filters:g,cities:f=[],availableProperties:l=[]}){const{hasPermission:d,hasAnyPermission:h,hasAllPermissions:s}=M(),[n,o]=c.useState(g),[x,S]=c.useState(!1),[y,u]=c.useState(!1),[j,P]=c.useState(!1),[_,w]=c.useState(null),{flash:D}=N().props,m=()=>{const t={};return e.current_page&&e.current_page>1&&(t.page=e.current_page.toString()),e.per_page&&(t.per_page=e.per_page.toString()),Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),t},E=(t,a)=>{const i={...n,[t]:a};o(i)},C=()=>{const t={};Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),e.per_page&&(t.per_page=e.per_page.toString()),p.get(route("properties-info.index"),t,{preserveState:!0,preserveScroll:!0})},v=()=>{o({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};e.per_page&&(a.per_page=e.per_page.toString()),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},b=t=>{confirm("Are you sure you want to delete this property?")&&p.delete(route("properties-info.destroy",t.id),{data:m(),preserveState:!0,preserveScroll:!0})},A=()=>{if(e.data.length===0){alert("No data to export");return}S(!0);try{const t=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;W(e.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{S(!1)}},F=()=>{u(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},O=()=>{P(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},I=t=>{w(t),P(!0)},$=t=>{const a=m();delete a.page,a.per_page=t.toString(),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=t=>{const a=m();p.get(route("properties-info.show",t.id),a,{preserveState:!1})};return r.jsxs(R,{children:[r.jsx(T,{title:"Properties Insurance"}),r.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:r.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[r.jsx(J,{success:D?.success,error:D?.error}),r.jsx(Q,{onExport:A,onAddProperty:()=>u(!0),isExporting:x,hasExportData:e.data.length>0,canCreate:s(["properties.create","properties.store"])}),r.jsxs(k,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(H,{children:r.jsx(q,{filters:n,onFilterChange:E,onSearch:C,onClear:v})}),r.jsxs(U,{children:[r.jsx(z,{properties:e.data,onEdit:I,onDelete:b,onShow:L,canEdit:s(["properties.update","properties.edit"]),canDelete:d("properties.destroy"),canShow:d("properties.show"),hasAnyActionPermission:h(["properties.destroy","properties.update","properties.edit","properties.show"])}),e.data.length===0&&r.jsx(G,{}),e.data.length>0&&r.jsx(K,{paginatedData:e,currentPerPage:e.per_page||15,onPerPageChange:$})]})]})]})}),r.jsx(V,{open:y,onOpenChange:u,cities:f,availableProperties:l,onSuccess:F,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15}),_&&r.jsx(B,{open:j,onOpenChange:P,property:_,availableProperties:l,onSuccess:O,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15})]})}export{Ct as default};
