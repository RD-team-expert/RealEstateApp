import{r as n,b as it,j as s}from"./app-ouZqxB1_.js";import{D as at,a as st,b as lt}from"./drawer-By3Utn4a.js";import{B as G}from"./button-Dwk07ddD.js";import{OriginalPaymentInfo as ct}from"./OriginalPaymentInfo-CInOgBEG.js";import{CascadingSelectionFields as ut}from"./CascadingSelectionFields-BW0udjhJ.js";import{PaymentDetailsFields as dt}from"./PaymentDetailsFields-rQ5EoHuj.js";import{NotesField as mt}from"./NotesField-BmMLt1pI.js";import"./app-CsCti_B1.js";import"./index-D_5cRLds.js";import"./index-ChCgVrQ9.js";import"./index-CBrQgTKF.js";import"./index-DZ6Q_eM6.js";import"./index-B409lPMy.js";import"./index-Cw-58lmC.js";import"./index-L_KZmfdx.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-C6lwu6z7.js";import"./createLucideIcon-D2D4_K7R.js";import"./circle-alert-3vEhvGtg.js";import"./SelectionField-CBBwJqOK.js";import"./label-DuRYAP1m.js";import"./command-Bvk0WKej.js";import"./search-K6eFBQan.js";import"./popover-HByMxBFn.js";import"./index-D8RbbIhn.js";import"./chevrons-up-down-BP70ShdQ.js";import"./check-Ef_HP5Pc.js";import"./DateField-D8r7tpj3.js";import"./calendar-CiekVgOK.js";import"./format-PYUiRpxY.js";import"./chevron-left-B6urspn_.js";import"./chevron-right-DK0aPss0.js";import"./chevron-down-DJ1Ff5Fx.js";import"./calendar-Bep_gocc.js";import"./AmountField-CZsQMuN9.js";import"./input-Be-glciT.js";import"./PaidField-Czx6uqIG.js";import"./textarea-DhBPhXm2.js";function ft({cities:T,properties:k,propertiesByCityId:v,unitsByPropertyId:S,tenantsByUnitId:x,allUnits:y,tenantsData:A,paymentPlan:t,setData:j}){const[U,D]=n.useState(null),[z,f]=n.useState(null),[I,_]=n.useState(null),[$,g]=n.useState(null),[O,b]=n.useState([]),[w,u]=n.useState([]),[E,c]=n.useState([]),[N,p]=n.useState({city:"",property:"",unit:"",tenant:""});return n.useEffect(()=>{if(t&&y){const i=y.find(e=>e.unit_name===t.unit);if(i){const e=T.find(C=>C.city===t.city_name),r=k.find(C=>C.property_name===t.property);e&&(D(e.id),v[e.id]&&b(v[e.id])),r&&(f(r.id),S[r.id]&&u(S[r.id])),_(i.id),x[i.id]&&c(x[i.id]);const m=A.find(C=>C.full_name===t.tenant);m&&(g(m.id),j("tenant_id",m.id))}}},[t,y,T,k,v,S,x,A]),{selectedCity:U,selectedProperty:z,selectedUnit:I,selectedTenant:$,availableProperties:O,availableUnits:w,availableTenants:E,validationErrors:N,handleCityChange:i=>{const e=parseInt(i);D(e),f(null),_(null),g(null),j("tenant_id",null),p(r=>({...r,city:"",property:"",unit:"",tenant:""})),e&&v[e]?b(v[e]):b([]),u([]),c([])},handlePropertyChange:i=>{const e=parseInt(i);f(e),_(null),g(null),j("tenant_id",null),p(r=>({...r,property:"",unit:"",tenant:""})),e&&S[e]?u(S[e]):u([]),c([])},handleUnitChange:i=>{const e=parseInt(i);_(e),g(null),j("tenant_id",null),p(r=>({...r,unit:"",tenant:""})),e&&x[e]?c(x[e]):c([])},handleTenantChange:i=>{const e=parseInt(i),r=E.find(m=>m.id===e);r&&(g(e),j("tenant_id",r.id),p(m=>({...m,tenant:""})))},resetSelections:()=>{D(null),f(null),_(null),g(null),b([]),u([]),c([]),p({city:"",property:"",unit:"",tenant:""})},setValidationErrors:p}}function Bt({cities:T,properties:k,propertiesByCityId:v,unitsByPropertyId:S,tenantsByUnitId:x,allUnits:y,tenantsData:A,paymentPlan:t,open:j,onOpenChange:U,onSuccess:D,search:z,filters:f,perPage:I,currentPage:_}){const[$,g]=n.useState(t.paid),[O,b]=n.useState(""),w=n.useRef(null),u=n.useRef(null),E=n.useRef(null),c=n.useRef(null),N=n.useRef(null),p=l=>{if(!l)return"";const o=String(l),R=o.match(/^\d{4}-\d{2}-\d{2}/);if(R)return R[0];try{const a=new Date(o),nt=a.getFullYear(),rt=String(a.getMonth()+1).padStart(2,"0"),ot=String(a.getDate()).padStart(2,"0");return`${nt}-${rt}-${ot}`}catch{return""}},{data:d,setData:h,put:P,processing:M,errors:F,transform:i}=it({tenant_id:t.tenant_id,amount:t.amount,dates:p(t.dates),paid:t.paid,notes:t.notes||""}),{selectedCity:e,selectedProperty:r,selectedUnit:m,selectedTenant:C,availableProperties:H,availableUnits:J,availableTenants:K,validationErrors:L,handleCityChange:Q,handlePropertyChange:W,handleUnitChange:X,handleTenantChange:Z,resetSelections:B,setValidationErrors:V}=ft({cities:T,properties:k,propertiesByCityId:v,unitsByPropertyId:S,tenantsByUnitId:x,allUnits:y,tenantsData:A,paymentPlan:t,setData:h});n.useEffect(()=>{h({tenant_id:t.tenant_id,amount:t.amount,dates:p(t.dates),paid:t.paid,notes:t.notes||""}),g(t.paid)},[t.id]);const Y=l=>{l.preventDefault(),V({city:"",property:"",unit:"",tenant:""}),b("");let o=!1;if(e||(V(a=>({...a,city:"Please select a city before submitting the form."})),w.current&&(w.current.focus(),w.current.scrollIntoView({behavior:"smooth",block:"center"})),o=!0),r||(V(a=>({...a,property:"Please select a property before submitting the form."})),u.current&&(u.current.focus(),u.current.scrollIntoView({behavior:"smooth",block:"center"})),o=!0),m||(V(a=>({...a,unit:"Please select a unit before submitting the form."})),E.current&&(E.current.focus(),E.current.scrollIntoView({behavior:"smooth",block:"center"})),o=!0),(!C||!d.tenant_id)&&(V(a=>({...a,tenant:"Please select a tenant before submitting the form."})),c.current&&(c.current.focus(),c.current.scrollIntoView({behavior:"smooth",block:"center"})),o=!0),(!d.dates||!String(d.dates).trim())&&(b("Please select a payment date."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),o=!0),o)return;const R=I;i(a=>({...a,search:z??null,city:f?.city??null,property:f?.property??null,unit:f?.unit??null,tenant:f?.tenant??null,per_page:R??null,page:_??null})),P(route("payment-plans.update",t.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{q(),D?.()}})},q=()=>{h({tenant_id:t.tenant_id,amount:t.amount,dates:t.dates,paid:t.paid,notes:t.notes||""}),B(),U(!1)},tt=l=>{const o=parseFloat(l.target.value)||0;h("amount",o),d.paid>o&&h("paid",o)},et=l=>{const o=parseFloat(l.target.value)||0,R=Math.min(o,d.amount||0);h("paid",R)};return s.jsx(at,{open:j,onOpenChange:U,modal:!1,children:s.jsx(st,{size:"half",title:"Edit Payment Plan",children:s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1 overflow-auto p-6",children:s.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[s.jsx(ct,{paymentPlan:t}),s.jsx(ut,{cities:T,selectedCity:e,selectedProperty:r,selectedUnit:m,selectedTenant:C,availableProperties:H,availableUnits:J,availableTenants:K,validationErrors:L,formErrors:F,onCityChange:Q,onPropertyChange:W,onUnitChange:X,onTenantChange:Z,cityRef:w,propertyRef:u,unitRef:E,tenantRef:c}),s.jsx(dt,{dates:d.dates,amount:d.amount,paid:d.paid,originalPaidAmount:$,errors:O?{...F,dates:O}:F,onDateChange:l=>{h("dates",l),b("")},onAmountChange:tt,onPaidChange:et,dateRef:N}),s.jsx(mt,{notes:d.notes,error:F.notes,onChange:l=>h("notes",l)})]})}),s.jsx(lt,{children:s.jsxs("div",{className:"flex gap-2 w-full",children:[s.jsx(G,{type:"button",variant:"outline",onClick:q,className:"flex-1",children:"Cancel"}),s.jsx(G,{type:"submit",onClick:Y,disabled:M,className:"flex-1",children:M?"Updating...":"Update Payment Plan"})]})})]})})})}export{Bt as default};
