import{r as i,u as st,b as ot,a as g,j as e,H as it}from"./app-IncGAUEB.js";import{B as w}from"./button-BZreYh_c.js";import{C as at,a as nt,b as pt}from"./card-hD-4qfcw.js";import{u as mt}from"./usePermissions-BWmUIPam.js";import{A as ct}from"./app-layout-DdQ-RLDz.js";import lt from"./UnitCreateDrawer-Jli0q8CN.js";import dt from"./UnitEditDrawer-DH_VLj1x.js";import ut from"./Notification-DzjL2FTO.js";import ht from"./ImportStatsCard-FQsnD0vM.js";import ft from"./ImportModal-Co8MQIzl.js";import L from"./FlashMessage-Dvg68--p.js";import gt from"./UnitsFilter-CTFowJAB.js";import xt from"./UnitsTable-CRSHr_2b.js";import St from"./Pagination-7eYgmOIJ.js";import{useNotification as yt}from"./useNotification-C9tVY2ew.js";import{f as Ct}from"./format-PYUiRpxY.js";import{D as jt}from"./download-BTdncQqR.js";import{U as _t}from"./upload-B5dq2297.js";import{P as bt}from"./plus-BVjqVSDl.js";import"./app-DgqXL21p.js";import"./index-bCzQdt7o.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CfKQ6yNG.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./index-Dc_FVRD7.js";import"./index-DfV2_jol.js";import"./index-DfBxMdWp.js";import"./index-CoG2tpvC.js";import"./collapsible-CmadTdVI.js";import"./chevron-right-Dv0ELFzT.js";import"./index-X0Rqfk2m.js";import"./log-out-DkEuD3xv.js";import"./chevrons-up-down-D4md56fd.js";import"./app-logo-icon-BCIu8Oaa.js";import"./house-D_snjZK4.js";import"./building-DGN1JdDp.js";import"./users-DR4b9nxK.js";import"./wrench-j2xp49CP.js";import"./credit-card-nxx9uyGn.js";import"./dollar-sign-Do5zHV6l.js";import"./file-text-D45rT7Bs.js";import"./triangle-alert-D4SYorIn.js";import"./bell-c07z0V_k.js";import"./drawer-BabOL_dj.js";import"./CitySelection-Do9zQvQ6.js";import"./label-BhALl-XJ.js";import"./popover-D0q3r5CP.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./check-gd2_wZBq.js";import"./PropertySelection-BoxCCBOK.js";import"./UnitDetails-C_guTZ3r.js";import"./input-BKi6rfRv.js";import"./TenantDetails-CHBBMAjz.js";import"./LeaseDates-CWSTi5Lc.js";import"./calendar-UFpA7cIJ.js";import"./chevron-left-WEUqp8UO.js";import"./chevron-down-uas8HWR-.js";import"./calendar-CBsjNrh9.js";import"./UnitSpecifications-_58PF9yN.js";import"./LeaseStatus-ClMRtAfh.js";import"./radioGroup-BhgCKDH3.js";import"./index-DizBXXCV.js";import"./FinancialInformation-BmtdOr7S.js";import"./UtilityInformation-c53iQSuY.js";import"./InsuranceInformation-Dp9Tt8-b.js";import"./NewLease-rQZV2oWe.js";import"./CityPropertySelector-VOhXefLB.js";import"./FormSection-DgXyG9xu.js";import"./UnitDetailsFields-80oMOBMi.js";import"./LeaseInformationFields-BtNPWWzC.js";import"./DatePickerField-B1ee1dll.js";import"./FinancialFields-BFomYKTS.js";import"./UtilitiesFields-DiN5i35L.js";import"./InsuranceFields-DOy4PmK6.js";import"./CalculatedValuesDisplay-CeBoCdOl.js";import"./circle-alert-BBZTEKZT.js";import"./circle-x-DTthYDSi.js";import"./circle-check-big-ssalT6e6.js";import"./file-spreadsheet-DRzc_tKY.js";import"./loader-circle-C0PnIHBB.js";import"./select-BqJlafxu.js";import"./chevron-up-DtKhYrlV.js";import"./CityAutocomplete-C8qEXuIg.js";import"./PropertyAutocomplete-Bfpy4tPQ.js";import"./badge-ByZ6dyck.js";import"./table-DyrYtZnv.js";import"./square-pen-PIAnrcOq.js";import"./trash-2-DcRRmtsX.js";const N=(s,c="-")=>{if(!s)return c;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return c;const[,d,u,a]=l,f=new Date(Number(d),Number(u)-1,Number(a));return Ct(f,"P")},Pt=(s,c="units.csv")=>{const d=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),u=new Blob([d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),f=URL.createObjectURL(u);a.setAttribute("href",f),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(f)};function ur({units:s,filters:c,cities:l,properties:d,importStats:u}){const{hasPermission:a,hasAnyPermission:f,hasAllPermissions:r}=mt(),[,E]=i.useState(c),[n,I]=i.useState(c),[x,D]=i.useState(String(s?.per_page??"15")),[U,$]=i.useState(!1),[A,C]=i.useState(!1),[O,T]=i.useState(!!u),[R,v]=i.useState(!1),[V,F]=i.useState(!1),[k,M]=i.useState(null),{flash:y}=st().props,[B,j]=i.useState(n.city||""),[H,_]=i.useState(n.property||""),{notification:b,showNotification:P,hideNotification:z}=yt(),h=ot({file:null,skip_duplicates:!0,update_existing:!1}),S=(t,o)=>{I({...n,[t]:o})},q=t=>{j(t),S("city",t)},G=t=>{j(t),S("city",t)},J=t=>{_(t),S("property",t)},K=t=>{_(t.property_name),S("property",t.property_name)},Q=()=>{E(n);const t={};Object.entries(n).forEach(([o,p])=>{p!=null&&p!==""&&(t[o]=String(p))}),t.per_page=String(x),g.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},W=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:"",is_new_lease:""};I(t),E(t),j(""),_(""),D("15"),g.get(route("units.index"),{per_page:"15"},{preserveState:!0,preserveScroll:!0})},X=t=>{if(confirm("Are you sure you want to delete this unit?")){const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),g.visit(route("units.destroy",t.id),{method:"delete",data:{redirect:{filters:o,per_page:String(x),page:String(s?.current_page??1)}},preserveState:!0,preserveScroll:!0})}},Y=t=>{M(t),F(!0)},Z=()=>{g.reload({only:["units","statistics"]})},tt=()=>{},et=()=>{if(s.data.length===0){alert("No data to export");return}$(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;Pt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{$(!1)}},rt=i.useCallback(t=>{h.setData("file",t),g.post(route("units.import"),{file:t,skip_duplicates:h.data.skip_duplicates,update_existing:h.data.update_existing},{forceFormData:!0,onSuccess:()=>{C(!1),h.reset(),P("success","CSV file imported successfully!")},onError:o=>{const p=o.file||"Failed to import CSV file. Please try again.";P("error",p)},onFinish:()=>{h.clearErrors()}})},[h,P]);return e.jsxs(ct,{children:[e.jsx(it,{title:"Units"}),b&&e.jsx(ut,{type:b.type,message:b.message,onClose:z}),e.jsx(ft,{isOpen:A,onClose:()=>C(!1),onSubmit:rt,isLoading:h.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx(L,{type:"success",message:y?.success}),y?.error&&e.jsx(L,{type:"error",message:y?.error}),O&&u&&e.jsx(ht,{stats:u,onClose:()=>T(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:et,disabled:U||s.data.length===0,className:"flex items-center",children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),U?"Exporting...":"Export CSV"]}),a("units.import")&&e.jsxs(w,{onClick:()=>C(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),f(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>v(!0),children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(at,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(nt,{children:e.jsx(gt,{filters:n,cities:l||[],properties:d||[],cityInput:B,propertyInput:H,onFilterChange:S,onCityInputChange:q,onCitySelect:G,onPropertyInputChange:J,onPropertySelect:K,onSearch:Q,onClear:W})}),e.jsxs(pt,{children:[e.jsx(xt,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:a("units.destroy"),onEdit:Y,onDelete:X}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(St,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,from:s.from,to:s.to,total:s.total,perPage:x,onPerPageChange:t=>{D(t);const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),o.per_page=String(t),g.get(route("units.index"),o,{preserveState:!0,preserveScroll:!0})}})]})]})]})}),e.jsx(lt,{open:R,onOpenChange:v,cities:l||[],properties:d||[],onSuccess:tt,redirectState:{filters:n,per_page:x,page:s?.current_page??1}}),k&&e.jsx(dt,{unit:k,cities:l||[],properties:d||[],open:V,onOpenChange:F,onSuccess:Z,redirectState:{filters:n,per_page:x,page:s?.current_page??1}})]})}export{ur as default};
