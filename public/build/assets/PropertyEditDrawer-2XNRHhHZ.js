import{r as l,b as $,j as i}from"./app-ouZqxB1_.js";import{D as q,a as G,b as H}from"./drawer-By3Utn4a.js";import{B as b}from"./button-Dwk07ddD.js";import J from"./CitySelectionSection-R3BOzr9c.js";import K from"./PropertySelectionSection-CZsbKMvv.js";import L from"./InsuranceCompanyField-GNr0z43y.js";import M from"./AmountPolicyFields-CxRoRlbI.js";import Q from"./DateFields-CUSmpEqL.js";import T from"./NotesField-BVFFHahL.js";import"./app-CsCti_B1.js";import"./index-D_5cRLds.js";import"./index-ChCgVrQ9.js";import"./index-CBrQgTKF.js";import"./index-DZ6Q_eM6.js";import"./index-B409lPMy.js";import"./index-Cw-58lmC.js";import"./index-L_KZmfdx.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-C6lwu6z7.js";import"./createLucideIcon-D2D4_K7R.js";import"./label-DuRYAP1m.js";import"./popover-HByMxBFn.js";import"./index-D8RbbIhn.js";import"./command-Bvk0WKej.js";import"./search-K6eFBQan.js";import"./map-pin-Cnb7huEq.js";import"./chevrons-up-down-BP70ShdQ.js";import"./check-Ef_HP5Pc.js";import"./alert-CK63Rytu.js";import"./building-2-D_d-M5I2.js";import"./circle-alert-3vEhvGtg.js";import"./input-Be-glciT.js";import"./shield-MlsdZ2L-.js";import"./dollar-sign-DHkBemQX.js";import"./file-text-BT_oga12.js";import"./calendar-Bep_gocc.js";import"./textarea-DhBPhXm2.js";function Ae({open:E,onOpenChange:u,property:e,availableProperties:y=[],onSuccess:W,currentFilters:S,currentPage:_,currentPerPage:x,cities:j=[]}){const[D,m]=l.useState(""),[c,h]=l.useState(""),[N,v]=l.useState([]),{data:o,setData:r,put:I,processing:f,errors:s,clearErrors:g,transform:P}=$({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""});l.useEffect(()=>{if(e){r({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""}),m("");const t=e.property,n=t?.city_id?t.city_id.toString():"";h(n)}},[e]),l.useEffect(()=>{if(c){const t=parseInt(c);let n=y.filter(d=>d.city_id===t);const a=e?.property;a&&a.city_id===t&&(n.some(p=>p.id===a.id)||(n=[{id:a.id,city_id:a.city_id??null,property_name:a.property_name,is_archived:a.is_archived,created_at:a.created_at,updated_at:a.updated_at,city:a.city},...n])),v(n)}else v([])},[c,y,e]);const F=t=>{r("insurance_company_name",t.target.value)},w=t=>{r("amount",t.target.value)},V=t=>{r("policy_number",t.target.value)},k=t=>{r("effective_date",t.target.value)},A=t=>{r("expiration_date",t.target.value)},U=t=>{r("notes",t.target.value)},B=t=>{h(t),r("property_id",0),g(),m("")},z=()=>{const t={};x&&(t.filter_per_page=String(x)),_&&_>0&&(t.filter_page=_);const{property_name:n,insurance_company_name:a,policy_number:d,status:p}=S||{};return n&&(t.filter_property_name=n),a&&(t.filter_insurance_company_name=a),d&&(t.filter_policy_number=d),p&&(t.filter_status=p),t},C=t=>{if(t.preventDefault(),!o.property_id||o.property_id===0){m("Please select a property before submitting the form.");return}P(n=>({...n,...z()})),I(route("properties-info.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m(""),u(!1)},onError:()=>{}})},R=()=>{r({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""}),g(),m(""),u(!1)};return i.jsx(q,{open:E,onOpenChange:u,modal:!1,children:i.jsx(G,{size:"half",title:`Edit Property - ${e.property?.property_name||"Unknown"}`,children:i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx("div",{className:"flex-1 overflow-auto p-6",children:i.jsxs("form",{onSubmit:C,className:"space-y-4",children:[i.jsx(J,{selectedCityId:c,cities:j,onCityChange:B}),i.jsx(K,{propertyId:o.property_id,selectedCityId:c,filteredProperties:N,onPropertyChange:t=>{r("property_id",parseInt(t)),m("")},errors:s,validationError:D}),i.jsx(L,{value:o.insurance_company_name,onChange:F,error:s.insurance_company_name}),i.jsx(M,{amountValue:o.amount,policyNumberValue:o.policy_number,onAmountChange:w,onPolicyNumberChange:V,amountError:s.amount,policyNumberError:s.policy_number}),i.jsx(Q,{effectiveDateValue:o.effective_date,expirationDateValue:o.expiration_date,onEffectiveDateChange:k,onExpirationDateChange:A,effectiveDateError:s.effective_date,expirationDateError:s.expiration_date}),i.jsx(T,{value:o.notes,onChange:U,error:s.notes})]})}),i.jsx(H,{children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(b,{type:"button",variant:"outline",onClick:R,disabled:f,children:"Cancel"}),i.jsx(b,{type:"submit",onClick:C,disabled:f,children:f?"Updating...":"Update Property"})]})})]})})})}export{Ae as default};
