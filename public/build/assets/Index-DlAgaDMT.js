import{r as n,u as B,j as t,H as M,a as l}from"./app-Y5k3mklr.js";import{C as z,b as G}from"./card-DrRiDRID.js";import{u as J}from"./usePermissions-BhSSdkVr.js";import{A as K}from"./app-layout-CTk7sr4u.js";import W from"./VendorCreateDrawer-D1v6Fqlt.js";import X from"./VendorEditDrawer-Cb_cH0ZM.js";import Y from"./FlashMessages-BPfadB8D.js";import Z from"./PageHeader-BuzXX29a.js";import ee from"./VendorFilters-Cy786wq9.js";import te from"./VendorTable-B5bSUFHc.js";import re from"./VendorPagination-C8iAygal.js";import"./app-BZFxL5VY.js";import"./utils-CBfrqCZ4.js";import"./index-DeKsjAJz.js";import"./index-CdJFUDDL.js";import"./button-CQfb3JBO.js";import"./index-uindsx95.js";import"./index-CVo6BqxD.js";import"./index-wwqKUVc_.js";import"./index-DLyAnWAc.js";import"./index-D1TeM0R1.js";import"./index-BwS5tYp4.js";import"./x-Nz9yRxvI.js";import"./createLucideIcon-BOWbKjUa.js";import"./index-Dc_FVRD7.js";import"./index-12wiZxBo.js";import"./index-ClDX_llA.js";import"./index-1ypBnunE.js";import"./collapsible-gNKnkPA_.js";import"./chevron-right-MFcKsrea.js";import"./index-vpTsBzNQ.js";import"./log-out-CCSYfweR.js";import"./chevrons-up-down-Dx5zMBh7.js";import"./app-logo-icon-AsZY8TzN.js";import"./house-BPvUorqd.js";import"./building-sYDUExbj.js";import"./users-Cx0WPs1m.js";import"./wrench-CUEKGXnc.js";import"./credit-card-DsM7WiA3.js";import"./dollar-sign-BwSFA-ho.js";import"./file-text-BYo38brw.js";import"./triangle-alert-CTk5zCLO.js";import"./bell-CU32QIDE.js";import"./drawer-DFF_jVi3.js";import"./CityField-BcheRfvk.js";import"./label-TGf-rOKa.js";import"./popover-DdSV75dE.js";import"./command-DZJD3kpm.js";import"./search-DjaWC1MF.js";import"./VendorNameField-DjKB0Wnj.js";import"./input-C9nWuHON.js";import"./PhoneNumberField-DkcuriaC.js";import"./plus-COh7YTMB.js";import"./trash-2-CifiXUqC.js";import"./EmailField-BdavEUv_.js";import"./ServiceTypeField-DstTuOi9.js";import"./select-DH9YXgtJ.js";import"./index-BHdDvuH_.js";import"./chevron-down-DPdXkLmR.js";import"./check-Dye3JuSq.js";import"./chevron-up-CeaLGkuh.js";import"./CityField-CIrB_Nj3.js";import"./VendorNameField-B7pOjy_Y.js";import"./PhoneNumberField-PibenUCh.js";import"./EmailField-D8niIhXy.js";import"./ServiceTypeField-C2O5tKxD.js";import"./download-DNhQ9Ubq.js";import"./table-DpdbT0jv.js";import"./VendorTableRow-C6pIroTG.js";import"./square-pen-B47UA1Qy.js";const oe=(i,a="vendors.csv")=>{const c=["ID","City","Vendor Name","Number","Email","Service Type"],p=r=>!r||!Array.isArray(r)||r.length===0?"":r.join("; "),y=[c.join(","),...i.map(r=>[r.id,`"${r.city?.city||"N/A"}"`,`"${r.vendor_name}"`,`"${p(r.number)}"`,`"${p(r.email)}"`,`"${p(r.service_type)}"`].join(","))].join(`
`),u=new Blob([y],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)};function jt({vendors:i,filters:a,cities:c}){const[,p]=n.useState(a),[y,u]=n.useState(!1),[o,d]=n.useState(!1),[r,j]=n.useState(!1),[V,A]=n.useState(null),{flash:F}=B().props,{hasPermission:C,hasAllPermissions:_}=J(),[g,w]=n.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[v,N]=n.useState(a?.per_page?.toString?.()??"15"),[O,h]=n.useState(!1),f=(e,s)=>{w(m=>({...m,[e]:s}))},R=e=>{const s=e.target.value;f("city",s),h(s.length>0)},k=e=>{f("city",e.city),h(!1)},I=()=>{const e={...g,per_page:v};p(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},T=()=>{const e={city:"",vendor_name:""};w(e),p(e),h(!1),l.get(route("vendors.index"),{per_page:v},{preserveState:!0,preserveScroll:!0})},L=e=>{const s=e.target.value;N(s);const m={...g,per_page:s};l.get(route("vendors.index"),m,{preserveState:!0,preserveScroll:!0})},$=()=>{if(i.data.length===0){alert("No data to export");return}u(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{u(!1)}},U=e=>{if(!confirm("Are you sure you want to delete this vendor?"))return;const m=(()=>{try{const x=new URLSearchParams(window.location.search),S=["city","city_id","vendor_name","number","email","per_page","page"],E={};return S.forEach(P=>{const D=x.get(P);D!==null&&(E[P]=D)}),E}catch{return{}}})(),b={};[["city","filter_city"],["city_id","filter_city_id"],["vendor_name","filter_vendor_name"],["number","filter_number"],["email","filter_email"],["per_page","filter_per_page"],["page","filter_page"]].forEach(([x,S])=>{m[x]!==void 0&&(b[S]=m[x])}),l.delete(route("vendors.destroy",e.id),{preserveScroll:!0,preserveState:!0,data:b})},H=()=>{l.reload()},q=e=>{A(e),j(!0)},Q=()=>{l.reload()};return t.jsxs(K,{children:[t.jsx(M,{title:"Vendors"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(Y,{flash:F}),t.jsx(Z,{hasExportPermission:C("vendor.export"),hasCreatePermissions:_(["vendors.create","vendors.store"]),isExporting:y,onExport:$,onAddVendor:()=>d(!0)}),t.jsx(z,{children:t.jsxs(G,{className:"p-6",children:[t.jsx(ee,{tempFilters:g,cities:c,showCityDropdown:O,onTempFilterChange:f,onCityInputChange:R,onCitySelect:k,onSearchClick:I,onClearFilters:T,setShowCityDropdown:h}),t.jsx(te,{vendors:i.data,hasEditPermissions:_(["vendors.edit","vendors.update"]),hasDeletePermission:C("vendors.destroy"),onEditVendor:q,onDeleteVendor:U}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),t.jsxs("select",{value:v,onChange:L,className:"rounded-md border border-input bg-background px-2 py-1 text-sm shadow-sm focus:outline-none",children:[t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"all",children:"All"})]})]}),t.jsx(re,{links:i.links})]})]})})]})}),t.jsx(W,{cities:c,open:o,onOpenChange:d,onSuccess:H}),t.jsx(X,{cities:c,open:r,onOpenChange:j,vendor:V,onSuccess:Q})]})}export{jt as default};
