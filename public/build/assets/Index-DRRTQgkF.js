import{r as p,j as i,H as O,a as u}from"./app-DIEWn7Ix.js";import{C as P,b as k}from"./card-D0lM0cRg.js";import{u as N}from"./usePermissions-C5kTLoeu.js";import{A as L}from"./app-layout-C9S1njiG.js";import U from"./MoveInCreateDrawer-B4h9gP7M.js";import T from"./MoveInEditDrawer-Dbw0b9RC.js";import R from"./PageHeader-29Y2mmBL.js";import H from"./MoveInFilters-eppdIdPc.js";import V from"./MoveInTable-BJfsAxJo.js";import K from"./EmptyState-DEaWT4pl.js";import Z from"./PaginationInfo-n_ls9IdA.js";import"./app-ChTVGdbA.js";import"./utils-CBfrqCZ4.js";import"./index-Bt0zfGgm.js";import"./index-CdJFUDDL.js";import"./button-C0qpziZb.js";import"./index-DKA-WKms.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./index-Dc_FVRD7.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-BuLzMHmv.js";import"./collapsible-D1_DD34n.js";import"./chevron-right-lBI-HPj1.js";import"./index-Bp33PYYw.js";import"./log-out-CE4a_W2h.js";import"./chevrons-up-down-wcdr16Hr.js";import"./app-logo-icon-BrLszCI4.js";import"./house-DKj--ObP.js";import"./building-CBRSJYqv.js";import"./users-B43C_7xE.js";import"./wrench-DwJ9zT3b.js";import"./credit-card-D-F9DsZs.js";import"./dollar-sign-CTn_hGqc.js";import"./file-text-BkIwiqXy.js";import"./triangle-alert-mmtwxqk7.js";import"./bell-CBmeO6wA.js";import"./drawer-fqLIckn8.js";import"./CityPropertyUnitSelector-DED_luHy.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./LeaseInformationFields-7-9gy7PL.js";import"./radioGroup-BEE05Kck.js";import"./DatePickerField-DEuUAEIY.js";import"./calendar-A7iFafDy.js";import"./format-PYUiRpxY.js";import"./chevron-left-CWUKElF8.js";import"./popover-BTBKKAKu.js";import"./calendar-BV4TAGR8.js";import"./PaymentInformationFields-BqIBW_Nr.js";import"./KeysAndFormsFields-CpGi44Fv.js";import"./InsuranceInformationFields-1r3-r39P.js";import"./CitySelector-CBsKWH0h.js";import"./FormSection-DygG0rhZ.js";import"./PropertySelector-Re8c6Jh4.js";import"./UnitSelector-DrHEKqxd.js";import"./LeaseSigningSection-Cx4MFp7X.js";import"./RadioGroupField-BVYq9264.js";import"./DatePickerField-D-lDT-OY.js";import"./MoveInDetailsSection-DrdkaS0L.js";import"./PaymentSection-BY6ZPqu2.js";import"./KeysAndFormsSection-LkM0hK4x.js";import"./InsuranceSection-4iSiI9M5.js";import"./download-C1kHH7o-.js";import"./plus-DhhAwnw0.js";import"./input-Dp80VBC1.js";import"./search-Cudh47UL.js";import"./table-CvyjvZRw.js";import"./MoveInTableRow-CPtW18Km.js";import"./badge-n90aW425.js";import"./square-pen-BESSjlPV.js";import"./trash-2-BbHlzFlW.js";const q=(o,c="move-ins.csv")=>{try{const e=t=>{if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(s)}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),d=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...o.map(t=>{try{return[t.id||"",`"${a(t.city_name)}"`,`"${a(t.property_name)}"`,`"${a(t.unit_name)}"`,`"${a(t.signed_lease)}"`,`"${e(t.lease_signing_date)}"`,`"${e(t.move_in_date)}"`,`"${a(t.paid_security_deposit_first_month_rent)}"`,`"${e(t.scheduled_paid_time)}"`,`"${a(t.handled_keys)}"`,`"${e(t.move_in_form_sent_date)}"`,`"${a(t.filled_move_in_form)}"`,`"${e(t.date_of_move_in_form_filled)}"`,`"${a(t.submitted_insurance)}"`,`"${e(t.date_of_insurance_expiration)}"`].join(",")}catch(s){return console.error("Error processing move-in row:",t,s),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([d],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(f);return n.setAttribute("href",l),n.setAttribute("download",c),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Sr({moveIns:o,search:c,filters:e,units:a,cities:h,properties:d,unitsByProperty:f}){const[n,l]=p.useState(!1),[t,s]=p.useState(!1),[v,S]=p.useState(!1),[E,D]=p.useState(null),[y,g]=p.useState({city:e?.city||"",property:e?.property||"",search:e?.search||c||""});p.useEffect(()=>{g({city:e?.city||"",property:e?.property||"",search:e?.search||c||""})},[e,c]);const{hasPermission:_,hasAnyPermission:j}=N(),C=r=>{g(r);const m={};r.search?.trim()&&(m.search=r.search.trim()),r.city?.trim()&&(m.city=r.city.trim()),r.property?.trim()&&(m.property=r.property.trim()),u.get(route("move-in.index"),m,{preserveState:!0,preserveScroll:!0})},b=()=>{g({city:"",property:"",search:""}),u.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},w=r=>{confirm("Are you sure you want to delete this move-in record?")&&u.delete(route("move-in.destroy",r.id))},$=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}l(!0);try{console.log("Exporting move-in data:",o.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;q(o.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const m=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${m}. Please check the console for details.`)}finally{l(!1)}},M=()=>{u.reload()},A=()=>{u.reload()},F=r=>{D(r),S(!0)},x=y.search||y.city||y.property;return i.jsxs(L,{children:[i.jsx(O,{title:"Move-In Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(R,{hasActiveFilters:!!x,isExporting:n,hasData:o?.data&&o.data.length>0,hasCreatePermission:_("move-in.store"),onExport:$,onCreateClick:()=>s(!0)}),i.jsxs(P,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(H,{cities:h,properties:d,initialFilters:y,onSearch:C,onClear:b,hasActiveFilters:!!x}),i.jsxs(k,{children:[i.jsx(V,{moveIns:o.data,canEdit:_("move-in.update"),canDelete:_("move-in.destroy"),showActions:j(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:F,onDelete:w}),o.data.length===0&&i.jsx(K,{hasActiveFilters:!!x}),o.meta&&i.jsx(Z,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})]})]})}),i.jsx(U,{units:a,cities:h,properties:d,unitsByProperty:f,open:t,onOpenChange:s,onSuccess:M}),E&&i.jsx(T,{moveIn:E,units:a,cities:h,properties:d,unitsByProperty:f,open:v,onOpenChange:S,onSuccess:A})]})}export{Sr as default};
