import{r as s,j as e,H as Ne,L as ye,a as N}from"./app-nUSYw4ai.js";import{B as F}from"./badge-D3YraplM.js";import{B as p}from"./createLucideIcon-C5GD6QeA.js";import{C as we,a as ke,b as Ce}from"./card-Nz8H8S7P.js";import{I as w}from"./input-OhVo65AQ.js";import{P as Se,T as _e,a as De,b as ee,c as a,d as Te,e as d,f as Ee}from"./table-DNmiDd_k.js";import{u as Ie,A as Pe}from"./app-layout-SVUR4mDr.js";import Re from"./VendorTaskTrackerCreateDrawer-BlFgp9CU.js";import Ve from"./VendorTaskTrackerEditDrawer-C90shktE.js";import{D as Le}from"./download-Cfi3vdAl.js";import{C as O}from"./chevron-up-BHOYq5G1.js";import{S as ze}from"./search-D9q-g70L.js";import{X as Fe}from"./index-5YpAK82Y.js";import{E as Oe}from"./eye-Bt0sbOX4.js";import{S as $e}from"./square-pen-BsWDWlPj.js";import{f as Ae}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-UYkM-lg7.js";import"./index-nh9QAngE.js";import"./index-DbaH1TRh.js";import"./index-DGbRjXgX.js";import"./index-CedKduyQ.js";import"./index-BKS2-tOY.js";import"./collapsible-BaDJNkTm.js";import"./chevron-right-uK37_yne.js";import"./log-out-Ct0Az9_H.js";import"./app-logo-icon-kFXdOc6h.js";import"./house-0n7o0-rx.js";import"./building-BIZdrc6N.js";import"./users-BhWwggl0.js";import"./wrench-SwJ0VGsJ.js";import"./credit-card-BdaPoiio.js";import"./dollar-sign-DvmVu0rD.js";import"./file-text-B1Xrnfk_.js";import"./triangle-alert-DaU4wCbf.js";import"./bell-BOTwwMit.js";import"./popover-CMnBhXYh.js";import"./drawer-ikeMES7v.js";import"./label-DtPmPEai.js";import"./select-PjIVfLW0.js";import"./index-mn3Hv6wy.js";import"./radioGroup-BdD1VW6H.js";import"./calendar-C-0kt65W.js";const b=(n,i="-")=>{if(!n)return i;const h=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!h)return i;const[,l,m,c]=h,u=new Date(Number(l),Number(m)-1,Number(c));return Ae(u,"P")},Ue=(n,i="vendor-tasks.csv")=>{const l=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...n.map(o=>[o.id,`"${o.city||""}"`,`"${o.property_name||""}"`,`"${o.unit_name||""}"`,`"${o.vendor_name||""}"`,`"${b(o.task_submission_date,"")}"`,`"${(o.assigned_tasks||"").replace(/"/g,'""')}"`,`"${b(o.any_scheduled_visits,"")}"`,`"${b(o.task_ending_date,"")}"`,`"${(o.notes||"").replace(/"/g,'""')}"`,`"${o.status||""}"`,`"${o.urgent}"`].join(","))].join(`
`),m=new Blob([l],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),u=URL.createObjectURL(m);c.setAttribute("href",u),c.setAttribute("download",i),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(u)};function Ir({tasks:n,filters:i,units:h,cities:l,properties:m,unitsByCity:c,propertiesByCity:u,unitsByProperty:o,vendorsByCity:$,vendors:k}){const{hasPermission:A,hasAnyPermission:U,hasAllPermissions:H}=Ie(),[C,B]=s.useState(i),[q,X]=s.useState(!1),[re,S]=s.useState(!1),[te,_]=s.useState(!1),[Y,G]=s.useState(null),[y,D]=s.useState(i.city||""),[se,g]=s.useState(!1),[J,K]=s.useState([]),T=s.useRef(null),E=s.useRef(null),[M,I]=s.useState(i.property||""),[oe,v]=s.useState(!1),P=s.useRef(null),R=s.useRef(null),[Q,V]=s.useState(i.vendor_name||""),[ne,j]=s.useState(!1),L=s.useRef(null),z=s.useRef(null);s.useEffect(()=>{if(l)if(y.trim()==="")K(l);else{const r=l.filter(t=>t.city.toLowerCase().includes(y.toLowerCase()));K(r)}},[y,l]);const W=m?.filter(r=>r.property_name.toLowerCase().includes(M.toLowerCase()))||[],Z=k?.filter(r=>r.vendor_name.toLowerCase().includes(Q.toLowerCase()))||[];s.useEffect(()=>{const r=t=>{E.current&&!E.current.contains(t.target)&&T.current&&!T.current.contains(t.target)&&g(!1),R.current&&!R.current.contains(t.target)&&P.current&&!P.current.contains(t.target)&&v(!1),z.current&&!z.current.contains(t.target)&&L.current&&!L.current.contains(t.target)&&j(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const ae=()=>{N.reload(),S(!1)},de=()=>{N.reload(),_(!1),G(null)},ce=r=>{G(r),_(!0)},x=(r,t)=>{B({...C,[r]:t})},le=r=>{D(r),x("city",r),g(!1)},ie=r=>{D(r),x("city",r),g(!0)},me=r=>{const t=r.target.value;I(t),x("property",t),v(t.length>0)},ue=r=>{I(r.property_name),x("property",r.property_name),v(!1)},xe=r=>{const t=r.target.value;V(t),x("vendor_name",t),j(t.length>0)},pe=r=>{V(r.vendor_name),x("vendor_name",r.vendor_name),j(!1)},he=()=>{const r={};Object.entries(C).forEach(([t,f])=>{f!=null&&f!==""&&(r[t]=String(f))}),N.get(route("vendor-task-tracker.index"),r,{preserveState:!0,preserveScroll:!0})},fe=()=>{B({}),D(""),I(""),V(""),g(!1),v(!1),j(!1),N.get(route("vendor-task-tracker.index"),{},{preserveState:!0,preserveScroll:!0})},be=r=>{confirm("Are you sure you want to archive this task?")&&N.delete(route("vendor-task-tracker.destroy",r.id))},ge=()=>{if(n.data.length===0){alert("No data to export");return}X(!0);try{const r=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Ue(n.data,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{X(!1)}},ve=r=>e.jsx(F,{variant:r==="Yes"?"destructive":"secondary",children:r}),je=r=>{const t=r??null;if(!t)return e.jsx(F,{variant:"outline",children:"No Status"});const f=t.toLowerCase().includes("completed")?"default":t.toLowerCase().includes("pending")?"secondary":"outline";return e.jsx(F,{variant:f,children:t})};return e.jsxs(Pe,{children:[e.jsx(Ne,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Vendor Task Tracker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:ge,disabled:q||n.data.length===0,className:"flex items-center",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),q?"Exporting...":"Export CSV"]}),H(["vendor-task-tracker.create","vendor-task-tracker.store"])&&e.jsxs(p,{onClick:()=>S(!0),children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Add Task"]})]})]}),e.jsxs(we,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ke,{children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:T,type:"text",placeholder:"Filter by City",value:y,onChange:r=>ie(r.target.value),onFocus:()=>g(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),se&&J.length>0&&e.jsx("div",{ref:E,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>le(r.city),children:r.city},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:P,type:"text",placeholder:"Filter by Property",value:M,onChange:me,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&W.length>0&&e.jsx("div",{ref:R,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:W.map(r=>e.jsxs("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ue(r),children:[r.property_name,r.city&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",r.city,")"]})]},r.id))})]}),e.jsx(w,{type:"text",placeholder:"Filter by Unit",value:C.unit_name||"",onChange:r=>x("unit_name",r.target.value),className:"text-input-foreground bg-input"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:L,type:"text",placeholder:"Filter by Vendor",value:Q,onChange:xe,onFocus:()=>j(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&Z.length>0&&e.jsx("div",{ref:z,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Z.map(r=>e.jsxs("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>pe(r),children:[r.vendor_name,r.city&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",r.city,")"]})]},r.id))})]}),e.jsxs(p,{onClick:he,variant:"default",className:"flex items-center",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(p,{onClick:fe,variant:"outline",className:"flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Clear"]})]})}),e.jsxs(Ce,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(_e,{className:"border-collapse rounded-md border border-border",children:[e.jsx(De,{children:e.jsxs(ee,{className:"border-border",children:[e.jsx(a,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(a,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(a,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(a,{className:"sticky left-[390px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Vendor Name"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Submission Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Assigned Tasks"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Scheduled Visits"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Task End Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Notes"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Urgent"}),U(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])&&e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(Te,{children:n.data.map(r=>e.jsxs(ee,{className:"border-border hover:bg-muted/50",children:[e.jsx(d,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city||"-"}),e.jsx(d,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property_name||"-"}),e.jsx(d,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.unit_name||"-"}),e.jsx(d,{className:"sticky left-[390px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.vendor_name||"-"}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.task_submission_date)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:e.jsx("div",{className:"max-w-32 truncate",title:r.assigned_tasks||"",children:r.assigned_tasks||"-"})}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.any_scheduled_visits)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.task_ending_date)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:e.jsx("div",{className:"max-w-24 truncate",title:r.notes||"",children:r.notes||"-"})}),e.jsx(d,{className:"border border-border text-center",children:je(r.status)}),e.jsx(d,{className:"border border-border text-center",children:ve(r.urgent)}),U(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])&&e.jsx(d,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[A("vendor-task-tracker.show")&&e.jsx(ye,{href:route("vendor-task-tracker.show",r.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(Oe,{className:"h-4 w-4"})})}),H(["vendor-task-tracker.edit","vendor-task-tracker.update"])&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>ce(r),children:e.jsx($e,{className:"h-4 w-4"})}),A("vendor-task-tracker.destroy")&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>be(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]},r.id))})]})}),n.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tasks found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters or clearing them to see all tasks."})]}),n.meta&&e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",n.meta.from||0," to ",n.meta.to||0," of ",n.meta.total||0," results"]})]})]})]})}),e.jsx(Re,{cities:l,properties:m,units:h,vendors:k,unitsByCity:c,propertiesByCity:u,unitsByProperty:o,vendorsByCity:$,open:re,onOpenChange:S,onSuccess:ae}),Y&&e.jsx(Ve,{task:Y,cities:l,properties:m,units:h,vendors:k,unitsByCity:c,propertiesByCity:u,unitsByProperty:o,vendorsByCity:$,open:te,onOpenChange:_,onSuccess:de})]})}export{Ir as default};
