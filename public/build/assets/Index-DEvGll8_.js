import{r as a,b as q,a as v,j as e,H as je}from"./app-C79wt3tX.js";import{u as fe,A as ge,H as D}from"./app-layout-CQQyJnHK.js";import{B as d}from"./createLucideIcon-C1z_f29J.js";import{I as X}from"./input-BS89LrTW.js";import{L as V}from"./label-CArU7ATR.js";import{C as F,a as _,c as P,b as I}from"./card-AzpDVrLx.js";import{P as G,T as Ne,a as be,b as K,c as A,d as ve,e as z,f as ye}from"./table-BkCbQJPV.js";import{B as L}from"./badge-BxLpr-IS.js";import{A as Ce,a as we}from"./alert-C2MdDTBO.js";import{S as J,a as Q,b as Y,c as Z,d as B}from"./select-4_arDXlR.js";import{B as Se}from"./building-2-Di3iXPYV.js";import{U as M,F as W}from"./upload-CUSYaqTV.js";import{X as y}from"./index-DkjncacZ.js";import{S as $}from"./search-BTrBOoaV.js";import{L as ke}from"./loader-circle-29bbHCsR.js";import{C as ee}from"./circle-check-big-Bq2J0eZh.js";import{C as H}from"./circle-alert-BzASD5aK.js";import{S as se}from"./square-pen-C2yNsVP7.js";import{M as Fe}from"./map-pin-HpWmO8Ji.js";import{C as _e}from"./circle-x-spimeuTI.js";import"./app-Do7cDRzv.js";import"./index-DMpLQi-Z.js";import"./index-CkXl1I8e.js";import"./index-ChhieIKn.js";import"./index-DLJGb8q0.js";import"./chevron-right-CkaRxpST.js";import"./app-logo-icon-CJ6cgBSF.js";import"./file-text-DtifDZmy.js";import"./index-BUbw163t.js";const Pe=({type:s,message:c,onClose:l,duration:r=4e3})=>{a.useEffect(()=>{const h=setTimeout(()=>{l()},r);return()=>clearTimeout(h)},[l,r]);const n=()=>{switch(s){case"success":return e.jsx(ee,{className:"h-5 w-5 text-green-500"});case"error":return e.jsx(_e,{className:"h-5 w-5 text-red-500"});case"info":return e.jsx(H,{className:"h-5 w-5 text-blue-500"});default:return e.jsx(H,{className:"h-5 w-5 text-blue-500"})}},t=()=>{switch(s){case"success":return"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800";case"error":return"bg-red-50 border-red-200 dark:bg-red-950 dark:border-red-800";case"info":return"bg-blue-50 border-blue-200 dark:bg-blue-950 dark:border-blue-800";default:return"bg-blue-50 border-blue-200 dark:bg-blue-950 dark:border-blue-800"}};return e.jsx("div",{className:`fixed top-4 right-4 z-50 min-w-80 max-w-md p-4 rounded-lg border shadow-lg transform transition-all duration-300 ease-in-out ${t()}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[n(),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:c})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:l,className:"h-6 w-6 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(y,{className:"h-4 w-4"})})]})})},Ie=()=>{const[s,c]=a.useState(null),l=a.useCallback((n,t)=>{c({type:n,message:t})},[]),r=a.useCallback(()=>{c(null)},[]);return{notification:s,showNotification:l,hideNotification:r}},Te=({stats:s,onClose:c})=>s?e.jsxs(F,{className:"mb-6 border-green-200 bg-green-50 dark:bg-green-950/20 dark:border-green-800",children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-green-600"}),e.jsx(P,{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:"Import Completed Successfully"})]}),e.jsx(d,{onClick:c,variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-800 dark:text-green-400",children:e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:s.total_rows}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:"Total Rows"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:s.cities_created}),e.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Cities Created"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:s.cities_updated}),e.jsx("div",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Cities Updated"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:s.properties_created}),e.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:"Properties Created"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:s.properties_updated}),e.jsx("div",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Properties Updated"})]})]}),s.errors&&s.errors.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h4",{className:"font-semibold text-red-700 dark:text-red-300 mb-2",children:["Import Errors (",s.errors.length,"):"]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-md p-3 max-h-40 overflow-y-auto",children:[s.errors.slice(0,5).map((l,r)=>e.jsxs("div",{className:"text-sm text-red-700 dark:text-red-300 mb-1",children:["• ",l]},r)),s.errors.length>5&&e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400 italic",children:["... and ",s.errors.length-5," more errors"]})]})]})]})]}):null,Ee=({isOpen:s,onClose:c,onSubmit:l,isLoading:r})=>{const n=a.useRef(null),[t,h]=a.useState(null),[j,u]=a.useState(!1),o=m=>{m&&m.type==="text/csv"?h(m):alert("Please select a valid CSV file.")},f=m=>{const g=m.target.files?.[0];g&&o(g)},x=m=>{m.preventDefault(),u(!1);const g=m.dataTransfer.files[0];g&&o(g)},b=m=>{m.preventDefault(),t&&l(t)},C=()=>{h(null),u(!1),n.current&&(n.current.value="")},N=()=>{C(),c()};return a.useEffect(()=>{s||C()},[s]),s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(F,{className:"w-full max-w-md bg-background",children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),e.jsx(P,{children:"Import Properties from CSV"})]}),e.jsx(d,{onClick:N,variant:"ghost",size:"sm",disabled:r,children:e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsx(I,{children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"CSV File"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${j?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDrop:x,onDragOver:m=>{m.preventDefault(),u(!0)},onDragLeave:()=>u(!1),children:[t?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{className:"h-8 w-8 text-green-600 mx-auto"}),e.jsx("p",{className:"font-medium text-green-700",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(t.size/1024).toFixed(1)," KB"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-8 w-8 text-muted-foreground mx-auto"}),e.jsxs("p",{className:"text-muted-foreground",children:["Drop your CSV file here or"," ",e.jsx(d,{type:"button",variant:"link",className:"p-0 h-auto text-primary",onClick:()=>n.current?.click(),children:"browse files"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CSV files only, max 10MB"})]}),e.jsx("input",{ref:n,type:"file",accept:".csv",onChange:f,className:"hidden",disabled:r})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Required CSV Columns:"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Property name"})," - Name of the property"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"City/Locality"})," - City where property is located"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(d,{type:"submit",disabled:!t||r,className:"flex-1",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Import CSV"]})}),e.jsx(d,{type:"button",variant:"outline",onClick:N,disabled:r,children:"Cancel"})]})]})})]})}):null},Ae=({onSubmit:s,onCancel:c,isLoading:l,error:r,cities:n,editingProperty:t})=>{const[h,j]=a.useState(t?.property_name||""),[u,o]=a.useState(t?.city_id?.toString()||""),f=x=>{x.preventDefault(),h.trim()&&(s({property_name:h.trim(),city_id:u?parseInt(u):null}),t||(j(""),o("")))};return e.jsxs(F,{className:"bg-card text-card-foreground shadow-lg border-primary/10",children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-primary"}),e.jsx(P,{className:"text-xl font-semibold",children:t?"Edit Property":"Add New Property"})]}),e.jsx(d,{onClick:c,variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",children:e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsxs(I,{children:[r&&e.jsxs(Ce,{className:"mb-4 text-destructive",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(we,{className:"text-destructive",children:r})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"property_name",className:"text-sm font-medium",children:["Property Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(X,{id:"property_name",type:"text",value:h,onChange:x=>j(x.target.value),placeholder:"Enter property name (e.g., Sunset Apartments, Oak Street Complex)",className:"transition-colors focus:border-primary",disabled:l,autoComplete:"off"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"city_id",className:"text-sm font-medium",children:["City ",e.jsx("span",{className:"text-muted-foreground",children:"(Optional)"})]}),e.jsxs(J,{value:u,onValueChange:o,disabled:l,children:[e.jsx(Q,{children:e.jsx(Y,{placeholder:"Select a city (optional)"})}),e.jsx(Z,{children:n.map(x=>e.jsx(B,{value:x.id.toString(),children:x.city},x.id))})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(d,{type:"submit",disabled:l||!h.trim(),className:"flex-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent"}),t?"Updating...":"Adding..."]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Update Property"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Property"]})})}),e.jsx(d,{type:"button",variant:"outline",onClick:c,disabled:l,children:"Cancel"})]})]})]})]})},ze=({properties:s,onDelete:c,onEdit:l,canEdit:r,canDelete:n,canView:t,searchTerm:h,cityFilter:j})=>{const u=a.useCallback((o,f)=>{window.confirm(`Are you sure you want to delete "${f}"? This action cannot be undone.`)&&c(o)},[c]);return s.length===0&&(h||j)?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-foreground",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground",children:"No properties match your current filters"})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-foreground",children:"No properties yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Get started by adding your first property"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-hidden rounded-lg border border-border",children:e.jsxs(Ne,{children:[e.jsx(be,{children:e.jsxs(K,{className:"bg-muted/50 hover:bg-muted/50",children:[e.jsx(A,{className:"font-semibold text-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Property Name"]})}),e.jsx(A,{className:"font-semibold text-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"City"]})}),(r||n||t)&&e.jsx(A,{className:"font-semibold text-foreground w-32",children:"Actions"})]})}),e.jsx(ve,{children:s.map(o=>e.jsxs(K,{className:"hover:bg-muted/30 transition-colors group",children:[e.jsx(z,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary/60"}),e.jsx("span",{className:"text-foreground",children:o.property_name})]})}),e.jsx(z,{children:o.city?e.jsx(L,{variant:"secondary",className:"font-normal",children:o.city.city}):e.jsx("span",{className:"text-muted-foreground italic",children:"No city assigned"})}),(r||n||t)&&e.jsx(z,{children:e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[r&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>l(o),className:"text-muted-foreground hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-950",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsxs("span",{className:"sr-only",children:["Edit ",o.property_name]})]}),n&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>u(o.id,o.property_name),className:"text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs("span",{className:"sr-only",children:["Delete ",o.property_name]})]})]})})]},o.id))})]})}),e.jsx("div",{className:"flex items-center justify-between pt-4 text-sm text-muted-foreground border-t border-border",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"secondary",className:"font-mono",children:s.length}),e.jsxs("span",{children:[s.length===1?"property":"properties"," on this page"]})]})})]})},De=({paginationData:s,filters:c})=>{const l=r=>{r&&v.get(r,c,{preserveState:!0,preserveScroll:!0})};return s.last_page<=1?null:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.from," to ",s.to," of ",s.total," results"]}),e.jsx("div",{className:"flex items-center gap-2",children:s.links.map((r,n)=>e.jsx(d,{variant:r.active?"default":"outline",size:"sm",onClick:()=>l(r.url),disabled:!r.url,className:"min-w-[2.5rem]",dangerouslySetInnerHTML:{__html:r.label}},n))})]})},ms=({properties:s,cities:c,filters:l,importStats:r})=>{const[n,t]=a.useState(!1),[h,j]=a.useState(!1),[u,o]=a.useState(!!r),[f,x]=a.useState(null),[b,C]=a.useState(l.search||""),[N,m]=a.useState(l.city_filter?.toString()||""),{notification:g,showNotification:p,hideNotification:re}=Ie(),{processing:te,errors:U,reset:w}=q({property_name:"",city_id:null}),S=q({csv_file:null}),{hasPermission:k,hasAllPermissions:ae}=fe(),T=ae(["all-properties.store","all-properties.create"]),le=k("all-properties.update"),ne=k("all-properties.destroy"),ie=k("all-properties.show"),ce=k("all-properties.import"),oe=a.useCallback(i=>{f?v.put(`/all-properties/${f.id}`,i,{onSuccess:()=>{w(),t(!1),x(null),p("success",`Property "${i.property_name}" has been updated successfully!`)},onError:()=>{p("error","Failed to update property. Please try again.")}}):v.post("/all-properties",i,{onSuccess:()=>{w(),t(!1),p("success",`Property "${i.property_name}" has been added successfully!`)},onError:()=>{p("error","Failed to add property. Please try again.")}})},[f,w,p]),de=a.useCallback(i=>{S.setData("csv_file",i),v.post("/all-properties/import",{csv_file:i},{forceFormData:!0,onSuccess:()=>{j(!1),S.reset(),p("success","CSV file imported successfully!")},onError:O=>{const E=O.csv_file||"Failed to import CSV file. Please try again.";p("error",E)},onFinish:()=>{S.clearErrors()}})},[S,p]),me=a.useCallback(i=>{const E=s.data.find(pe=>pe.id===i)?.property_name||"Unknown";v.delete(`/all-properties/${i}`,{onSuccess:()=>{p("success",`Property "${E}" has been deleted successfully!`)},onError:()=>{p("error","Failed to delete property. Please try again.")}})},[s.data,p]),xe=a.useCallback(i=>{x(i),t(!0)},[]),he=a.useCallback(()=>{t(!1),x(null),w()},[w]),R=a.useCallback(()=>{v.visit("/all-properties",{data:{search:b||void 0,city_filter:N||void 0},preserveState:!0,preserveScroll:!0})},[b,N]),ue=a.useCallback(()=>{C(""),m(""),v.visit("/all-properties",{preserveState:!0,preserveScroll:!0})},[]);return e.jsxs(ge,{children:[e.jsx(je,{title:"Properties Without Insurance"}),g&&e.jsx(Pe,{type:g.type,message:g.message,onClose:re}),e.jsx(Ee,{isOpen:h,onClose:()=>j(!1),onSubmit:de,isLoading:S.processing}),e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[u&&r&&e.jsx(Te,{stats:r,onClose:()=>o(!1)}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center gap-3",children:[e.jsx(Se,{className:"h-8 w-8 text-primary"}),"Properties Without Insurance"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage properties that don't require insurance coverage"})]}),e.jsxs("div",{className:"flex gap-3",children:[ce&&e.jsxs(d,{onClick:()=>j(!0),variant:"outline",size:"lg",className:"shadow-lg border-primary/20 hover:border-primary/40",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Import CSV"]}),T&&e.jsx(d,{onClick:()=>{x(null),t(!n)},variant:n?"outline":"default",size:"lg",className:"shadow-lg",children:n?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Property"]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[n&&T&&e.jsx("div",{className:"lg:col-span-4",children:e.jsx(Ae,{onSubmit:oe,onCancel:he,isLoading:te,error:U.property_name||U.city_id,cities:c,editingProperty:f})}),e.jsx("div",{className:`${n&&T?"lg:col-span-8":"lg:col-span-12"}`,children:e.jsxs(F,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(P,{className:"text-xl font-semibold",children:"Properties Directory"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Search properties...",value:b,onChange:i=>C(i.target.value),className:"pl-10 bg-background",onKeyDown:i=>i.key==="Enter"&&R()})]}),e.jsxs(J,{value:N,onValueChange:m,children:[e.jsx(Q,{className:"w-full sm:w-48",children:e.jsx(Y,{placeholder:"Filter by city"})}),e.jsxs(Z,{children:[e.jsx(B,{value:"all-cities",children:"All Cities"}),c.map(i=>e.jsx(B,{value:i.id.toString(),children:i.city},i.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:R,variant:"outline",size:"sm",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Search"]}),(b||N)&&e.jsxs(d,{onClick:ue,variant:"ghost",size:"sm",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Clear"]})]})]})]})}),e.jsxs(I,{children:[e.jsx(ze,{properties:s.data,onDelete:me,onEdit:xe,canEdit:le,canDelete:ne,canView:ie,searchTerm:b,cityFilter:N}),e.jsx("div",{className:"mt-6",children:e.jsx(De,{paginationData:s,filters:l})})]})]})})]})]})})]})};export{ms as default};
