import{r as o,j as e,H as ie,L as le,a as C}from"./app-Dn1r5IbR.js";import{B as h}from"./badge-RsTSOVo0.js";import{B as p}from"./button-DoJlCKhy.js";import{C as ce,a as me,b as ue}from"./card-CC5S67z1.js";import{I as L}from"./input-DJHjvjS7.js";import{T as xe,a as pe,b as Y,c as i,d as fe,e as l}from"./table-Db_Q7fBX.js";import{u as be,A as he}from"./app-layout-DnYRhJak.js";import ge from"./PaymentCreateDrawer-CuVrJ20O.js";import je from"./PaymentEditDrawer-I_4JJH4V.js";import{D as Ne}from"./download-6aFrEsoc.js";import{P as ve}from"./plus-Dipb1hms.js";import{C as O}from"./chevron-down-Bfpn-qjr.js";import{S as we}from"./search-BFedrvkI.js";import{E as ye}from"./eye-CqYxBCw5.js";import{S as Se}from"./square-pen-FxHG6met.js";import{T as Ce}from"./trash-2-D4imcYNn.js";import{f as ke}from"./format-PYUiRpxY.js";import"./app-BmbQfT0_.js";import"./index-DF1-xgR-.js";import"./utils-CBfrqCZ4.js";import"./index-C_Yr3VBI.js";import"./index-Dc_FVRD7.js";import"./index-cId8iuZu.js";import"./index-WPnjh8bd.js";import"./index-qhuad6ry.js";import"./index-C5yiDUFi.js";import"./index-CGaG4LkD.js";import"./index-BHn9DcD9.js";import"./index-BV3nWfAJ.js";import"./x-BwrjvaMS.js";import"./createLucideIcon-ezkluWMI.js";import"./index-h5kqUyi-.js";import"./index-IWqIVFcu.js";import"./index-q0Alrdsu.js";import"./collapsible-qDUSHKwG.js";import"./chevron-right-BXKQFlIK.js";import"./index-rczzAiLR.js";import"./log-out-Ct01-_Ob.js";import"./app-logo-icon-BlbTi8ah.js";import"./house-DJeZoJEi.js";import"./building-BqS3fvcq.js";import"./users-DQ0jSc7b.js";import"./wrench-CQBd_7T8.js";import"./credit-card-D5_xJTq0.js";import"./dollar-sign-Ci_GX2V5.js";import"./file-text-goluWCNr.js";import"./triangle-alert-Dv1F3tRV.js";import"./bell-DmBxL8R5.js";import"./popover-CuJpm8qA.js";import"./drawer-BbQvx4Pm.js";import"./label-CyLYjr_a.js";import"./radioGroup-Dyu-l9CF.js";import"./index-C0T19-Xq.js";import"./select-BPfsX62k.js";import"./check-CZby3Z4H.js";import"./chevron-up-CyiongBQ.js";import"./calendar-Xujg-VPa.js";const M=(s,u="-")=>{if(!s)return u;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return u;const[,d,f,g]=n,b=new Date(Number(d),Number(f)-1,Number(g));return ke(b,"P")},Pe=(s,u="payments.csv")=>{try{const n=t=>t==null||isNaN(t)?"0.00":Number(t).toFixed(2),d=t=>t==null?"":String(t).replace(/"/g,'""'),f=t=>{if(!t)return"";try{return M(t,"")}catch{return t||""}},b=[["ID","Date","City","Property Name","Unit Name","Owes","Paid","Left to Pay","Status","Notes","Reversed Payments","Permanent"].join(","),...s.map(t=>{try{return[t.id||"",`"${f(t.date)}"`,`"${d(t.city)}"`,`"${d(t.property_name)}"`,`"${d(t.unit_name)}"`,n(t.owes),n(t.paid),n(t.left_to_pay),`"${d(t.status)}"`,`"${d(t.notes)}"`,`"${d(t.reversed_payments)}"`,`"${d(t.permanent)}"`].join(",")}catch(N){return console.error("Error processing payment row:",t,N),""}}).filter(t=>t!=="")].join(`
`),j=new Blob([b],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),y=URL.createObjectURL(j);return x.setAttribute("href",y),x.setAttribute("download",u),x.style.visibility="hidden",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(y),!0}catch(n){throw console.error("CSV Export Error:",n),n}};function Ur({payments:s,filters:u,units:n,cities:d,properties:f,unitsByCity:g,unitsByProperty:b,propertiesByCity:j,allCities:x,allProperties:y}){const{hasPermission:t,hasAnyPermission:N,hasAllPermissions:T}=be(),[$,I]=o.useState(!1),[G,H]=o.useState(!1),[J,B]=o.useState(!1),[V,K]=o.useState(null),[c,k]=o.useState(u?.city||""),[m,S]=o.useState(u?.property||""),[v,w]=o.useState(u?.unit||""),[Q,P]=o.useState(!1),[W,D]=o.useState(!1),[X,E]=o.useState(!1),F=o.useRef(null),U=o.useRef(null),z=o.useRef(null),q=x||[],Z=y||[],R=()=>{let r=n;return c&&(r=r.filter(a=>a.city===c)),m&&(r=r.filter(a=>a.property_name===m)),[...new Set(r.map(a=>a.unit_name))].sort()},_=()=>c?j[c]||[]:Z;o.useEffect(()=>{const r=a=>{F.current&&!F.current.contains(a.target)&&P(!1),U.current&&!U.current.contains(a.target)&&D(!1),z.current&&!z.current.contains(a.target)&&E(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),o.useEffect(()=>{c&&m&&(_().includes(m)||(S(""),w("")))},[c]),o.useEffect(()=>{m&&v&&(R().includes(v)||w(""))},[c,m]);const ee=r=>{r.preventDefault();const a={};c&&(a.city=c),m&&(a.property=m),v&&(a.unit=v),C.get(route("payments.index"),a,{preserveState:!0,preserveScroll:!0})},re=()=>{k(""),S(""),w(""),C.get(route("payments.index"),{},{preserveState:!0,preserveScroll:!0})},te=r=>{confirm("Are you sure you want to delete this payment?")&&C.delete(route("payments.destroy",r.id))},se=r=>{K(r),B(!0)},oe=()=>{C.reload()},ae=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}I(!0);try{console.log("Exporting payments data:",s.data);const r=`payments-${new Date().toISOString().split("T")[0]}.csv`;Pe(s.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}. Please check the console for details.`)}finally{I(!1)}},A=r=>r==null||isNaN(r)?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),ne=r=>r?r.toLowerCase().includes("paid")?e.jsx(h,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:r}):r.toLowerCase().includes("pending")?e.jsx(h,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:r}):e.jsx(h,{variant:"outline",children:r}):e.jsx(h,{variant:"outline",children:"N/A"}),de=r=>r?e.jsx(h,{variant:r==="Yes"?"default":"secondary",className:r==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:r}):e.jsx(h,{variant:"outline",children:"N/A"});return e.jsxs(he,{children:[e.jsx(ie,{title:"Payments"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Payments Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:ae,disabled:$||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),$?"Exporting...":"Export CSV"]}),T(["payments.create","payments.store"])&&e.jsxs(p,{onClick:()=>H(!0),className:"bg-primary text-background",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Add Payment"]})]})]}),e.jsxs(ce,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(me,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-5",children:[e.jsxs("div",{className:"relative",ref:F,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by city...",value:c,onChange:r=>k(r.target.value),onFocus:()=>P(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),Q&&q.length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:q.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{k(r),P(!1)},children:r},r))})]}),e.jsxs("div",{className:"relative",ref:U,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by property...",value:m,onChange:r=>S(r.target.value),onFocus:()=>D(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),W&&_().length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:_().map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{S(r),D(!1)},children:r},r))})]}),e.jsxs("div",{className:"relative",ref:z,children:[e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:"text",placeholder:"Filter by unit...",value:v,onChange:r=>w(r.target.value),onFocus:()=>E(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"})]}),X&&R().length>0&&e.jsx("div",{className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-input bg-popover shadow-lg",children:R().map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent",onClick:()=>{w(r),E(!1)},children:r},r))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:ee,variant:"default",className:"flex-1",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsx(p,{onClick:re,variant:"outline",size:"sm",className:"whitespace-nowrap",children:"Clear"})]})]})}),e.jsxs(ue,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(xe,{className:"border-collapse rounded-md border border-border",children:[e.jsx(pe,{children:e.jsxs(Y,{className:"border-border",children:[e.jsx(i,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(i,{className:"sticky left-[120px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(i,{className:"sticky left-[240px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Date"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Owes"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Paid"}),e.jsx(i,{className:"border border-border bg-muted text-right text-muted-foreground",children:"Left to Pay"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Note"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Reversed Payments"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Permanent"}),N(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(fe,{children:s.data.map(r=>e.jsxs(Y,{className:"border-border hover:bg-muted/50",children:[e.jsx(l,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.city}),e.jsx(l,{className:"sticky left-[120px] z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.property_name||"N/A"}),e.jsx(l,{className:"sticky left-[240px] z-10 min-w-[120px] border border-border bg-card text-center font-medium text-foreground",children:r.unit_name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:M(r.date)}),e.jsx(l,{className:"border border-border text-center font-medium text-red-600 dark:text-red-400",children:A(r.owes)}),e.jsx(l,{className:"border border-border text-center text-green-600 dark:text-green-400",children:A(r.paid)}),e.jsx(l,{className:"border border-border text-center font-medium text-blue-600 dark:text-blue-400",children:A(r.left_to_pay)}),e.jsx(l,{className:"border border-border text-center",children:ne(r.status)}),e.jsx(l,{className:"border border-border text-center text-foreground max-w-32 truncate",children:r.notes}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.reversed_payments}),e.jsx(l,{className:"border border-border text-center",children:de(r.permanent)}),N(["payments.show","payments.edit","payments.update","payments.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1 justify-center",children:[t("payments.show")&&e.jsx(le,{href:route("payments.show",r.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(ye,{className:"h-4 w-4"})})}),T(["payments.edit","payments.update"])&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>se(r),children:e.jsx(Se,{className:"h-4 w-4"})}),t("payments.destroy")&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Ce,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No payments found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})]})}),e.jsx(ge,{open:G,onOpenChange:H,units:n,cities:d,properties:f,unitsByCity:g,unitsByProperty:b,propertiesByCity:j}),V&&e.jsx(je,{payment:V,units:n,cities:d,properties:f,unitsByCity:g,unitsByProperty:b,propertiesByCity:j,open:J,onOpenChange:B,onSuccess:oe})]})}export{Ur as default};
