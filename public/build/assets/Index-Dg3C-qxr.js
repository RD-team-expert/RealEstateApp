import{r as c,u as N,j as r,H as T,a as p}from"./app-DIEWn7Ix.js";import{A as R}from"./app-layout-C9S1njiG.js";import{C as k,a as H,b as U}from"./card-D0lM0cRg.js";import{u as M}from"./usePermissions-C5kTLoeu.js";import V from"./PropertyCreateDrawer-3jhLTvjP.js";import B from"./PropertyEditDrawer-DLvyj7bt.js";import Q from"./PropertyPageHeader-D_esrVFo.js";import q from"./PropertyFilters-jM2kv2Mp.js";import z from"./PropertyTable-DUBUS32i.js";import G from"./PropertyEmptyState-DWVH0EV3.js";import J from"./FlashMessages-BVrgnDHF.js";import K from"./PropertyPagination-D5rEENyr.js";import"./app-ChTVGdbA.js";import"./index-Bt0zfGgm.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-C0qpziZb.js";import"./index-DKA-WKms.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./index-Dc_FVRD7.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-BuLzMHmv.js";import"./collapsible-D1_DD34n.js";import"./chevron-right-lBI-HPj1.js";import"./index-Bp33PYYw.js";import"./log-out-CE4a_W2h.js";import"./chevrons-up-down-wcdr16Hr.js";import"./app-logo-icon-BrLszCI4.js";import"./house-DKj--ObP.js";import"./building-CBRSJYqv.js";import"./users-B43C_7xE.js";import"./wrench-DwJ9zT3b.js";import"./credit-card-D-F9DsZs.js";import"./dollar-sign-CTn_hGqc.js";import"./file-text-BkIwiqXy.js";import"./triangle-alert-mmtwxqk7.js";import"./bell-CBmeO6wA.js";import"./drawer-fqLIckn8.js";import"./CitySelectionSection-nXYqA7I9.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./map-pin-D2EWDn0V.js";import"./PropertySelectionSection-BMyGfRQk.js";import"./alert-BsldglEu.js";import"./building-2-BcM9SqmS.js";import"./circle-alert-BKK80Ky4.js";import"./InsuranceCompanySection-EMqDL6ED.js";import"./input-Dp80VBC1.js";import"./shield-D_tOWT8J.js";import"./AmountPolicySection-BE5JKnji.js";import"./DatesSection-IzAZzTlL.js";import"./calendar-BV4TAGR8.js";import"./NotesSection-DsE-cqul.js";import"./textarea-DmwE5RE4.js";import"./PropertySelectField-BQzl_umg.js";import"./InsuranceCompanyField-ChCdlrct.js";import"./AmountPolicyFields-YoBr8Bgo.js";import"./DateFields-RgvDvAip.js";import"./NotesField-N-Huv667.js";import"./download-C1kHH7o-.js";import"./plus-DhhAwnw0.js";import"./search-Cudh47UL.js";import"./table-CvyjvZRw.js";import"./PropertyTableRow-B0Z2WHsH.js";import"./PropertyStatusBadge-DE8_ZzEE.js";import"./badge-n90aW425.js";import"./PropertyDaysLeftBadge-Rt3Z4GeU.js";import"./eye-OpQu41aA.js";import"./square-pen-BESSjlPV.js";import"./trash-2-BbHlzFlW.js";import"./pagination-DRm9RAHT.js";import"./chevron-left-CWUKElF8.js";const W=(e,g="properties.csv")=>{const f=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],l=o=>{const x=new Date,y=new Date(o).getTime()-x.getTime();return Math.ceil(y/(1e3*60*60*24))},d=[f.join(","),...e.map(o=>[o.id,`"${o.property?.property_name||"N/A"}"`,`"${o.insurance_company_name}"`,`"${o.formatted_amount}"`,`"${o.effective_date}"`,`"${o.policy_number}"`,`"${o.expiration_date}"`,l(o.expiration_date),`"${o.status}"`].join(","))].join(`
`),h=new Blob([d],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(h);s.setAttribute("href",n),s.setAttribute("download",g),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)};function vt({properties:e,filters:g,cities:f=[],availableProperties:l=[]}){const{hasPermission:d,hasAnyPermission:h,hasAllPermissions:s}=M(),[n,o]=c.useState(g),[x,S]=c.useState(!1),[y,u]=c.useState(!1),[j,P]=c.useState(!1),[_,w]=c.useState(null),{flash:D}=N().props,m=()=>{const t={};return e.current_page&&e.current_page>1&&(t.page=e.current_page.toString()),e.per_page&&(t.per_page=e.per_page.toString()),Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),t},E=(t,a)=>{const i={...n,[t]:a};o(i)},C=()=>{const t={};Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),e.per_page&&(t.per_page=e.per_page.toString()),p.get(route("properties-info.index"),t,{preserveState:!0,preserveScroll:!0})},v=()=>{o({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};e.per_page&&(a.per_page=e.per_page.toString()),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},b=t=>{confirm("Are you sure you want to delete this property?")&&p.delete(route("properties-info.destroy",t.id),{data:m(),preserveState:!0,preserveScroll:!0})},A=()=>{if(e.data.length===0){alert("No data to export");return}S(!0);try{const t=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;W(e.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{S(!1)}},F=()=>{u(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},O=()=>{P(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},I=t=>{w(t),P(!0)},$=t=>{const a=m();delete a.page,a.per_page=t.toString(),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=t=>{const a=m();p.get(route("properties-info.show",t.id),a,{preserveState:!1})};return r.jsxs(R,{children:[r.jsx(T,{title:"Properties Insurance"}),r.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:r.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[r.jsx(J,{success:D?.success,error:D?.error}),r.jsx(Q,{onExport:A,onAddProperty:()=>u(!0),isExporting:x,hasExportData:e.data.length>0,canCreate:s(["properties.create","properties.store"])}),r.jsxs(k,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(H,{children:r.jsx(q,{filters:n,onFilterChange:E,onSearch:C,onClear:v})}),r.jsxs(U,{children:[r.jsx(z,{properties:e.data,onEdit:I,onDelete:b,onShow:L,canEdit:s(["properties.update","properties.edit"]),canDelete:d("properties.destroy"),canShow:d("properties.show"),hasAnyActionPermission:h(["properties.destroy","properties.update","properties.edit","properties.show"])}),e.data.length===0&&r.jsx(G,{}),e.data.length>0&&r.jsx(K,{paginatedData:e,currentPerPage:e.per_page||15,onPerPageChange:$})]})]})]})}),r.jsx(V,{open:y,onOpenChange:u,cities:f,availableProperties:l,onSuccess:F,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15}),_&&r.jsx(B,{open:j,onOpenChange:P,property:_,availableProperties:l,onSuccess:O,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15})]})}export{vt as default};
