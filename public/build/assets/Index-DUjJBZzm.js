import{r as i,u as tt,b as et,a as h,j as e,H as rt}from"./app-p7g_f0wo.js";import{B as w}from"./button-CgWb-OwV.js";import{C as st,a as ot,b as it}from"./card-BzYl35PS.js";import{u as at}from"./usePermissions-CJLv3dp-.js";import{A as nt}from"./app-layout-DPClFEfr.js";import mt from"./UnitCreateDrawer-IvjAV4q_.js";import pt from"./UnitEditDrawer-BwyOegu0.js";import ct from"./Notification-DZ8979Qs.js";import lt from"./ImportStatsCard-Ba0K6D97.js";import dt from"./ImportModal-h0LEzcyh.js";import $ from"./FlashMessage-lGKoLQOS.js";import ut from"./UnitsFilter-Zmlc2cXE.js";import ht from"./UnitsTable-DAwnXIbQ.js";import ft from"./Pagination-DUutEQki.js";import{useNotification as xt}from"./useNotification-D808gKJJ.js";import{f as yt}from"./format-PYUiRpxY.js";import{D as gt}from"./download-B86n1ynC.js";import{U as St}from"./upload-iVDk9xVl.js";import{P as Ct}from"./plus-Su-bBcUY.js";import"./app-D9ss4c-j.js";import"./index-6lgmZUbB.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-C9RY0Fne.js";import"./index-H5dANVBP.js";import"./index-DkhO7hde.js";import"./index-soOnB7Xl.js";import"./index-CiElmmUH.js";import"./index-DqXNBRMy.js";import"./x-CLgUf5rt.js";import"./createLucideIcon-DCkjgf37.js";import"./index-Dc_FVRD7.js";import"./index-DBAs5r5h.js";import"./index-DbQ0MNsB.js";import"./index-BFObTlUk.js";import"./index-BUWKjyuJ.js";import"./collapsible-D-5VlHH9.js";import"./chevron-right-DVrPLLPg.js";import"./index-BxQHv4UU.js";import"./log-out-DolkPHtZ.js";import"./chevrons-up-down-KkSb8Z31.js";import"./app-logo-icon-CpLLQQyo.js";import"./house-DG1cwSyn.js";import"./building-Dsvg2gBa.js";import"./users-DUIlRejs.js";import"./wrench-CShl7EQD.js";import"./credit-card-DD1qylaU.js";import"./dollar-sign-BuRVt3W_.js";import"./file-text-CmxpgnvI.js";import"./triangle-alert-BvRY_CAH.js";import"./bell-ZeWLA2EG.js";import"./drawer-BG8f08dK.js";import"./CitySelection-BUeaw-3P.js";import"./label-DYy2JzQ2.js";import"./select-CfH1ySLB.js";import"./index-BAfRhOcu.js";import"./chevron-down-QjJMMFQo.js";import"./check-Cfkty5Qk.js";import"./chevron-up-DNYJO-3s.js";import"./PropertySelection-cuIulBsm.js";import"./UnitDetails-BwCVTOAT.js";import"./input-DiaYLKYe.js";import"./TenantDetails-C_nzJvR5.js";import"./LeaseDates-BjRAhEKg.js";import"./calendar-BbyHMKLt.js";import"./chevron-left-DEQB7mOe.js";import"./popover-B4-HGuiv.js";import"./calendar-C5PdxC03.js";import"./UnitSpecifications-DutMhtIa.js";import"./LeaseStatus-BQhBYst0.js";import"./radioGroup-Dy3ozKpR.js";import"./FinancialInformation-oRGWWre0.js";import"./UtilityInformation-Cd7CLYmI.js";import"./InsuranceInformation-CjPjyQ1R.js";import"./CityPropertySelector-4qGV7PiF.js";import"./FormSection-CB9E9fcm.js";import"./UnitDetailsFields-BqD0Sxo3.js";import"./LeaseInformationFields-BFgBKu8u.js";import"./DatePickerField-Bo8ZaIeq.js";import"./FinancialFields-22W3wjkP.js";import"./UtilitiesFields-kZB0V32D.js";import"./InsuranceFields-uVfz_s5K.js";import"./CalculatedValuesDisplay-CiivjGGC.js";import"./circle-alert-BGRUz81p.js";import"./circle-x-CdxvysKK.js";import"./circle-check-big-DJMLKwPr.js";import"./file-spreadsheet-C560eQY3.js";import"./loader-circle-CpH9bhzT.js";import"./CityAutocomplete-DWJb6_B7.js";import"./PropertyAutocomplete-DcS7XAoD.js";import"./search-BU1dLuL3.js";import"./badge-I-sz7QIO.js";import"./table-Cs4vzKKx.js";import"./square-pen-Cwnx6pJj.js";import"./trash-2-B0CH3TAF.js";const N=(s,a="-")=>{if(!s)return a;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return a;const[,m,p,o]=n,l=new Date(Number(m),Number(p)-1,Number(o));return yt(l,"P")},jt=(s,a="units.csv")=>{const m=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(p);o.setAttribute("href",l),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)};function pr({units:s,filters:a,cities:n,properties:m,importStats:p}){const{hasPermission:o,hasAnyPermission:l,hasAllPermissions:r}=at(),[,_]=i.useState(a),[d,E]=i.useState(a),[P,I]=i.useState(!1),[F,g]=i.useState(!1),[k,L]=i.useState(!!p),[A,D]=i.useState(!1),[O,U]=i.useState(!1),[v,T]=i.useState(null),{flash:y}=tt().props,[R,S]=i.useState(d.city||""),[V,C]=i.useState(d.property||""),{notification:j,showNotification:b,hideNotification:M}=xt(),c=et({file:null,skip_duplicates:!0,update_existing:!1}),f=(t,x)=>{E({...d,[t]:x})},B=t=>{S(t),f("city",t)},H=t=>{S(t),f("city",t)},z=t=>{C(t),f("property",t)},q=t=>{C(t.property_name),f("property",t.property_name)},G=()=>{_(d);const t={};Object.entries(d).forEach(([x,u])=>{u!=null&&u!==""&&(t[x]=String(u))}),h.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},J=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:""};E(t),_(t),S(""),C(""),h.get(route("units.index"),{},{preserveState:!0,preserveScroll:!0})},K=t=>{confirm("Are you sure you want to delete this unit?")&&h.delete(route("units.destroy",t.id))},Q=t=>{T(t),U(!0)},W=()=>{h.reload({only:["units","statistics"]})},X=()=>{h.reload({only:["units","statistics"]})},Y=()=>{if(s.data.length===0){alert("No data to export");return}I(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;jt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{I(!1)}},Z=i.useCallback(t=>{c.setData("file",t),h.post(route("units.import"),{file:t,skip_duplicates:c.data.skip_duplicates,update_existing:c.data.update_existing},{forceFormData:!0,onSuccess:()=>{g(!1),c.reset(),b("success","CSV file imported successfully!")},onError:x=>{const u=x.file||"Failed to import CSV file. Please try again.";b("error",u)},onFinish:()=>{c.clearErrors()}})},[c,b]);return e.jsxs(nt,{children:[e.jsx(rt,{title:"Units"}),j&&e.jsx(ct,{type:j.type,message:j.message,onClose:M}),e.jsx(dt,{isOpen:F,onClose:()=>g(!1),onSubmit:Z,isLoading:c.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx($,{type:"success",message:y?.success}),y?.error&&e.jsx($,{type:"error",message:y?.error}),k&&p&&e.jsx(lt,{stats:p,onClose:()=>L(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:Y,disabled:P||s.data.length===0,className:"flex items-center",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),P?"Exporting...":"Export CSV"]}),o("units.import")&&e.jsxs(w,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),l(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>D(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(st,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ot,{children:e.jsx(ut,{filters:d,cities:n||[],properties:m||[],cityInput:R,propertyInput:V,onFilterChange:f,onCityInputChange:B,onCitySelect:H,onPropertyInputChange:z,onPropertySelect:q,onSearch:G,onClear:J})}),e.jsxs(it,{children:[e.jsx(ht,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:o("units.destroy"),onEdit:Q,onDelete:K}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(ft,{links:s.links,currentPage:s.current_page,lastPage:s.last_page}),e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total||0," units"]})]})]})]})}),e.jsx(mt,{open:A,onOpenChange:D,cities:n||[],properties:m||[],onSuccess:X}),v&&e.jsx(pt,{unit:v,cities:n||[],properties:m||[],open:O,onOpenChange:U,onSuccess:W})]})}export{pr as default};
