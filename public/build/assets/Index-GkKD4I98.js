import{r as a,u as te,b as re,a as d,j as e,H as se}from"./app-BSOlzI_M.js";import{C as k,b as M}from"./card-lrH58jzJ.js";import{u as oe}from"./usePermissions-DDr8nGFF.js";import{A as ae}from"./app-layout-BU6wzt8Q.js";import ie from"./TenantCreateDrawer-Cq0R5rba.js";import ne from"./TenantEditDrawer-CqKt5X7i.js";import{FlashMessages as ce}from"./FlashMessages-DMGnUv7o.js";import{ImportModal as me}from"./ImportModal-DdlplwDX.js";import{ImportStatsCard as le}from"./ImportStatsCard-_RwSptws.js";import{Notification as pe}from"./Notification-BZlVCGgu.js";import{TenantFilters as de}from"./TenantFilters-CqHF59GT.js";import{TenantPageHeader as ue}from"./TenantPageHeader-CL_P-qHr.js";import{TenantTable as he}from"./TenantTable-C-O7oLXa.js";import{useNotification as xe}from"./useNotification-CZUQXWL4.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./button-D2rKFPK1.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./index-Dc_FVRD7.js";import"./index-CJ72cHre.js";import"./index-C4PIvpnm.js";import"./index-D4B3QgQ6.js";import"./collapsible-BeIaK3gz.js";import"./chevron-right-DU-yjHU5.js";import"./index-p7EaCzMM.js";import"./log-out-CU7fAD8S.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./app-logo-icon-Chz0QK53.js";import"./house-A7z-bt3N.js";import"./building-X8V0cPLX.js";import"./users-BZ-W0K9D.js";import"./wrench-AB0PbR3c.js";import"./credit-card-Dh1t_toN.js";import"./dollar-sign-CX6g00Px.js";import"./file-text-XuiuEW0Z.js";import"./triangle-alert-EDCPZCCy.js";import"./bell-CjUavl-i.js";import"./drawer-B6ZRXvIZ.js";import"./CitySelectionSection-xGCxo9tN.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./command-CBR154ui.js";import"./search-BcNZ_u8M.js";import"./check-BE4k6INO.js";import"./PropertySelectionSection-BO0xwvn4.js";import"./UnitSelectionSection-BrkGTOLt.js";import"./PersonalInformationSection-CaQueML6.js";import"./FormField-DUvVMlBA.js";import"./input-DWv8_Yxn.js";import"./ContactInformationSection-BMtHzKB7.js";import"./PaymentAndPreferencesSection-BzlHJTLa.js";import"./RadioGroupField-OUXiG2Gx.js";import"./radioGroup-DqEJ_5sj.js";import"./index-C4dPa-2_.js";import"./AssistanceSection-BauyiY4u.js";import"./LocationSection-5QZDBupY.js";import"./PersonalInfoSection-DYZNlqzk.js";import"./ContactInfoSection-CziJKX3s.js";import"./PreferencesSection-Czo_tHX_.js";import"./AssistanceSection-D6OZ3Luo.js";import"./file-spreadsheet-BJ-uUDIK.js";import"./upload-mLZp_prS.js";import"./loader-circle-BeuPJ3Yc.js";import"./circle-check-big-D971uMc1.js";import"./circle-alert-CDOkMJ4H.js";import"./circle-x-DdSGTMq6.js";import"./rotate-ccw-B0RGZt2F.js";import"./download-DpLM-FVr.js";import"./plus-DpdyZws7.js";import"./badge-Bc6JwGPl.js";import"./table-D6Ykx5nO.js";import"./square-pen-BbbP7D49.js";import"./trash-2-CnyQPA5D.js";const fe=(i,c="tenants.csv")=>{const f=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...i.map(r=>[r.id,`"${r.city_name||""}"`,`"${r.property_name||""}"`,`"${r.unit_number||""}"`,`"${r.first_name||""}"`,`"${r.last_name||""}"`,`"${(r.street_address_line||"").replace(/"/g,'""')}"`,`"${r.login_email||""}"`,`"${r.alternate_email||""}"`,`"${r.mobile||""}"`,`"${r.emergency_phone||""}"`,`"${r.cash_or_check||""}"`,`"${r.has_insurance||""}"`,`"${r.sensitive_communication||""}"`,`"${r.has_assistance||""}"`,`"${r.assistance_amount||""}"`,`"${(r.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),y=URL.createObjectURL(g);m.setAttribute("href",y),m.setAttribute("download",c),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(y)};function Bt({tenants:i,search:c,cities:j,properties:f,unitsByProperty:g,allCities:m,allProperties:y,allUnitNames:r,importStats:b,pagination:s}){const{hasPermission:C,hasAnyPermission:L,hasAllPermissions:w}=oe(),[O,E]=a.useState(!1),[R,S]=a.useState(!1),[U,H]=a.useState(!!b),[V,$]=a.useState(!1),[q,P]=a.useState(!1),[A,N]=a.useState(null),{flash:T}=te().props,{notification:v,showNotification:p,hideNotification:z}=xe(),u=re({file:null,skip_duplicates:!1}),[l,h]=a.useState(s?.current_page??1),[n,_]=a.useState(s?s.per_page:15),[o,F]=a.useState({city:"",property:"",unitName:"",search:c||""});a.useEffect(()=>{s?(h(s.current_page),_(s.per_page)):(_("all"),h(1))},[s]);const B=t=>{F(t),d.get(route("tenants.index"),{search:t.search,city:t.city,property:t.property,unit_name:t.unitName,perPage:n,page:1},{preserveState:!0})},G=()=>{F({city:"",property:"",unitName:"",search:""}),h(1),d.get(route("tenants.index"),{perPage:n,page:1},{preserveState:!1,replace:!0})},J=t=>{confirm(`Are you sure you want to archive ${t.first_name} ${t.last_name}? This will hide them from the main list but they can be restored later.`)&&d.patch(route("tenants.archive",t.id),{search:o.search,city:o.city,property:o.property,unit_name:o.unitName,perPage:n,page:l},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p("success","Tenant archived successfully!")},onError:()=>{p("error","Failed to archive tenant. Please try again.")}})},K=t=>{N(t),P(!0)},Q=()=>{p("success","Tenant updated successfully!"),N(null)},W=()=>{if(i.length===0){alert("No data to export");return}E(!0);try{const t=`tenants-${new Date().toISOString().split("T")[0]}.csv`;fe(i,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{E(!1)}},X=a.useCallback((t,x)=>{u.setData({file:t,skip_duplicates:x}),d.post(route("tenants.import.process"),{file:t,skip_duplicates:x},{forceFormData:!0,onSuccess:()=>{S(!1),u.reset(),p("success","CSV file imported successfully!")},onError:D=>{const ee=D.file||D.import||"Failed to import CSV file. Please try again.";p("error",ee)},onFinish:()=>{u.clearErrors()}})},[u,p]),Y=r||[],I=t=>{h(t),d.get(route("tenants.index"),{search:o.search,city:o.city,property:o.property,unit_name:o.unitName,perPage:n,page:t},{preserveState:!0})},Z=t=>{const x=t==="all"?"all":parseInt(t,10);_(x),h(1),d.get(route("tenants.index"),{search:o.search,city:o.city,property:o.property,unit_name:o.unitName,perPage:x,page:1},{preserveState:!0})};return e.jsxs(ae,{children:[e.jsx(se,{title:"Tenants"}),v&&e.jsx(pe,{type:v.type,message:v.message,onClose:z}),e.jsx(me,{isOpen:R,onClose:()=>S(!1),onSubmit:X,isLoading:u.processing}),e.jsx(ie,{open:V,onOpenChange:()=>$(!1),cities:j,properties:f,unitsByProperty:g,currentFilters:o,page:l,perPage:n,onSuccess:()=>p("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(ce,{success:T?.success,error:T?.error}),U&&b&&e.jsx(le,{stats:b,onClose:()=>H(!1)}),e.jsx(ue,{onExport:W,onImport:()=>S(!0),onAddNew:()=>$(!0),isExporting:O,hasExportData:i.length>0,canImport:C("tenants.import"),canCreate:w(["tenants.create","tenants.store"])}),e.jsx(k,{className:"bg-card text-card-foreground shadow-lg mb-6",children:e.jsx(M,{className:"p-6 overflow-visible",children:e.jsx(de,{cities:m,properties:y,uniqueUnitNames:Y,onSearch:B,onClear:G,initialFilters:{city:"",property:"",unitName:"",search:c||""}})})}),e.jsx(k,{className:"bg-card text-card-foreground shadow-lg",children:e.jsxs(M,{className:"p-6",children:[e.jsx(he,{tenants:i,onEdit:K,onDelete:J,canEdit:w(["tenants.edit","tenants.update"]),canDelete:C("tenants.destroy"),showActions:L(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),i.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center justify-between gap-3 border-t border-border pt-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:s?e.jsxs(e.Fragment,{children:["Showing ",i.length," of ",s.total," tenant",s.total!==1?"s":"",c&&` matching "${c}"`]}):e.jsxs(e.Fragment,{children:["Showing ",i.length," tenant",i.length!==1?"s":""," (all)",c&&` matching "${c}"`]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Rows per page"}),e.jsxs("select",{className:"rounded-md border bg-background px-2 py-1 text-sm",value:n==="all"?"all":String(n),onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]}),n!=="all"&&s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm disabled:opacity-50",onClick:()=>I(Math.max(1,l-1)),disabled:l<=1,children:"Prev"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",l," of ",s.last_page]}),e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm disabled:opacity-50",onClick:()=>I(Math.min(s.last_page,l+1)),disabled:l>=s.last_page,children:"Next"})]})]})]})]})})]})}),A&&e.jsx(ne,{open:q,onOpenChange:()=>{P(!1),N(null)},tenant:A,cities:j,properties:f,unitsByProperty:g,currentFilters:o,page:l,perPage:n,onSuccess:Q})]})}export{Bt as default};
