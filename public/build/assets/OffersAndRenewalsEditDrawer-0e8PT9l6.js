import{r as d,b as G,j as i,a as W}from"./app-BSOlzI_M.js";import{B as R}from"./button-D2rKFPK1.js";import{D as $,a as H,b as J}from"./drawer-B6ZRXvIZ.js";import Q from"./CitySelector-C79mZ7DA.js";import X from"./PropertySelector-D2jecpBB.js";import Z from"./UnitSelector-0CagkJ0Y.js";import ee from"./TenantSelector-CpCyI6Mn.js";import m from"./DatePickerField-BjYI5MvM.js";import y from"./RadioGroupField-MwFlB-fR.js";import te from"./TextAreaField-C_RIxM9v.js";import ne from"./DateOfDeclineSectionEdit-BFL2TjtZ.js";import{p as ae}from"./calendar-Di5dbzoO.js";import{f as ie,i as oe}from"./format-PYUiRpxY.js";import"./app-D9zByHv3.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./index-C4PIvpnm.js";import"./command-CBR154ui.js";import"./search-BcNZ_u8M.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./check-BE4k6INO.js";import"./input-DWv8_Yxn.js";import"./calendar-CthI5zTo.js";import"./radioGroup-DqEJ_5sj.js";import"./index-p7EaCzMM.js";import"./index-C4dPa-2_.js";import"./chevron-left-CVo-4b8C.js";import"./chevron-right-DU-yjHU5.js";import"./chevron-down--Oeingn_.js";const o=t=>{if(!t)return"";const u=t.slice(0,10),h=ae(u,"yyyy-MM-dd",new Date);return oe(h)?ie(h,"yyyy-MM-dd"):""};function Ge({offer:t,hierarchicalData:u,open:h,onOpenChange:j,onSuccess:N,currentFilters:b,perPage:M,page:P}){const f=d.useRef(null),C=d.useRef(null),v=d.useRef(null),S=d.useRef(null),[g,_]=d.useState({}),[c,A]=d.useState({date_sent_offer:!1,date_of_acceptance:!1,date_of_decline:!1,last_notice_sent:!1,date_sent_lease:!1,date_signed:!1,last_notice_sent_2:!1}),p=(e,a)=>{A(l=>({...l,[e]:a}))},k=()=>{if(!t.tenant_id)return{cityId:"",propertyId:"",unitId:"",tenantId:""};for(const e of u)for(const a of e.properties)for(const l of a.units){const x=l.tenants.find(z=>z.id===t.tenant_id);if(x)return{cityId:e.id.toString(),propertyId:a.id.toString(),unitId:l.id.toString(),tenantId:x.id.toString()}}return{cityId:"",propertyId:"",unitId:"",tenantId:""}},I=k(),{data:n,setData:s,processing:D,errors:r}=G({tenant_id:t.tenant_id?.toString()||"",city_id:I.cityId,property_id:I.propertyId,unit_id:I.unitId,other_tenants:t.other_tenants||"",date_sent_offer:o(t.date_sent_offer),status:t.status||"",date_of_acceptance:o(t.date_of_acceptance),date_of_decline:o(t.date_of_decline),last_notice_sent:o(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:o(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:o(t.date_signed),last_notice_sent_2:o(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""});d.useEffect(()=>{if(t){const e=k();s({tenant_id:t.tenant_id?.toString()||"",city_id:e.cityId,property_id:e.propertyId,unit_id:e.unitId,other_tenants:t.other_tenants||"",date_sent_offer:o(t.date_sent_offer),status:t.status||"",date_of_acceptance:o(t.date_of_acceptance),date_of_decline:o(t.date_of_decline),last_notice_sent:o(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:o(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:o(t.date_signed),last_notice_sent_2:o(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""})}},[t]);const w=d.useMemo(()=>{if(!n.city_id)return[];const e=u.find(a=>a.id.toString()===n.city_id);return e?e.properties:[]},[u,n.city_id]),O=d.useMemo(()=>{if(!n.property_id)return[];const e=w.find(a=>a.id.toString()===n.property_id);return e?e.units:[]},[w,n.property_id]),U=d.useMemo(()=>{if(!n.unit_id)return[];const e=O.find(a=>a.id.toString()===n.unit_id);return e?e.tenants:[]},[O,n.unit_id]),V=e=>{s({...n,city_id:e,property_id:"",unit_id:"",tenant_id:""}),_(a=>({...a,city:void 0}))},T=e=>{s({...n,property_id:e,unit_id:"",tenant_id:""}),_(a=>({...a,property:void 0}))},L=e=>{s({...n,unit_id:e,tenant_id:""}),_(a=>({...a,unit:void 0}))},F=e=>{s("tenant_id",e),_(a=>({...a,tenant:void 0}))},B=e=>{s("other_tenants",e)},K=e=>{s("date_sent_offer",e||""),_(a=>({...a,date_sent_offer:void 0}))},Y=e=>{s("date_of_decline",e||"")},E=e=>{e.preventDefault(),_({});let a=!1;const l={};if((!n.city_id||n.city_id.trim()==="")&&(l.city="Please select a city before submitting the form.",f.current&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.property_id||n.property_id.trim()==="")&&(l.property="Please select a property before submitting the form.",C.current&&!a&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.unit_id||n.unit_id.trim()==="")&&(l.unit="Please select a unit before submitting the form.",v.current&&!a&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.tenant_id||n.tenant_id.trim()==="")&&(l.tenant="Please select a tenant before submitting the form.",S.current&&!a&&(S.current.focus(),S.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),a){_(l);return}const x={...n,city_name:b.city||"",property_name:b.property||"",unit_name:b.unit||"",tenant_name:b.tenant||"",per_page:String(M),page:P};W.put(route("offers_and_renewals.update",t.id),x,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{_({}),j(!1),N?.()}})},q=()=>{const e=k();s({tenant_id:t.tenant_id?.toString()||"",city_id:e.cityId,property_id:e.propertyId,unit_id:e.unitId,other_tenants:t.other_tenants||"",date_sent_offer:o(t.date_sent_offer),status:t.status||"",date_of_acceptance:o(t.date_of_acceptance),date_of_decline:o(t.date_of_decline),last_notice_sent:o(t.last_notice_sent),notice_kind:t.notice_kind||"",lease_sent:t.lease_sent||"",date_sent_lease:o(t.date_sent_lease),lease_signed:t.lease_signed||"",date_signed:o(t.date_signed),last_notice_sent_2:o(t.last_notice_sent_2),notice_kind_2:t.notice_kind_2||"",notes:t.notes||"",how_many_days_left:t.how_many_days_left?.toString()||""}),_({}),j(!1)};return i.jsx($,{open:h,onOpenChange:j,modal:!1,children:i.jsx(H,{size:"half",title:`Edit Offer/Renewal (ID: ${t.id})`,children:i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx("div",{className:"flex-1 overflow-auto p-6",children:i.jsxs("form",{onSubmit:E,className:"space-y-4",children:[i.jsx(Q,{cities:u,value:n.city_id,onChange:V,error:r.city_id,validationError:g.city,cityRef:f}),i.jsx(X,{properties:w,value:n.property_id,onChange:T,error:r.property_id,validationError:g.property,propertyRef:C,citySelected:!!n.city_id}),i.jsx(Z,{units:O,value:n.unit_id,onChange:L,error:r.unit_id,validationError:g.unit,unitRef:v,propertySelected:!!n.property_id}),i.jsx(ee,{tenants:U,value:n.tenant_id,onChange:F,error:r.tenant_id,validationError:g.tenant,tenantRef:S,unitSelected:!!n.unit_id,otherTenants:n.other_tenants,onOtherTenantsChange:B}),i.jsx(m,{label:"Date Sent Offer",value:n.date_sent_offer,onChange:K,error:r.date_sent_offer,validationError:g.date_sent_offer,required:!0,borderColor:"border-l-orange-500",isOpen:c.date_sent_offer,onOpenChange:e=>p("date_sent_offer",e),allowClear:!1}),i.jsx(y,{label:"Status",name:"status",value:n.status,onChange:e=>s("status",e),options:[{value:"Accepted",label:"Accepted"},{value:"Didn't Accept",label:"Didn't Accept"},{value:"Didn't respond",label:"Didn't respond"}],error:r.status,borderColor:"border-l-emerald-500"}),n.status==="Didn't Accept"?i.jsx(ne,{value:n.date_of_decline,onChange:Y,error:r.date_of_decline,isOpen:c.date_of_decline,onOpenChange:e=>p("date_of_decline",e)}):i.jsxs(i.Fragment,{children:[i.jsx(m,{label:"Date of Acceptance",value:n.date_of_acceptance,onChange:e=>s("date_of_acceptance",e||""),error:r.date_of_acceptance,borderColor:"border-l-teal-500",isOpen:c.date_of_acceptance,onOpenChange:e=>p("date_of_acceptance",e)}),i.jsx(m,{label:"Offer Last Notice Sent",value:n.last_notice_sent,onChange:e=>s("last_notice_sent",e||""),error:r.last_notice_sent,borderColor:"border-l-indigo-500",isOpen:c.last_notice_sent,onOpenChange:e=>p("last_notice_sent",e)}),i.jsx(y,{label:"Offer Notice Kind",name:"notice_kind",value:n.notice_kind,onChange:e=>s("notice_kind",e),options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"},{value:"Messages",label:"Messages"}],error:r.notice_kind,borderColor:"border-l-pink-500"}),i.jsx(y,{label:"Lease Sent?",name:"lease_sent",value:n.lease_sent,onChange:e=>s("lease_sent",e),options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}],error:r.lease_sent,borderColor:"border-l-red-500"}),i.jsx(m,{label:"Date Sent Lease",value:n.date_sent_lease,onChange:e=>s("date_sent_lease",e||""),error:r.date_sent_lease,borderColor:"border-l-yellow-500",isOpen:c.date_sent_lease,onOpenChange:e=>p("date_sent_lease",e)}),i.jsx(y,{label:"Lease Signed?",name:"lease_signed",value:n.lease_signed,onChange:e=>s("lease_signed",e),options:[{value:"Signed",label:"Signed"},{value:"Unsigned",label:"Unsigned"}],error:r.lease_signed,borderColor:"border-l-cyan-500"}),i.jsx(m,{label:"Date Signed",value:n.date_signed,onChange:e=>s("date_signed",e||""),error:r.date_signed,borderColor:"border-l-violet-500",isOpen:c.date_signed,onOpenChange:e=>p("date_signed",e)}),i.jsx(m,{label:"Renewal Last Notice Sent",value:n.last_notice_sent_2,onChange:e=>s("last_notice_sent_2",e||""),error:r.last_notice_sent_2,borderColor:"border-l-rose-500",isOpen:c.last_notice_sent_2,onOpenChange:e=>p("last_notice_sent_2",e)}),i.jsx(y,{label:"Renewal Notice Kind",name:"notice_kind_2",value:n.notice_kind_2,onChange:e=>s("notice_kind_2",e),options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"},{value:"Messages",label:"Messages"}],error:r.notice_kind_2,borderColor:"border-l-amber-500"}),i.jsx(te,{label:"Notes",value:n.notes,onChange:e=>s("notes",e),error:r.notes,borderColor:"border-l-slate-500",placeholder:"Add any additional notes...",rows:3})]})]})}),i.jsx(J,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(R,{onClick:q,variant:"outline",className:"flex-1",children:"Cancel"}),i.jsx(R,{onClick:E,disabled:D,className:"flex-1",children:D?"Updating...":"Update Offer"})]})})]})})})}export{Ge as default};
