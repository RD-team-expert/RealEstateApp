import{r as o,j as e,H as Ne,L as ye,a as N}from"./app-CCzuXckj.js";import{B as F}from"./badge-bEJK_mFj.js";import{B as x}from"./button-CMWBItP5.js";import{C as we,a as ke,b as Ce}from"./card-DRu8D1Tp.js";import{I as w}from"./input-Du17bKS3.js";import{T as Se,a as _e,b as ee,c as a,d as De,e as d}from"./table-CeO9TH2o.js";import{u as Te,A as Ee}from"./app-layout-BoNLLPeQ.js";import Ie from"./VendorTaskTrackerCreateDrawer-BGI0Fuh5.js";import Pe from"./VendorTaskTrackerEditDrawer-C5RJzYR3.js";import{D as Re}from"./download-DA4WEWuy.js";import{P as Ve}from"./plus-DQ_VxF2F.js";import{C as O}from"./chevron-down-CCgMrUAw.js";import{S as Le}from"./search-CdnXWL7g.js";import{X as ze}from"./x-DYjqv_U5.js";import{E as Fe}from"./eye-CA8YZk5d.js";import{S as Oe}from"./square-pen-CZ9y11nC.js";import{T as $e}from"./trash-2-qsChcdJa.js";import{f as Ae}from"./format-PYUiRpxY.js";import"./app-BmbQfT0_.js";import"./index-ChB7U0Zf.js";import"./utils-CBfrqCZ4.js";import"./index-agTCOONj.js";import"./index-Dc_FVRD7.js";import"./index-DyliiUy6.js";import"./index-CqHfpVA2.js";import"./index-DvwIsXwg.js";import"./index-Dt7h0l9k.js";import"./index-DODHwusq.js";import"./index-wJbuxyvX.js";import"./index-DTxO9eYn.js";import"./index-vq7VqFSt.js";import"./index-5SWgZ8xG.js";import"./index-BNwgaesP.js";import"./createLucideIcon-C69XpSIN.js";import"./collapsible-CcNV7e-r.js";import"./chevron-right-C8wvZ16F.js";import"./index-D6OiOCOB.js";import"./log-out-nz5FjWG9.js";import"./app-logo-icon-atlGpzJG.js";import"./house-CQx8K8A-.js";import"./building-BN0Wz64N.js";import"./users-DybgbioK.js";import"./wrench-Cuo6Tfe4.js";import"./credit-card-sJP7HDaK.js";import"./dollar-sign-N6h4oYi4.js";import"./file-text-DuBeEt6Y.js";import"./triangle-alert-DpTJsPz5.js";import"./bell-BsA6WElf.js";import"./popover-D_vSdCKF.js";import"./drawer-D037HPJn.js";import"./label-B-O3f5QY.js";import"./select-HddS9BVA.js";import"./index-wPy1uw0V.js";import"./check-Du7_omyy.js";import"./chevron-up-D8wKuaQi.js";import"./radioGroup-0S5_KQF6.js";import"./calendar-Dcylb9am.js";const b=(n,l="-")=>{if(!n)return l;const h=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!h)return l;const[,c,m,i]=h,u=new Date(Number(c),Number(m)-1,Number(i));return Ae(u,"P")},Ue=(n,l="vendor-tasks.csv")=>{const c=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...n.map(s=>[s.id,`"${s.city||""}"`,`"${s.property_name||""}"`,`"${s.unit_name||""}"`,`"${s.vendor_name||""}"`,`"${b(s.task_submission_date,"")}"`,`"${(s.assigned_tasks||"").replace(/"/g,'""')}"`,`"${b(s.any_scheduled_visits,"")}"`,`"${b(s.task_ending_date,"")}"`,`"${(s.notes||"").replace(/"/g,'""')}"`,`"${s.status||""}"`,`"${s.urgent}"`].join(","))].join(`
`),m=new Blob([c],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),u=URL.createObjectURL(m);i.setAttribute("href",u),i.setAttribute("download",l),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(u)};function Xr({tasks:n,filters:l,units:h,cities:c,properties:m,unitsByCity:i,propertiesByCity:u,unitsByProperty:s,vendorsByCity:$,vendors:k}){const{hasPermission:A,hasAnyPermission:U,hasAllPermissions:H}=Te(),[C,B]=o.useState(l),[q,X]=o.useState(!1),[re,S]=o.useState(!1),[te,_]=o.useState(!1),[Y,G]=o.useState(null),[y,D]=o.useState(l.city||""),[oe,g]=o.useState(!1),[J,K]=o.useState([]),T=o.useRef(null),E=o.useRef(null),[M,I]=o.useState(l.property||""),[se,v]=o.useState(!1),P=o.useRef(null),R=o.useRef(null),[Q,V]=o.useState(l.vendor_name||""),[ne,j]=o.useState(!1),L=o.useRef(null),z=o.useRef(null);o.useEffect(()=>{if(c)if(y.trim()==="")K(c);else{const r=c.filter(t=>t.city.toLowerCase().includes(y.toLowerCase()));K(r)}},[y,c]);const W=m?.filter(r=>r.property_name.toLowerCase().includes(M.toLowerCase()))||[],Z=k?.filter(r=>r.vendor_name.toLowerCase().includes(Q.toLowerCase()))||[];o.useEffect(()=>{const r=t=>{E.current&&!E.current.contains(t.target)&&T.current&&!T.current.contains(t.target)&&g(!1),R.current&&!R.current.contains(t.target)&&P.current&&!P.current.contains(t.target)&&v(!1),z.current&&!z.current.contains(t.target)&&L.current&&!L.current.contains(t.target)&&j(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const ae=()=>{N.reload(),S(!1)},de=()=>{N.reload(),_(!1),G(null)},ie=r=>{G(r),_(!0)},p=(r,t)=>{B({...C,[r]:t})},ce=r=>{D(r),p("city",r),g(!1)},le=r=>{D(r),p("city",r),g(!0)},me=r=>{const t=r.target.value;I(t),p("property",t),v(t.length>0)},ue=r=>{I(r.property_name),p("property",r.property_name),v(!1)},pe=r=>{const t=r.target.value;V(t),p("vendor_name",t),j(t.length>0)},xe=r=>{V(r.vendor_name),p("vendor_name",r.vendor_name),j(!1)},he=()=>{const r={};Object.entries(C).forEach(([t,f])=>{f!=null&&f!==""&&(r[t]=String(f))}),N.get(route("vendor-task-tracker.index"),r,{preserveState:!0,preserveScroll:!0})},fe=()=>{B({}),D(""),I(""),V(""),g(!1),v(!1),j(!1),N.get(route("vendor-task-tracker.index"),{},{preserveState:!0,preserveScroll:!0})},be=r=>{confirm("Are you sure you want to archive this task?")&&N.delete(route("vendor-task-tracker.destroy",r.id))},ge=()=>{if(n.data.length===0){alert("No data to export");return}X(!0);try{const r=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Ue(n.data,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{X(!1)}},ve=r=>e.jsx(F,{variant:r==="Yes"?"destructive":"secondary",children:r}),je=r=>{const t=r??null;if(!t)return e.jsx(F,{variant:"outline",children:"No Status"});const f=t.toLowerCase().includes("completed")?"default":t.toLowerCase().includes("pending")?"secondary":"outline";return e.jsx(F,{variant:f,children:t})};return e.jsxs(Ee,{children:[e.jsx(Ne,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Vendor Task Tracker"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:ge,disabled:q||n.data.length===0,className:"flex items-center",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),q?"Exporting...":"Export CSV"]}),H(["vendor-task-tracker.create","vendor-task-tracker.store"])&&e.jsxs(x,{onClick:()=>S(!0),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Add Task"]})]})]}),e.jsxs(we,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ke,{children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:T,type:"text",placeholder:"Filter by City",value:y,onChange:r=>le(r.target.value),onFocus:()=>g(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&J.length>0&&e.jsx("div",{ref:E,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(r.city),children:r.city},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:P,type:"text",placeholder:"Filter by Property",value:M,onChange:me,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),se&&W.length>0&&e.jsx("div",{ref:R,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:W.map(r=>e.jsxs("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ue(r),children:[r.property_name,r.city&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",r.city,")"]})]},r.id))})]}),e.jsx(w,{type:"text",placeholder:"Filter by Unit",value:C.unit_name||"",onChange:r=>p("unit_name",r.target.value),className:"text-input-foreground bg-input"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{ref:L,type:"text",placeholder:"Filter by Vendor",value:Q,onChange:pe,onFocus:()=>j(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(O,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&Z.length>0&&e.jsx("div",{ref:z,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Z.map(r=>e.jsxs("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>xe(r),children:[r.vendor_name,r.city&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(",r.city,")"]})]},r.id))})]}),e.jsxs(x,{onClick:he,variant:"default",className:"flex items-center",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(x,{onClick:fe,variant:"outline",className:"flex items-center",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Clear"]})]})}),e.jsxs(Ce,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(Se,{className:"border-collapse rounded-md border border-border",children:[e.jsx(_e,{children:e.jsxs(ee,{className:"border-border",children:[e.jsx(a,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(a,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(a,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(a,{className:"sticky left-[390px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Vendor Name"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Submission Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Assigned Tasks"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Scheduled Visits"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Task End Date"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Notes"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Urgent"}),U(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])&&e.jsx(a,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(De,{children:n.data.map(r=>e.jsxs(ee,{className:"border-border hover:bg-muted/50",children:[e.jsx(d,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city||"-"}),e.jsx(d,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property_name||"-"}),e.jsx(d,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.unit_name||"-"}),e.jsx(d,{className:"sticky left-[390px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.vendor_name||"-"}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.task_submission_date)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:e.jsx("div",{className:"max-w-32 truncate",title:r.assigned_tasks||"",children:r.assigned_tasks||"-"})}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.any_scheduled_visits)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:b(r.task_ending_date)}),e.jsx(d,{className:"border border-border text-center text-foreground",children:e.jsx("div",{className:"max-w-24 truncate",title:r.notes||"",children:r.notes||"-"})}),e.jsx(d,{className:"border border-border text-center",children:je(r.status)}),e.jsx(d,{className:"border border-border text-center",children:ve(r.urgent)}),U(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])&&e.jsx(d,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[A("vendor-task-tracker.show")&&e.jsx(ye,{href:route("vendor-task-tracker.show",r.id),children:e.jsx(x,{variant:"outline",size:"sm",children:e.jsx(Fe,{className:"h-4 w-4"})})}),H(["vendor-task-tracker.edit","vendor-task-tracker.update"])&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>ie(r),children:e.jsx(Oe,{className:"h-4 w-4"})}),A("vendor-task-tracker.destroy")&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>be(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx($e,{className:"h-4 w-4"})})]})})]},r.id))})]})}),n.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tasks found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters or clearing them to see all tasks."})]}),n.meta&&e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",n.meta.from||0," to ",n.meta.to||0," of ",n.meta.total||0," results"]})]})]})]})}),e.jsx(Ie,{cities:c,properties:m,units:h,vendors:k,unitsByCity:i,propertiesByCity:u,unitsByProperty:s,vendorsByCity:$,open:re,onOpenChange:S,onSuccess:ae}),Y&&e.jsx(Pe,{task:Y,cities:c,properties:m,units:h,vendors:k,unitsByCity:i,propertiesByCity:u,unitsByProperty:s,vendorsByCity:$,open:te,onOpenChange:_,onSuccess:de})]})}export{Xr as default};
