import{r as m,b as L,j as o}from"./app-DYme-6ST.js";import{D as M,a as R,b as z}from"./drawer-BC2XqbDZ.js";import{B as N}from"./button-DygVteL_.js";import{CityPropertyUnitSelector as T}from"./CityPropertyUnitSelector-B3oz4Guq.js";import{ApplicantInformationFields as $}from"./ApplicantInformationFields-cxC2sfnX.js";import{StatusAndDateFields as q}from"./StatusAndDateFields-KUL9YdCd.js";import{StageAndNotesFields as G}from"./StageAndNotesFields-Dg_7KFrM.js";import{AttachmentField as H}from"./AttachmentField-BEYWsHDu.js";import{CurrentSelectionDisplay as J}from"./CurrentSelectionDisplay-hm75S6_K.js";import{f as K}from"./format-PYUiRpxY.js";import"./app-BxoA0TtB.js";import"./index-BPUi24BT.js";import"./index-DAeyJQLn.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-Dc_FVRD7.js";import"./index-D6kz9xqy.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./input-pR7fOcUW.js";import"./calendar-BWK2M4JP.js";import"./chevron-left-C0SnhLPd.js";import"./chevron-right-BQBVxicn.js";import"./popover-iS5_0AtM.js";import"./radioGroup-F0AlgpLY.js";import"./calendar-Bw6k_ssZ.js";function ke({application:r,cities:D,properties:d,units:l,open:u,onOpenChange:y,onSuccess:P}){const[_,n]=m.useState({}),[I,x]=m.useState(r.selected_city_id||null),[C,h]=m.useState(r.selected_property_id||null),[A,g]=m.useState([]),[w,c]=m.useState([]),v=t=>{if(!t||t.trim()==="")return"";try{const e=new Date(t);return e&&!isNaN(e.getTime())?K(e,"yyyy-MM-dd"):""}catch(e){return console.warn("Date parsing error:",e),""}},{data:i,setData:a,put:E,processing:j,errors:f}=L({unit_id:r.unit_id,name:r.name||"",co_signer:r.co_signer||"",status:r.status||"New",date:v(r.date),stage_in_progress:r.stage_in_progress||"",notes:r.notes||"",attachment:null}),F=()=>{let t=r.selected_property_id??null,e=r.selected_city_id??null;if((!t||isNaN(t))&&r.unit_id){for(const[s,p]of Object.entries(l||{}))if(p?.some(b=>b.id===r.unit_id)){t=parseInt(s,10);break}}if((!e||isNaN(e))&&t){for(const[s,p]of Object.entries(d||{}))if(p?.some(b=>b.id===t)){e=parseInt(s,10);break}}return{cityId:e??null,propertyId:t??null}};m.useEffect(()=>{if(r&&u){const{cityId:t,propertyId:e}=F();x(t),h(e),t&&d[t]?g(d[t]):g([]),e&&l[e]?c(l[e]):c([]),a({unit_id:r.unit_id,name:r.name||"",co_signer:r.co_signer||"",status:r.status||"New",date:v(r.date),stage_in_progress:r.stage_in_progress||"",notes:r.notes||"",attachment:null})}},[r,u,d,l]),m.useEffect(()=>{u||n({})},[u]);const U=t=>{const e=parseInt(t);x(e),h(null),a("unit_id",null),n(s=>({...s,city:void 0,property:void 0,unit:void 0})),d[e]?g(d[e]):g([]),c([])},k=t=>{const e=parseInt(t);h(e),a("unit_id",null),n(s=>({...s,property:void 0,unit:void 0})),l[e]?c(l[e]):c([])},V=t=>{const e=parseInt(t);a("unit_id",e),n(s=>({...s,unit:void 0}))},S=t=>{t.preventDefault(),n({});let e=!1;const s={};if(I||(s.city="Please select a city before submitting the form.",e=!0),C||(s.property="Please select a property before submitting the form.",e=!0),i.unit_id||(s.unit="Please select a unit before submitting the form.",e=!0),(!i.name||i.name.trim()==="")&&(s.name="Please enter a name before submitting the form.",e=!0),(!i.co_signer||i.co_signer.trim()==="")&&(s.co_signer="Please enter a co-signer before submitting the form.",e=!0),(!i.status||i.status.trim()==="")&&(s.status="Please select a status before submitting the form.",e=!0),e){n(s);return}E(route("applications.update",r.id),{onSuccess:()=>{n({}),y(!1),P?.()}})},B=()=>{n({}),y(!1)};return o.jsx(M,{open:u,onOpenChange:y,modal:!1,children:o.jsx(R,{size:"half",title:`Edit Application - ${r.name}`,children:o.jsxs("div",{className:"flex h-full flex-col",children:[o.jsx("div",{className:"flex-1 overflow-auto p-6",children:o.jsxs("form",{onSubmit:S,className:"space-y-4",children:[o.jsx(T,{cities:D,selectedCityId:I,selectedPropertyId:C,selectedUnitId:i.unit_id,availableProperties:A,availableUnits:w,onCityChange:U,onPropertyChange:k,onUnitChange:V,errors:f,validationErrors:_}),o.jsx(J,{city:r.city,property:r.property,unitName:r.unit_name}),o.jsx($,{name:i.name,coSigner:i.co_signer,onNameChange:t=>{a("name",t),n(e=>({...e,name:void 0}))},onCoSignerChange:t=>{a("co_signer",t),n(e=>({...e,co_signer:void 0}))},errors:f,validationErrors:_}),o.jsx(q,{status:i.status,date:i.date,onStatusChange:t=>{a("status",t),n(e=>({...e,status:void 0}))},onDateChange:t=>a("date",t),errors:f,validationErrors:_}),o.jsx(G,{stageInProgress:i.stage_in_progress,notes:i.notes,onStageChange:t=>a("stage_in_progress",t),onNotesChange:t=>a("notes",t),errors:f}),o.jsx(H,{currentAttachmentName:r.attachment_name,onAttachmentChange:t=>a("attachment",t),error:f.attachment})]})}),o.jsx(z,{children:o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(N,{type:"button",variant:"outline",onClick:B,children:"Cancel"}),o.jsx(N,{type:"submit",disabled:j,onClick:S,children:j?"Updatingâ€¦":"Update Application"})]})})]})})})}export{ke as default};
