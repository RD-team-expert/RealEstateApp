import{r as n,u as B,j as t,H as M,a as l}from"./app-IncGAUEB.js";import{C as z,b as G}from"./card-hD-4qfcw.js";import{u as J}from"./usePermissions-BWmUIPam.js";import{A as K}from"./app-layout-DdQ-RLDz.js";import W from"./VendorCreateDrawer-BuxFAobp.js";import X from"./VendorEditDrawer-Dbiy2hCH.js";import Y from"./FlashMessages-DvZNMsqh.js";import Z from"./PageHeader-Cvio0y4U.js";import ee from"./VendorFilters-Cx7EciXD.js";import te from"./VendorTable-D_m7HNbn.js";import re from"./VendorPagination-nLXmsnn6.js";import"./app-DgqXL21p.js";import"./utils-CBfrqCZ4.js";import"./index-bCzQdt7o.js";import"./index-CdJFUDDL.js";import"./button-BZreYh_c.js";import"./index-CfKQ6yNG.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./index-Dc_FVRD7.js";import"./index-DfV2_jol.js";import"./index-DfBxMdWp.js";import"./index-CoG2tpvC.js";import"./collapsible-CmadTdVI.js";import"./chevron-right-Dv0ELFzT.js";import"./index-X0Rqfk2m.js";import"./log-out-DkEuD3xv.js";import"./chevrons-up-down-D4md56fd.js";import"./app-logo-icon-BCIu8Oaa.js";import"./house-D_snjZK4.js";import"./building-DGN1JdDp.js";import"./users-DR4b9nxK.js";import"./wrench-j2xp49CP.js";import"./credit-card-nxx9uyGn.js";import"./dollar-sign-Do5zHV6l.js";import"./file-text-D45rT7Bs.js";import"./triangle-alert-D4SYorIn.js";import"./bell-c07z0V_k.js";import"./drawer-BabOL_dj.js";import"./CityField-Dlat-XxC.js";import"./label-BhALl-XJ.js";import"./popover-D0q3r5CP.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./VendorNameField-B_yddmSO.js";import"./input-BKi6rfRv.js";import"./PhoneNumberField-BOMTJ2iA.js";import"./plus-BVjqVSDl.js";import"./trash-2-DcRRmtsX.js";import"./EmailField-2ItKoUme.js";import"./ServiceTypeField-Cn5zfcdU.js";import"./select-BqJlafxu.js";import"./index-DizBXXCV.js";import"./chevron-down-uas8HWR-.js";import"./check-gd2_wZBq.js";import"./chevron-up-DtKhYrlV.js";import"./CityField-BEFX8fwx.js";import"./VendorNameField-8-Vj0dCT.js";import"./PhoneNumberField-D55D1Ouw.js";import"./EmailField-DbEcayUq.js";import"./ServiceTypeField-DdkmodT_.js";import"./download-BTdncQqR.js";import"./table-DyrYtZnv.js";import"./VendorTableRow-C6X9kuUv.js";import"./square-pen-PIAnrcOq.js";const oe=(i,a="vendors.csv")=>{const c=["ID","City","Vendor Name","Number","Email","Service Type"],p=r=>!r||!Array.isArray(r)||r.length===0?"":r.join("; "),y=[c.join(","),...i.map(r=>[r.id,`"${r.city?.city||"N/A"}"`,`"${r.vendor_name}"`,`"${p(r.number)}"`,`"${p(r.email)}"`,`"${p(r.service_type)}"`].join(","))].join(`
`),u=new Blob([y],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)};function jt({vendors:i,filters:a,cities:c}){const[,p]=n.useState(a),[y,u]=n.useState(!1),[o,d]=n.useState(!1),[r,j]=n.useState(!1),[V,A]=n.useState(null),{flash:F}=B().props,{hasPermission:C,hasAllPermissions:_}=J(),[g,w]=n.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[v,N]=n.useState(a?.per_page?.toString?.()??"15"),[O,h]=n.useState(!1),f=(e,s)=>{w(m=>({...m,[e]:s}))},R=e=>{const s=e.target.value;f("city",s),h(s.length>0)},k=e=>{f("city",e.city),h(!1)},I=()=>{const e={...g,per_page:v};p(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},T=()=>{const e={city:"",vendor_name:""};w(e),p(e),h(!1),l.get(route("vendors.index"),{per_page:v},{preserveState:!0,preserveScroll:!0})},L=e=>{const s=e.target.value;N(s);const m={...g,per_page:s};l.get(route("vendors.index"),m,{preserveState:!0,preserveScroll:!0})},$=()=>{if(i.data.length===0){alert("No data to export");return}u(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{u(!1)}},U=e=>{if(!confirm("Are you sure you want to delete this vendor?"))return;const m=(()=>{try{const x=new URLSearchParams(window.location.search),S=["city","city_id","vendor_name","number","email","per_page","page"],E={};return S.forEach(P=>{const D=x.get(P);D!==null&&(E[P]=D)}),E}catch{return{}}})(),b={};[["city","filter_city"],["city_id","filter_city_id"],["vendor_name","filter_vendor_name"],["number","filter_number"],["email","filter_email"],["per_page","filter_per_page"],["page","filter_page"]].forEach(([x,S])=>{m[x]!==void 0&&(b[S]=m[x])}),l.delete(route("vendors.destroy",e.id),{preserveScroll:!0,preserveState:!0,data:b})},H=()=>{l.reload()},q=e=>{A(e),j(!0)},Q=()=>{l.reload()};return t.jsxs(K,{children:[t.jsx(M,{title:"Vendors"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(Y,{flash:F}),t.jsx(Z,{hasExportPermission:C("vendor.export"),hasCreatePermissions:_(["vendors.create","vendors.store"]),isExporting:y,onExport:$,onAddVendor:()=>d(!0)}),t.jsx(z,{children:t.jsxs(G,{className:"p-6",children:[t.jsx(ee,{tempFilters:g,cities:c,showCityDropdown:O,onTempFilterChange:f,onCityInputChange:R,onCitySelect:k,onSearchClick:I,onClearFilters:T,setShowCityDropdown:h}),t.jsx(te,{vendors:i.data,hasEditPermissions:_(["vendors.edit","vendors.update"]),hasDeletePermission:C("vendors.destroy"),onEditVendor:q,onDeleteVendor:U}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),t.jsxs("select",{value:v,onChange:L,className:"rounded-md border border-input bg-background px-2 py-1 text-sm shadow-sm focus:outline-none",children:[t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"all",children:"All"})]})]}),t.jsx(re,{links:i.links})]})]})})]})}),t.jsx(W,{cities:c,open:o,onOpenChange:d,onSuccess:H}),t.jsx(X,{cities:c,open:r,onOpenChange:j,vendor:V,onSuccess:Q})]})}export{jt as default};
