import{r as p,j as i,H as O,a as u}from"./app-DfhMz46N.js";import{C as P,b as k}from"./card-DnYtlxUS.js";import{u as N}from"./usePermissions-CxLN4YG6.js";import{A as L}from"./app-layout-CkBdeP0R.js";import U from"./MoveInCreateDrawer-gvsz9Fcp.js";import T from"./MoveInEditDrawer-D2w-x4Zc.js";import R from"./PageHeader-ChjQCAkb.js";import H from"./MoveInFilters-ChlfqXU3.js";import V from"./MoveInTable-BmOUQBoR.js";import K from"./EmptyState-oyMh5dE-.js";import Z from"./PaginationInfo-BD8MXiZQ.js";import"./app-B7C1jyr3.js";import"./utils-CBfrqCZ4.js";import"./index-DCi-Xv1e.js";import"./index-CdJFUDDL.js";import"./button-D70ZdTAE.js";import"./index-BQKCx-PJ.js";import"./index-CBYZjZBF.js";import"./index-Be_qgOKl.js";import"./index-Bd9tPrb_.js";import"./index-DV6UInPh.js";import"./index-BTxfuEuk.js";import"./x-DZ3FO5Wj.js";import"./createLucideIcon-DgVEEFYv.js";import"./index-Dc_FVRD7.js";import"./index-Ct5EcCoK.js";import"./index-CubYnoId.js";import"./index-DLswfCi4.js";import"./collapsible-CxKi9m-H.js";import"./chevron-right-BW9owo_I.js";import"./index-PkKgVJHn.js";import"./log-out-wHczke_X.js";import"./chevrons-up-down-JgGBqF6F.js";import"./app-logo-icon-5xx7lIbL.js";import"./house-C6-1wI8m.js";import"./building-Dgb3xTR3.js";import"./users-ejwhL9u9.js";import"./wrench-BBDdmO44.js";import"./credit-card-muz8icID.js";import"./dollar-sign-CLLUuUfb.js";import"./file-text-jifTgd3g.js";import"./triangle-alert-DYFGciiD.js";import"./bell-C7uwicu3.js";import"./drawer-DfcxSr7r.js";import"./CityPropertyUnitSelector-CpqNyN9Z.js";import"./label-DcH_3_W8.js";import"./select-CjXVIajk.js";import"./index-DbgZyH5A.js";import"./chevron-down-VWfm6OW2.js";import"./check-CordmqsZ.js";import"./chevron-up-dLBEGKat.js";import"./LeaseInformationFields-D_G3d2jX.js";import"./radioGroup-D6vUyOHk.js";import"./DatePickerField-CI3SoIln.js";import"./calendar-MDrvGB0M.js";import"./format-PYUiRpxY.js";import"./chevron-left-DiUZGSRN.js";import"./popover-CAZC23Eq.js";import"./calendar-Rkx4ksc5.js";import"./PaymentInformationFields-DN7N4s27.js";import"./KeysAndFormsFields-DrPHmb4o.js";import"./InsuranceInformationFields-CBW8qcoD.js";import"./CitySelector-De3h6Wdv.js";import"./FormSection-D6ibOaio.js";import"./PropertySelector-DVzqcVG7.js";import"./UnitSelector-DPGUHei3.js";import"./LeaseSigningSection-Bxvf4THX.js";import"./RadioGroupField-BSzZhEyY.js";import"./DatePickerField-C14a1Xjh.js";import"./MoveInDetailsSection-C1qCWXZX.js";import"./PaymentSection-CObgi8Xf.js";import"./KeysAndFormsSection-GjiVHTbA.js";import"./InsuranceSection-DRxAr3ir.js";import"./download-Dlz0wQ4J.js";import"./plus-CSmAj_IW.js";import"./input-BxpY_ptm.js";import"./search-DDQcn7AF.js";import"./table-Cv3zQ3q1.js";import"./MoveInTableRow-D1Cx4BOA.js";import"./badge-CLj8v7wz.js";import"./square-pen-k3KPWcNg.js";import"./trash-2-CEOusBqN.js";const q=(o,c="move-ins.csv")=>{try{const e=t=>{if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(s)}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),d=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...o.map(t=>{try{return[t.id||"",`"${a(t.city_name)}"`,`"${a(t.property_name)}"`,`"${a(t.unit_name)}"`,`"${a(t.signed_lease)}"`,`"${e(t.lease_signing_date)}"`,`"${e(t.move_in_date)}"`,`"${a(t.paid_security_deposit_first_month_rent)}"`,`"${e(t.scheduled_paid_time)}"`,`"${a(t.handled_keys)}"`,`"${e(t.move_in_form_sent_date)}"`,`"${a(t.filled_move_in_form)}"`,`"${e(t.date_of_move_in_form_filled)}"`,`"${a(t.submitted_insurance)}"`,`"${e(t.date_of_insurance_expiration)}"`].join(",")}catch(s){return console.error("Error processing move-in row:",t,s),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([d],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(f);return n.setAttribute("href",l),n.setAttribute("download",c),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function _r({moveIns:o,search:c,filters:e,units:a,cities:h,properties:d,unitsByProperty:f}){const[n,l]=p.useState(!1),[t,s]=p.useState(!1),[v,S]=p.useState(!1),[E,D]=p.useState(null),[y,g]=p.useState({city:e?.city||"",property:e?.property||"",search:e?.search||c||""});p.useEffect(()=>{g({city:e?.city||"",property:e?.property||"",search:e?.search||c||""})},[e,c]);const{hasPermission:_,hasAnyPermission:j}=N(),C=r=>{g(r);const m={};r.search?.trim()&&(m.search=r.search.trim()),r.city?.trim()&&(m.city=r.city.trim()),r.property?.trim()&&(m.property=r.property.trim()),u.get(route("move-in.index"),m,{preserveState:!0,preserveScroll:!0})},b=()=>{g({city:"",property:"",search:""}),u.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},w=r=>{confirm("Are you sure you want to delete this move-in record?")&&u.delete(route("move-in.destroy",r.id))},$=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}l(!0);try{console.log("Exporting move-in data:",o.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;q(o.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const m=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${m}. Please check the console for details.`)}finally{l(!1)}},M=()=>{u.reload()},A=()=>{u.reload()},F=r=>{D(r),S(!0)},x=y.search||y.city||y.property;return i.jsxs(L,{children:[i.jsx(O,{title:"Move-In Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(R,{hasActiveFilters:!!x,isExporting:n,hasData:o?.data&&o.data.length>0,hasCreatePermission:_("move-in.store"),onExport:$,onCreateClick:()=>s(!0)}),i.jsxs(P,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(H,{cities:h,properties:d,initialFilters:y,onSearch:C,onClear:b,hasActiveFilters:!!x}),i.jsxs(k,{children:[i.jsx(V,{moveIns:o.data,canEdit:_("move-in.update"),canDelete:_("move-in.destroy"),showActions:j(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:F,onDelete:w}),o.data.length===0&&i.jsx(K,{hasActiveFilters:!!x}),o.meta&&i.jsx(Z,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})]})]})}),i.jsx(U,{units:a,cities:h,properties:d,unitsByProperty:f,open:t,onOpenChange:s,onSuccess:M}),E&&i.jsx(T,{moveIn:E,units:a,cities:h,properties:d,unitsByProperty:f,open:v,onOpenChange:S,onSuccess:A})]})}export{_r as default};
