import{r as p,u as z,j as o,H as G,a as _}from"./app-BSOlzI_M.js";import{C as J,a as K,b as Q}from"./card-lrH58jzJ.js";import{u as W}from"./usePermissions-DDr8nGFF.js";import{A as X}from"./app-layout-BU6wzt8Q.js";import Y from"./ApplicationCreateDrawer-WeoYV-fp.js";import Z from"./ApplicationEditDrawer-DQ452ekO.js";import tt from"./ApplicationsTable-DQ6skuPD.js";import rt from"./EmptyState-dFPcaI2l.js";import et from"./FilterBar-D8wDUQ6H.js";import ot from"./FlashMessages-Dt2MrB0Z.js";import it from"./PageHeader-cPYbyVw-.js";import st from"./Pagination-DdndFW7f.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./button-D2rKFPK1.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./index-Dc_FVRD7.js";import"./index-CJ72cHre.js";import"./index-C4PIvpnm.js";import"./index-D4B3QgQ6.js";import"./collapsible-BeIaK3gz.js";import"./chevron-right-DU-yjHU5.js";import"./index-p7EaCzMM.js";import"./log-out-CU7fAD8S.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./app-logo-icon-Chz0QK53.js";import"./house-A7z-bt3N.js";import"./building-X8V0cPLX.js";import"./users-BZ-W0K9D.js";import"./wrench-AB0PbR3c.js";import"./credit-card-Dh1t_toN.js";import"./dollar-sign-CX6g00Px.js";import"./file-text-XuiuEW0Z.js";import"./triangle-alert-EDCPZCCy.js";import"./bell-CjUavl-i.js";import"./drawer-B6ZRXvIZ.js";import"./CityPropertyUnitSelector-DgvYsdON.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./command-CBR154ui.js";import"./search-BcNZ_u8M.js";import"./check-BE4k6INO.js";import"./ApplicantInformationSection-Cg-X4rMD.js";import"./input-DWv8_Yxn.js";import"./select-Ckv1zRlQ.js";import"./index-C4dPa-2_.js";import"./chevron-down--Oeingn_.js";import"./chevron-up-RzjEL1k0.js";import"./application-CnwOiERd.js";import"./StatusAndDateSection-O11kkBng.js";import"./calendar-Di5dbzoO.js";import"./format-PYUiRpxY.js";import"./chevron-left-CVo-4b8C.js";import"./radioGroup-DqEJ_5sj.js";import"./calendar-CthI5zTo.js";import"./AdditionalDetailsSection-CFIhAVje.js";import"./ApplicantInformationFields-BuIa63ve.js";import"./AttachmentField-BIIo1_ba.js";import"./rotate-ccw-B0RGZt2F.js";import"./CityPropertyUnitSelector-DiN1qhn-.js";import"./CurrentSelectionDisplay-CjpfeO3m.js";import"./StageAndNotesFields-BqAJ14WZ.js";import"./StatusAndDateFields-C7X8bVtm.js";import"./table-D6Ykx5nO.js";import"./ApplicationsTableRow-DuDDJ4ns.js";import"./badge-Bc6JwGPl.js";import"./eye-D6dEBVIw.js";import"./square-pen-BbbP7D49.js";import"./trash-2-CnyQPA5D.js";import"./download-DpLM-FVr.js";import"./plus-DpdyZws7.js";import"./pagination-gtbI_ymV.js";const at=(e,m="applications.csv")=>{try{const i=t=>t==null?"":String(t).replace(/"/g,'""'),u=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),g=t=>!t||t.length===0?"":t.map(n=>n.name).join("; "),f=[["ID","City","Property","Unit","Name","Co-signer","Status","Applicant Applied From","Date","Stage in Progress","Notes","Attachments Count","Attachment Names"].join(","),...e.map(t=>{try{return[t.id||"",`"${i(t.city)}"`,`"${i(t.property)}"`,`"${i(t.unit_name)}"`,`"${i(t.name)}"`,`"${i(t.co_signer)}"`,`"${i(t.status)}"`,`"${i(t.applicant_applied_from)}"`,`"${u(t.date)}"`,`"${i(t.stage_in_progress)}"`,`"${i(t.notes)}"`,t.attachments?.length||0,`"${g(t.attachments)}"`].join(",")}catch(n){return console.error("Error processing application row:",t,n),""}}).filter(t=>t!=="")].join(`
`),h=new Blob([f],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(h);return a.setAttribute("href",c),a.setAttribute("download",m),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c),!0}catch(i){throw console.error("CSV Export Error:",i),i}};function Nr({applications:e,filters:m,cities:i,properties:u,units:g,filterCities:y,filterProperties:f,filterUnits:h}){const[a,c]=p.useState(!1),[t,n]=p.useState(!1),[S,E]=p.useState(null),[b,j]=p.useState(!1),{flash:w}=z().props,{hasPermission:A,hasAnyPermission:C,hasAllPermissions:F}=W(),[s,x]=p.useState({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),P=m?.per_page?String(m.per_page):String(e?.per_page??15),[l,D]=p.useState(P===String(e?.total??"")?"all":P);p.useEffect(()=>{const r=m||{};x({city:r.city||"",property:r.property||"",unit:r.unit||"",name:r.name||"",applicant_applied_from:r.applicant_applied_from||""})},[m]);const $=r=>{x(r),_.get(route("applications.index"),{...r,per_page:l,page:1},{preserveState:!0,preserveScroll:!0})},v=()=>{x({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),D("15"),_.get(route("applications.index"),{per_page:"15",page:1},{preserveState:!1})},O=r=>{confirm("Are you sure you want to delete this application?")&&_.delete(route("applications.destroy",r.id),{data:{filter_city:s.city||"",filter_property:s.property||"",filter_unit:s.unit||"",filter_name:s.name||"",filter_applicant_applied_from:s.applicant_applied_from||"",per_page:l,page:e.current_page},preserveState:!0,preserveScroll:!0})},k=()=>{if(!e||!e.data||e.data.length===0){alert("No data to export");return}j(!0);try{const r=`applications-${new Date().toISOString().split("T")[0]}.csv`;at(e.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}`)}finally{j(!1)}},N=()=>{c(!1)},I=()=>{n(!1),E(null)},U=r=>{E(r),n(!0)},L=(y||[]).map((r,d)=>({id:d+1,name:r})),R={0:(f||[]).map((r,d)=>({id:d+1,name:r,city_id:0}))},H={0:(h||[]).map((r,d)=>({id:d+1,name:r,property_id:0}))},V=F(["applications.create","applications.store"]),T=A("applications.show"),B=C(["applications.edit","applications.update"]),M=A("applications.destroy"),q=C(["applications.show","applications.edit","applications.update","applications.destroy"]);return o.jsxs(X,{children:[o.jsx(G,{title:"Applications"}),o.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:o.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[o.jsx(ot,{success:w?.success,error:w?.error}),o.jsx(it,{onExport:k,onAddNew:()=>c(!0),isExporting:b,hasExportData:!!(e?.data&&e.data.length>0),hasCreatePermission:V}),o.jsxs(J,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(K,{children:o.jsx(et,{cities:L,properties:R,units:H,initialFilters:s,onSearch:$,onClear:v})}),o.jsx(Q,{children:e.data.length>0?o.jsxs(o.Fragment,{children:[o.jsx(tt,{applications:e.data,onEdit:U,onDelete:O,hasViewPermission:T,hasEditPermission:B,hasDeletePermission:M,hasAnyActionPermission:q,filters:s}),o.jsx(st,{links:e.links,meta:{current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to},filters:s,perPage:l,onPerPageChange:D})]}):o.jsx(rt,{})})]})]})}),o.jsx(Y,{cities:i,properties:u,units:g,open:a,onOpenChange:c,onSuccess:N,currentFilters:s,perPage:l,page:e.current_page}),S&&o.jsx(Z,{application:S,cities:i,properties:u,units:g,open:t,onOpenChange:n,onSuccess:I,currentFilters:s,perPage:l,page:e.current_page})]})}export{Nr as default};
