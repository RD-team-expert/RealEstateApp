import{r as C,a as P,j as e,H as $,L as N,b as y}from"./app-DnZTfT0_.js";import{u as L,A as B}from"./app-layout-NpEgK4_T.js";import{B as j}from"./app-logo-icon-Bc2eyx79.js";import{I as x}from"./input-DQ_wq_vv.js";import{C as p,c as f,a as U,b as I}from"./card-C4RmjogZ.js";import{P as H,T as R,a as k,b as S,c as n,d as F,e as o,f as O}from"./table-7_H-LZJM.js";import{B as _}from"./badge-CCSbDhbi.js";import{D as z}from"./download-DrHPYDYz.js";import{E as V}from"./eye-Cf9la-Va.js";import{S as q}from"./square-pen-qd8CnHV4.js";import"./app-8ZSuAH30.js";import"./index-CToc1y-v.js";import"./index-D6oF8zzd.js";const M=(b,r="applications.csv")=>{try{const c=t=>{if(!t)return"";try{return new Date(t).toLocaleDateString()}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),v=[["ID","City","Property","Unit","Name","Co-signer","Status","Date","Stage in Progress","Notes","Attachment Name"].join(","),...b.map(t=>{try{return[t.id||"",`"${a(t.city)}"`,`"${a(t.property)}"`,`"${a(t.unit)}"`,`"${a(t.name)}"`,`"${a(t.co_signer)}"`,`"${a(t.status)}"`,`"${c(t.date)}"`,`"${a(t.stage_in_progress)}"`,`"${a(t.notes)}"`,`"${a(t.attachment_name)}"`].join(",")}catch(u){return console.error("Error processing application row:",t,u),""}}).filter(t=>t!=="")].join(`
`),g=new Blob([v],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),m=URL.createObjectURL(g);return d.setAttribute("href",m),d.setAttribute("download",r),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m),!0}catch(c){throw console.error("CSV Export Error:",c),c}};function ne({auth:b,applications:r,statistics:c,filters:a}){const[l,v]=C.useState(a),[g,d]=C.useState(!1),{flash:m}=P().props,{hasPermission:t,hasAnyPermission:u,hasAllPermissions:A}=L(),i=(s,h)=>{const w={...l,[s]:h};v(w),y.get(route("applications.index"),w,{preserveState:!0,preserveScroll:!0})},E=s=>{confirm("Are you sure you want to delete this application?")&&y.delete(route("applications.destroy",s.id))},D=()=>{if(!r||!r.data||r.data.length===0){alert("No data to export");return}d(!0);try{console.log("Exporting applications data:",r.data);const s=`applications-${new Date().toISOString().split("T")[0]}.csv`;M(r.data,s),console.log("Export completed successfully")}catch(s){console.error("Export failed:",s),alert(`Export failed: ${s.message||"Unknown error"}. Please check the console for details.`)}finally{d(!1)}},T=s=>s?e.jsx(_,{variant:"default",children:s}):e.jsx(_,{variant:"outline",children:"No Status"});return e.jsxs(B,{children:[e.jsx($,{title:"Applications"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[m?.success&&e.jsx("div",{className:"mb-4 bg-chart-1/20 border border-chart-1 text-chart-1 px-4 py-3 rounded",children:m.success}),m?.error&&e.jsx("div",{className:"mb-4 bg-destructive/20 border border-destructive text-destructive px-4 py-3 rounded",children:m.error}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(p,{children:e.jsxs(f,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Total Applications"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:c.total})]})}),e.jsx(p,{children:e.jsxs(f,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"By Status"}),e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(c.status_counts).map(([s,h])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s||"No Status",":"]}),e.jsx("span",{className:"font-semibold text-foreground",children:h})]},s))})]})}),e.jsx(p,{children:e.jsxs(f,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"By Stage"}),e.jsx("div",{className:"mt-2 space-y-1",children:Object.entries(c.stage_counts).slice(0,5).map(([s,h])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s||"No Stage",":"]}),e.jsx("span",{className:"font-semibold text-foreground",children:h})]},s))})]})})]}),e.jsxs(p,{children:[e.jsxs(U,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(I,{className:"text-2xl",children:"Applications"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:D,disabled:g||!r?.data||r.data.length===0,className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),g?"Exporting...":"Export CSV"]}),A(["applications.create","applications.store"])&&e.jsx(N,{href:route("applications.create"),children:e.jsxs(j,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Application"]})})]})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{type:"text",placeholder:"Property",value:l.property||"",onChange:s=>i("property",s.target.value)}),e.jsx(x,{type:"text",placeholder:"Name",value:l.name||"",onChange:s=>i("name",s.target.value)}),e.jsx(x,{type:"text",placeholder:"Unit",value:l.unit||"",onChange:s=>i("unit",s.target.value)}),e.jsx(x,{type:"text",placeholder:"Status",value:l.status||"",onChange:s=>i("status",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{type:"text",placeholder:"Co-signer",value:l.co_signer||"",onChange:s=>i("co_signer",s.target.value)}),e.jsx(x,{type:"text",placeholder:"Stage in Progress",value:l.stage_in_progress||"",onChange:s=>i("stage_in_progress",s.target.value)}),e.jsx(x,{type:"date",placeholder:"Date From",value:l.date_from||"",onChange:s=>i("date_from",s.target.value)}),e.jsx(x,{type:"date",placeholder:"Date To",value:l.date_to||"",onChange:s=>i("date_to",s.target.value)})]})]})]}),e.jsxs(f,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(k,{children:e.jsxs(S,{children:[e.jsx(n,{children:"City"}),e.jsx(n,{children:"Property"}),e.jsx(n,{children:"Unit"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Co-signer"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Stage"}),e.jsx(n,{children:"Note"}),e.jsx(n,{children:"Attachment"}),u(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(n,{children:"Actions"})]})}),e.jsx(F,{children:r.data.map(s=>e.jsxs(S,{className:"hover:bg-muted/50",children:[e.jsx(o,{className:"font-medium",children:s.city}),e.jsx(o,{className:"font-medium",children:s.property}),e.jsx(o,{children:s.unit}),e.jsx(o,{children:s.name}),e.jsx(o,{children:s.co_signer}),e.jsx(o,{children:T(s.status)}),e.jsx(o,{children:s.date?new Date(s.date).toLocaleDateString():"N/A"}),e.jsx(o,{children:s.stage_in_progress||"N/A"}),e.jsx(o,{children:s.notes||"N/A"}),e.jsx(o,{children:s.attachment_name?e.jsx("a",{href:`/applications/${s.id}/download`,className:"text-primary hover:underline text-sm",children:s.attachment_name}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No attachment"})}),u(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(o,{children:e.jsxs("div",{className:"flex gap-1",children:[t("applications.show")&&e.jsx(N,{href:route("applications.show",s.id),children:e.jsx(j,{variant:"outline",size:"sm",children:e.jsx(V,{className:"h-4 w-4"})})}),u(["applications.edit","applications.update"])&&e.jsx(N,{href:route("applications.edit",s.id),children:e.jsx(j,{variant:"outline",size:"sm",children:e.jsx(q,{className:"h-4 w-4"})})}),t("applications.destroy")&&e.jsx(j,{variant:"outline",size:"sm",onClick:()=>E(s),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:e.jsx(O,{className:"h-4 w-4"})})]})})]},s.id))})]})}),r.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No applications found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),r.last_page>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("nav",{className:"flex space-x-2",children:r.links.map((s,h)=>e.jsx("button",{onClick:()=>s.url&&y.get(s.url),disabled:!s.url,className:`px-3 py-2 text-sm rounded ${s.active?"bg-primary text-primary-foreground":s.url?"bg-muted text-foreground hover:bg-accent":"bg-muted text-muted-foreground cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:s.label}},h))})}),r.meta&&e.jsx("div",{className:"mt-6 flex justify-between items-center",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",r.meta.from||0," to ",r.meta.to||0," of ",r.meta.total||0," results"]})})]})]})]})})]})}export{ne as default};
