import{r as l,j as r,H as V,a as x}from"./app-DYme-6ST.js";import{A as M}from"./app-layout-H-O_MzQ8.js";import{C as K,a as q,b as z}from"./card-CWWVdt52.js";import{T as G,d as J}from"./table-NBJhLnC1.js";import{u as Q}from"./usePermissions-Bu-R0dRn.js";import W from"./OffersAndRenewalsCreateDrawer-BosMu2Cm.js";import X from"./OffersAndRenewalsEditDrawer-BuzzXfGy.js";import{FilterBar as Y}from"./FilterBar-CHSu0BK1.js";import{TabNavigation as Z}from"./TabNavigation-BKam8jQH.js";import{PageHeader as B}from"./PageHeader-xIf75aU4.js";import{OffersTableHeader as ee}from"./TableHeader-u6DlLRZ3.js";import{OffersTableRow as te}from"./TableRow-C8P_WvGp.js";import{EmptyState as re}from"./EmptyState-CeobnvCr.js";import{TableFooter as ne}from"./TableFooter-C4jTdRWR.js";import{f as oe}from"./format-PYUiRpxY.js";import"./app-BxoA0TtB.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-DygVteL_.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CascadingSelectors-DgYvmBF5.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./input-pR7fOcUW.js";import"./OfferInformationSection-CKp4q0PD.js";import"./DatePickerField-DfwcFXsM.js";import"./calendar-BWK2M4JP.js";import"./chevron-left-C0SnhLPd.js";import"./popover-iS5_0AtM.js";import"./calendar-Bw6k_ssZ.js";import"./RadioGroupField-Bd7lUx3E.js";import"./radioGroup-F0AlgpLY.js";import"./AcceptanceSection-DIuss5gR.js";import"./LeaseInformationSection-B7AAV7yY.js";import"./RenewalInformationSection-7z-0f6p6.js";import"./AdditionalFieldsSection-Dlry2GyL.js";import"./DateOfDeclineSection-f1i8Yr-2.js";import"./CitySelector-DUchaKeQ.js";import"./PropertySelector-DdO4NvkY.js";import"./UnitSelector-DsVEYi7x.js";import"./TenantSelector-COgvlYkI.js";import"./DatePickerField-Cww2ST-M.js";import"./RadioGroupField-D-B8kUDj.js";import"./TextAreaField-uKpCZ33b.js";import"./DateOfDeclineSectionEdit-YeJSFTd9.js";import"./search-1yu5M8Yr.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";import"./badge-DkU7s25L.js";import"./eye-aSD_-4Al.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";const u=(i,o="-")=>{if(!i)return o;const f=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!f)return o;const[,t,s,c]=f,w=new Date(Number(t),Number(s)-1,Number(c));return oe(w,"P")},se=(i,o,f="offers-renewals.csv")=>{try{const t=e=>e==null?"":String(e).replace(/"/g,'""');let s=["ID","City","Property","Unit","Tenant"];(o==="offers"||o==="both")&&(s=s.concat(["Date Sent Offer","Status","Date of Acceptance","Offer Last Notice Sent","Offer Notice Kind"])),(o==="renewals"||o==="both")&&(s=s.concat(["Lease Sent","Date Sent Lease","Lease Signed","Date Signed","Renewal Last Notice Sent","Renewal Notice Kind","Notes"])),s=s.concat(["How Many Days Left","Expired","Other Tenants","Date of Decline"]);const c=[s.join(","),...i.map(e=>{try{let a=[e.id||"",`"${t(e.city_name)}"`,`"${t(e.property)}"`,`"${t(e.unit)}"`,`"${t(e.tenant)}"`];return(o==="offers"||o==="both")&&(a=a.concat([`"${u(e.date_sent_offer,"")}"`,`"${t(e.status)}"`,`"${u(e.date_of_acceptance,"")}"`,`"${u(e.last_notice_sent,"")}"`,`"${t(e.notice_kind)}"`])),(o==="renewals"||o==="both")&&(a=a.concat([`"${t(e.lease_sent)}"`,`"${u(e.date_sent_lease,"")}"`,`"${t(e.lease_signed)}"`,`"${u(e.date_signed,"")}"`,`"${u(e.last_notice_sent_2,"")}"`,`"${t(e.notice_kind_2)}"`,`"${t(e.notes)}"`])),a=a.concat([`"${t(String(e.how_many_days_left))}"`,`"${t(e.expired)}"`,`"${t(e.other_tenants)}"`,`"${u(e.date_of_decline,"")}"`]),a.join(",")}catch(a){return console.error("Error processing offer row:",e,a),""}}).filter(e=>e!=="")].join(`
`),w=new Blob([c],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),m=URL.createObjectURL(w);return d.setAttribute("href",m),d.setAttribute("download",f),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(m),!0}catch(t){throw console.error("CSV Export Error:",t),t}},vt=({offers:i,cities:o,properties:f,propertiesByCityId:t,unitsByPropertyId:s,tenantsByUnitId:c,allUnits:w,tenantsData:d})=>{const[m,e]=l.useState("offers"),[a,S]=l.useState(!1),[I,b]=l.useState(!1),[T,j]=l.useState(!1),[C,L]=l.useState(null),[h,D]=l.useState({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),[,$]=l.useState({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),E=l.useMemo(()=>i?Array.isArray(i)?i:(console.warn("Offers data is in unexpected format:",i),[]):[],[i]),O=l.useMemo(()=>o.map(n=>({id:n.id,name:n.city,properties:(t[n.id]||[]).map(_=>({id:_.id,name:_.property_name,city_id:n.id,units:(s[_.id]||[]).map(y=>({id:y.id,name:y.unit_name,property_id:_.id,tenants:(c[y.id]||[]).map(g=>({id:g.id,name:g.full_name,first_name:g.full_name.split(" ")[0]||"",last_name:g.full_name.split(" ").slice(1).join(" ")||"",unit_id:y.id}))}))}))})),[o,t,s,c]),p=E,P=()=>{$(h),x.get(route("offers_and_renewals.index"),{city_name:h.city||null,property_name:h.property||null,unit_name:h.unit||null,tenant_name:h.tenant||null},{preserveState:!0})},R=()=>{D({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),$({city:"",property:"",unit:"",tenant:"",selectedCityId:null,selectedPropertyId:null,selectedUnitId:null,selectedTenantId:null}),x.get(route("offers_and_renewals.index"),{},{preserveState:!1})},k=n=>{window.confirm("Are you sure you want to delete this offer? This action cannot be undone.")&&x.delete(`/offers_and_renewals/${n.id}`)},v=n=>{L(n),j(!0)},U=()=>{if(!p||p.length===0){alert("No data to export");return}S(!0);try{console.log("Exporting offers and renewals data:",p);const n=`offers-renewals-${m}-${new Date().toISOString().split("T")[0]}.csv`;se(p,m,n),console.log("Export completed successfully")}catch(n){console.error("Export failed:",n),alert(`Export failed: ${n instanceof Error?n.message:"Unknown error"}. Please check the console for details.`)}finally{S(!1)}},{hasPermission:N,hasAnyPermission:F,hasAllPermissions:A}=Q(),H={canView:N("offers-and-renewals.show"),canEdit:A(["offers-and-renewals.edit","offers-and-renewals.update"]),canDelete:N("offers-and-renewals.destroy")};return r.jsxs(M,{children:[r.jsx(V,{title:"Offers and Renewals"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(B,{onExport:U,onAddNew:()=>b(!0),isExporting:a,hasData:p.length>0,canCreate:A(["offers-and-renewals.create","offers-and-renewals.store"])}),r.jsxs(K,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsxs(q,{children:[r.jsx(Y,{cities:o,properties:f,propertiesByCityId:t,unitsByPropertyId:s,tenantsByUnitId:c,allUnits:w,tenantsData:d,tempFilters:h,onTempFiltersChange:D,onSearch:P,onClear:R}),r.jsx(Z,{activeTab:m,onTabChange:e})]}),r.jsxs(z,{children:[r.jsx("div",{className:"relative overflow-x-auto",children:r.jsxs(G,{className:"border-collapse rounded-md border border-border",children:[r.jsx(ee,{activeTab:m,hasPermissions:F(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])}),r.jsx(J,{children:p.map(n=>r.jsx(te,{offer:n,activeTab:m,onEdit:v,onDelete:k,permissions:H},n.id))})]})}),p.length===0&&r.jsx(re,{}),r.jsx(ne,{filteredCount:p.length,totalCount:E.length})]})]})]})}),r.jsx(W,{hierarchicalData:O,open:I,onOpenChange:b,onSuccess:()=>{x.reload()}}),C&&r.jsx(X,{offer:C,hierarchicalData:O,open:T,onOpenChange:j,onSuccess:()=>{x.reload()}})]})};export{vt as default};
