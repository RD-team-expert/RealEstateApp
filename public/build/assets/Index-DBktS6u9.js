import{r as s,j as e,H as Dt,a as g}from"./app-B8FMPvUf.js";import{C as jt,a as wt,b as Pt}from"./card-EXxUjTX3.js";import{D as bt,a as Et,b as Nt,c as $t,d as It,e as Tt}from"./dialog-B0UicKOj.js";import{B as G}from"./button-DIZZiQM7.js";import{u as Ut}from"./usePermissions-DDZJFyXm.js";import{A as Ot}from"./app-layout-HHYyJByv.js";import At from"./NoticeAndEvictionsCreateDrawer-M7sbFFoQ.js";import Ft from"./NoticeAndEvictionsEditDrawer-DxzSx2-M.js";import{FilterBar as kt}from"./FilterBar-DsKWkjzs.js";import{NoticeEvictionsTable as Ht}from"./NoticeEvictionsTable-CvPa-lKj.js";import{PageHeader as Lt}from"./PageHeader-COpg8wrw.js";import{PaginationControls as Rt}from"./PaginationControls-B58nX7GP.js";import{f as qt}from"./format-PYUiRpxY.js";import"./app-BrEbHAEe.js";import"./utils-CBfrqCZ4.js";import"./index-fZywndxp.js";import"./index-C_zQ9kkn.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-CdJFUDDL.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./drawer-By-qy253.js";import"./CascadingSelectionFields-DE7mmP7I.js";import"./label-mSIjHkAE.js";import"./command-Byz7UfAg.js";import"./search-CLz9Z_Gu.js";import"./popover-BMQC-RgO.js";import"./check-BVaiT64F.js";import"./SelectionSummary-DQU9T2cO.js";import"./NoticeFormFields-C1952nl6.js";import"./DateField-DTQCl69_.js";import"./calendar-CzDWs5lf.js";import"./chevron-left-nbVEm8OA.js";import"./chevron-down-C7VOkDBv.js";import"./calendar-DesMu7qT.js";import"./EvectedOrPaymentPlanField-DRPss7Nd.js";import"./radioGroup-CuIQOkQ9.js";import"./index-BlkGWg27.js";import"./EvictionsField-DonESpgi.js";import"./input-DGLwPUn8.js";import"./HaveAnExceptionField-BClrd00Q.js";import"./HearingDatesField-B259xgy9.js";import"./IfLeftField-DOHoiHD1.js";import"./NoteField-CeWACzkM.js";import"./OtherTenantsField-CT6JPZB6.js";import"./SentToAttorneyField-CKDmOrjk.js";import"./StatusField-CHPpSSgI.js";import"./TypeOfNoticeField-ahDLmLrl.js";import"./select-CfQzsWP6.js";import"./chevron-up-AmVQJwmd.js";import"./WritDateField-Bl6_eui-.js";import"./CascadingSelectionSection-C9NNiy5S.js";import"./SelectionSummary-CWTi1Ffq.js";import"./StatusSection-CZT6S_0s.js";import"./DateSection-DywlwYvW.js";import"./NoticeTypeSection-fpXZSSxm.js";import"./ExceptionSection-CfoC5H0u.js";import"./NoteSection-onzumYAT.js";import"./EvictionsSection-UXkkRtFX.js";import"./AttorneySection-xX1JioWF.js";import"./HearingDatesSection-Dcj8XBO1.js";import"./EvictionPaymentPlanSection-DU5tfmMK.js";import"./IfLeftSection-DReD07wt.js";import"./WritDateSection-DiUBQKU2.js";import"./OtherTenantsSection-CNhqPibj.js";import"./FilterDropdown-DEi_pUjt.js";import"./table-CzYBox4s.js";import"./NoticeEvictionsTableRow-CMzEUQ0Q.js";import"./StatusBadge-Cg7uIACz.js";import"./badge-BGMBzjbn.js";import"./YesNoBadge-BFF0OvdL.js";import"./eye-DzrUIE3a.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";import"./download-v-3Aavkk.js";import"./plus-C7KcOOhZ.js";const F=i=>{if(!i)return"";const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!c)return"";const[,r,m,l]=c;return`${r}-${m}-${l}`},k=(i,c="-")=>{if(!i)return c;const r=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!r)return c;const[,m,l,y]=r,p=new Date(Number(m),Number(l)-1,Number(y));return qt(p,"P")},Bt=(i,c="notice-evictions.csv")=>{try{const r=n=>n==null?"":String(n).replace(/"/g,'""'),l=[["ID","Unit Name","City Name","Property Name","Tenants Name","Other Tenants","Status","Date","Type of Notice","Have An Exception","Note","Evictions","Sent to Attorney","Hearing Dates","Evicted/Payment Plan","If Left","Writ Date"].join(","),...i.map(n=>{try{return[n.id||"",`"${r(n.unit_name)}"`,`"${r(n.city_name)}"`,`"${r(n.property_name)}"`,`"${r(n.tenants_name)}"`,`"${r(n.other_tenants)}"`,`"${r(n.status)}"`,`"${k(n.date,"")}"`,`"${r(n.type_of_notice)}"`,`"${r(n.have_an_exception)}"`,`"${r(n.note)}"`,`"${r(n.evictions)}"`,`"${r(n.sent_to_atorney)}"`,`"${k(n.hearing_dates,"")}"`,`"${r(n.evected_or_payment_plan)}"`,`"${r(n.if_left)}"`,`"${k(n.writ_date,"")}"`].join(",")}catch(I){return console.error("Error processing record row:",n,I),""}}).filter(n=>n!=="")].join(`
`),y=new Blob([l],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),D=URL.createObjectURL(y);return p.setAttribute("href",D),p.setAttribute("download",c),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(D),!0}catch(r){throw console.error("CSV Export Error:",r),r}},An=({paginatedRecords:i,cities:c=[],properties:r=[],units:m=[],tenants:l=[],notices:y=[],pagination:p={current_page:1,per_page:15,total:0,last_page:1}})=>{const[D,n]=s.useState(!1),[I,T]=s.useState(!1),[J,U]=s.useState(!1),[x,H]=s.useState(null),[K,j]=s.useState(!1),[w,P]=s.useState(null),[O,L]=s.useState(!1),[R,q]=s.useState(p.current_page),[_,M]=s.useState(p.per_page),[v]=s.useState(i),[a,B]=s.useState({city:"",property:"",unit:"",tenant:""}),[,Q]=s.useState({city:"",property:"",unit:"",tenant:""}),[X,b]=s.useState(!1),[Z,E]=s.useState(!1),[tt,N]=s.useState(!1),[et,$]=s.useState(!1),u=(t,o)=>{B(S=>({...S,[t]:o}))},nt=t=>{u("city",t.city),b(!1)},rt=t=>{const o=t.target.value;u("city",o),b(o.length>0)},ot=t=>{const o=t.target.value;u("property",o),E(o.length>0)},it=t=>{u("property",t.property_name),E(!1)},st=t=>{const o=t.target.value;u("unit",o),N(o.length>0)},at=t=>{u("unit",t.unit_name),N(!1)},ct=t=>{const o=t.target.value;u("tenant",o),$(o.length>0)},pt=t=>{u("tenant",t.full_name),$(!1)},C=(t=1,o=_)=>{const S=c.find(f=>f.city===a.city),h=r.find(f=>f.property_name===a.property),Y=m.find(f=>f.unit_name===a.unit),z=l.find(f=>f.full_name===a.tenant),d={page:t,per_page:o};return S?.id?d.city_id=S.id:a.city.trim()&&(d.city_name=a.city.trim()),h?.id?d.property_id=h.id:a.property.trim()&&(d.property_name=a.property.trim()),Y?.id?d.unit_id=Y.id:a.unit.trim()&&(d.unit_name=a.unit.trim()),z?.id?d.tenant_id=z.id:a.tenant.trim()&&(d.tenant_name=a.tenant.trim()),d},lt=()=>{const t=C(R,_),o=[];return Object.entries(t).forEach(([S,h])=>{h!=null&&h!==""&&o.push(`${encodeURIComponent(S)}=${encodeURIComponent(String(h))}`)}),o.length>0?"?"+o.join("&"):""},mt=()=>{Q(a);const t=C(1);g.get(route("notice_and_evictions.index"),t,{preserveState:!0})},dt=()=>{B({city:"",property:"",unit:"",tenant:""}),Q({city:"",property:"",unit:"",tenant:""}),b(!1),E(!1),N(!1),$(!1),g.get(route("notice_and_evictions.index"),{},{preserveState:!1})},ut=t=>{q(t);const o=C(t,_);g.get(route("notice_and_evictions.index"),o,{preserveState:!0})},ht=t=>{M(t),q(1);const o=C(1,t);g.get(route("notice_and_evictions.index"),o,{preserveState:!0})},A=()=>C(R,_),ft=t=>{P(t),j(!0)},gt=async()=>{if(w){L(!0);try{const t=A(),o=new URLSearchParams(t).toString();g.delete(`/notice_and_evictions/${w.id}?${o}`,{onFinish:()=>{j(!1),P(null)}})}finally{L(!1)}}},yt=t=>{H(t),U(!0)},xt=()=>{U(!1),H(null),g.reload()},St=()=>{T(!1),g.reload()},_t=()=>{if(!i.data||i.data.length===0){alert("No data to export");return}n(!0);try{const t=`notice-evictions-${new Date().toISOString().split("T")[0]}.csv`;Bt(i.data,t)}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t instanceof Error?t.message:"Unknown error"}. Please check the console for details.`)}finally{n(!1)}},{hasPermission:V,hasAnyPermission:vt,hasAllPermissions:W}=Ut(),Ct=lt();return e.jsxs(Ot,{children:[e.jsx(Dt,{title:"Notice & Evictions"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(Lt,{title:"Notice & Evictions",onExport:_t,onAdd:()=>T(!0),isExporting:D,hasRecords:i.data&&i.data.length>0,canCreate:W(["notice-and-evictions.create","notice-and-evictions.store"])}),e.jsxs(jt,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(wt,{children:e.jsx(kt,{tempFilters:a,cities:c,properties:r,units:m,tenants:l,showCityDropdown:X,showPropertyDropdown:Z,showUnitDropdown:tt,showTenantDropdown:et,setShowCityDropdown:b,setShowPropertyDropdown:E,setShowUnitDropdown:N,setShowTenantDropdown:$,onCityInputChange:rt,onPropertyInputChange:ot,onUnitInputChange:st,onTenantInputChange:ct,onCitySelect:nt,onPropertySelect:it,onUnitSelect:at,onTenantSelect:pt,onSearch:mt,onClear:dt})}),e.jsxs(Pt,{children:[e.jsx(Ht,{records:i.data,hasShowPermission:V("notice-and-evictions.show"),hasEditPermission:W(["notice-and-evictions.edit","notice-and-evictions.update"]),hasDeletePermission:V("notice-and-evictions.destroy"),hasAnyActionPermission:vt(["notice-and-evictions.show","notice-and-evictions.edit","notice-and-evictions.update","notice-and-evictions.destroy"]),onEdit:yt,onDelete:ft,filterQueryString:Ct}),i.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),i.data.length>0&&e.jsx("div",{className:"mt-6 border-t border-border pt-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-between gap-4 md:flex-row",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",v.from," to ",v.to," of ",v.total," records"]}),e.jsx(Rt,{currentPage:v.current_page,lastPage:v.last_page,perPage:_,onPageChange:ut,onPerPageChange:ht})]})})]})]})]})}),e.jsx(At,{open:I,onOpenChange:T,cities:c,properties:r,units:m,tenants:l,notices:y,onSuccess:St,queryParams:A()}),x&&e.jsx(Ft,{record:{...x,date:F(x.date),hearing_dates:F(x.hearing_dates),writ_date:F(x.writ_date)},cities:c,properties:r,units:m,tenants:l,notices:y,open:J,onOpenChange:U,onSuccess:xt,queryParams:A()},x.id),e.jsx(bt,{open:K,onOpenChange:t=>{j(t),t||P(null)},children:e.jsxs(Et,{children:[e.jsxs(Nt,{children:[e.jsx($t,{children:"Delete Record"}),e.jsx(It,{children:"Delete this record? This cannot be undone."})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:w&&e.jsxs("p",{children:["You are deleting record ID ",e.jsx("span",{className:"font-medium text-foreground",children:w.id}),"."]})}),e.jsxs(Tt,{children:[e.jsx(G,{type:"button",variant:"secondary",onClick:()=>{j(!1),P(null)},disabled:O,children:"Cancel"}),e.jsx(G,{type:"button",variant:"destructive",onClick:gt,disabled:O,children:O?"Deletingâ€¦":"Delete"})]})]})})]})};export{An as default};
