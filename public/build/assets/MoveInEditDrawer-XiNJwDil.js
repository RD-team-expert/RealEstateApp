import{r as d,b as ae,j as r}from"./app-IncGAUEB.js";import{B as A}from"./button-BZreYh_c.js";import{D as oe,a as _e,b as se}from"./drawer-BabOL_dj.js";import{I as K}from"./input-BKi6rfRv.js";import U from"./FormSection-DqzeUTFx.js";import de from"./DatePickerField-CfuK0W0s.js";import le from"./CitySelector-CxRSr1nT.js";import fe from"./PropertySelector-ChYcIB4b.js";import me from"./UnitSelector-KVt8fzfV.js";import ce from"./LeaseSigningSection-DcvJon_3.js";import ue from"./MoveInDetailsSection-BULjwFTI.js";import pe from"./PaymentSection-B1B2p09U.js";import he from"./KeysAndFormsSection-DAo8JjN3.js";import ge from"./InsuranceSection-CkThQRF6.js";import"./app-DgqXL21p.js";import"./index-bCzQdt7o.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CfKQ6yNG.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./label-BhALl-XJ.js";import"./calendar-UFpA7cIJ.js";import"./format-PYUiRpxY.js";import"./chevron-left-WEUqp8UO.js";import"./chevron-right-Dv0ELFzT.js";import"./chevron-down-uas8HWR-.js";import"./popover-D0q3r5CP.js";import"./index-DfBxMdWp.js";import"./calendar-CBsjNrh9.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./chevrons-up-down-D4md56fd.js";import"./check-gd2_wZBq.js";import"./RadioGroupField-D7V9skTp.js";import"./radioGroup-BhgCKDH3.js";import"./index-X0Rqfk2m.js";import"./index-DizBXXCV.js";function _t({moveIn:t,units:T,cities:z,properties:v,unitsByProperty:u,open:Y,onOpenChange:F,onSuccess:q,currentFilters:p,currentPerPage:H,currentPage:Q}){const E=d.useRef(null),j=d.useRef(null),N=d.useRef(null),[W,h]=d.useState(""),[G,D]=d.useState(""),[J,C]=d.useState(""),[X,O]=d.useState([]),[Z,k]=d.useState([]),[S,P]=d.useState(""),[b,x]=d.useState(""),[f,R]=d.useState({lease_signing_date:!1,move_in_date:!1,scheduled_paid_time:!1,move_in_form_sent_date:!1,date_of_move_in_form_filled:!1,date_of_insurance_expiration:!1,last_notice_sent:!1}),m=(e,i)=>{R(n=>({...n,[e]:i}))},B=()=>{if(!t.unit_id)return{cityId:"",propertyId:""};const e=T.find(n=>n.id===t.unit_id);if(!e)return{cityId:"",propertyId:""};const i=v.find(n=>n.property_name===e.property_name);return i?{cityId:i.city_id?.toString()||"",propertyId:i.id.toString()}:{cityId:"",propertyId:""}},{cityId:c,propertyId:l}=B(),_=e=>{if(!e)return"";const i=String(e).match(/^(\d{4}-\d{2}-\d{2})/);if(i)return i[1];try{const n=new Date(e);if(!isNaN(n.getTime())){const $=n.getFullYear(),M=String(n.getMonth()+1).padStart(2,"0"),re=String(n.getDate()).padStart(2,"0");return`${$}-${M}-${re}`}}catch{}return""},g=e=>_(e)||null,y=e=>{if(!e)return{first:"",last:""};const i=e.trim();if(!i)return{first:"",last:""};const n=i.indexOf(" ");return n===-1?{first:i,last:""}:{first:i.slice(0,n),last:i.slice(n+1)}},{data:o,setData:a,put:I,processing:V,errors:s}=ae({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:_(t.lease_signing_date),move_in_date:_(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:_(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:_(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:_(t.last_notice_sent)});d.useEffect(()=>{a({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:_(t.lease_signing_date),move_in_date:_(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:_(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:_(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:_(t.last_notice_sent)}),P(c),x(l),w(),R({lease_signing_date:!1,move_in_date:!1,scheduled_paid_time:!1,move_in_form_sent_date:!1,date_of_move_in_form_filled:!1,date_of_insurance_expiration:!1,last_notice_sent:!1})},[t.id]),d.useEffect(()=>{P(c),x(l)},[c,l]),d.useEffect(()=>{if(c){const e=v.filter(i=>i.city_id?.toString()===c);k(e)}l&&u[l]&&O(u[l])},[c,l,v,u]);const w=()=>{h(""),D(""),C("")},ee=e=>{if(P(e),x(""),a("unit_id",""),D(""),C(""),h(""),e){const i=v.filter(n=>n.city_id?.toString()===e);k(i)}else k([]);O([])},te=e=>{x(e),a("unit_id",""),C(""),h(""),e&&u&&u[e]?O(u[e]):O([])},ie=e=>{a("unit_id",parseInt(e)),h("")},L=e=>{e.preventDefault(),h(""),D(""),C("");let i=!1;if((!S||S.trim()==="")&&(D("Please select a city before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),(!b||b.trim()==="")&&(C("Please select a property before submitting the form."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),(!o.unit_id||typeof o.unit_id!="number"||o.unit_id<=0)&&(h("Please select a unit before submitting the form."),E.current&&(E.current.focus(),E.current.scrollIntoView({behavior:"smooth",block:"center"})),i=!0),i)return;const n={};p.city?.trim()&&(n.city=p.city.trim()),p.property?.trim()&&(n.property=p.property.trim()),p.unit?.trim()&&(n.unit=p.unit.trim()),n.perPage=H,n.page=String(Q);const M=`${route("move-in.update",t.id)}?${new URLSearchParams(n).toString()}`;I(M,{preserveState:!0,preserveScroll:!0,onSuccess:()=>{w(),F(!1),q?.()}})},ne=()=>{a({unit_id:t.unit_id??"",signed_lease:t.signed_lease??"No",lease_signing_date:_(t.lease_signing_date),move_in_date:_(t.move_in_date),paid_security_deposit_first_month_rent:t.paid_security_deposit_first_month_rent??"No",scheduled_paid_time:_(t.scheduled_paid_time),handled_keys:t.handled_keys??"No",move_in_form_sent_date:_(t.move_in_form_sent_date),filled_move_in_form:t.filled_move_in_form??"No",date_of_move_in_form_filled:g(t.date_of_move_in_form_filled),submitted_insurance:t.submitted_insurance??"No",date_of_insurance_expiration:g(t.date_of_insurance_expiration),first_name:y(t.tenant_name).first,last_name:y(t.tenant_name).last,last_notice_sent:_(t.last_notice_sent)}),P(c),x(l),w(),F(!1)};return r.jsx(oe,{open:Y,onOpenChange:F,modal:!1,children:r.jsx(_e,{size:"half",title:`Edit Move-In Record #${t.id}`,children:r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"flex-1 overflow-auto p-6",children:r.jsxs("form",{onSubmit:L,className:"space-y-4",children:[r.jsx(le,{cities:z,selectedCityId:S,onCityChange:ee,cityRef:j,error:G||(s.unit_id?"Please select a valid unit.":void 0)}),r.jsx(fe,{properties:Z,selectedPropertyId:b,onPropertyChange:te,propertyRef:N,disabled:!S,selectedCityId:S,error:J}),r.jsx(me,{units:X,selectedUnitId:o.unit_id,onUnitChange:ie,unitRef:E,disabled:!b,selectedPropertyId:b,validationError:W,error:s.unit_id}),r.jsx(ce,{signedLease:o.signed_lease,onSignedLeaseChange:e=>a("signed_lease",e),leaseSigningDate:o.lease_signing_date,onLeaseSigningDateChange:e=>a("lease_signing_date",e),isCalendarOpen:f.lease_signing_date,onCalendarOpenChange:e=>m("lease_signing_date",e),signedLeaseError:s.signed_lease,dateError:s.lease_signing_date}),r.jsx(ue,{moveInDate:o.move_in_date,onMoveInDateChange:e=>a("move_in_date",e),isCalendarOpen:f.move_in_date,onCalendarOpenChange:e=>m("move_in_date",e),error:s.move_in_date}),r.jsx(pe,{paidSecurityDeposit:o.paid_security_deposit_first_month_rent,onPaidSecurityDepositChange:e=>a("paid_security_deposit_first_month_rent",e),scheduledPaidTime:o.scheduled_paid_time,onScheduledPaidTimeChange:e=>a("scheduled_paid_time",e),isCalendarOpen:f.scheduled_paid_time,onCalendarOpenChange:e=>m("scheduled_paid_time",e),paidError:s.paid_security_deposit_first_month_rent,dateError:s.scheduled_paid_time}),r.jsx(he,{handledKeys:o.handled_keys,onHandledKeysChange:e=>a("handled_keys",e),moveInFormSentDate:o.move_in_form_sent_date,onMoveInFormSentDateChange:e=>a("move_in_form_sent_date",e),filledMoveInForm:o.filled_move_in_form,onFilledMoveInFormChange:e=>{a("filled_move_in_form",e),e!=="Yes"&&a("date_of_move_in_form_filled",null)},dateOfMoveInFormFilled:o.date_of_move_in_form_filled??"",onDateOfMoveInFormFilledChange:e=>a("date_of_move_in_form_filled",e),formSentCalendarOpen:f.move_in_form_sent_date,onFormSentCalendarOpenChange:e=>m("move_in_form_sent_date",e),formFilledCalendarOpen:f.date_of_move_in_form_filled,onFormFilledCalendarOpenChange:e=>m("date_of_move_in_form_filled",e),handledKeysError:s.handled_keys,formSentDateError:s.move_in_form_sent_date,filledFormError:s.filled_move_in_form,formFilledDateError:s.date_of_move_in_form_filled}),r.jsx(ge,{submittedInsurance:o.submitted_insurance,onSubmittedInsuranceChange:e=>{a("submitted_insurance",e),e!=="Yes"&&a("date_of_insurance_expiration",null)},dateOfInsuranceExpiration:o.date_of_insurance_expiration??"",onDateOfInsuranceExpirationChange:e=>a("date_of_insurance_expiration",e),isCalendarOpen:f.date_of_insurance_expiration,onCalendarOpenChange:e=>m("date_of_insurance_expiration",e),submittedError:s.submitted_insurance,dateError:s.date_of_insurance_expiration}),r.jsx(U,{label:"First Name",borderColor:"border-l-blue-500",error:s.first_name,children:r.jsx(K,{id:"first_name",name:"first_name",value:o.first_name,onChange:e=>a("first_name",e.target.value),placeholder:"Enter first name"})}),r.jsx(U,{label:"Last Name",borderColor:"border-l-blue-500",error:s.last_name,children:r.jsx(K,{id:"last_name",name:"last_name",value:o.last_name,onChange:e=>a("last_name",e.target.value),placeholder:"Enter last name"})}),r.jsx(U,{label:"Last Notice Sent",borderColor:"border-l-blue-500",error:s.last_notice_sent,children:r.jsx(de,{value:o.last_notice_sent,onChange:e=>a("last_notice_sent",e??""),isOpen:f.last_notice_sent,onOpenChange:e=>m("last_notice_sent",e)})})]})}),r.jsx(se,{children:r.jsxs("div",{className:"flex w-full justify-end gap-2",children:[r.jsx(A,{type:"button",variant:"outline",onClick:ne,children:"Cancel"}),r.jsx(A,{type:"submit",disabled:V,onClick:L,children:V?"Updating...":"Update Move-In Record"})]})})]})})})}export{_t as default};
