import{r as i,u as st,b as ot,a as g,j as e,H as it}from"./app-B8FMPvUf.js";import{B as w}from"./button-DIZZiQM7.js";import{C as at,a as nt,b as pt}from"./card-EXxUjTX3.js";import{u as mt}from"./usePermissions-DDZJFyXm.js";import{A as ct}from"./app-layout-HHYyJByv.js";import lt from"./UnitCreateDrawer-DwD_VJ8K.js";import dt from"./UnitEditDrawer-CDon-U1O.js";import ut from"./Notification-VU8IGhG7.js";import ht from"./ImportStatsCard-DL2-KtuJ.js";import ft from"./ImportModal-DsphxFH8.js";import L from"./FlashMessage-DO-D3VX3.js";import gt from"./UnitsFilter-DrDTDbgK.js";import xt from"./UnitsTable-DxrsHMPK.js";import St from"./Pagination-D5SEWTXj.js";import{useNotification as yt}from"./useNotification-DTlccer_.js";import{f as Ct}from"./format-PYUiRpxY.js";import{D as jt}from"./download-v-3Aavkk.js";import{U as _t}from"./upload-Dv7B4upM.js";import{P as bt}from"./plus-C7KcOOhZ.js";import"./app-BrEbHAEe.js";import"./index-C_zQ9kkn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-fZywndxp.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./drawer-By-qy253.js";import"./CitySelection-CX7C0Rw_.js";import"./label-mSIjHkAE.js";import"./popover-BMQC-RgO.js";import"./command-Byz7UfAg.js";import"./search-CLz9Z_Gu.js";import"./check-BVaiT64F.js";import"./PropertySelection-CbucDM8V.js";import"./UnitDetails--Z7bDNdB.js";import"./input-DGLwPUn8.js";import"./TenantDetails-2pFeSnnR.js";import"./LeaseDates-CrwiROX2.js";import"./calendar-CzDWs5lf.js";import"./chevron-left-nbVEm8OA.js";import"./chevron-down-C7VOkDBv.js";import"./calendar-DesMu7qT.js";import"./UnitSpecifications-CQ_5s-4x.js";import"./LeaseStatus-JHrN67wh.js";import"./radioGroup-CuIQOkQ9.js";import"./index-BlkGWg27.js";import"./FinancialInformation-DrorZFnw.js";import"./UtilityInformation-D0lTlYVN.js";import"./InsuranceInformation-DwAB2RKM.js";import"./NewLease-BSVlgV6D.js";import"./CityPropertySelector-HWBQ3mqk.js";import"./FormSection-Bt6Akdi1.js";import"./UnitDetailsFields-BuWDX90d.js";import"./LeaseInformationFields-B-yKnb99.js";import"./DatePickerField-Dk---8TM.js";import"./FinancialFields-DoVeGFuZ.js";import"./UtilitiesFields-IV1XZztV.js";import"./InsuranceFields-cbwVRfwi.js";import"./CalculatedValuesDisplay-Dqs8D7u4.js";import"./circle-alert-Bo6rghsy.js";import"./circle-x-Ch21MINy.js";import"./circle-check-big-BPeC6Iqd.js";import"./file-spreadsheet-vwIGRRRk.js";import"./loader-circle-72TEuKN6.js";import"./select-CfQzsWP6.js";import"./chevron-up-AmVQJwmd.js";import"./CityAutocomplete-CRuWRjDU.js";import"./PropertyAutocomplete-DZ7x21ds.js";import"./badge-BGMBzjbn.js";import"./table-CzYBox4s.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";const N=(s,c="-")=>{if(!s)return c;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return c;const[,d,u,a]=l,f=new Date(Number(d),Number(u)-1,Number(a));return Ct(f,"P")},Pt=(s,c="units.csv")=>{const d=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),u=new Blob([d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),f=URL.createObjectURL(u);a.setAttribute("href",f),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(f)};function ur({units:s,filters:c,cities:l,properties:d,importStats:u}){const{hasPermission:a,hasAnyPermission:f,hasAllPermissions:r}=mt(),[,E]=i.useState(c),[n,I]=i.useState(c),[x,D]=i.useState(String(s?.per_page??"15")),[U,$]=i.useState(!1),[A,C]=i.useState(!1),[O,T]=i.useState(!!u),[R,v]=i.useState(!1),[V,F]=i.useState(!1),[k,M]=i.useState(null),{flash:y}=st().props,[B,j]=i.useState(n.city||""),[H,_]=i.useState(n.property||""),{notification:b,showNotification:P,hideNotification:z}=yt(),h=ot({file:null,skip_duplicates:!0,update_existing:!1}),S=(t,o)=>{I({...n,[t]:o})},q=t=>{j(t),S("city",t)},G=t=>{j(t),S("city",t)},J=t=>{_(t),S("property",t)},K=t=>{_(t.property_name),S("property",t.property_name)},Q=()=>{E(n);const t={};Object.entries(n).forEach(([o,p])=>{p!=null&&p!==""&&(t[o]=String(p))}),t.per_page=String(x),g.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},W=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:"",is_new_lease:""};I(t),E(t),j(""),_(""),D("15"),g.get(route("units.index"),{per_page:"15"},{preserveState:!0,preserveScroll:!0})},X=t=>{if(confirm("Are you sure you want to delete this unit?")){const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),g.visit(route("units.destroy",t.id),{method:"delete",data:{redirect:{filters:o,per_page:String(x),page:String(s?.current_page??1)}},preserveState:!0,preserveScroll:!0})}},Y=t=>{M(t),F(!0)},Z=()=>{g.reload({only:["units","statistics"]})},tt=()=>{},et=()=>{if(s.data.length===0){alert("No data to export");return}$(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;Pt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{$(!1)}},rt=i.useCallback(t=>{h.setData("file",t),g.post(route("units.import"),{file:t,skip_duplicates:h.data.skip_duplicates,update_existing:h.data.update_existing},{forceFormData:!0,onSuccess:()=>{C(!1),h.reset(),P("success","CSV file imported successfully!")},onError:o=>{const p=o.file||"Failed to import CSV file. Please try again.";P("error",p)},onFinish:()=>{h.clearErrors()}})},[h,P]);return e.jsxs(ct,{children:[e.jsx(it,{title:"Units"}),b&&e.jsx(ut,{type:b.type,message:b.message,onClose:z}),e.jsx(ft,{isOpen:A,onClose:()=>C(!1),onSubmit:rt,isLoading:h.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx(L,{type:"success",message:y?.success}),y?.error&&e.jsx(L,{type:"error",message:y?.error}),O&&u&&e.jsx(ht,{stats:u,onClose:()=>T(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:et,disabled:U||s.data.length===0,className:"flex items-center",children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),U?"Exporting...":"Export CSV"]}),a("units.import")&&e.jsxs(w,{onClick:()=>C(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),f(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>v(!0),children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(at,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(nt,{children:e.jsx(gt,{filters:n,cities:l||[],properties:d||[],cityInput:B,propertyInput:H,onFilterChange:S,onCityInputChange:q,onCitySelect:G,onPropertyInputChange:J,onPropertySelect:K,onSearch:Q,onClear:W})}),e.jsxs(pt,{children:[e.jsx(xt,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:a("units.destroy"),onEdit:Y,onDelete:X}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(St,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,from:s.from,to:s.to,total:s.total,perPage:x,onPerPageChange:t=>{D(t);const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),o.per_page=String(t),g.get(route("units.index"),o,{preserveState:!0,preserveScroll:!0})}})]})]})]})}),e.jsx(lt,{open:R,onOpenChange:v,cities:l||[],properties:d||[],onSuccess:tt,redirectState:{filters:n,per_page:x,page:s?.current_page??1}}),k&&e.jsx(dt,{unit:k,cities:l||[],properties:d||[],open:V,onOpenChange:F,onSuccess:Z,redirectState:{filters:n,per_page:x,page:s?.current_page??1}})]})}export{ur as default};
