import{r as x,j as e,H as U,a as d}from"./app-BSOlzI_M.js";import{C as q,a as z,b as G}from"./card-lrH58jzJ.js";import{u as J}from"./usePermissions-DDr8nGFF.js";import{A as K}from"./app-layout-BU6wzt8Q.js";import M from"./EmptyState-DJMS_V_2.js";import Q from"./FilterBar-DjepRlP2.js";import W from"./PageHeader-VPXv4idF.js";import X from"./PaginationInfo-BJgOCDeU.js";import Y from"./TaskTable-CXhl_j3G.js";import Z from"./VendorTaskTrackerCreateDrawer-CV_WZQ83.js";import ee from"./VendorTaskTrackerEditDrawer-Br2ifXYX.js";import{f as re}from"./format-PYUiRpxY.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./button-D2rKFPK1.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./index-Dc_FVRD7.js";import"./index-CJ72cHre.js";import"./index-C4PIvpnm.js";import"./index-D4B3QgQ6.js";import"./collapsible-BeIaK3gz.js";import"./chevron-right-DU-yjHU5.js";import"./index-p7EaCzMM.js";import"./log-out-CU7fAD8S.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./app-logo-icon-Chz0QK53.js";import"./house-A7z-bt3N.js";import"./building-X8V0cPLX.js";import"./users-BZ-W0K9D.js";import"./wrench-AB0PbR3c.js";import"./credit-card-Dh1t_toN.js";import"./dollar-sign-CX6g00Px.js";import"./file-text-XuiuEW0Z.js";import"./triangle-alert-EDCPZCCy.js";import"./bell-CjUavl-i.js";import"./input-DWv8_Yxn.js";import"./chevron-down--Oeingn_.js";import"./search-BcNZ_u8M.js";import"./download-DpLM-FVr.js";import"./plus-DpdyZws7.js";import"./table-D6Ykx5nO.js";import"./TaskTableRow-1iBoo8BB.js";import"./badge-Bc6JwGPl.js";import"./eye-D6dEBVIw.js";import"./square-pen-BbbP7D49.js";import"./trash-2-CnyQPA5D.js";import"./drawer-B6ZRXvIZ.js";import"./CitySection-Bacv8COX.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./command-CBR154ui.js";import"./check-BE4k6INO.js";import"./PropertySection-k83zv5uh.js";import"./UnitSection-LjvgqcLY.js";import"./VendorSection-lqYpZrbJ.js";import"./TaskSubmissionDateSection-N0mC5YEn.js";import"./calendar-Di5dbzoO.js";import"./chevron-left-CVo-4b8C.js";import"./calendar-CthI5zTo.js";import"./ScheduledVisitsSection-DOTwx0yF.js";import"./TaskEndingDateSection-B831lgYs.js";import"./AssignedTasksSection-CQc3N5rH.js";import"./NotesSection-BPpuvB6v.js";import"./StatusSection-C-BZGT41.js";import"./radioGroup-DqEJ_5sj.js";import"./index-C4dPa-2_.js";import"./UrgencySection-DrO21CFZ.js";import"./CitySelector-Dsa4GP5n.js";import"./FormSection-BFFw8pQD.js";import"./PropertySelector-CAF6D5Rj.js";import"./UnitSelector-m-xYxCNe.js";import"./VendorSelector-DF5zz5Wq.js";import"./DatePickerField-DLuUo63g.js";import"./TextAreaField-kLTtArb8.js";import"./StatusRadioGroup-CQO7V-dH.js";import"./UrgencyRadioGroup-DnqeCIQG.js";const h=(t,r="-")=>{if(!t)return r;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!l)return r;const[,u,g,c]=l,m=new Date(Number(u),Number(g)-1,Number(c));return re(m,"P")},te=(t,r="vendor-tasks.csv")=>{const u=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(a=>[a.id,`"${a.city||""}"`,`"${a.property_name||""}"`,`"${a.unit_name||""}"`,`"${a.vendor_name||""}"`,`"${h(a.task_submission_date,"")}"`,`"${(a.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(a.any_scheduled_visits,"")}"`,`"${h(a.task_ending_date,"")}"`,`"${(a.notes||"").replace(/"/g,'""')}"`,`"${a.status||""}"`,`"${a.urgent}"`].join(","))].join(`
`),g=new Blob([u],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),m=URL.createObjectURL(g);c.setAttribute("href",m),c.setAttribute("download",r),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(m)};function Ar({tasks:t,filters:r,units:l,cities:u,properties:g,vendors:c,drawerCities:m,drawerProperties:a,drawerUnits:f,drawerVendors:j,drawerUnitsByCity:S,drawerPropertiesByCity:k,drawerUnitsByProperty:y,drawerVendorsByCity:_}){const{hasPermission:E,hasAnyPermission:O,hasAllPermissions:C}=J(),[P,N]=x.useState(!1),[$,v]=x.useState(!1),[w,b]=x.useState(!1),[D,T]=x.useState(null),A=()=>{v(!1)},I=()=>{b(!1),T(null)},B=o=>{T(o),b(!0)},V=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([n,i])=>{i!=null&&i!==""&&(p[n]=String(i))}),d.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},L=()=>{if(t.data.length===0){alert("No data to export");return}N(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;te(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{N(!1)}},R=o=>{const p={};Object.entries(o).forEach(([n,i])=>{i!=null&&i!==""&&(p[n]=String(i))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",d.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},F=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",d.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},H={canView:E("vendor-task-tracker.show"),canEdit:C(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:E("vendor-task-tracker.destroy"),hasAnyPermission:O(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(K,{children:[e.jsx(U,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(W,{onExport:L,onAddTask:()=>v(!0),isExporting:P,hasExportData:t.data.length>0,canCreate:C(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(q,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(Q,{filters:r,cities:u,properties:g,units:l,vendors:c,onSearch:R,onClear:F})}),e.jsx(G,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{tasks:t.data,formatDateOnly:h,onEdit:B,onDelete:V,permissions:H,filters:r}),e.jsx(X,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.per_page=p,n.page="1",d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,n={};Object.entries(r).forEach(([i,s])=>{s!=null&&s!==""&&(n[i]=String(s))}),n.page=String(p),d.get(route("vendor-task-tracker.index"),n,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(M,{})})]})]})}),e.jsx(Z,{cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:$,onOpenChange:v,onSuccess:A}),D&&e.jsx(ee,{task:D,cities:m,properties:a,units:f,vendors:j,unitsByCity:S,propertiesByCity:k,unitsByProperty:y,vendorsByCity:_,filters:r,open:w,onOpenChange:b,onSuccess:I})]})}export{Ar as default};
