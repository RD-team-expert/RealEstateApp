import{r as _,j as o,H as k,a as l}from"./app-mUrH0ynJ.js";import{C as U,a as L,b as P}from"./card-D_RIkHPn.js";import{u as A}from"./usePermissions-BawB_cjI.js";import{A as v}from"./app-layout-CXK9X9au.js";import R from"./MoveOutCreateDrawer-AG56AQY8.js";import F from"./MoveOutEditDrawer-DvzyiBbN.js";import I from"./MoveOutEmptyState-CgCDq3eD.js";import T from"./MoveOutFilters-Am8K7yim.js";import H from"./MoveOutPageHeader-6oU7osu8.js";import V from"./MoveOutPagination-TuOkqFj4.js";import B from"./MoveOutTable-D43I1GCV.js";import{f as K}from"./format-PYUiRpxY.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./button-BFBNYzQ-.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./index-Dc_FVRD7.js";import"./index-CXBw7cFo.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./index-I5U3wwZt.js";import"./collapsible-DR70Hr7v.js";import"./chevron-right-o746ehSI.js";import"./index-DK4fbPLM.js";import"./log-out-CXDwqi9T.js";import"./chevrons-up-down-FHN_82j5.js";import"./app-logo-icon-afD3Sqey.js";import"./house-Bx2Ik4FM.js";import"./building-uSWxfBdk.js";import"./users-C2kYwBw2.js";import"./wrench-Cq_dpeQy.js";import"./credit-card-Bcb_2PMm.js";import"./dollar-sign-BB476t67.js";import"./file-text-CjfNfFxM.js";import"./triangle-alert-Dr9RWMLY.js";import"./bell-ch4AgGU_.js";import"./drawer-B7FkQmZP.js";import"./LocationSection-CMBVV_pF.js";import"./FormField-BFaPLpUi.js";import"./label-DmNL2-zA.js";import"./SelectField-BDb_VpVO.js";import"./select-NL-VGbzo.js";import"./index-p6YNWFgp.js";import"./chevron-down-CcniYHCH.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./TextInputField-D0uAoOtH.js";import"./input-Bo52L6_R.js";import"./DateFieldsSection-CsXZSkFe.js";import"./DatePickerField-DnKuhIa2.js";import"./calendar-DAc8iCNl.js";import"./chevron-left-Bx0Sy0a0.js";import"./popover-B07j7TfD.js";import"./calendar-e6qKYHCo.js";import"./PropertyDetailsSection-uo0UofRP.js";import"./TextAreaField-DfXDX515.js";import"./textarea-_9m8vmUo.js";import"./RadioGroupField-DZufQWgb.js";import"./radioGroup-DvkZrWpP.js";import"./StatusFieldsSection-CRUkpkpd.js";import"./LocationSelectionFields-ZeIDyc7R.js";import"./MoveOutDateFields-CYd1NY5m.js";import"./MoveOutDetailsFields-LTYDf2df.js";import"./MoveOutStatusFields-DBU-6WzP.js";import"./search-BHqZNlG5.js";import"./download-tURfbWWG.js";import"./plus-Vhp6TgB7.js";import"./table-DpihfFkM.js";import"./MoveOutTableRow-C5MFDJEq.js";import"./badge-CXaZ35ua.js";import"./eye-sD0tKuKR.js";import"./square-pen-3gz5SX3m.js";import"./trash-2-PUmSVtRb.js";const h=(e,i="-")=>{if(!e)return i;const r=/^(\d{4})-(\d{2})-(\d{2})/.exec(e);if(!r)return i;const[,m,s,p]=r,a=new Date(Number(m),Number(s)-1,Number(p));return K(a,"P")},f=e=>{if(!e)return"";const i=/^(\d{4})-(\d{2})-(\d{2})/.exec(e);if(!i)return"";const[,r,m,s]=i;return`${r}-${m}-${s}`},W=(e,i="move-outs.csv")=>{try{const r=t=>t==null?"":String(t).replace(/"/g,'""'),s=[["ID","City Name","Property Name","Unit Name","Tenants","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Move Out Form","Utility Type"].join(","),...e.map(t=>{try{return[t.id||"",`"${r(t.city_name)}"`,`"${r(t.property_name)}"`,`"${r(t.unit_name)}"`,`"${r(t.tenants)}"`,`"${h(t.move_out_date,"")}"`,`"${r(t.lease_status)}"`,`"${h(t.date_lease_ending_on_buildium,"")}"`,`"${r(t.keys_location)}"`,`"${r(t.utilities_under_our_name)}"`,`"${h(t.date_utility_put_under_our_name,"")}"`,`"${r(t.walkthrough)}"`,`"${r(t.repairs)}"`,`"${r(t.send_back_security_deposit)}"`,`"${r(t.notes)}"`,`"${r(t.cleaning)}"`,`"${r(t.list_the_unit)}"`,`"${r(t.move_out_form)}"`,`"${r(t.utility_type)}"`].join(",")}catch(u){return console.error("Error processing move-out row:",t,u),""}}).filter(t=>t!=="")].join(`
`),p=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(p);return a.setAttribute("href",c),a.setAttribute("download",i),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c),!0}catch(r){throw console.error("CSV Export Error:",r),r}};function yr({moveOuts:e,cities:i,properties:r,propertiesByCityId:m,unitsByPropertyId:s,allUnits:p}){const[a,c]=_.useState(!1),[t,u]=_.useState(!1),[y,x]=_.useState(!1),[d,S]=_.useState(null),{hasPermission:$,hasAnyPermission:j,hasAllPermissions:g}=A(),E=n=>{l.get(route("move-out.index"),n,{preserveState:!0})},b=()=>{l.get(route("move-out.index"),{},{preserveState:!1})},w=n=>{confirm("Are you sure you want to delete this move-out record?")&&l.delete(route("move-out.destroy",n.id))},D=()=>{if(!e||!e.data||e.data.length===0){alert("No data to export");return}c(!0);try{const n=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;W(e.data,n)}catch(n){console.error("Export failed:",n),alert(`Export failed: ${n instanceof Error?n.message:"Unknown error"}`)}finally{c(!1)}},C=()=>{l.reload()},N=()=>{l.reload()},M=n=>{S(n),x(!0)};return o.jsxs(v,{children:[o.jsx(k,{title:"Move-Out Management"}),o.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:o.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[o.jsx(H,{hasCreatePermission:g(["move-out.create","move-out.store"]),isExporting:a,hasData:e?.data&&e.data.length>0,onExport:D,onAddNew:()=>u(!0)}),o.jsxs(U,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(L,{children:o.jsx(T,{cities:i,properties:r,allUnits:p,onSearch:E,onClear:b})}),o.jsx(P,{children:e.data.length>0?o.jsxs(o.Fragment,{children:[o.jsx(B,{moveOuts:e.data,formatDateOnly:h,hasPermission:$,hasAnyPermission:j,hasAllPermissions:g,onEdit:M,onDelete:w}),e.meta&&o.jsx(V,{meta:e.meta})]}):o.jsx(I,{})})]})]})}),o.jsx(R,{cities:i,properties:r,propertiesByCityId:m,unitsByPropertyId:s,allUnits:p,open:t,onOpenChange:u,onSuccess:C}),d&&o.jsx(F,{cities:i,properties:r,propertiesByCityId:m,unitsByPropertyId:s,allUnits:p,moveOut:{...d,move_out_date:f(d.move_out_date),date_lease_ending_on_buildium:f(d.date_lease_ending_on_buildium),date_utility_put_under_our_name:f(d.date_utility_put_under_our_name)},open:y,onOpenChange:x,onSuccess:N},d.id)]})}export{yr as default};
