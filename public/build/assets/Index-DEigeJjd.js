import{r as l,j as r,H as T,a as u}from"./app-IncGAUEB.js";import{C as D,b as H}from"./card-hD-4qfcw.js";import{u as V}from"./usePermissions-BWmUIPam.js";import{A as K}from"./app-layout-DdQ-RLDz.js";import Q from"./MoveInCreateDrawer-BARKCn0F.js";import W from"./MoveInEditDrawer-XiNJwDil.js";import Z from"./PageHeader-Bvq2AAmx.js";import q from"./MoveInFilters-B2dlTlF1.js";import z from"./MoveInTable-bSwr6kMM.js";import B from"./EmptyState-BJPyBpMe.js";import G from"./PaginationInfo-C9leJgxX.js";import"./app-DgqXL21p.js";import"./utils-CBfrqCZ4.js";import"./index-bCzQdt7o.js";import"./index-CdJFUDDL.js";import"./button-BZreYh_c.js";import"./index-CfKQ6yNG.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./index-Dc_FVRD7.js";import"./index-DfV2_jol.js";import"./index-DfBxMdWp.js";import"./index-CoG2tpvC.js";import"./collapsible-CmadTdVI.js";import"./chevron-right-Dv0ELFzT.js";import"./index-X0Rqfk2m.js";import"./log-out-DkEuD3xv.js";import"./chevrons-up-down-D4md56fd.js";import"./app-logo-icon-BCIu8Oaa.js";import"./house-D_snjZK4.js";import"./building-DGN1JdDp.js";import"./users-DR4b9nxK.js";import"./wrench-j2xp49CP.js";import"./credit-card-nxx9uyGn.js";import"./dollar-sign-Do5zHV6l.js";import"./file-text-D45rT7Bs.js";import"./triangle-alert-D4SYorIn.js";import"./bell-c07z0V_k.js";import"./drawer-BabOL_dj.js";import"./CityPropertyUnitSelector-CZlpDCMc.js";import"./label-BhALl-XJ.js";import"./popover-D0q3r5CP.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./check-gd2_wZBq.js";import"./LeaseInformationFields-BKGJKjOe.js";import"./radioGroup-BhgCKDH3.js";import"./index-DizBXXCV.js";import"./DatePickerField-ClweAHvh.js";import"./calendar-UFpA7cIJ.js";import"./format-PYUiRpxY.js";import"./chevron-left-WEUqp8UO.js";import"./chevron-down-uas8HWR-.js";import"./calendar-CBsjNrh9.js";import"./PaymentInformationFields-Cts1x6On.js";import"./KeysAndFormsFields-Dwlbax4v.js";import"./InsuranceInformationFields-DxL1YuSh.js";import"./input-BKi6rfRv.js";import"./FormSection-DqzeUTFx.js";import"./DatePickerField-CfuK0W0s.js";import"./CitySelector-CxRSr1nT.js";import"./PropertySelector-ChYcIB4b.js";import"./UnitSelector-KVt8fzfV.js";import"./LeaseSigningSection-DcvJon_3.js";import"./RadioGroupField-D7V9skTp.js";import"./MoveInDetailsSection-BULjwFTI.js";import"./PaymentSection-B1B2p09U.js";import"./KeysAndFormsSection-DAo8JjN3.js";import"./InsuranceSection-CkThQRF6.js";import"./download-BTdncQqR.js";import"./plus-BVjqVSDl.js";import"./table-DyrYtZnv.js";import"./MoveInTableRow-Ded9dgtN.js";import"./badge-ByZ6dyck.js";import"./square-pen-PIAnrcOq.js";import"./trash-2-DcRRmtsX.js";const J=(o,s="move-ins.csv")=>{try{const n=t=>{if(!t)return"";try{const d=new Date(t);return isNaN(d.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(d)}catch{return t||""}},p=t=>t==null?"":String(t).replace(/"/g,'""'),h=[["ID","City","Property Name","Unit Name","Tenant Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration","Last Notice Sent"].join(","),...o.map(t=>{try{return[t.id||"",`"${p(t.city_name)}"`,`"${p(t.property_name)}"`,`"${p(t.unit_name)}"`,`"${p(t.tenant_name)}"`,`"${p(t.signed_lease)}"`,`"${n(t.lease_signing_date)}"`,`"${n(t.move_in_date)}"`,`"${p(t.paid_security_deposit_first_month_rent)}"`,`"${n(t.scheduled_paid_time)}"`,`"${p(t.handled_keys)}"`,`"${n(t.move_in_form_sent_date)}"`,`"${p(t.filled_move_in_form)}"`,`"${n(t.date_of_move_in_form_filled)}"`,`"${p(t.submitted_insurance)}"`,`"${n(t.date_of_insurance_expiration)}"`,`"${n(t.last_notice_sent)}"`].join(",")}catch(d){return console.error("Error processing move-in row:",t,d),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([h],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),y=URL.createObjectURL(f);return c.setAttribute("href",y),c.setAttribute("download",s),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(y),!0}catch(n){throw console.error("CSV Export Error:",n),n}};function Ee({moveIns:o,filters:s,units:n,cities:p,properties:g,unitsByProperty:h}){const[f,c]=l.useState(!1),[y,t]=l.useState(!1),[d,b]=l.useState(!1),[v,N]=l.useState(null),[a,_]=l.useState({city:s?.city||"",property:s?.property||"",unit:s?.unit||""}),[m,C]=l.useState(s?.perPage||"15"),[S,E]=l.useState(s?.page||1);l.useEffect(()=>{_({city:s?.city||"",property:s?.property||"",unit:s?.unit||""}),C(s?.perPage||"15"),E(s?.page||1)},[s]);const{hasPermission:j,hasAnyPermission:$}=V(),w=i=>{_(i);const e={};i.city?.trim()&&(e.city=i.city.trim()),i.property?.trim()&&(e.property=i.property.trim()),i.unit?.trim()&&(e.unit=i.unit.trim()),e.perPage=m,e.page=1,u.get(route("move-in.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{_({city:"",property:"",unit:""});const e={perPage:m,page:1};u.get(route("move-in.index"),e,{preserveState:!0,preserveScroll:!0})},M=i=>{C(i);const e={};a.city?.trim()&&(e.city=a.city.trim()),a.property?.trim()&&(e.property=a.property.trim()),a.unit?.trim()&&(e.unit=a.unit.trim()),e.perPage=i,e.page=1,u.get(route("move-in.index"),e,{preserveState:!0,preserveScroll:!0})},P=i=>{E(i);const e={};a.city?.trim()&&(e.city=a.city.trim()),a.property?.trim()&&(e.property=a.property.trim()),a.unit?.trim()&&(e.unit=a.unit.trim()),e.perPage=m,e.page=i,u.get(route("move-in.index"),e,{preserveState:!0,preserveScroll:!0})},k=i=>{if(confirm("Are you sure you want to delete this move-in record?")){const e={};a.city?.trim()&&(e.city=a.city.trim()),a.property?.trim()&&(e.property=a.property.trim()),a.unit?.trim()&&(e.unit=a.unit.trim()),e.perPage=m,e.page=String(S);const R=`${route("move-in.destroy",i.id)}?${new URLSearchParams(e).toString()}`;u.delete(R,{preserveState:!0,preserveScroll:!0})}},F=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}c(!0);try{console.log("Exporting move-in data:",o.data);const i=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;J(o.data,i),console.log("Export completed successfully")}catch(i){console.error("Export failed:",i);const e=i instanceof Error?i.message:"Unknown error";alert(`Export failed: ${e}. Please check the console for details.`)}finally{c(!1)}},O=()=>{u.reload()},U=()=>{u.reload()},L=i=>{N(i),b(!0)},x=a.city||a.property||a.unit;return r.jsxs(K,{children:[r.jsx(T,{title:"Move-In Management"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(Z,{hasActiveFilters:!!x,isExporting:f,hasData:o?.data&&o.data.length>0,hasCreatePermission:j("move-in.store"),onExport:F,onCreateClick:()=>t(!0)}),r.jsx(D,{className:"bg-card text-card-foreground shadow-lg mb-6",children:r.jsx(q,{cities:p,properties:g,initialFilters:a,onSearch:w,onClear:A,hasActiveFilters:!!x,units:n})}),r.jsx(D,{className:"bg-card text-card-foreground shadow-lg",children:r.jsxs(H,{children:[r.jsx(z,{moveIns:o.data,canEdit:j("move-in.update"),canDelete:j("move-in.destroy"),showActions:$(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:L,onDelete:k}),r.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm",children:"Rows per page:"}),r.jsxs("select",{className:"border rounded px-2 py-1 bg-background text-foreground",value:m,onChange:i=>M(i.target.value),children:[r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"30",children:"30"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]})]}),r.jsx("div",{className:"flex items-center gap-4",children:m!=="all"&&o?.meta?r.jsxs(r.Fragment,{children:[r.jsxs("span",{className:"text-sm",children:["Page ",o.meta?.current_page??1," of ",o.meta?.last_page??1]}),r.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",disabled:(o.meta?.current_page??1)<=1,onClick:()=>P((o.meta?.current_page??1)-1),children:"Previous"}),r.jsx("button",{className:"px-3 py-1 border rounded disabled:opacity-50",disabled:(o.meta?.current_page??1)>=(o.meta?.last_page??1),onClick:()=>P((o.meta?.current_page??1)+1),children:"Next"})]}):r.jsxs("span",{className:"text-sm",children:["Showing all ",o?.data?.length??0," records"]})})]}),o.data.length===0&&r.jsx(B,{hasActiveFilters:!!x}),o.meta&&r.jsx(G,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})})]})}),r.jsx(Q,{units:n,cities:p,properties:g,unitsByProperty:h,open:y,onOpenChange:t,onSuccess:O,currentFilters:a,currentPerPage:m,currentPage:S}),v&&r.jsx(W,{moveIn:v,units:n,cities:p,properties:g,unitsByProperty:h,open:d,onOpenChange:b,onSuccess:U,currentFilters:a,currentPerPage:m,currentPage:S})]})}export{Ee as default};
