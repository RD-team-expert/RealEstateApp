import{r as a,u as R,b as V,a as u,j as e,H as q}from"./app-mUrH0ynJ.js";import{C as B,a as z,b as G}from"./card-D_RIkHPn.js";import{u as J}from"./usePermissions-BawB_cjI.js";import{A as K}from"./app-layout-CXK9X9au.js";import Q from"./TenantCreateDrawer-qW-uwUjj.js";import W from"./TenantEditDrawer-BGRzfBh8.js";import{FlashMessages as X}from"./FlashMessages-D0Rf8esh.js";import{ImportModal as Y}from"./ImportModal--Brf4q06.js";import{ImportStatsCard as Z}from"./ImportStatsCard-0cjzIP69.js";import{Notification as ee}from"./Notification-CM8i70cL.js";import{TenantFilters as te}from"./TenantFilters-CJJiUxbt.js";import{TenantPageHeader as re}from"./TenantPageHeader-CopL6Kzm.js";import{TenantTable as oe}from"./TenantTable-B9m0Ut3E.js";import{useNotification as se}from"./useNotification-W0nTOUum.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./button-BFBNYzQ-.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./index-Dc_FVRD7.js";import"./index-CXBw7cFo.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./index-I5U3wwZt.js";import"./collapsible-DR70Hr7v.js";import"./chevron-right-o746ehSI.js";import"./index-DK4fbPLM.js";import"./log-out-CXDwqi9T.js";import"./chevrons-up-down-FHN_82j5.js";import"./app-logo-icon-afD3Sqey.js";import"./house-Bx2Ik4FM.js";import"./building-uSWxfBdk.js";import"./users-C2kYwBw2.js";import"./wrench-Cq_dpeQy.js";import"./credit-card-Bcb_2PMm.js";import"./dollar-sign-BB476t67.js";import"./file-text-CjfNfFxM.js";import"./triangle-alert-Dr9RWMLY.js";import"./bell-ch4AgGU_.js";import"./drawer-B7FkQmZP.js";import"./CitySelectionSection-C5T9Yknp.js";import"./label-DmNL2-zA.js";import"./select-NL-VGbzo.js";import"./index-p6YNWFgp.js";import"./chevron-down-CcniYHCH.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./PropertySelectionSection-ia9VBKVf.js";import"./UnitSelectionSection-oKCJHTA9.js";import"./PersonalInformationSection-CmwlEypy.js";import"./FormField-CUMbI5QA.js";import"./input-Bo52L6_R.js";import"./ContactInformationSection-Wf1yYWaA.js";import"./PaymentAndPreferencesSection-GPcThu2c.js";import"./RadioGroupField-DvEudLjy.js";import"./radioGroup-DvkZrWpP.js";import"./AssistanceSection-hR8ckpgB.js";import"./LocationSection-D-2w_DZS.js";import"./PersonalInfoSection-xa1j4RYy.js";import"./ContactInfoSection-CYiGBljt.js";import"./PreferencesSection-BtGe2vae.js";import"./AssistanceSection-DFBZEckq.js";import"./file-spreadsheet-DX_zq0xC.js";import"./upload-DN0aTFGZ.js";import"./loader-circle-BjljqF34.js";import"./circle-check-big-PZXwy0Bk.js";import"./circle-alert-B4oHAxZv.js";import"./circle-x-Cxoqe6fh.js";import"./search-BHqZNlG5.js";import"./rotate-ccw-BWotPKug.js";import"./download-tURfbWWG.js";import"./plus-Vhp6TgB7.js";import"./badge-CXaZ35ua.js";import"./table-DpihfFkM.js";import"./square-pen-3gz5SX3m.js";import"./trash-2-PUmSVtRb.js";const ie=(o,n="tenants.csv")=>{const m=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...o.map(t=>[t.id,`"${t.city_name||""}"`,`"${t.property_name||""}"`,`"${t.unit_number||""}"`,`"${t.first_name||""}"`,`"${t.last_name||""}"`,`"${(t.street_address_line||"").replace(/"/g,'""')}"`,`"${t.login_email||""}"`,`"${t.alternate_email||""}"`,`"${t.mobile||""}"`,`"${t.emergency_phone||""}"`,`"${t.cash_or_check||""}"`,`"${t.has_insurance||""}"`,`"${t.sensitive_communication||""}"`,`"${t.has_assistance||""}"`,`"${t.assistance_amount||""}"`,`"${(t.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),d=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),c=URL.createObjectURL(d);s.setAttribute("href",c),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};function Lt({tenants:o,search:n,cities:l,properties:m,unitsByProperty:d,importStats:s}){const{hasPermission:c,hasAnyPermission:t,hasAllPermissions:g}=J(),[E,y]=a.useState(!1),[N,h]=a.useState(!1),[v,$]=a.useState(!!s),[A,S]=a.useState(!1),[T,j]=a.useState(!1),[b,f]=a.useState(null),{flash:w}=R().props,{notification:x,showNotification:i,hideNotification:D}=se(),p=V({file:null,skip_duplicates:!1}),I=r=>{u.get(route("tenants.index"),{search:r.search,city:r.city,property:r.property,unit_name:r.unitName},{preserveState:!0})},F=()=>{u.get(route("tenants.index"),{},{preserveState:!1,replace:!0})},P=r=>{confirm(`Are you sure you want to archive ${r.first_name} ${r.last_name}? This will hide them from the main list but they can be restored later.`)&&u.patch(route("tenants.archive",r.id),{},{onSuccess:()=>{i("success","Tenant archived successfully!")},onError:()=>{i("error","Failed to archive tenant. Please try again.")}})},k=r=>{f(r),j(!0)},L=()=>{i("success","Tenant updated successfully!"),f(null)},M=()=>{if(o.length===0){alert("No data to export");return}y(!0);try{const r=`tenants-${new Date().toISOString().split("T")[0]}.csv`;ie(o,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},H=a.useCallback((r,C)=>{p.setData({file:r,skip_duplicates:C}),u.post(route("tenants.import.process"),{file:r,skip_duplicates:C},{forceFormData:!0,onSuccess:()=>{h(!1),p.reset(),i("success","CSV file imported successfully!")},onError:_=>{const U=_.file||_.import||"Failed to import CSV file. Please try again.";i("error",U)},onFinish:()=>{p.clearErrors()}})},[p,i]),O=Array.from(new Set(o.map(r=>r.unit_number).filter(Boolean)));return e.jsxs(K,{children:[e.jsx(q,{title:"Tenants"}),x&&e.jsx(ee,{type:x.type,message:x.message,onClose:D}),e.jsx(Y,{isOpen:N,onClose:()=>h(!1),onSubmit:H,isLoading:p.processing}),e.jsx(Q,{open:A,onOpenChange:()=>S(!1),cities:l,properties:m,unitsByProperty:d,onSuccess:()=>i("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(X,{success:w?.success,error:w?.error}),v&&s&&e.jsx(Z,{stats:s,onClose:()=>$(!1)}),e.jsx(re,{onExport:M,onImport:()=>h(!0),onAddNew:()=>S(!0),isExporting:E,hasExportData:o.length>0,canImport:c("tenants.import"),canCreate:g(["tenants.create","tenants.store"])}),e.jsxs(B,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(te,{cities:l,properties:m,uniqueUnitNames:O,onSearch:I,onClear:F,initialFilters:{city:"",property:"",unitName:"",search:n||""}})}),e.jsxs(G,{className:"p-6",children:[e.jsx(oe,{tenants:o,onEdit:k,onDelete:P,canEdit:g(["tenants.edit","tenants.update"]),canDelete:c("tenants.destroy"),showActions:t(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),o.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length," tenant",o.length!==1?"s":"",n&&` matching "${n}"`]})})]})]})]})}),b&&e.jsx(W,{open:T,onOpenChange:()=>{j(!1),f(null)},tenant:b,cities:l,properties:m,unitsByProperty:d,onSuccess:L})]})}export{Lt as default};
