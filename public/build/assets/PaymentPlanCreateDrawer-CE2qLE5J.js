import{r as a,b as ae,j as e}from"./app-nUSYw4ai.js";import{B as T}from"./createLucideIcon-C5GD6QeA.js";import{P as le,a as re,p as $,b as ie,C as oe}from"./popover-CMnBhXYh.js";import{D as ce,a as de,b as me}from"./drawer-ikeMES7v.js";import{I as q}from"./input-OhVo65AQ.js";import{L as o}from"./label-DtPmPEai.js";import{S as v,a as y,b as g,c as N,d as S}from"./select-PjIVfLW0.js";import{T as ue}from"./textarea-CS9Q9qGG.js";import{C as pe}from"./calendar-C-0kt65W.js";import{f as G}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./chevron-right-uK37_yne.js";import"./chevron-up-BHOYq5G1.js";import"./index-nh9QAngE.js";import"./index-CedKduyQ.js";import"./index-5YpAK82Y.js";import"./index-UYkM-lg7.js";import"./index-DbaH1TRh.js";import"./index-DGbRjXgX.js";import"./index-BKS2-tOY.js";import"./index-mn3Hv6wy.js";function Ee({cities:H,propertiesByCityId:V,unitsByPropertyId:_,tenantsByUnitId:R,open:J,onOpenChange:E,onSuccess:K}){const[C,M]=a.useState(null),[P,w]=a.useState(null),[k,p]=a.useState(null),[A,m]=a.useState(null),[Q,F]=a.useState([]),[W,x]=a.useState([]),[U,u]=a.useState([]),[c,l]=a.useState({city:"",property:"",unit:"",tenant:""}),[X,D]=a.useState(!1),h=a.useRef(null),f=a.useRef(null),j=a.useRef(null),b=a.useRef(null),{data:r,setData:d,post:Y,processing:L,errors:i,reset:Z}=ae({tenant_id:null,amount:0,dates:"",paid:0,notes:""}),B=t=>{const s=parseInt(t);M(s),w(null),p(null),m(null),d("tenant_id",null),l(n=>({...n,city:"",property:"",unit:"",tenant:""})),s&&V[s]?F(V[s]):F([]),x([]),u([])},ee=t=>{const s=parseInt(t);w(s),p(null),m(null),d("tenant_id",null),l(n=>({...n,property:"",unit:"",tenant:""})),s&&_[s]?x(_[s]):x([]),u([])},te=t=>{const s=parseInt(t);p(s),m(null),d("tenant_id",null),l(n=>({...n,unit:"",tenant:""})),s&&R[s]?u(R[s]):u([])},se=t=>{const s=parseInt(t),n=U.find(I=>I.id===s);n&&(m(s),d("tenant_id",n.id),l(I=>({...I,tenant:""})))},ne=t=>{t&&(d("dates",G(t,"yyyy-MM-dd")),D(!1))},O=t=>{t.preventDefault(),l({city:"",property:"",unit:"",tenant:""});let s=!1;C||(l(n=>({...n,city:"Please select a city before submitting the form."})),h.current&&(h.current.focus(),h.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),P||(l(n=>({...n,property:"Please select a property before submitting the form."})),f.current&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),k||(l(n=>({...n,unit:"Please select a unit before submitting the form."})),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),(!A||!r.tenant_id)&&(l(n=>({...n,tenant:"Please select a tenant before submitting the form."})),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),!s&&Y(route("payment-plans.store"),{onSuccess:()=>{z(),K?.()}})},z=()=>{Z(),M(null),w(null),p(null),m(null),l({city:"",property:"",unit:"",tenant:""}),F([]),x([]),u([]),D(!1),E(!1)};return e.jsx(ce,{open:J,onOpenChange:E,modal:!1,children:e.jsx(de,{size:"half",title:"Create Payment Plan",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-4 flex items-center gap-2",children:e.jsx(o,{className:"text-base font-semibold",children:"Location & Tenant Selection *"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"city",className:"text-sm font-medium mb-2 block",children:"City *"}),e.jsxs(v,{onValueChange:B,value:C?.toString()||"",children:[e.jsx(y,{ref:h,children:e.jsx(g,{placeholder:"Select city"})}),e.jsx(N,{children:H.map(t=>e.jsx(S,{value:t.id.toString(),children:t.city},t.id))})]}),c.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.city})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"property",className:"text-sm font-medium mb-2 block",children:"Property *"}),e.jsxs(v,{onValueChange:ee,value:P?.toString()||"",disabled:!C,children:[e.jsx(y,{ref:f,children:e.jsx(g,{placeholder:"Select property"})}),e.jsx(N,{children:Q.map(t=>e.jsx(S,{value:t.id.toString(),children:t.property_name},t.id))})]}),c.property&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.property})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"unit",className:"text-sm font-medium mb-2 block",children:"Unit *"}),e.jsxs(v,{onValueChange:te,value:k?.toString()||"",disabled:!P,children:[e.jsx(y,{ref:j,children:e.jsx(g,{placeholder:"Select unit"})}),e.jsx(N,{children:W.map(t=>e.jsx(S,{value:t.id.toString(),children:t.unit_name},t.id))})]}),c.unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.unit})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tenant",className:"text-sm font-medium mb-2 block",children:"Tenant *"}),e.jsxs(v,{onValueChange:se,value:A?.toString()||"",disabled:!k,children:[e.jsx(y,{ref:b,children:e.jsx(g,{placeholder:"Select tenant"})}),e.jsx(N,{children:U.map(t=>e.jsx(S,{value:t.id.toString(),children:t.full_name},t.id))})]}),i.tenant_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.tenant_id}),c.tenant&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.tenant})]})]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx(o,{className:"text-base font-semibold",children:"Payment Plan Details"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{htmlFor:"dates",className:"text-sm font-medium mb-2 block",children:"Date *"}),e.jsxs(le,{open:X,onOpenChange:D,modal:!1,children:[e.jsx(re,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:`w-full justify-start text-left font-normal ${!r.dates&&"text-muted-foreground"}`,children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),r.dates?G($(r.dates,"yyyy-MM-dd",new Date),"PPP"):"Pick a date"]})}),e.jsx(ie,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(oe,{mode:"single",selected:r.dates?$(r.dates,"yyyy-MM-dd",new Date):void 0,onSelect:ne,initialFocus:!0})})]}),i.dates&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.dates})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{htmlFor:"amount",className:"text-sm font-medium mb-2 block",children:"Amount *"}),e.jsx(q,{id:"amount",type:"number",step:"0.01",min:"0",value:r.amount||"",onChange:t=>d("amount",parseFloat(t.target.value)||0),placeholder:"0.00"}),i.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.amount})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{htmlFor:"paid",className:"text-sm font-medium mb-2 block",children:"Paid"}),e.jsx(q,{id:"paid",type:"number",step:"0.01",min:"0",value:r.paid??"",onChange:t=>d("paid",parseFloat(t.target.value)||0),placeholder:"0.00"}),i.paid&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.paid})]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx(ue,{id:"notes",value:r.notes||"",onChange:t=>d("notes",t.target.value),rows:3,placeholder:"Enter any additional notes...",maxLength:1e3}),i.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.notes}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[(r.notes||"").length,"/1000 characters"]})]})]})}),e.jsx(me,{children:e.jsxs("div",{className:"flex justify-end gap-2 w-full",children:[e.jsx(T,{type:"button",variant:"outline",onClick:z,children:"Cancel"}),e.jsx(T,{type:"submit",onClick:O,disabled:L,children:L?"Creating...":"Create Payment Plan"})]})})]})})})}export{Ee as default};
