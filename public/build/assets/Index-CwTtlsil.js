import{r as C,a as L,j as e,H as $,L as y,b as w}from"./app-CAyDEZnj.js";import{u as B,A as H}from"./app-layout-DY74bARH.js";import{B as h}from"./app-logo-icon-CjN8lF6W.js";import{I as _}from"./input-B9ajaorg.js";import{C as l,c,a as R,b as z}from"./card-C0B-VCo5.js";import{P as F,T as M,a as U,b as E,c as n,d as O,e as o,f as V}from"./table-vqUsJnJJ.js";import{B as f}from"./badge-DMHCbH1W.js";import{D as q}from"./download-CaQXFYds.js";import{E as G}from"./eye-mISP0EBM.js";import{S as J}from"./square-pen-CUGzDP7i.js";import"./app-DSIzZYCB.js";import"./index-DsYzNQ6z.js";import"./index-3TL2J1ZM.js";const K=(D,s="properties.csv")=>{const x=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],b=r=>{const j=new Date,i=new Date(r).getTime()-j.getTime();return Math.ceil(i/(1e3*60*60*24))},g=[x.join(","),...D.map(r=>[r.id,`"${r.property_name}"`,`"${r.insurance_company_name}"`,`"${r.formatted_amount}"`,`"${r.effective_date}"`,`"${r.policy_number}"`,`"${r.expiration_date}"`,b(r.expiration_date),`"${r.status}"`].join(","))].join(`
`),p=new Blob([g],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),d=URL.createObjectURL(p);a.setAttribute("href",d),a.setAttribute("download",s),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(d)};function le({auth:D,properties:s,statistics:x,filters:b}){const{hasPermission:g,hasAnyPermission:p,hasAllPermissions:a}=B(),[d,r]=C.useState(b),[j,N]=C.useState(!1),{flash:i}=L().props,m=(t,u)=>{const v={...d,[t]:u};r(v),w.get(route("properties-info.index"),v,{preserveState:!0,preserveScroll:!0})},T=t=>{confirm("Are you sure you want to delete this property?")&&w.delete(route("properties-info.destroy",t.id))},P=()=>{if(s.data.length===0){alert("No data to export");return}N(!0);try{const t=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;K(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{N(!1)}},k=t=>t.status==="Expired"?e.jsx(f,{variant:"destructive",children:"Expired"}):e.jsx(f,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"Active"}),S=t=>t<0?e.jsxs(f,{variant:"destructive",children:[Math.abs(t)," days overdue"]}):t<=30?e.jsxs(f,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[t," days left"]}):e.jsxs(f,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[t," days left"]}),A=t=>{const u=new Date,I=new Date(t).getTime()-u.getTime();return Math.ceil(I/(1e3*60*60*24))};return e.jsxs(H,{children:[e.jsx($,{title:"Properties Insurance"}),e.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[i?.success&&e.jsx(l,{className:"mb-4 border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800",children:e.jsx(c,{className:"p-4",children:e.jsx("div",{className:"text-green-700 dark:text-green-300",children:i.success})})}),i?.error&&e.jsx(l,{className:"mb-4 border-red-200 bg-red-50 dark:bg-red-950 dark:border-red-800",children:e.jsx(c,{className:"p-4",children:e.jsx("div",{className:"text-red-700 dark:text-red-300",children:i.error})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(l,{className:"bg-card text-card-foreground",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:x.total})]})}),e.jsx(l,{className:"bg-card text-card-foreground",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:x.active})]})}),e.jsx(l,{className:"bg-card text-card-foreground",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Expired"}),e.jsx("p",{className:"text-3xl font-bold text-destructive",children:x.expired})]})})]}),e.jsxs(l,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsxs(R,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{className:"text-2xl",children:"Property Insurance List"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:P,disabled:j||s.data.length===0,className:"flex items-center",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),j?"Exporting...":"Export CSV"]}),a(["properties.create","properties.store"])&&e.jsx(y,{href:route("properties-info.create"),children:e.jsxs(h,{children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Add Property"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4",children:[e.jsx(_,{type:"text",placeholder:"Property Name",value:d.property_name||"",onChange:t=>m("property_name",t.target.value),className:"bg-input text-input-foreground"}),e.jsx(_,{type:"text",placeholder:"Insurance Company",value:d.insurance_company_name||"",onChange:t=>m("insurance_company_name",t.target.value),className:"bg-input text-input-foreground"}),e.jsx(_,{type:"text",placeholder:"Policy Number",value:d.policy_number||"",onChange:t=>m("policy_number",t.target.value),className:"bg-input text-input-foreground"}),e.jsxs("select",{value:d.status||"",onChange:t=>m("status",t.target.value),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Expired",children:"Expired"})]})]})]}),e.jsxs(c,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(M,{children:[e.jsx(U,{children:e.jsxs(E,{className:"border-border",children:[e.jsx(n,{className:"text-muted-foreground",children:"Property Name"}),e.jsx(n,{className:"text-muted-foreground",children:"Insurance Company"}),e.jsx(n,{className:"text-muted-foreground",children:"Amount"}),e.jsx(n,{className:"text-muted-foreground",children:"Effective Date"}),e.jsx(n,{className:"text-muted-foreground",children:"Policy Number"}),e.jsx(n,{className:"text-muted-foreground",children:"Expiration Date"}),e.jsx(n,{className:"text-muted-foreground",children:"Days Left"}),e.jsx(n,{className:"text-muted-foreground",children:"Status"}),p(["properties.destroy","properties.update","properties.edit","properties.show"])&&e.jsx(n,{className:"text-muted-foreground",children:"Actions"})]})}),e.jsx(O,{children:s.data.map(t=>e.jsxs(E,{className:"hover:bg-muted/50 border-border",children:[e.jsx(o,{className:"font-medium text-foreground",children:t.property_name}),e.jsx(o,{className:"text-foreground",children:t.insurance_company_name}),e.jsx(o,{className:"text-foreground",children:t.formatted_amount}),e.jsx(o,{className:"text-foreground",children:t.effective_date}),e.jsx(o,{className:"text-foreground",children:t.policy_number}),e.jsx(o,{className:"text-foreground",children:t.expiration_date}),e.jsx(o,{children:S(A(t.expiration_date))}),e.jsx(o,{children:k(t)}),p(["properties.destroy","properties.update","properties.edit","properties.show"])&&e.jsx(o,{children:e.jsxs("div",{className:"flex gap-1",children:[g("properties.show")&&e.jsx(y,{href:route("properties-info.show",t.id),children:e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(G,{className:"h-4 w-4"})})}),a(["properties.update","properties.edit"])&&e.jsx(y,{href:route("properties-info.edit",t.id),children:e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(J,{className:"h-4 w-4"})})}),g("properties.destroy")&&e.jsx(h,{variant:"outline",size:"sm",onClick:()=>T(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(V,{className:"h-4 w-4"})})]})})]},t.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No properties found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.last_page>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("nav",{className:"flex space-x-2",children:s.links.map((t,u)=>e.jsx("button",{onClick:()=>t.url&&w.get(t.url),disabled:!t.url,className:`px-3 py-2 text-sm rounded transition-colors ${t.active?"bg-primary text-primary-foreground":t.url?"bg-secondary text-secondary-foreground hover:bg-secondary/80":"bg-muted text-muted-foreground cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:t.label}},u))})}),s.meta&&e.jsx("div",{className:"mt-6 flex justify-between items-center border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})]})})]})}export{le as default};
