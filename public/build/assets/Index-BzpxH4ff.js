import{r as a,u as ie,j as e,H as me,L as ue,a as b}from"./app-CHDKARjb.js";import{B as H}from"./badge-eUHoACpP.js";import{B as p}from"./button-DVMLQ4Cf.js";import{C as pe,a as xe,b as he}from"./card-C7nNTwWV.js";import{I as C}from"./input-CESuFFYh.js";import{T as fe,a as be,b as V,c as d,d as ge,e as l}from"./table-OH-MIgN2.js";import{u as je,A as Ne}from"./app-layout-Cz-niD8H.js";import ve from"./ApplicationCreateDrawer-PGMwocxf.js";import ye from"./ApplicationEditDrawer-ED80Xunf.js";import{D as we}from"./download-BkR6JC2L.js";import{P as Ce}from"./plus-C_kG8f__.js";import{C as L}from"./chevron-down-qX4-vl1q.js";import{S as Se}from"./search-m1-QTzWz.js";import{X as De}from"./x-DzxxLS5y.js";import{E as Ee}from"./eye-BmtEEgNg.js";import{S as ke}from"./square-pen-FIXyxp3A.js";import{T as Ae}from"./trash-2-BG_L6yri.js";import{f as Pe}from"./format-PYUiRpxY.js";import"./app-BmbQfT0_.js";import"./index-DzrNkgKa.js";import"./utils-CBfrqCZ4.js";import"./index-DH5c0sFq.js";import"./index-Dc_FVRD7.js";import"./index-BMM8wKPv.js";import"./index-DhGOy-yS.js";import"./index-Bc-3DsyS.js";import"./index-DzT3tnb6.js";import"./index-q1apwmMP.js";import"./index-0tk3grE1.js";import"./index-DfGTd3cq.js";import"./index-DUM9UyY6.js";import"./index-CwBu8RV2.js";import"./index-qPHptkmt.js";import"./createLucideIcon-C7c1hvIj.js";import"./collapsible-CBxE2yZh.js";import"./chevron-right-CzDW8WF4.js";import"./index-DiN52TcP.js";import"./log-out-Ckm4m212.js";import"./app-logo-icon--P_-c3yX.js";import"./house-R0vSJ-MQ.js";import"./building-mIkOh_fr.js";import"./users-BelIezuD.js";import"./wrench-CSdkG0qX.js";import"./credit-card-3sFCGHNT.js";import"./dollar-sign-C6zNmobC.js";import"./file-text-Ia3zVVV6.js";import"./triangle-alert-DtVQmrkD.js";import"./bell-DGEfdnEl.js";import"./popover-CqkGk1d9.js";import"./drawer-DBQSSrTa.js";import"./label-DcQ_-sMZ.js";import"./radioGroup-DeMlaPSu.js";import"./index-vBQwvlXi.js";import"./select-DSkJK3rS.js";import"./check-Ck6Rqaxz.js";import"./chevron-up-DiltP7zF.js";import"./calendar-DnRZTeuR.js";const q=(n,m="-")=>{if(!n)return m;const s=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!s)return m;const[,x,g,h]=s,c=new Date(Number(x),Number(g)-1,Number(h));return Pe(c,"P")},Re=(n,m="applications.csv")=>{try{const s=t=>t==null?"":String(t).replace(/"/g,'""'),g=[["ID","City","Property","Unit","Name","Co-signer","Status","Date","Stage in Progress","Notes","Attachment Name"].join(","),...n.map(t=>{try{return[t.id||"",`"${s(t.city)}"`,`"${s(t.property)}"`,`"${s(t.unit_name)}"`,`"${s(t.name)}"`,`"${s(t.co_signer)}"`,`"${s(t.status)}"`,`"${q(t.date,"")}"`,`"${s(t.stage_in_progress)}"`,`"${s(t.notes)}"`,`"${s(t.attachment_name)}"`].join(",")}catch(j){return console.error("Error processing application row:",t,j),""}}).filter(t=>t!=="")].join(`
`),h=new Blob([g],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),f=URL.createObjectURL(h);return c.setAttribute("href",f),c.setAttribute("download",m),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(f),!0}catch(s){throw console.error("CSV Export Error:",s),s}};function $r({applications:n,cities:m,properties:s,units:x}){const[g,h]=a.useState(!1),[c,f]=a.useState(!1),[t,j]=a.useState(null),[_,I]=a.useState(!1),{flash:N}=ie().props,{hasPermission:T,hasAnyPermission:S,hasAllPermissions:M}=je(),[i,U]=a.useState({city:"",property:"",unit:"",name:""}),[$,z]=a.useState({city:"",property:"",unit:"",name:""}),[X,v]=a.useState(!1),[G,y]=a.useState(!1),[J,w]=a.useState(!1),D=a.useRef(null),E=a.useRef(null),k=a.useRef(null),A=a.useRef(null),P=a.useRef(null),R=a.useRef(null);a.useEffect(()=>{const r=o=>{D.current&&!D.current.contains(o.target)&&A.current&&!A.current.contains(o.target)&&v(!1),E.current&&!E.current.contains(o.target)&&P.current&&!P.current.contains(o.target)&&y(!1),k.current&&!k.current.contains(o.target)&&R.current&&!R.current.contains(o.target)&&w(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const u=(r,o)=>{U(ce=>({...ce,[r]:o}))},K=r=>{u("city",r.name),v(!1)},Q=r=>{const o=r.target.value;u("city",o),v(o.length>0)},W=r=>{u("property",r.name),y(!1)},Y=r=>{const o=r.target.value;u("property",o),y(o.length>0)},Z=r=>{u("unit",r.name),w(!1)},ee=r=>{const o=r.target.value;u("unit",o),w(o.length>0)},re=()=>{z(i),b.get(route("applications.index"),i,{preserveState:!0,preserveScroll:!0})},te=r=>{confirm("Are you sure you want to delete this application?")&&b.delete(route("applications.destroy",r.id))},se=()=>{if(!n||!n.data||n.data.length===0){alert("No data to export");return}I(!0);try{const r=`applications-${new Date().toISOString().split("T")[0]}.csv`;Re(n.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}`)}finally{I(!1)}},oe=r=>r?e.jsx(H,{variant:"default",children:r}):e.jsx(H,{variant:"outline",children:"No Status"}),ae=()=>{b.get(route("applications.index"),$,{preserveState:!0,preserveScroll:!0})},ne=()=>{const r={city:"",property:"",unit:"",name:""};U(r),z(r),b.get(route("applications.index"),{},{preserveState:!1})},de=()=>{b.get(route("applications.index"),$,{preserveState:!0,preserveScroll:!0}),f(!1),j(null)},le=r=>{j(r),f(!0)},O=m.filter(r=>r.name.toLowerCase().includes(i.city.toLowerCase())),F=Object.values(s).flat().filter(r=>r.name.toLowerCase().includes(i.property.toLowerCase())),B=Object.values(x).flat().filter(r=>r.name.toLowerCase().includes(i.unit.toLowerCase()));return e.jsxs(Ne,{children:[e.jsx(me,{title:"Applications"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[N?.success&&e.jsx("div",{className:"mb-4 rounded border border-chart-1 bg-chart-1/20 px-4 py-3 text-chart-1",children:N?.success}),N?.error&&e.jsx("div",{className:"mb-4 rounded border border-destructive bg-destructive/20 px-4 py-3 text-destructive",children:N?.error}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Applications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:se,disabled:_||!n?.data||n.data.length===0,className:"flex items-center",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),_?"Exporting...":"Export CSV"]}),M(["applications.create","applications.store"])&&e.jsxs(p,{onClick:()=>h(!0),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Add Application"]})]})]}),e.jsxs(pe,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:A,type:"text",placeholder:"City",value:i.city,onChange:Q,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),X&&O.length>0&&e.jsx("div",{ref:D,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:O.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>K(r),children:r.name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:P,type:"text",placeholder:"Property",value:i.property,onChange:Y,onFocus:()=>y(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),G&&F.length>0&&e.jsx("div",{ref:E,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:F.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>W(r),children:r.name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:R,type:"text",placeholder:"Unit",value:i.unit,onChange:ee,onFocus:()=>w(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),J&&B.length>0&&e.jsx("div",{ref:k,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:B.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>Z(r),children:r.name},r.id))})]}),e.jsx(C,{type:"text",placeholder:"Application Name",value:i.name,onChange:r=>u("name",r.target.value),className:"text-input-foreground bg-input"}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:re,variant:"default",className:"flex items-center",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(p,{onClick:ne,variant:"outline",className:"flex items-center",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(he,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(fe,{className:"border-collapse rounded-md border border-border",children:[e.jsx(be,{children:e.jsxs(V,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Co-signer"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Stage"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Note"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Attachment"}),S(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(ge,{children:n.data.map(r=>e.jsxs(V,{className:"border-border hover:bg-muted/50",children:[e.jsx(l,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city}),e.jsx(l,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property}),e.jsx(l,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.unit_name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.co_signer}),e.jsx(l,{className:"border border-border text-center",children:oe(r.status)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:q(r.date)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.stage_in_progress||"N/A"}),e.jsx(l,{className:"border border-border text-center",children:r.notes?e.jsx("div",{className:"max-w-24 truncate",title:r.notes,children:r.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:r.attachment_name?e.jsx("a",{href:`/applications/${r.id}/download`,className:"text-sm text-primary hover:underline",children:r.attachment_name}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No attachment"})}),S(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[T("applications.show")&&e.jsx(ue,{href:route("applications.show",r.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(Ee,{className:"h-4 w-4"})})}),S(["applications.edit","applications.update"])&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>le(r),children:e.jsx(ke,{className:"h-4 w-4"})}),T("applications.destroy")&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]},r.id))})]})}),n.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No applications found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),n.last_page>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("nav",{className:"flex space-x-2",children:n.links.map((r,o)=>e.jsx("button",{onClick:()=>r.url&&b.get(r.url),disabled:!r.url,className:`rounded px-3 py-2 text-sm ${r.active?"bg-primary text-primary-foreground":r.url?"bg-muted text-foreground hover:bg-accent":"cursor-not-allowed bg-muted text-muted-foreground"}`,dangerouslySetInnerHTML:{__html:r.label}},o))})})]})]})]})}),e.jsx(ve,{cities:m,properties:s,units:x,open:g,onOpenChange:h,onSuccess:ae}),t&&e.jsx(ye,{application:t,cities:m,properties:s,units:x,open:c,onOpenChange:f,onSuccess:de})]})}export{$r as default};
