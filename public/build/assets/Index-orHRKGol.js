import{r as p,u as z,j as o,H as G,a as _}from"./app-B8FMPvUf.js";import{C as J,a as K,b as Q}from"./card-EXxUjTX3.js";import{u as W}from"./usePermissions-DDZJFyXm.js";import{A as X}from"./app-layout-HHYyJByv.js";import Y from"./ApplicationCreateDrawer-Dd9YREMZ.js";import Z from"./ApplicationEditDrawer-CVqt9tMN.js";import tt from"./ApplicationsTable-mZtdw-2P.js";import rt from"./EmptyState-CxwboeDv.js";import et from"./FilterBar-uAZeIuby.js";import ot from"./FlashMessages-DVnXzyWp.js";import it from"./PageHeader-DmvjmTsF.js";import st from"./Pagination-TnKE5nL9.js";import"./app-BrEbHAEe.js";import"./utils-CBfrqCZ4.js";import"./index-C_zQ9kkn.js";import"./index-CdJFUDDL.js";import"./button-DIZZiQM7.js";import"./index-fZywndxp.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./drawer-By-qy253.js";import"./CityPropertyUnitSelector-DMtc4Ym7.js";import"./label-mSIjHkAE.js";import"./popover-BMQC-RgO.js";import"./command-Byz7UfAg.js";import"./search-CLz9Z_Gu.js";import"./check-BVaiT64F.js";import"./ApplicantInformationSection-C2wRm5wW.js";import"./input-DGLwPUn8.js";import"./select-CfQzsWP6.js";import"./index-BlkGWg27.js";import"./chevron-down-C7VOkDBv.js";import"./chevron-up-AmVQJwmd.js";import"./application-CnwOiERd.js";import"./StatusAndDateSection-CJB1teLG.js";import"./calendar-CzDWs5lf.js";import"./format-PYUiRpxY.js";import"./chevron-left-nbVEm8OA.js";import"./radioGroup-CuIQOkQ9.js";import"./calendar-DesMu7qT.js";import"./AdditionalDetailsSection-CH0qhsXv.js";import"./ApplicantInformationFields-tKEB5jht.js";import"./AttachmentField-7wwLvMww.js";import"./rotate-ccw-xl-uYsB0.js";import"./CityPropertyUnitSelector-C2whnvua.js";import"./CurrentSelectionDisplay-CCeiAE-F.js";import"./StageAndNotesFields-bPwk7Tm7.js";import"./StatusAndDateFields-fwb9vj-f.js";import"./table-CzYBox4s.js";import"./ApplicationsTableRow-DUwbQoB4.js";import"./badge-BGMBzjbn.js";import"./eye-DzrUIE3a.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";import"./download-v-3Aavkk.js";import"./plus-C7KcOOhZ.js";import"./pagination-yroiR-i4.js";const at=(e,m="applications.csv")=>{try{const i=t=>t==null?"":String(t).replace(/"/g,'""'),u=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),g=t=>!t||t.length===0?"":t.map(n=>n.name).join("; "),f=[["ID","City","Property","Unit","Name","Co-signer","Status","Applicant Applied From","Date","Stage in Progress","Notes","Attachments Count","Attachment Names"].join(","),...e.map(t=>{try{return[t.id||"",`"${i(t.city)}"`,`"${i(t.property)}"`,`"${i(t.unit_name)}"`,`"${i(t.name)}"`,`"${i(t.co_signer)}"`,`"${i(t.status)}"`,`"${i(t.applicant_applied_from)}"`,`"${u(t.date)}"`,`"${i(t.stage_in_progress)}"`,`"${i(t.notes)}"`,t.attachments?.length||0,`"${g(t.attachments)}"`].join(",")}catch(n){return console.error("Error processing application row:",t,n),""}}).filter(t=>t!=="")].join(`
`),h=new Blob([f],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(h);return a.setAttribute("href",c),a.setAttribute("download",m),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c),!0}catch(i){throw console.error("CSV Export Error:",i),i}};function Nr({applications:e,filters:m,cities:i,properties:u,units:g,filterCities:y,filterProperties:f,filterUnits:h}){const[a,c]=p.useState(!1),[t,n]=p.useState(!1),[S,E]=p.useState(null),[b,j]=p.useState(!1),{flash:w}=z().props,{hasPermission:A,hasAnyPermission:C,hasAllPermissions:F}=W(),[s,x]=p.useState({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),P=m?.per_page?String(m.per_page):String(e?.per_page??15),[l,D]=p.useState(P===String(e?.total??"")?"all":P);p.useEffect(()=>{const r=m||{};x({city:r.city||"",property:r.property||"",unit:r.unit||"",name:r.name||"",applicant_applied_from:r.applicant_applied_from||""})},[m]);const $=r=>{x(r),_.get(route("applications.index"),{...r,per_page:l,page:1},{preserveState:!0,preserveScroll:!0})},v=()=>{x({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),D("15"),_.get(route("applications.index"),{per_page:"15",page:1},{preserveState:!1})},O=r=>{confirm("Are you sure you want to delete this application?")&&_.delete(route("applications.destroy",r.id),{data:{filter_city:s.city||"",filter_property:s.property||"",filter_unit:s.unit||"",filter_name:s.name||"",filter_applicant_applied_from:s.applicant_applied_from||"",per_page:l,page:e.current_page},preserveState:!0,preserveScroll:!0})},k=()=>{if(!e||!e.data||e.data.length===0){alert("No data to export");return}j(!0);try{const r=`applications-${new Date().toISOString().split("T")[0]}.csv`;at(e.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}`)}finally{j(!1)}},N=()=>{c(!1)},I=()=>{n(!1),E(null)},U=r=>{E(r),n(!0)},L=(y||[]).map((r,d)=>({id:d+1,name:r})),R={0:(f||[]).map((r,d)=>({id:d+1,name:r,city_id:0}))},H={0:(h||[]).map((r,d)=>({id:d+1,name:r,property_id:0}))},V=F(["applications.create","applications.store"]),T=A("applications.show"),B=C(["applications.edit","applications.update"]),M=A("applications.destroy"),q=C(["applications.show","applications.edit","applications.update","applications.destroy"]);return o.jsxs(X,{children:[o.jsx(G,{title:"Applications"}),o.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:o.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[o.jsx(ot,{success:w?.success,error:w?.error}),o.jsx(it,{onExport:k,onAddNew:()=>c(!0),isExporting:b,hasExportData:!!(e?.data&&e.data.length>0),hasCreatePermission:V}),o.jsxs(J,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(K,{children:o.jsx(et,{cities:L,properties:R,units:H,initialFilters:s,onSearch:$,onClear:v})}),o.jsx(Q,{children:e.data.length>0?o.jsxs(o.Fragment,{children:[o.jsx(tt,{applications:e.data,onEdit:U,onDelete:O,hasViewPermission:T,hasEditPermission:B,hasDeletePermission:M,hasAnyActionPermission:q,filters:s}),o.jsx(st,{links:e.links,meta:{current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to},filters:s,perPage:l,onPerPageChange:D})]}):o.jsx(rt,{})})]})]})}),o.jsx(Y,{cities:i,properties:u,units:g,open:a,onOpenChange:c,onSuccess:N,currentFilters:s,perPage:l,page:e.current_page}),S&&o.jsx(Z,{application:S,cities:i,properties:u,units:g,open:t,onOpenChange:n,onSuccess:I,currentFilters:s,perPage:l,page:e.current_page})]})}export{Nr as default};
