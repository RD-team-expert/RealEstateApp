import{r as x,j as e,H as L,a as g}from"./app-XlMZG7vD.js";import{C as R,a as F,b as H}from"./card-BeQJ7hrb.js";import{u as q}from"./usePermissions-C5sl0_76.js";import{A as z}from"./app-layout-CGrAe6KQ.js";import G from"./EmptyState-BL_FaqRv.js";import J from"./FilterBar-DOFRQe6t.js";import K from"./PageHeader-DzFnxSWV.js";import M from"./PaginationInfo-BtS0sWBn.js";import Q from"./TaskTable-C4HK3jHf.js";import W from"./VendorTaskTrackerCreateDrawer-COiytXl7.js";import X from"./VendorTaskTrackerEditDrawer-Bts1e1M4.js";import{f as Y}from"./format-PYUiRpxY.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./button-D56PIbu9.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./input-nhBJFe9F.js";import"./chevron-down-Dqt3V4Kg.js";import"./search-BKBHV1D6.js";import"./download-AfMUchev.js";import"./plus-Brzm8xdb.js";import"./table-Dsn5Ek_l.js";import"./TaskTableRow-D0H8oWkn.js";import"./badge-amDNRRn_.js";import"./eye-L6iv3Y43.js";import"./square-pen-DJiq7j_0.js";import"./trash-2-CisDGbUX.js";import"./drawer-B7-2XtV2.js";import"./CitySection-DvkpcWTi.js";import"./label-BKN3erGN.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./check-ZO7ekD6P.js";import"./PropertySection-CIr2eiWd.js";import"./UnitSection-B4h3OUK0.js";import"./VendorSection-C1KHIaoc.js";import"./TaskSubmissionDateSection-DP6O75L8.js";import"./calendar-D02iCkay.js";import"./chevron-left-DiIjHAK0.js";import"./calendar-CGMbx-hL.js";import"./ScheduledVisitsSection-DV78avJE.js";import"./TaskEndingDateSection-BYv6FSlu.js";import"./AssignedTasksSection-BEOJa6r9.js";import"./NotesSection-uQyqvzic.js";import"./StatusSection-DFnpFykV.js";import"./radioGroup-DrlpglLG.js";import"./index-DdpYxxi8.js";import"./UrgencySection-DRqzk66X.js";import"./CitySelector-Dx-wBkUj.js";import"./FormSection-BMkTEQQv.js";import"./PropertySelector-D5WjCbmy.js";import"./UnitSelector-Cf8V0fTl.js";import"./VendorSelector-BZQleqfb.js";import"./DatePickerField-DKCRptxS.js";import"./TextAreaField-CsIbTfUt.js";import"./StatusRadioGroup-DDGnMbV-.js";import"./UrgencyRadioGroup-BUa6bXIm.js";const h=(t,r="-")=>{if(!t)return r;const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!c)return r;const[,d,l,m]=c,u=new Date(Number(d),Number(l)-1,Number(m));return Y(u,"P")},Z=(t,r="vendor-tasks.csv")=>{const d=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(n=>[n.id,`"${n.city||""}"`,`"${n.property_name||""}"`,`"${n.unit_name||""}"`,`"${n.vendor_name||""}"`,`"${h(n.task_submission_date,"")}"`,`"${(n.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(n.any_scheduled_visits,"")}"`,`"${h(n.task_ending_date,"")}"`,`"${(n.notes||"").replace(/"/g,'""')}"`,`"${n.status||""}"`,`"${n.urgent}"`].join(","))].join(`
`),l=new Blob([d],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),u=URL.createObjectURL(l);m.setAttribute("href",u),m.setAttribute("download",r),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)};function Tr({tasks:t,filters:r,units:c,cities:d,properties:l,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,vendors:b}){const{hasPermission:v,hasAnyPermission:y,hasAllPermissions:k}=q(),[w,_]=x.useState(!1),[D,f]=x.useState(!1),[C,j]=x.useState(!1),[E,N]=x.useState(null),T=()=>{f(!1)},O=()=>{j(!1),N(null)},P=o=>{N(o),j(!0)},$=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),g.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},A=()=>{if(t.data.length===0){alert("No data to export");return}_(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Z(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{_(!1)}},V=o=>{const p={};Object.entries(o).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",g.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},I=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",g.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},U={canView:v("vendor-task-tracker.show"),canEdit:k(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:v("vendor-task-tracker.destroy"),hasAnyPermission:y(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(z,{children:[e.jsx(L,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(K,{onExport:A,onAddTask:()=>f(!0),isExporting:w,hasExportData:t.data.length>0,canCreate:k(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(R,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(F,{children:e.jsx(J,{filters:r,cities:d,properties:l,units:c,vendors:b,onSearch:V,onClear:I})}),e.jsx(H,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Q,{tasks:t.data,formatDateOnly:h,onEdit:P,onDelete:$,permissions:U,filters:r}),e.jsx(M,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.per_page=p,a.page="1",g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(G,{})})]})]})}),e.jsx(W,{cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:D,onOpenChange:f,onSuccess:T}),E&&e.jsx(X,{task:E,cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:C,onOpenChange:j,onSuccess:O})]})}export{Tr as default};
