import{r as c,b as se,j as e}from"./app-CHDKARjb.js";import{B as D}from"./button-DVMLQ4Cf.js";import{P as re,a as ae,b as ne,C as le,p as de}from"./popover-CqkGk1d9.js";import{D as ie,a as oe,b as ce}from"./drawer-DBQSSrTa.js";import{I as v}from"./input-CESuFFYh.js";import{L as m}from"./label-DcQ_-sMZ.js";import{R as me}from"./radioGroup-DeMlaPSu.js";import{S as F,a as A,b as R,c as E,d as V}from"./select-DSkJK3rS.js";import{C as ue}from"./calendar-DnRZTeuR.js";import{f as k,i as N}from"./format-PYUiRpxY.js";import"./app-BmbQfT0_.js";import"./index-DzrNkgKa.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-C7c1hvIj.js";import"./chevron-right-CzDW8WF4.js";import"./chevron-down-qX4-vl1q.js";import"./index-BMM8wKPv.js";import"./index-DzT3tnb6.js";import"./index-q1apwmMP.js";import"./index-0tk3grE1.js";import"./index-DhGOy-yS.js";import"./index-CwBu8RV2.js";import"./index-qPHptkmt.js";import"./index-DH5c0sFq.js";import"./index-Dc_FVRD7.js";import"./index-Bc-3DsyS.js";import"./index-DfGTd3cq.js";import"./x-DzxxLS5y.js";import"./index-DiN52TcP.js";import"./index-vBQwvlXi.js";import"./index-DUM9UyY6.js";import"./check-Ck6Rqaxz.js";import"./chevron-up-DiltP7zF.js";function qe({application:r,cities:$,properties:u,units:x,open:h,onOpenChange:_,onSuccess:T}){const p=c.useRef(null),g=c.useRef(null),b=c.useRef(null),[d,i]=c.useState({}),[y,U]=c.useState(r.selected_city_id||null),[C,S]=c.useState(r.selected_property_id||null),[G,j]=c.useState([]),[W,f]=c.useState([]),[q,M]=c.useState(!1),H=()=>{let t=r.selected_property_id??null,s=r.selected_city_id??null;if((!t||isNaN(t))&&r.unit_id){for(const[n,P]of Object.entries(x||{}))if(P?.some(w=>w.id===r.unit_id)){t=parseInt(n,10);break}}if((!s||isNaN(s))&&t){for(const[n,P]of Object.entries(u||{}))if(P?.some(w=>w.id===t)){s=parseInt(n,10);break}}return{cityId:s??null,propertyId:t??null}},B=t=>{if(!(!t||t.trim()===""))try{const s=de(t,"yyyy-MM-dd",new Date);if(N(s))return s;const n=new Date(t);return N(n)?n:void 0}catch(s){console.warn("Date parsing error:",s);return}},L=t=>{if(!t||t.trim()==="")return"";const s=B(t);return s&&N(s)?k(s,"yyyy-MM-dd"):""},{data:l,setData:o,put:J,processing:O,errors:a}=se({unit_id:r.unit_id,name:r.name||"",co_signer:r.co_signer||"",status:r.status||"New",date:L(r.date),stage_in_progress:r.stage_in_progress||"",notes:r.notes||"",attachment:null});c.useEffect(()=>{if(r&&h){const{cityId:t,propertyId:s}=H();U(t),S(s),t&&u[t]?j(u[t]):j([]),s&&x[s]?f(x[s]):f([]),o({unit_id:r.unit_id,name:r.name||"",co_signer:r.co_signer||"",status:r.status||"New",date:L(r.date),stage_in_progress:r.stage_in_progress||"",notes:r.notes||"",attachment:null})}},[r,h,u,x]),c.useEffect(()=>{h||i({})},[h]);const K=t=>{const s=parseInt(t);U(s),S(null),o("unit_id",null),i(n=>({...n,city:void 0,property:void 0,unit:void 0})),u[s]?j(u[s]):j([]),f([])},Q=t=>{const s=parseInt(t);S(s),o("unit_id",null),i(n=>({...n,property:void 0,unit:void 0})),x[s]?f(x[s]):f([])},X=t=>{const s=parseInt(t);o("unit_id",s),i(n=>({...n,unit:void 0}))},Y=t=>{o("name",t),i(s=>({...s,name:void 0}))},Z=t=>{o("co_signer",t),i(s=>({...s,co_signer:void 0}))},ee=t=>{o("status",t),i(s=>({...s,status:void 0}))},z=t=>{t.preventDefault(),i({});let s=!1;const n={};if(y||(n.city="Please select a city before submitting the form.",p.current&&(p.current.focus(),p.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),C||(n.property="Please select a property before submitting the form.",!s&&g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),l.unit_id||(n.unit="Please select a unit before submitting the form.",!s&&b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),(!l.name||l.name.trim()==="")&&(n.name="Please enter a name before submitting the form.",s=!0),(!l.co_signer||l.co_signer.trim()==="")&&(n.co_signer="Please enter a co-signer before submitting the form.",s=!0),(!l.status||l.status.trim()==="")&&(n.status="Please select a status before submitting the form.",s=!0),s){i(n);return}J(route("applications.update",r.id),{onSuccess:()=>{i({}),_(!1),T?.()}})},te=()=>{i({}),_(!1)},I=()=>B(l.date);return e.jsx(ie,{open:h,onOpenChange:_,modal:!1,children:e.jsx(oe,{size:"half",title:`Edit Application - ${r.name}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(F,{onValueChange:K,value:y?.toString()||"",children:[e.jsx(A,{ref:p,children:e.jsx(R,{placeholder:"Select city"})}),e.jsx(E,{children:$?.map(t=>e.jsx(V,{value:t.id.toString(),children:t.name},t.id))||[]})]}),a.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.unit_id}),d.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.city})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"property",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(F,{onValueChange:Q,value:C?.toString()||"",disabled:!y,children:[e.jsx(A,{ref:g,children:e.jsx(R,{placeholder:"Select property"})}),e.jsx(E,{children:G?.map(t=>e.jsx(V,{value:t.id.toString(),children:t.name},t.id))||[]})]}),a.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.unit_id}),d.property&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.property})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"unit",className:"text-base font-semibold",children:"Unit *"})}),e.jsxs(F,{onValueChange:X,value:l.unit_id?.toString()||"",disabled:!C,children:[e.jsx(A,{ref:b,children:e.jsx(R,{placeholder:"Select unit"})}),e.jsx(E,{children:W?.map(t=>e.jsx(V,{value:t.id.toString(),children:t.name},t.id))||[]})]}),a.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.unit_id}),d.unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.unit})]}),e.jsx("div",{className:"rounded-lg bg-muted/50 p-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{children:e.jsx("strong",{children:"Current Selection:"})}),e.jsxs("p",{children:["City: ",r.city||"N/A"]}),e.jsxs("p",{children:["Property: ",r.property||"N/A"]}),e.jsxs("p",{children:["Unit: ",r.unit_name||"N/A"]})]})}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"name",className:"text-base font-semibold",children:"Name *"})}),e.jsx(v,{id:"name",value:l.name,onChange:t=>Y(t.target.value),placeholder:"Enter applicant name"}),a.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.name}),d.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.name})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"co_signer",className:"text-base font-semibold",children:"Co-signer *"})}),e.jsx(v,{id:"co_signer",value:l.co_signer,onChange:t=>Z(t.target.value),placeholder:"Enter co-signer name"}),a.co_signer&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.co_signer}),d.co_signer&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.co_signer})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"status",className:"text-base font-semibold",children:"Status *"})}),e.jsx(me,{value:l.status,onValueChange:ee,name:"status",options:[{value:"New",label:"New"},{value:"Approved",label:"Approved"},{value:"Undecided",label:"Undecided"},{value:"Rejected",label:"Rejected"},{value:"Pending",label:"Pending"}]}),a.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.status}),d.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.status})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"date",className:"text-base font-semibold",children:"Date"})}),e.jsxs(re,{open:q,onOpenChange:M,modal:!1,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:`w-full justify-start text-left font-normal ${!l.date&&"text-muted-foreground"}`,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),l.date&&I()?k(I(),"PPP"):"Pick a date"]})}),e.jsx(ne,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(le,{mode:"single",selected:I(),onSelect:t=>{t&&N(t)&&(o("date",k(t,"yyyy-MM-dd")),M(!1))},initialFocus:!0})})]}),a.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.date})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"stage_in_progress",className:"text-base font-semibold",children:"Stage in Progress"})}),e.jsx(v,{id:"stage_in_progress",value:l.stage_in_progress,onChange:t=>o("stage_in_progress",t.target.value),placeholder:"e.g., Document Review, Background Check, etc."}),a.stage_in_progress&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.stage_in_progress})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-red-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",className:"resize-vertical min-h-[100px] w-full rounded-md border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none",value:l.notes,onChange:t=>o("notes",t.target.value),placeholder:"Add any additional notes...",rows:4}),a.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.notes})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-yellow-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"attachment",className:"text-base font-semibold",children:"Attachment"})}),r.attachment_name&&e.jsxs("div",{className:"mb-3 rounded border bg-muted p-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current attachment:"}),e.jsx("p",{className:"font-medium",children:r.attachment_name})]}),e.jsx(v,{id:"attachment",type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",onChange:t=>o("attachment",t.target.files?.[0]||null),className:"cursor-pointer file:cursor-pointer file:border-0 file:bg-transparent file:text-sm file:font-medium"}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Accepted formats: PDF, Word documents, and images (max 10MB)",r.attachment_name&&" • Upload a new file to replace the current attachment"]}),a.attachment&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.attachment})]})]})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:te,children:"Cancel"}),e.jsx(D,{type:"submit",disabled:O,onClick:z,children:O?"Updating…":"Update Application"})]})})]})})})}export{qe as default};
