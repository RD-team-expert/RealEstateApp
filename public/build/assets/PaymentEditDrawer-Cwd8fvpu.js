import{r as i,b as et,j as n}from"./app-DYme-6ST.js";import{D as rt,a as it,b as st}from"./drawer-BC2XqbDZ.js";import{B as F}from"./button-DygVteL_.js";import ot from"./PaymentForm-DTovmHnG.js";import{f as at}from"./format-PYUiRpxY.js";import"./app-BxoA0TtB.js";import"./index-BPUi24BT.js";import"./index-DAeyJQLn.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./CityField-DnO-zVjw.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-Dc_FVRD7.js";import"./index-D6kz9xqy.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./PropertyField-DA6JdPHK.js";import"./UnitField-DSLORKa4.js";import"./DateField-DKst-fam.js";import"./calendar-BWK2M4JP.js";import"./chevron-left-C0SnhLPd.js";import"./chevron-right-BQBVxicn.js";import"./popover-iS5_0AtM.js";import"./calendar-Bw6k_ssZ.js";import"./OwesField-DQavWrKs.js";import"./input-pR7fOcUW.js";import"./PaidField-P1BknjVJ.js";import"./AssistanceField-CI7tl7J1.js";import"./checkbox-DnglLfek.js";import"./index-B8KHhnfk.js";import"./PermanentField-DXKmEQgQ.js";import"./radioGroup-F0AlgpLY.js";import"./HiddenField-CkJnKyHm.js";import"./ReversedPaymentsField-DIFgv-KS.js";import"./NotesField-B8rDnG62.js";import"./DebugInfo-Z7l3Pl3f.js";function re({payment:t,units:R,cities:A,unitsByCity:B,propertiesByCity:M,open:w,onOpenChange:S,onSuccess:O}){const h=i.useRef(null),_=i.useRef(null),b=i.useRef(null),g=i.useRef(null),v=i.useRef(null),[z,U]=i.useState(""),[$,E]=i.useState(""),[q,u]=i.useState(""),[G,x]=i.useState(""),[H,P]=i.useState(""),[J,V]=i.useState(!1),[s,j]=i.useState(""),[o,d]=i.useState(""),[m,c]=i.useState(""),{data:l,setData:a,put:K,processing:y,errors:L}=et({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:"",is_hidden:!1});i.useEffect(()=>{t&&w&&(a({date:t.date??"",unit_id:t.unit_id?.toString()??"",owes:t.owes?.toString()??"",paid:t.paid?.toString()??"",status:t.status??"",notes:t.notes??"",reversed_payments:t.reversed_payments??"",permanent:t.permanent??"No",has_assistance:t.has_assistance??!1,assistance_amount:t.assistance_amount?.toString()??"",assistance_company:t.assistance_company??"",is_hidden:t.is_hidden??!1}),j(t.city??""),d(t.property_name??""),c(t.unit_name??""),f())},[t,w]);const f=()=>{U(""),E(""),u(""),x(""),P("")},D=()=>s?M[s]||[]:[],k=()=>s?o?R.filter(r=>r.city===s&&r.property_name===o).map(r=>r.unit_name):B[s]||[]:[],Q=(r,e,p)=>{const N=R.find(C=>C.city===r&&C.property_name===e&&C.unit_name===p);return N?N.id:null};i.useEffect(()=>{s&&o&&(D().includes(o)||(d(""),c(""),a(e=>({...e,unit_id:""}))))},[s]),i.useEffect(()=>{o&&m&&(k().includes(m)||(c(""),a(e=>({...e,unit_id:""}))))},[s,o]);const T=r=>{j(r),d(""),c(""),a(e=>({...e,unit_id:""})),f()},W=r=>{d(r),c(""),a(e=>({...e,unit_id:""})),E(""),u("")},X=r=>{if(c(r),u(""),s&&o&&r){const e=Q(s,o,r);e&&a(p=>({...p,unit_id:e.toString()}))}},Y=r=>{r&&(a(e=>({...e,date:at(r,"yyyy-MM-dd")})),x(""),V(!1))},Z=r=>{a(e=>({...e,owes:r.target.value})),P("")},I=r=>{r.preventDefault(),f();let e=!1;(!l.date||l.date.trim()==="")&&(x("Please select a date before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!s||s.trim()==="")&&(U("Please select a city before submitting the form."),h.current&&(h.current.focus(),h.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!o||o.trim()==="")&&(E("Please select a property before submitting the form."),_.current&&(_.current.focus(),_.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!m||m.trim()==="")&&(u("Please select a unit before submitting the form."),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!l.owes||l.owes.trim()==="")&&(P("Please enter the amount owed before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!l.unit_id||l.unit_id.trim()==="")&&(u("Unable to identify the selected unit. Please try selecting again."),e=!0),!e&&K(route("payments.update",t.id),{onSuccess:()=>{f(),S(!1),O?.()},onError:p=>{console.error("Form submission errors:",p)}})},tt=()=>{t&&(a({date:t.date??"",unit_id:t.unit_id?.toString()??"",owes:t.owes?.toString()??"",paid:t.paid?.toString()??"",status:t.status??"",notes:t.notes??"",reversed_payments:t.reversed_payments??"",permanent:t.permanent??"No",has_assistance:t.has_assistance??!1,assistance_amount:t.assistance_amount?.toString()??"",assistance_company:t.assistance_company??"",is_hidden:t.is_hidden??!1}),j(t.city??""),d(t.property_name??""),c(t.unit_name??"")),f(),V(!1),S(!1)};return n.jsx(rt,{open:w,onOpenChange:S,modal:!1,children:n.jsx(it,{size:"half",title:`Edit Payment #${t.id}`,children:n.jsxs("div",{className:"flex h-full flex-col",children:[n.jsx("div",{className:"flex-1 overflow-auto p-6",children:n.jsx(ot,{data:l,setData:a,errors:L,cities:A,selectedCity:s,selectedProperty:o,selectedUnit:m,getAvailableProperties:D,getAvailableUnits:k,handleCityChange:T,handlePropertyChange:W,handleUnitChange:X,handleDateChange:Y,handleOwesChange:Z,calendarOpen:J,setCalendarOpen:V,cityRef:h,propertyRef:_,unitNameRef:b,dateRef:g,owesRef:v,validationError:z,propertyValidationError:$,unitValidationError:q,dateValidationError:G,owesValidationError:H,payment:t,onSubmit:I})}),n.jsx(st,{className:"border-t bg-muted/50 p-4",children:n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx(F,{type:"button",variant:"outline",onClick:tt,disabled:y,children:"Cancel"}),n.jsx(F,{type:"submit",onClick:I,disabled:y,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:y?"Updating...":"Update Payment"})]})})]})})})}export{re as default};
