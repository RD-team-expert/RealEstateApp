import{r as a,u as R,b as V,a as u,j as e,H as q}from"./app-B8ebXpyL.js";import{C as B,a as z,b as G}from"./card-I5kwi667.js";import{u as J}from"./usePermissions-s98nhEDu.js";import{A as K}from"./app-layout-DmWdmcS1.js";import Q from"./TenantCreateDrawer-BTuKy20r.js";import W from"./TenantEditDrawer-lOlE88Lh.js";import{FlashMessages as X}from"./FlashMessages-P8g6xmK0.js";import{ImportModal as Y}from"./ImportModal-CO4g3Xwv.js";import{ImportStatsCard as Z}from"./ImportStatsCard-DNVyiuzk.js";import{Notification as ee}from"./Notification-40XxK-9i.js";import{TenantFilters as te}from"./TenantFilters-BKonBDrH.js";import{TenantPageHeader as re}from"./TenantPageHeader-BTGxbZAq.js";import{TenantTable as oe}from"./TenantTable-Cx78fR8h.js";import{useNotification as se}from"./useNotification-Dwzxc3qi.js";import"./app-DzAncQ8Z.js";import"./utils-CBfrqCZ4.js";import"./index-BvTxALZe.js";import"./index-CdJFUDDL.js";import"./button-CPgLtvIU.js";import"./index-D1eOqOTZ.js";import"./index-DAWwAdgX.js";import"./index-D-HIh1V3.js";import"./index-D14oVES4.js";import"./index-B1T6AYU9.js";import"./index-Ck7g32ef.js";import"./x-DoFGuxfS.js";import"./createLucideIcon-B4WReUhf.js";import"./index-Dc_FVRD7.js";import"./index-7ugTB-P5.js";import"./index-Z2oIQlZU.js";import"./index-BGNXafUJ.js";import"./collapsible-D48RZtcV.js";import"./chevron-right-g-fM4TgC.js";import"./index-B2KxWlhD.js";import"./log-out-CxyPaRj9.js";import"./chevrons-up-down-CIZQ0EQ8.js";import"./app-logo-icon-BiqGLCxP.js";import"./house-BviqJpCK.js";import"./building-W9cmgTVn.js";import"./users-BK0LvTD0.js";import"./wrench-4e_DbURg.js";import"./credit-card-D3gmHRKt.js";import"./dollar-sign-8AMWFOh2.js";import"./file-text-CFwiw5Hy.js";import"./triangle-alert-Cc4FkIFs.js";import"./bell-B34QRIOc.js";import"./drawer-BGYUKi-8.js";import"./CitySelectionSection-BPBdp5Bu.js";import"./label-nhRupGpP.js";import"./select-B8s2DExj.js";import"./index-BCMuVr1f.js";import"./chevron-down-CWVENDnU.js";import"./check-BsIcLAQ3.js";import"./chevron-up-LAfsrV3l.js";import"./PropertySelectionSection-NvXTHzEb.js";import"./UnitSelectionSection-BSUkERJN.js";import"./PersonalInformationSection-CkR3A6Wv.js";import"./FormField-CIXi4Khp.js";import"./input-C70n0jI8.js";import"./ContactInformationSection-DNS6hJZs.js";import"./PaymentAndPreferencesSection-DDSCZLJ4.js";import"./RadioGroupField-DEd5Xm5-.js";import"./radioGroup-Bu6NMix8.js";import"./AssistanceSection-BKhpJltW.js";import"./LocationSection-BV7A1Kw_.js";import"./PersonalInfoSection-sik_n2pd.js";import"./ContactInfoSection-cWIcmbzK.js";import"./PreferencesSection-BsjiN1YL.js";import"./AssistanceSection-Bi5m87-h.js";import"./file-spreadsheet-CcKBqbP4.js";import"./upload-B7fyIjCr.js";import"./loader-circle-DI0eRt18.js";import"./circle-check-big-By3BiyeC.js";import"./circle-alert-T7KB0ret.js";import"./circle-x-KDMMuAQT.js";import"./search-B07AvWR6.js";import"./rotate-ccw-ggOSKmL4.js";import"./download-CP3NEa-C.js";import"./plus-WII3wxe5.js";import"./badge-CPO96EIV.js";import"./table-DhCWrlNv.js";import"./square-pen-CTNwHmLR.js";import"./trash-2-CKQv4Lrc.js";const ie=(o,n="tenants.csv")=>{const m=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...o.map(t=>[t.id,`"${t.city_name||""}"`,`"${t.property_name||""}"`,`"${t.unit_number||""}"`,`"${t.first_name||""}"`,`"${t.last_name||""}"`,`"${(t.street_address_line||"").replace(/"/g,'""')}"`,`"${t.login_email||""}"`,`"${t.alternate_email||""}"`,`"${t.mobile||""}"`,`"${t.emergency_phone||""}"`,`"${t.cash_or_check||""}"`,`"${t.has_insurance||""}"`,`"${t.sensitive_communication||""}"`,`"${t.has_assistance||""}"`,`"${t.assistance_amount||""}"`,`"${(t.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),d=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),c=URL.createObjectURL(d);s.setAttribute("href",c),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};function kt({tenants:o,search:n,cities:l,properties:m,unitsByProperty:d,importStats:s}){const{hasPermission:c,hasAnyPermission:t,hasAllPermissions:g}=J(),[E,y]=a.useState(!1),[N,h]=a.useState(!1),[v,$]=a.useState(!!s),[A,S]=a.useState(!1),[T,j]=a.useState(!1),[b,f]=a.useState(null),{flash:w}=R().props,{notification:x,showNotification:i,hideNotification:D}=se(),p=V({file:null,skip_duplicates:!1}),I=r=>{u.get(route("tenants.index"),{search:r.search,city:r.city,property:r.property,unit_name:r.unitName},{preserveState:!0})},F=()=>{u.get(route("tenants.index"),{},{preserveState:!1,replace:!0})},P=r=>{confirm(`Are you sure you want to archive ${r.first_name} ${r.last_name}? This will hide them from the main list but they can be restored later.`)&&u.patch(route("tenants.archive",r.id),{},{onSuccess:()=>{i("success","Tenant archived successfully!")},onError:()=>{i("error","Failed to archive tenant. Please try again.")}})},k=r=>{f(r),j(!0)},L=()=>{i("success","Tenant updated successfully!"),f(null)},M=()=>{if(o.length===0){alert("No data to export");return}y(!0);try{const r=`tenants-${new Date().toISOString().split("T")[0]}.csv`;ie(o,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},H=a.useCallback((r,C)=>{p.setData({file:r,skip_duplicates:C}),u.post(route("tenants.import.process"),{file:r,skip_duplicates:C},{forceFormData:!0,onSuccess:()=>{h(!1),p.reset(),i("success","CSV file imported successfully!")},onError:_=>{const U=_.file||_.import||"Failed to import CSV file. Please try again.";i("error",U)},onFinish:()=>{p.clearErrors()}})},[p,i]),O=Array.from(new Set(o.map(r=>r.unit_number).filter(Boolean)));return e.jsxs(K,{children:[e.jsx(q,{title:"Tenants"}),x&&e.jsx(ee,{type:x.type,message:x.message,onClose:D}),e.jsx(Y,{isOpen:N,onClose:()=>h(!1),onSubmit:H,isLoading:p.processing}),e.jsx(Q,{open:A,onOpenChange:()=>S(!1),cities:l,properties:m,unitsByProperty:d,onSuccess:()=>i("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(X,{success:w?.success,error:w?.error}),v&&s&&e.jsx(Z,{stats:s,onClose:()=>$(!1)}),e.jsx(re,{onExport:M,onImport:()=>h(!0),onAddNew:()=>S(!0),isExporting:E,hasExportData:o.length>0,canImport:c("tenants.import"),canCreate:g(["tenants.create","tenants.store"])}),e.jsxs(B,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(te,{cities:l,properties:m,uniqueUnitNames:O,onSearch:I,onClear:F,initialFilters:{city:"",property:"",unitName:"",search:n||""}})}),e.jsxs(G,{className:"p-6",children:[e.jsx(oe,{tenants:o,onEdit:k,onDelete:P,canEdit:g(["tenants.edit","tenants.update"]),canDelete:c("tenants.destroy"),showActions:t(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),o.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length," tenant",o.length!==1?"s":"",n&&` matching "${n}"`]})})]})]})]})}),b&&e.jsx(W,{open:T,onOpenChange:()=>{j(!1),f(null)},tenant:b,cities:l,properties:m,unitsByProperty:d,onSuccess:L})]})}export{kt as default};
