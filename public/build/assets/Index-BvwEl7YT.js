import{r as i,u as tt,b as et,a as h,j as e,H as rt}from"./app-DIEWn7Ix.js";import{B as w}from"./button-C0qpziZb.js";import{C as st,a as ot,b as it}from"./card-D0lM0cRg.js";import{u as at}from"./usePermissions-C5kTLoeu.js";import{A as nt}from"./app-layout-C9S1njiG.js";import mt from"./UnitCreateDrawer-BUkzijY8.js";import pt from"./UnitEditDrawer-BA0bX0b-.js";import ct from"./Notification-BlhJS5ZK.js";import lt from"./ImportStatsCard-BK8bT8RB.js";import dt from"./ImportModal-meoBxUfJ.js";import $ from"./FlashMessage-Dvq2fABa.js";import ut from"./UnitsFilter-D1msnR53.js";import ht from"./UnitsTable-CQWQN2qq.js";import ft from"./Pagination-BWG_EYZP.js";import{useNotification as xt}from"./useNotification-CfxttNON.js";import{f as yt}from"./format-PYUiRpxY.js";import{D as gt}from"./download-C1kHH7o-.js";import{U as St}from"./upload-CbKC-Y5O.js";import{P as Ct}from"./plus-DhhAwnw0.js";import"./app-ChTVGdbA.js";import"./index-Bt0zfGgm.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-DKA-WKms.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./index-Dc_FVRD7.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-BuLzMHmv.js";import"./collapsible-D1_DD34n.js";import"./chevron-right-lBI-HPj1.js";import"./index-Bp33PYYw.js";import"./log-out-CE4a_W2h.js";import"./chevrons-up-down-wcdr16Hr.js";import"./app-logo-icon-BrLszCI4.js";import"./house-DKj--ObP.js";import"./building-CBRSJYqv.js";import"./users-B43C_7xE.js";import"./wrench-DwJ9zT3b.js";import"./credit-card-D-F9DsZs.js";import"./dollar-sign-CTn_hGqc.js";import"./file-text-BkIwiqXy.js";import"./triangle-alert-mmtwxqk7.js";import"./bell-CBmeO6wA.js";import"./drawer-fqLIckn8.js";import"./CitySelection-Kw47vdFC.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./PropertySelection-De4XfyNV.js";import"./UnitDetails-BXD9SBiO.js";import"./input-Dp80VBC1.js";import"./TenantDetails-BLT1v1BS.js";import"./LeaseDates-BoQ9U1Fz.js";import"./calendar-A7iFafDy.js";import"./chevron-left-CWUKElF8.js";import"./popover-BTBKKAKu.js";import"./calendar-BV4TAGR8.js";import"./UnitSpecifications-YoRW7iGV.js";import"./LeaseStatus-owdhkwuU.js";import"./radioGroup-BEE05Kck.js";import"./FinancialInformation-B4mN0hkD.js";import"./UtilityInformation-BGVhwJer.js";import"./InsuranceInformation-B_08cUrx.js";import"./CityPropertySelector-BxvqfRTn.js";import"./FormSection-DQ-ACJOq.js";import"./UnitDetailsFields-CXoQgYqt.js";import"./LeaseInformationFields-DBhBfJ5L.js";import"./DatePickerField-D4ihp_XX.js";import"./FinancialFields-IXf-TAdX.js";import"./UtilitiesFields-BGAKNpix.js";import"./InsuranceFields-C0GG0x8i.js";import"./CalculatedValuesDisplay-C0Ed_JrL.js";import"./circle-alert-BKK80Ky4.js";import"./circle-x-CCzLNqA-.js";import"./circle-check-big-CnlFTzVi.js";import"./file-spreadsheet-cfLteSY8.js";import"./loader-circle-DunDFCHN.js";import"./CityAutocomplete-CsdQD1NH.js";import"./PropertyAutocomplete-CQO0gLYf.js";import"./search-Cudh47UL.js";import"./badge-n90aW425.js";import"./table-CvyjvZRw.js";import"./square-pen-BESSjlPV.js";import"./trash-2-BbHlzFlW.js";const N=(s,a="-")=>{if(!s)return a;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return a;const[,m,p,o]=n,l=new Date(Number(m),Number(p)-1,Number(o));return yt(l,"P")},jt=(s,a="units.csv")=>{const m=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(p);o.setAttribute("href",l),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)};function pr({units:s,filters:a,cities:n,properties:m,importStats:p}){const{hasPermission:o,hasAnyPermission:l,hasAllPermissions:r}=at(),[,_]=i.useState(a),[d,E]=i.useState(a),[P,I]=i.useState(!1),[F,g]=i.useState(!1),[k,L]=i.useState(!!p),[A,D]=i.useState(!1),[O,U]=i.useState(!1),[v,T]=i.useState(null),{flash:y}=tt().props,[R,S]=i.useState(d.city||""),[V,C]=i.useState(d.property||""),{notification:j,showNotification:b,hideNotification:M}=xt(),c=et({file:null,skip_duplicates:!0,update_existing:!1}),f=(t,x)=>{E({...d,[t]:x})},B=t=>{S(t),f("city",t)},H=t=>{S(t),f("city",t)},z=t=>{C(t),f("property",t)},q=t=>{C(t.property_name),f("property",t.property_name)},G=()=>{_(d);const t={};Object.entries(d).forEach(([x,u])=>{u!=null&&u!==""&&(t[x]=String(u))}),h.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},J=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:""};E(t),_(t),S(""),C(""),h.get(route("units.index"),{},{preserveState:!0,preserveScroll:!0})},K=t=>{confirm("Are you sure you want to delete this unit?")&&h.delete(route("units.destroy",t.id))},Q=t=>{T(t),U(!0)},W=()=>{h.reload({only:["units","statistics"]})},X=()=>{h.reload({only:["units","statistics"]})},Y=()=>{if(s.data.length===0){alert("No data to export");return}I(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;jt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{I(!1)}},Z=i.useCallback(t=>{c.setData("file",t),h.post(route("units.import"),{file:t,skip_duplicates:c.data.skip_duplicates,update_existing:c.data.update_existing},{forceFormData:!0,onSuccess:()=>{g(!1),c.reset(),b("success","CSV file imported successfully!")},onError:x=>{const u=x.file||"Failed to import CSV file. Please try again.";b("error",u)},onFinish:()=>{c.clearErrors()}})},[c,b]);return e.jsxs(nt,{children:[e.jsx(rt,{title:"Units"}),j&&e.jsx(ct,{type:j.type,message:j.message,onClose:M}),e.jsx(dt,{isOpen:F,onClose:()=>g(!1),onSubmit:Z,isLoading:c.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx($,{type:"success",message:y?.success}),y?.error&&e.jsx($,{type:"error",message:y?.error}),k&&p&&e.jsx(lt,{stats:p,onClose:()=>L(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:Y,disabled:P||s.data.length===0,className:"flex items-center",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),P?"Exporting...":"Export CSV"]}),o("units.import")&&e.jsxs(w,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),l(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>D(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(st,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ot,{children:e.jsx(ut,{filters:d,cities:n||[],properties:m||[],cityInput:R,propertyInput:V,onFilterChange:f,onCityInputChange:B,onCitySelect:H,onPropertyInputChange:z,onPropertySelect:q,onSearch:G,onClear:J})}),e.jsxs(it,{children:[e.jsx(ht,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:o("units.destroy"),onEdit:Q,onDelete:K}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(ft,{links:s.links,currentPage:s.current_page,lastPage:s.last_page}),e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total||0," units"]})]})]})]})}),e.jsx(mt,{open:A,onOpenChange:D,cities:n||[],properties:m||[],onSuccess:X}),v&&e.jsx(pt,{unit:v,cities:n||[],properties:m||[],open:O,onOpenChange:U,onSuccess:W})]})}export{pr as default};
