import{r as a,b as q,j as t}from"./app-DYme-6ST.js";import{B as b}from"./button-DygVteL_.js";import{D as G,a as H,b as J}from"./drawer-BC2XqbDZ.js";import K from"./CitySelectionSection-DmrZhpqH.js";import L from"./PropertySelectionSection-DV3Zsw02.js";import M from"./InsuranceCompanySection-DZzRT3Tc.js";import Q from"./AmountPolicySection-D0FmvvAI.js";import T from"./DatesSection-DTZiOXGE.js";import W from"./NotesSection-zlXVBzov.js";import"./app-BxoA0TtB.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./label-Cs5jgoI2.js";import"./select-CPtJWUF5.js";import"./index-Dc_FVRD7.js";import"./index-D6kz9xqy.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-CadWMiU4.js";import"./chevron-down-CDnjTFxC.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./map-pin-yvAuql9R.js";import"./alert-BkgVQNRR.js";import"./building-2-CrM-EXSd.js";import"./circle-alert-jsi0zk16.js";import"./input-pR7fOcUW.js";import"./shield-Bj8dj4yD.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./calendar-Bw6k_ssZ.js";import"./textarea-CICftYaV.js";function ze({open:m,onOpenChange:c,cities:j=[],availableProperties:h=[],onSuccess:X,currentFilters:S,currentPage:l,currentPerPage:y}){const[i,C]=a.useState(""),[v,d]=a.useState([]),[D,u]=a.useState(""),E={property_id:0,insurance_company_name:"",amount:"",policy_number:"",effective_date:"",expiration_date:"",notes:""},{data:r,setData:o,post:I,processing:x,errors:n,reset:N,clearErrors:g}=q(E);a.useEffect(()=>{if(i){const e=h.filter(s=>s.city_id===parseInt(i));d(e)}else d([]);o("property_id",0)},[i,h]),a.useEffect(()=>{m&&f()},[m]);const f=()=>{N(),C(""),d([]),u(""),g()},P=e=>{o("property_id",parseInt(e)),u("")},w=e=>{o("insurance_company_name",e.target.value)},$=e=>{o("amount",e.target.value)},F=e=>{o("policy_number",e.target.value)},A=e=>{o("effective_date",e.target.value)},U=e=>{o("expiration_date",e.target.value)},V=e=>{o("notes",e.target.value)},k=()=>{const e=[];l&&l>1&&e.push(`page=${l}`),y&&e.push(`per_page=${y}`),Object.entries(S).forEach(([z,p])=>{p!=null&&p!==""&&e.push(`${z}=${encodeURIComponent(String(p))}`)});const s=route("properties-info.store");return e.length>0?`${s}?${e.join("&")}`:s},_=e=>{if(e.preventDefault(),!r.property_id||r.property_id===0){u("Please select a property before submitting the form.");return}I(k(),{onSuccess:()=>{f(),c(!1)},onError:()=>{}})},B=()=>{f(),c(!1)},R=e=>{C(e),o("property_id",0),g()};return t.jsx(G,{open:m,onOpenChange:c,modal:!1,children:t.jsx(H,{size:"half",title:"Create New Property Insurance",children:t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsxs("form",{onSubmit:_,className:"space-y-4",children:[t.jsx(K,{selectedCityId:i,cities:j,onCityChange:R}),t.jsx(L,{propertyId:r.property_id,selectedCityId:i,filteredProperties:v,onPropertyChange:P,errors:n,validationError:D}),t.jsx(M,{value:r.insurance_company_name,onChange:w,errors:n}),t.jsx(Q,{amount:r.amount,policyNumber:r.policy_number,onAmountChange:$,onPolicyNumberChange:F,errors:n}),t.jsx(T,{effectiveDate:r.effective_date,expirationDate:r.expiration_date,onEffectiveDateChange:A,onExpirationDateChange:U,errors:n}),t.jsx(W,{value:r.notes,onChange:V,errors:n})]})}),t.jsxs(J,{className:"flex-row justify-end gap-2 border-t bg-muted/50 p-4",children:[t.jsx(b,{type:"button",variant:"outline",onClick:B,children:"Cancel"}),t.jsx(b,{type:"submit",onClick:_,disabled:x,children:x?"Creating...":"Create Property"})]})]})})})}export{ze as default};
