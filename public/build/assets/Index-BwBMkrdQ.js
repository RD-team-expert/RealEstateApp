import{r as m,u as V,j as e,H as q,a as u}from"./app-CHDKARjb.js";import{u as X,A as G}from"./app-layout-Cz-niD8H.js";import{B as c}from"./button-DVMLQ4Cf.js";import{I as S}from"./input-CESuFFYh.js";import{C,b as _,a as J}from"./card-C7nNTwWV.js";import{T as K,a as Q,b as P,c as a,d as W,e as n}from"./table-OH-MIgN2.js";import{B as p}from"./badge-eUHoACpP.js";import Y from"./PropertyCreateDrawer-DFiqE5DN.js";import Z from"./PropertyEditDrawer-DfTBnF-Q.js";import{D as ee}from"./download-BkR6JC2L.js";import{P as re}from"./plus-C_kG8f__.js";import{X as te}from"./x-DzxxLS5y.js";import{S as se}from"./search-m1-QTzWz.js";import{S as oe}from"./square-pen-FIXyxp3A.js";import{T as ae}from"./trash-2-BG_L6yri.js";import"./app-BmbQfT0_.js";import"./index-DzrNkgKa.js";import"./utils-CBfrqCZ4.js";import"./index-DH5c0sFq.js";import"./index-Dc_FVRD7.js";import"./index-BMM8wKPv.js";import"./index-DhGOy-yS.js";import"./index-Bc-3DsyS.js";import"./index-DzT3tnb6.js";import"./index-q1apwmMP.js";import"./index-0tk3grE1.js";import"./index-DfGTd3cq.js";import"./index-DUM9UyY6.js";import"./index-CwBu8RV2.js";import"./index-qPHptkmt.js";import"./createLucideIcon-C7c1hvIj.js";import"./collapsible-CBxE2yZh.js";import"./chevron-right-CzDW8WF4.js";import"./index-DiN52TcP.js";import"./log-out-Ckm4m212.js";import"./app-logo-icon--P_-c3yX.js";import"./house-R0vSJ-MQ.js";import"./building-mIkOh_fr.js";import"./users-BelIezuD.js";import"./wrench-CSdkG0qX.js";import"./credit-card-3sFCGHNT.js";import"./dollar-sign-C6zNmobC.js";import"./file-text-Ia3zVVV6.js";import"./triangle-alert-DtVQmrkD.js";import"./bell-DGEfdnEl.js";import"./label-DcQ_-sMZ.js";import"./select-DSkJK3rS.js";import"./index-vBQwvlXi.js";import"./chevron-down-qX4-vl1q.js";import"./check-Ck6Rqaxz.js";import"./chevron-up-DiltP7zF.js";import"./drawer-DBQSSrTa.js";import"./alert-DFvfow0h.js";import"./map-pin-DSg4Hlv0.js";import"./building-2-DomSuNJ6.js";import"./circle-alert-CGCoDwFe.js";import"./shield-DZk6mm_U.js";import"./calendar-DnRZTeuR.js";const ne=(i,j="properties.csv")=>{const N=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],x=t=>{const h=new Date,w=new Date(t).getTime()-h.getTime();return Math.ceil(w/(1e3*60*60*24))},v=[N.join(","),...i.map(t=>[t.id,`"${t.property?.property_name||"N/A"}"`,`"${t.insurance_company_name}"`,`"${t.formatted_amount}"`,`"${t.effective_date}"`,`"${t.policy_number}"`,`"${t.expiration_date}"`,x(t.expiration_date),`"${t.status}"`].join(","))].join(`
`),b=new Blob([v],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),o=URL.createObjectURL(b);s.setAttribute("href",o),s.setAttribute("download",j),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)};function ur({properties:i,filters:j,cities:N=[],availableProperties:x=[]}){const{hasPermission:v,hasAnyPermission:b,hasAllPermissions:s}=X(),[o,t]=m.useState(j),[h,y]=m.useState(!1),[w,D]=m.useState(!1),[T,k]=m.useState(!1),[E,A]=m.useState(null),{flash:f}=V().props,g=(r,l)=>{const d={...o,[r]:l};t(d)},I=()=>{const r={};Object.entries(o).forEach(([l,d])=>{d!=null&&d!==""&&(r[l]=String(d))}),u.get(route("properties-info.index"),r,{preserveState:!0,preserveScroll:!0})},O=()=>{t({property_name:"",insurance_company_name:"",policy_number:"",status:void 0}),u.get(route("properties-info.index"),{},{preserveState:!0,preserveScroll:!0})},B=r=>{confirm("Are you sure you want to delete this property?")&&u.delete(route("properties-info.destroy",r.id))},$=()=>{if(i.data.length===0){alert("No data to export");return}y(!0);try{const r=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;ne(i.data,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},F=()=>{u.reload()},L=()=>{u.reload()},R=r=>{A(r),k(!0)},z=r=>r.status==="Expired"?e.jsx(p,{variant:"destructive",children:"Expired"}):e.jsx(p,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"Active"}),H=r=>r<0?e.jsxs(p,{variant:"destructive",children:[Math.abs(r)," days overdue"]}):r<=30?e.jsxs(p,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[r," days left"]}):e.jsxs(p,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[r," days left"]}),U=r=>{const l=new Date,M=new Date(r).getTime()-l.getTime();return Math.ceil(M/(1e3*60*60*24))};return e.jsxs(G,{children:[e.jsx(q,{title:"Properties Insurance"}),e.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[f?.success&&e.jsx(C,{className:"mb-4 border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800",children:e.jsx(_,{className:"p-4",children:e.jsx("div",{className:"text-green-700 dark:text-green-300",children:f?.success})})}),f?.error&&e.jsx(C,{className:"mb-4 border-red-200 bg-red-50 dark:bg-red-950 dark:border-red-800",children:e.jsx(_,{className:"p-4",children:e.jsx("div",{className:"text-red-700 dark:text-red-300",children:f?.error})})}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Property Insurance List"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:$,disabled:h||i.data.length===0,className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),h?"Exporting...":"Export CSV"]}),s(["properties.create","properties.store"])&&e.jsxs(c,{onClick:()=>D(!0),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Add Property"]})]})]}),e.jsxs(C,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(J,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4",children:[e.jsx(S,{type:"text",placeholder:"Property Name",value:o.property_name||"",onChange:r=>g("property_name",r.target.value),className:"bg-input text-input-foreground"}),e.jsx(S,{type:"text",placeholder:"Insurance Company",value:o.insurance_company_name||"",onChange:r=>g("insurance_company_name",r.target.value),className:"bg-input text-input-foreground"}),e.jsx(S,{type:"text",placeholder:"Policy Number",value:o.policy_number||"",onChange:r=>g("policy_number",r.target.value),className:"bg-input text-input-foreground"}),e.jsxs("select",{value:o.status||"",onChange:r=>g("status",r.target.value),className:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Expired",children:"Expired"})]}),e.jsxs("div",{className:"flex justify-around",children:[e.jsxs(c,{variant:"outline",onClick:O,className:"flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Clear"]}),e.jsxs(c,{onClick:I,className:"flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Search"]})]})]})}),e.jsxs(_,{children:[e.jsx("div",{className:"overflow-x-auto relative",children:e.jsxs(K,{className:"border-collapse border border-border rounded-md",children:[e.jsx(Q,{children:e.jsxs(P,{className:"border-border",children:[e.jsx(a,{className:"text-muted-foreground border border-border bg-muted sticky left-0 z-10 min-w-[120px]",children:"Property Name"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Insurance Company"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Amount"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Effective Date"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Policy Number"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Expiration Date"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Days Left"}),e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Status"}),b(["properties.destroy","properties.update","properties.edit","properties.show"])&&e.jsx(a,{className:"text-muted-foreground border border-border bg-muted",children:"Actions"})]})}),e.jsx(W,{children:i.data.map(r=>e.jsxs(P,{className:"hover:bg-muted/50 border-border",children:[e.jsxs(n,{className:"font-medium text-center text-foreground border border-border bg-muted sticky left-0 z-10 min-w-[120px]",children:[r.property?.property_name||"N/A"," "]}),e.jsx(n,{className:"text-center text-foreground border border-border",children:r.insurance_company_name}),e.jsx(n,{className:"text-center text-foreground border border-border",children:r.formatted_amount}),e.jsx(n,{className:"text-center text-foreground border border-border",children:r.effective_date}),e.jsx(n,{className:"text-center text-foreground border border-border",children:r.policy_number}),e.jsx(n,{className:"text-center text-foreground border border-border",children:r.expiration_date}),e.jsx(n,{className:"text-center border border-border",children:H(U(r.expiration_date))}),e.jsx(n,{className:"text-center border border-border",children:z(r)}),b(["properties.destroy","properties.update","properties.edit","properties.show"])&&e.jsx(n,{className:"text-center border border-border",children:e.jsxs("div",{className:"flex gap-1",children:[s(["properties.update","properties.edit"])&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>R(r),children:e.jsx(oe,{className:"h-4 w-4"})}),v("properties.destroy")&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>B(r),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},r.id))})]})}),i.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No properties found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]})]})]})]})}),e.jsx(Y,{open:w,onOpenChange:D,cities:N,availableProperties:x,onSuccess:F}),E&&e.jsx(Z,{open:T,onOpenChange:k,property:E,availableProperties:x,onSuccess:L})]})}export{ur as default};
