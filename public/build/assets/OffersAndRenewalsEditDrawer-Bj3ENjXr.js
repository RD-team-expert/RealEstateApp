import{r as p,b as te,j as e}from"./app-nUSYw4ai.js";import{B as f}from"./createLucideIcon-C5GD6QeA.js";import{P as b,a as y,b as g,C as N,p as se}from"./popover-CMnBhXYh.js";import{D as ne,a as ae,b as le}from"./drawer-ikeMES7v.js";import{I as ie}from"./input-OhVo65AQ.js";import{L as r}from"./label-DtPmPEai.js";import{S as M,a as O,b as V,c as R,d as E}from"./select-PjIVfLW0.js";import{R as C}from"./radioGroup-BdD1VW6H.js";import{C as v}from"./calendar-C-0kt65W.js";import{f as _,i as h}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./chevron-right-uK37_yne.js";import"./chevron-up-BHOYq5G1.js";import"./index-nh9QAngE.js";import"./index-CedKduyQ.js";import"./index-5YpAK82Y.js";import"./index-UYkM-lg7.js";import"./index-DbaH1TRh.js";import"./index-DGbRjXgX.js";import"./index-BKS2-tOY.js";import"./index-mn3Hv6wy.js";function Pe({offer:n,hierarchicalData:k,open:K,onOpenChange:A,onSuccess:Y}){const P=p.useRef(null),D=p.useRef(null),F=p.useRef(null),I=p.useRef(null),[u,x]=p.useState({}),[j,G]=p.useState({date_sent_offer:!1,date_of_acceptance:!1,last_notice_sent:!1,date_sent_lease:!1,date_signed:!1,last_notice_sent_2:!1}),m=(t,a)=>{G(o=>({...o,[t]:a}))},c=t=>{if(!(!t||t.trim()===""))try{const a=se(t,"yyyy-MM-dd",new Date);if(h(a))return a;const o=new Date(t);return h(o)?o:void 0}catch(a){console.warn("Date parsing error:",a);return}},d=t=>{if(!t||t.trim()==="")return"";const a=c(t);return a&&h(a)?_(a,"yyyy-MM-dd"):""},$=()=>{if(!n.tenant_id)return{cityId:"",propertyId:"",unitId:"",tenantId:""};for(const t of k)for(const a of t.properties)for(const o of a.units){const B=o.tenants.find(ee=>ee.id===n.tenant_id);if(B)return{cityId:t.id.toString(),propertyId:a.id.toString(),unitId:o.id.toString(),tenantId:B.id.toString()}}return{cityId:"",propertyId:"",unitId:"",tenantId:""}},L=$(),{data:s,setData:i,put:H,processing:z,errors:l}=te({tenant_id:n.tenant_id?.toString()||"",city_id:L.cityId,property_id:L.propertyId,unit_id:L.unitId,date_sent_offer:d(n.date_sent_offer),status:n.status||"",date_of_acceptance:d(n.date_of_acceptance),last_notice_sent:d(n.last_notice_sent),notice_kind:n.notice_kind||"",lease_sent:n.lease_sent||"",date_sent_lease:d(n.date_sent_lease),lease_signed:n.lease_signed||"",date_signed:d(n.date_signed),last_notice_sent_2:d(n.last_notice_sent_2),notice_kind_2:n.notice_kind_2||"",notes:n.notes||"",how_many_days_left:n.how_many_days_left?.toString()||""});p.useEffect(()=>{if(n){const t=$();i({tenant_id:n.tenant_id?.toString()||"",city_id:t.cityId,property_id:t.propertyId,unit_id:t.unitId,date_sent_offer:d(n.date_sent_offer),status:n.status||"",date_of_acceptance:d(n.date_of_acceptance),last_notice_sent:d(n.last_notice_sent),notice_kind:n.notice_kind||"",lease_sent:n.lease_sent||"",date_sent_lease:d(n.date_sent_lease),lease_signed:n.lease_signed||"",date_signed:d(n.date_signed),last_notice_sent_2:d(n.last_notice_sent_2),notice_kind_2:n.notice_kind_2||"",notes:n.notes||"",how_many_days_left:n.how_many_days_left?.toString()||""})}},[n]);const w=p.useMemo(()=>{if(!s.city_id)return[];const t=k.find(a=>a.id.toString()===s.city_id);return t?t.properties:[]},[k,s.city_id]),S=p.useMemo(()=>{if(!s.property_id)return[];const t=w.find(a=>a.id.toString()===s.property_id);return t?t.units:[]},[w,s.property_id]),U=p.useMemo(()=>{if(!s.unit_id)return[];const t=S.find(a=>a.id.toString()===s.unit_id);return t?t.tenants:[]},[S,s.unit_id]),q=t=>{i({...s,city_id:t,property_id:"",unit_id:"",tenant_id:""}),x(a=>({...a,city:void 0}))},J=t=>{i({...s,property_id:t,unit_id:"",tenant_id:""}),x(a=>({...a,property:void 0}))},Q=t=>{i({...s,unit_id:t,tenant_id:""}),x(a=>({...a,unit:void 0}))},W=t=>{i("tenant_id",t),x(a=>({...a,tenant:void 0}))},X=t=>{i("date_sent_offer",t),x(a=>({...a,date_sent_offer:void 0}))},T=t=>{t.preventDefault(),x({});let a=!1;const o={};if((!s.city_id||s.city_id.trim()==="")&&(o.city="Please select a city before submitting the form.",P.current&&(P.current.focus(),P.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!s.property_id||s.property_id.trim()==="")&&(o.property="Please select a property before submitting the form.",D.current&&!a&&(D.current.focus(),D.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!s.unit_id||s.unit_id.trim()==="")&&(o.unit="Please select a unit before submitting the form.",F.current&&!a&&(F.current.focus(),F.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!s.tenant_id||s.tenant_id.trim()==="")&&(o.tenant="Please select a tenant before submitting the form.",I.current&&!a&&(I.current.focus(),I.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!s.date_sent_offer||s.date_sent_offer.trim()==="")&&(o.date_sent_offer="Please select a date sent offer before submitting the form.",a=!0),a){x(o);return}H(`/offers_and_renewals/${n.id}`,{onSuccess:()=>{x({}),A(!1),Y?.()}})},Z=()=>{const t=$();i({tenant_id:n.tenant_id?.toString()||"",city_id:t.cityId,property_id:t.propertyId,unit_id:t.unitId,date_sent_offer:d(n.date_sent_offer),status:n.status||"",date_of_acceptance:d(n.date_of_acceptance),last_notice_sent:d(n.last_notice_sent),notice_kind:n.notice_kind||"",lease_sent:n.lease_sent||"",date_sent_lease:d(n.date_sent_lease),lease_signed:n.lease_signed||"",date_signed:d(n.date_signed),last_notice_sent_2:d(n.last_notice_sent_2),notice_kind_2:n.notice_kind_2||"",notes:n.notes||"",how_many_days_left:n.how_many_days_left?.toString()||""}),x({}),A(!1)};return e.jsx(ne,{open:K,onOpenChange:A,modal:!1,children:e.jsx(ae,{size:"half",title:`Edit Offer/Renewal (ID: ${n.id})`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(M,{onValueChange:q,value:s.city_id,children:[e.jsx(O,{ref:P,children:e.jsx(V,{placeholder:"Select city"})}),e.jsx(R,{children:k.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))})]}),l.city_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.city_id}),u.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.city})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"property",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(M,{onValueChange:J,value:s.property_id,disabled:!s.city_id||w.length===0,children:[e.jsx(O,{ref:D,children:e.jsx(V,{placeholder:s.city_id?w.length===0?"No properties available":"Select property":"Select city first"})}),e.jsx(R,{children:w.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))})]}),l.property_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.property_id}),u.property&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.property})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"unit",className:"text-base font-semibold",children:"Unit *"})}),e.jsxs(M,{onValueChange:Q,value:s.unit_id,disabled:!s.property_id||S.length===0,children:[e.jsx(O,{ref:F,children:e.jsx(V,{placeholder:s.property_id?S.length===0?"No units available":"Select unit":"Select property first"})}),e.jsx(R,{children:S.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))})]}),l.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.unit_id}),u.unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.unit})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"tenant",className:"text-base font-semibold",children:"Tenant *"})}),e.jsxs(M,{onValueChange:W,value:s.tenant_id,disabled:!s.unit_id||U.length===0,children:[e.jsx(O,{ref:I,children:e.jsx(V,{placeholder:s.unit_id?U.length===0?"No tenants available":"Select tenant":"Select unit first"})}),e.jsx(R,{children:U.map(t=>e.jsx(E,{value:t.id.toString(),children:t.name},t.id))})]}),l.tenant_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.tenant_id}),u.tenant&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.tenant})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"date_sent_offer",className:"text-base font-semibold",children:"Date Sent Offer *"})}),e.jsxs(b,{open:j.date_sent_offer,onOpenChange:t=>m("date_sent_offer",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.date_sent_offer&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.date_sent_offer&&s.date_sent_offer.trim()!==""?(()=>{const t=c(s.date_sent_offer);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.date_sent_offer),onSelect:t=>{t&&h(t)&&(X(_(t,"yyyy-MM-dd")),m("date_sent_offer",!1))},initialFocus:!0})})]}),l.date_sent_offer&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_sent_offer}),u.date_sent_offer&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.date_sent_offer})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"status",className:"text-base font-semibold",children:"Status"})}),e.jsx(C,{value:s.status,onValueChange:t=>i("status",t),name:"status",options:[{value:"Accepted",label:"Accepted"},{value:"Didn't Accept",label:"Didn't Accept"},{value:"Didn't respond",label:"Didn't respond"}]}),l.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.status})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"date_of_acceptance",className:"text-base font-semibold",children:"Date of Acceptance"})}),e.jsxs(b,{open:j.date_of_acceptance,onOpenChange:t=>m("date_of_acceptance",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.date_of_acceptance&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.date_of_acceptance&&s.date_of_acceptance.trim()!==""?(()=>{const t=c(s.date_of_acceptance);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.date_of_acceptance),onSelect:t=>{t&&h(t)&&(i("date_of_acceptance",_(t,"yyyy-MM-dd")),m("date_of_acceptance",!1))},initialFocus:!0})})]}),l.date_of_acceptance&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_of_acceptance})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"last_notice_sent",className:"text-base font-semibold",children:"Offer Last Notice Sent"})}),e.jsxs(b,{open:j.last_notice_sent,onOpenChange:t=>m("last_notice_sent",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.last_notice_sent&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.last_notice_sent&&s.last_notice_sent.trim()!==""?(()=>{const t=c(s.last_notice_sent);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.last_notice_sent),onSelect:t=>{t&&h(t)&&(i("last_notice_sent",_(t,"yyyy-MM-dd")),m("last_notice_sent",!1))},initialFocus:!0})})]}),l.last_notice_sent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.last_notice_sent})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"notice_kind",className:"text-base font-semibold",children:"Offer Notice Kind"})}),e.jsx(C,{value:s.notice_kind,onValueChange:t=>i("notice_kind",t),name:"notice_kind",options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"}]}),l.notice_kind&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notice_kind})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-red-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"lease_sent",className:"text-base font-semibold",children:"Lease Sent?"})}),e.jsx(C,{value:s.lease_sent,onValueChange:t=>i("lease_sent",t),name:"lease_sent",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),l.lease_sent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.lease_sent})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-yellow-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"date_sent_lease",className:"text-base font-semibold",children:"Date Sent Lease"})}),e.jsxs(b,{open:j.date_sent_lease,onOpenChange:t=>m("date_sent_lease",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.date_sent_lease&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.date_sent_lease&&s.date_sent_lease.trim()!==""?(()=>{const t=c(s.date_sent_lease);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.date_sent_lease),onSelect:t=>{t&&h(t)&&(i("date_sent_lease",_(t,"yyyy-MM-dd")),m("date_sent_lease",!1))},initialFocus:!0})})]}),l.date_sent_lease&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_sent_lease})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-cyan-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"lease_signed",className:"text-base font-semibold",children:"Lease Signed?"})}),e.jsx(C,{value:s.lease_signed,onValueChange:t=>i("lease_signed",t),name:"lease_signed",options:[{value:"Signed",label:"Signed"},{value:"Unsigned",label:"Unsigned"}]}),l.lease_signed&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.lease_signed})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-violet-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"date_signed",className:"text-base font-semibold",children:"Date Signed"})}),e.jsxs(b,{open:j.date_signed,onOpenChange:t=>m("date_signed",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.date_signed&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.date_signed&&s.date_signed.trim()!==""?(()=>{const t=c(s.date_signed);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.date_signed),onSelect:t=>{t&&h(t)&&(i("date_signed",_(t,"yyyy-MM-dd")),m("date_signed",!1))},initialFocus:!0})})]}),l.date_signed&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_signed})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-rose-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"last_notice_sent_2",className:"text-base font-semibold",children:"Renewal Last Notice Sent"})}),e.jsxs(b,{open:j.last_notice_sent_2,onOpenChange:t=>m("last_notice_sent_2",t),modal:!1,children:[e.jsx(y,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:`w-full justify-start text-left font-normal ${!s.last_notice_sent_2&&"text-muted-foreground"}`,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),s.last_notice_sent_2&&s.last_notice_sent_2.trim()!==""?(()=>{const t=c(s.last_notice_sent_2);return t?_(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(g,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(N,{mode:"single",selected:c(s.last_notice_sent_2),onSelect:t=>{t&&h(t)&&(i("last_notice_sent_2",_(t,"yyyy-MM-dd")),m("last_notice_sent_2",!1))},initialFocus:!0})})]}),l.last_notice_sent_2&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.last_notice_sent_2})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-amber-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"notice_kind_2",className:"text-base font-semibold",children:"Renewal Notice Kind"})}),e.jsx(C,{value:s.notice_kind_2,onValueChange:t=>i("notice_kind_2",t),name:"notice_kind_2",options:[{value:"Email",label:"Email"},{value:"Call",label:"Call"}]}),l.notice_kind_2&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notice_kind_2})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-lime-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"how_many_days_left",className:"text-base font-semibold",children:"How Many Days Left"})}),e.jsx(ie,{id:"how_many_days_left",type:"number",min:"0",step:"1",value:s.how_many_days_left,onChange:t=>i("how_many_days_left",t.target.value),placeholder:"Enter number of days"}),l.how_many_days_left&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.how_many_days_left})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-slate-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(r,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",value:s.notes,onChange:t=>i("notes",t.target.value),rows:3,placeholder:"Add any additional notes...",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}),l.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notes})]})]})}),e.jsx(le,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:Z,variant:"outline",className:"flex-1",children:"Cancel"}),e.jsx(f,{onClick:T,disabled:z,className:"flex-1",children:z?"Updating...":"Update Offer"})]})})]})})})}export{Pe as default};
