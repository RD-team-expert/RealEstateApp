import{r as l,b as $,j as i}from"./app-BBH7zvDr.js";import{D as q,a as G,b as H}from"./drawer-vn5In2pd.js";import{B as b}from"./button-kQLvnJYc.js";import J from"./CitySelectionSection-B58GKDSw.js";import K from"./PropertySelectionSection-CUfKyXXC.js";import L from"./InsuranceCompanyField-DnR_ctNr.js";import M from"./AmountPolicyFields-EyIwJVxq.js";import Q from"./DateFields-Dj3c_9VH.js";import T from"./NotesField-CAjfki8r.js";import"./app-B1OP9MFD.js";import"./index-CKW8D5J0.js";import"./index-B4JvrASg.js";import"./index-BWJ0fZlj.js";import"./index-df1YLpcl.js";import"./index-wsGo_tiU.js";import"./index-LvlgiWdi.js";import"./index-D7NAAONM.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-CW_SbUiO.js";import"./createLucideIcon-7kSuh4z9.js";import"./label-DwnzeD4h.js";import"./popover-BEQRNvy0.js";import"./index-5ce13En_.js";import"./command-BsAkKql8.js";import"./search-Bh1y_imo.js";import"./map-pin-D1id6YWL.js";import"./chevrons-up-down-CfF2yZbR.js";import"./check-Xlj0_DVN.js";import"./alert-B5G5vRlE.js";import"./building-2-Xawr6Web.js";import"./circle-alert-CIAs1HED.js";import"./input-BCr8ZI70.js";import"./shield-COjS6_jx.js";import"./dollar-sign-BHC8XRqH.js";import"./file-text-BtoeH6mv.js";import"./calendar-BfOPHJgp.js";import"./textarea-CZoZ6jFB.js";function Ae({open:E,onOpenChange:u,property:e,availableProperties:y=[],onSuccess:W,currentFilters:S,currentPage:_,currentPerPage:x,cities:j=[]}){const[D,m]=l.useState(""),[c,h]=l.useState(""),[N,v]=l.useState([]),{data:o,setData:r,put:I,processing:f,errors:s,clearErrors:g,transform:P}=$({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""});l.useEffect(()=>{if(e){r({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""}),m("");const t=e.property,n=t?.city_id?t.city_id.toString():"";h(n)}},[e]),l.useEffect(()=>{if(c){const t=parseInt(c);let n=y.filter(d=>d.city_id===t);const a=e?.property;a&&a.city_id===t&&(n.some(p=>p.id===a.id)||(n=[{id:a.id,city_id:a.city_id??null,property_name:a.property_name,is_archived:a.is_archived,created_at:a.created_at,updated_at:a.updated_at,city:a.city},...n])),v(n)}else v([])},[c,y,e]);const F=t=>{r("insurance_company_name",t.target.value)},w=t=>{r("amount",t.target.value)},V=t=>{r("policy_number",t.target.value)},k=t=>{r("effective_date",t.target.value)},A=t=>{r("expiration_date",t.target.value)},U=t=>{r("notes",t.target.value)},B=t=>{h(t),r("property_id",0),g(),m("")},z=()=>{const t={};x&&(t.filter_per_page=String(x)),_&&_>0&&(t.filter_page=_);const{property_name:n,insurance_company_name:a,policy_number:d,status:p}=S||{};return n&&(t.filter_property_name=n),a&&(t.filter_insurance_company_name=a),d&&(t.filter_policy_number=d),p&&(t.filter_status=p),t},C=t=>{if(t.preventDefault(),!o.property_id||o.property_id===0){m("Please select a property before submitting the form.");return}P(n=>({...n,...z()})),I(route("properties-info.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m(""),u(!1)},onError:()=>{}})},R=()=>{r({property_id:e.property_id||0,insurance_company_name:e.insurance_company_name||"",amount:e.amount?e.amount.toString():"",policy_number:e.policy_number||"",effective_date:e.effective_date||"",expiration_date:e.expiration_date||"",notes:e.notes||""}),g(),m(""),u(!1)};return i.jsx(q,{open:E,onOpenChange:u,modal:!1,children:i.jsx(G,{size:"half",title:`Edit Property - ${e.property?.property_name||"Unknown"}`,children:i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx("div",{className:"flex-1 overflow-auto p-6",children:i.jsxs("form",{onSubmit:C,className:"space-y-4",children:[i.jsx(J,{selectedCityId:c,cities:j,onCityChange:B}),i.jsx(K,{propertyId:o.property_id,selectedCityId:c,filteredProperties:N,onPropertyChange:t=>{r("property_id",parseInt(t)),m("")},errors:s,validationError:D}),i.jsx(L,{value:o.insurance_company_name,onChange:F,error:s.insurance_company_name}),i.jsx(M,{amountValue:o.amount,policyNumberValue:o.policy_number,onAmountChange:w,onPolicyNumberChange:V,amountError:s.amount,policyNumberError:s.policy_number}),i.jsx(Q,{effectiveDateValue:o.effective_date,expirationDateValue:o.expiration_date,onEffectiveDateChange:k,onExpirationDateChange:A,effectiveDateError:s.effective_date,expirationDateError:s.expiration_date}),i.jsx(T,{value:o.notes,onChange:U,error:s.notes})]})}),i.jsx(H,{children:i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx(b,{type:"button",variant:"outline",onClick:R,disabled:f,children:"Cancel"}),i.jsx(b,{type:"submit",onClick:C,disabled:f,children:f?"Updating...":"Update Property"})]})})]})})})}export{Ae as default};
