import{r as p,j as i,H as O,a as u}from"./app-mUrH0ynJ.js";import{C as P,b as k}from"./card-D_RIkHPn.js";import{u as N}from"./usePermissions-BawB_cjI.js";import{A as L}from"./app-layout-CXK9X9au.js";import U from"./MoveInCreateDrawer-DNjX5Pnm.js";import T from"./MoveInEditDrawer-B-3ZwYJr.js";import R from"./PageHeader-CEYaHq92.js";import H from"./MoveInFilters-Br2CHgH0.js";import V from"./MoveInTable-DsCS2wm6.js";import K from"./EmptyState-D9Jvx8_v.js";import Z from"./PaginationInfo-DICgdoH3.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./button-BFBNYzQ-.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./index-Dc_FVRD7.js";import"./index-CXBw7cFo.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./index-I5U3wwZt.js";import"./collapsible-DR70Hr7v.js";import"./chevron-right-o746ehSI.js";import"./index-DK4fbPLM.js";import"./log-out-CXDwqi9T.js";import"./chevrons-up-down-FHN_82j5.js";import"./app-logo-icon-afD3Sqey.js";import"./house-Bx2Ik4FM.js";import"./building-uSWxfBdk.js";import"./users-C2kYwBw2.js";import"./wrench-Cq_dpeQy.js";import"./credit-card-Bcb_2PMm.js";import"./dollar-sign-BB476t67.js";import"./file-text-CjfNfFxM.js";import"./triangle-alert-Dr9RWMLY.js";import"./bell-ch4AgGU_.js";import"./drawer-B7FkQmZP.js";import"./CityPropertyUnitSelector-C4tAUwXK.js";import"./label-DmNL2-zA.js";import"./select-NL-VGbzo.js";import"./index-p6YNWFgp.js";import"./chevron-down-CcniYHCH.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./LeaseInformationFields-BgHzeVRc.js";import"./radioGroup-DvkZrWpP.js";import"./DatePickerField-YWR5BVdA.js";import"./calendar-DAc8iCNl.js";import"./format-PYUiRpxY.js";import"./chevron-left-Bx0Sy0a0.js";import"./popover-B07j7TfD.js";import"./calendar-e6qKYHCo.js";import"./PaymentInformationFields-BiTjWcCT.js";import"./KeysAndFormsFields-B5yLiAZW.js";import"./InsuranceInformationFields-Bsvmujfb.js";import"./CitySelector-CuY8EBeK.js";import"./FormSection-DWod2uLi.js";import"./PropertySelector-CvjL9Ce9.js";import"./UnitSelector-qQTPHgp6.js";import"./LeaseSigningSection-BjSJZvLl.js";import"./RadioGroupField-COwkwPTI.js";import"./DatePickerField-C-RYZ5qp.js";import"./MoveInDetailsSection-CvUXek81.js";import"./PaymentSection-Dn6Za8S4.js";import"./KeysAndFormsSection-Vtbv4jU-.js";import"./InsuranceSection-eiNCEzwu.js";import"./download-tURfbWWG.js";import"./plus-Vhp6TgB7.js";import"./input-Bo52L6_R.js";import"./search-BHqZNlG5.js";import"./table-DpihfFkM.js";import"./MoveInTableRow-BcbkPVln.js";import"./badge-CXaZ35ua.js";import"./square-pen-3gz5SX3m.js";import"./trash-2-PUmSVtRb.js";const q=(o,c="move-ins.csv")=>{try{const e=t=>{if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(s)}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),d=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...o.map(t=>{try{return[t.id||"",`"${a(t.city_name)}"`,`"${a(t.property_name)}"`,`"${a(t.unit_name)}"`,`"${a(t.signed_lease)}"`,`"${e(t.lease_signing_date)}"`,`"${e(t.move_in_date)}"`,`"${a(t.paid_security_deposit_first_month_rent)}"`,`"${e(t.scheduled_paid_time)}"`,`"${a(t.handled_keys)}"`,`"${e(t.move_in_form_sent_date)}"`,`"${a(t.filled_move_in_form)}"`,`"${e(t.date_of_move_in_form_filled)}"`,`"${a(t.submitted_insurance)}"`,`"${e(t.date_of_insurance_expiration)}"`].join(",")}catch(s){return console.error("Error processing move-in row:",t,s),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([d],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(f);return n.setAttribute("href",l),n.setAttribute("download",c),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Sr({moveIns:o,search:c,filters:e,units:a,cities:h,properties:d,unitsByProperty:f}){const[n,l]=p.useState(!1),[t,s]=p.useState(!1),[v,S]=p.useState(!1),[E,D]=p.useState(null),[y,g]=p.useState({city:e?.city||"",property:e?.property||"",search:e?.search||c||""});p.useEffect(()=>{g({city:e?.city||"",property:e?.property||"",search:e?.search||c||""})},[e,c]);const{hasPermission:_,hasAnyPermission:j}=N(),C=r=>{g(r);const m={};r.search?.trim()&&(m.search=r.search.trim()),r.city?.trim()&&(m.city=r.city.trim()),r.property?.trim()&&(m.property=r.property.trim()),u.get(route("move-in.index"),m,{preserveState:!0,preserveScroll:!0})},b=()=>{g({city:"",property:"",search:""}),u.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},w=r=>{confirm("Are you sure you want to delete this move-in record?")&&u.delete(route("move-in.destroy",r.id))},$=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}l(!0);try{console.log("Exporting move-in data:",o.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;q(o.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const m=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${m}. Please check the console for details.`)}finally{l(!1)}},M=()=>{u.reload()},A=()=>{u.reload()},F=r=>{D(r),S(!0)},x=y.search||y.city||y.property;return i.jsxs(L,{children:[i.jsx(O,{title:"Move-In Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(R,{hasActiveFilters:!!x,isExporting:n,hasData:o?.data&&o.data.length>0,hasCreatePermission:_("move-in.store"),onExport:$,onCreateClick:()=>s(!0)}),i.jsxs(P,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(H,{cities:h,properties:d,initialFilters:y,onSearch:C,onClear:b,hasActiveFilters:!!x}),i.jsxs(k,{children:[i.jsx(V,{moveIns:o.data,canEdit:_("move-in.update"),canDelete:_("move-in.destroy"),showActions:j(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:F,onDelete:w}),o.data.length===0&&i.jsx(K,{hasActiveFilters:!!x}),o.meta&&i.jsx(Z,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})]})]})}),i.jsx(U,{units:a,cities:h,properties:d,unitsByProperty:f,open:t,onOpenChange:s,onSuccess:M}),E&&i.jsx(T,{moveIn:E,units:a,cities:h,properties:d,unitsByProperty:f,open:v,onOpenChange:S,onSuccess:A})]})}export{Sr as default};
