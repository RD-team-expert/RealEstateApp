import{r as m,j as i,H as Q,a as l}from"./app-BSOlzI_M.js";import{A as W}from"./app-layout-BU6wzt8Q.js";import{u as X}from"./usePermissions-DDr8nGFF.js";import Y from"./PageHeader-DyKpkdQx.js";import Z from"./FilterSection-BuZEbR9c.js";import B from"./PaymentsTable-DakDbAC5.js";import tt from"./PaginationInfo-GIvPRqYP.js";import et from"./EmptyState-BMvYQYrO.js";import rt from"./PaymentCreateDrawer-CSxmUYNg.js";import ot from"./PaymentEditDrawer-D2r5Vva0.js";import{e as it}from"./PaymentRow-CEjpPe7Y.js";import pt from"./PaginationControls-DPyRS7lz.js";import"./app-D9zByHv3.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-D2rKFPK1.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./index-Dc_FVRD7.js";import"./index-CJ72cHre.js";import"./index-C4PIvpnm.js";import"./index-D4B3QgQ6.js";import"./collapsible-BeIaK3gz.js";import"./chevron-right-DU-yjHU5.js";import"./index-p7EaCzMM.js";import"./log-out-CU7fAD8S.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./app-logo-icon-Chz0QK53.js";import"./house-A7z-bt3N.js";import"./building-X8V0cPLX.js";import"./users-BZ-W0K9D.js";import"./wrench-AB0PbR3c.js";import"./credit-card-Dh1t_toN.js";import"./dollar-sign-CX6g00Px.js";import"./file-text-XuiuEW0Z.js";import"./triangle-alert-EDCPZCCy.js";import"./bell-CjUavl-i.js";import"./card-lrH58jzJ.js";import"./download-DpLM-FVr.js";import"./plus-DpdyZws7.js";import"./FilterDropdown-BG1R_kZs.js";import"./input-DWv8_Yxn.js";import"./chevron-down--Oeingn_.js";import"./PermanentFilter-ZFKzjad_.js";import"./HiddenFilter-CI7wBkXu.js";import"./eye-D6dEBVIw.js";import"./eye-off-C9NH3OIB.js";import"./search-BcNZ_u8M.js";import"./table-D6Ykx5nO.js";import"./drawer-B6ZRXvIZ.js";import"./DateField-DNEKD1x6.js";import"./calendar-Di5dbzoO.js";import"./format-PYUiRpxY.js";import"./chevron-left-CVo-4b8C.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./calendar-CthI5zTo.js";import"./CityField-B3UynTqK.js";import"./command-CBR154ui.js";import"./check-BE4k6INO.js";import"./PropertyField-BFrCsOOR.js";import"./UnitField-B9wXKyw_.js";import"./FinancialFields-BouOx5mm.js";import"./AssistanceFields-DBCDY9hP.js";import"./checkbox-CPh6jisW.js";import"./index-C4dPa-2_.js";import"./PermanentField-CspMQJFU.js";import"./radioGroup-DqEJ_5sj.js";import"./ReversedPaymentsField-l6yriI6s.js";import"./NotesField-CfaaUxrq.js";import"./DebugInfo-BC3lBj4F.js";import"./PaymentForm-D30N7BKk.js";import"./CityField-DZ15OqNN.js";import"./PropertyField-D7qUt1BZ.js";import"./UnitField-CkzGgOzV.js";import"./DateField-C3Z-dzHq.js";import"./OwesField-BBDo7s0-.js";import"./PaidField-9d9uyuQQ.js";import"./AssistanceField-DMdhPT9l.js";import"./PermanentField-D7A6v3Un.js";import"./ReversedPaymentsField-D9W0Oq-8.js";import"./NotesField-DzlhHsNr.js";import"./DebugInfo-BIbyoWNu.js";import"./PaymentActions-CzACBPOD.js";import"./square-pen-BbbP7D49.js";import"./trash-2-CnyQPA5D.js";import"./StatusBadge-8ZOSI-FI.js";import"./badge-Bc6JwGPl.js";import"./PermanentBadge-DaXsDkDT.js";import"./pagination-gtbI_ymV.js";import"./select-Ckv1zRlQ.js";import"./chevron-up-RzjEL1k0.js";function Ye({payments:r,filters:d,units:u,cities:h,properties:g,unitsByCity:x,unitsByProperty:y,propertiesByCity:S,allCities:O,allProperties:k,statistics:I}){const{hasPermission:U,hasAnyPermission:b,hasAllPermissions:v}=X(),[N,_]=m.useState(!1),[T,P]=m.useState(!1),[q,j]=m.useState(!1),[E,V]=m.useState(null),[p,F]=m.useState(d?.city||""),[a,w]=m.useState(d?.property||""),[n,C]=m.useState(d?.unit||""),[o,D]=m.useState(d?.permanent||[]),[s,A]=m.useState(d?.is_hidden||!1),[c,f]=m.useState(d?.per_page||"15");m.useEffect(()=>{f(d?.per_page||"15")},[d?.per_page]);const $=e=>{e.preventDefault();const t={};p&&(t.city=p),a&&(t.property=a),n&&(t.unit=n),o&&o.length>0&&(t.permanent=o.join(",")),s&&(t.is_hidden="true"),t.per_page=c,t.page=1,l.get(route("payments.index"),t,{preserveState:!0,preserveScroll:!0})},z=()=>{F(""),w(""),C(""),D([]),A(!1),f("15"),l.get(route("payments.index"),{per_page:"15",page:1},{preserveState:!0,preserveScroll:!0})},L=e=>{if(confirm("Are you sure you want to delete this payment?")){const t={};p&&(t.city=p),a&&(t.property=a),n&&(t.unit=n),o&&o.length>0&&(t.permanent=o.join(",")),s&&(t.is_hidden="true"),t.per_page=c,t.page=r?.meta?.current_page||1,l.delete(route("payments.destroy",e.id),{data:t,preserveState:!0,preserveScroll:!0})}},R=e=>{if(confirm("Are you sure you want to hide this payment?")){const t={};p&&(t.city=p),a&&(t.property=a),n&&(t.unit=n),o&&o.length>0&&(t.permanent=o.join(",")),s&&(t.is_hidden="true"),t.per_page=c,t.page=r?.meta?.current_page||1,l.patch(route("payments.hide",e.id),t,{preserveState:!0,preserveScroll:!0})}},G=e=>{if(confirm("Are you sure you want to unhide this payment?")){const t={};p&&(t.city=p),a&&(t.property=a),n&&(t.unit=n),o&&o.length>0&&(t.permanent=o.join(",")),s&&(t.is_hidden="true"),t.per_page=c,t.page=r?.meta?.current_page||1,l.patch(route("payments.unhide",e.id),t,{preserveState:!0,preserveScroll:!0})}},J=e=>{const t=(()=>{if(!e.date)return"";const H=e.date.match(/^(\d{4}-\d{2}-\d{2})/);return H?H[1]:e.date})();V({...e,date:t}),j(!0)},K=()=>{l.reload()},M=()=>{if(!r||!r.data||r.data.length===0){alert("No data to export");return}_(!0);try{console.log("Exporting payments data:",r.data);const e=`payments-${new Date().toISOString().split("T")[0]}.csv`;it(r.data,e),console.log("Export completed successfully")}catch(e){console.error("Export failed:",e),alert(`Export failed: ${e instanceof Error?e.message:"Unknown error"}. Please check the console for details.`)}finally{_(!1)}};return i.jsxs(W,{children:[i.jsx(Q,{title:"Payments"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(Y,{onExport:M,onAddPayment:()=>P(!0),isExporting:N,hasData:r?.data&&r.data.length>0,canCreate:v(["payments.create","payments.store"]),statistics:I}),i.jsx(Z,{cityFilter:p,propertyFilter:a,unitFilter:n,permanentFilter:o,isHiddenFilter:s,setCityFilter:F,setPropertyFilter:w,setUnitFilter:C,setPermanentFilter:D,setIsHiddenFilter:A,uniqueCities:O,uniqueProperties:k,units:u,onSearch:$,onClear:z}),r.data.length===0?i.jsx(et,{}):i.jsxs(i.Fragment,{children:[i.jsx(B,{payments:r.data,onEdit:J,onDelete:L,onHide:R,onUnhide:G,hasAnyPermission:b,hasAllPermissions:v,hasPermission:U,filters:{city:p||void 0,property:a||void 0,unit:n||void 0,permanent:o,is_hidden:s}}),i.jsx(pt,{meta:r.meta,links:r.links,perPage:c,onPerPageChange:f,filters:{city:p||void 0,property:a||void 0,unit:n||void 0,permanent:o,is_hidden:s}}),i.jsx(tt,{meta:r.meta})]})]})}),i.jsx(rt,{open:T,onOpenChange:P,units:u,cities:h,properties:g,unitsByCity:x,unitsByProperty:y,propertiesByCity:S,filtersContext:{city:p||void 0,property:a||void 0,unit:n||void 0,permanent:o,is_hidden:s,per_page:c,page:r?.meta?.current_page||1}}),E&&i.jsx(ot,{payment:E,units:u,cities:h,properties:g,unitsByCity:x,unitsByProperty:y,propertiesByCity:S,open:q,onOpenChange:j,onSuccess:K,filtersContext:{city:p||void 0,property:a||void 0,unit:n||void 0,permanent:o,is_hidden:s,per_page:c,page:r?.meta?.current_page||1}})]})}export{Ye as default};
