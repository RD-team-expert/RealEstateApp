import{r as i,u as st,b as ot,a as g,j as e,H as it}from"./app-BBH7zvDr.js";import{B as w}from"./button-kQLvnJYc.js";import{C as at,a as nt,b as pt}from"./card-nXNWfAGy.js";import{u as mt}from"./usePermissions-9xbEqhTW.js";import{A as ct}from"./app-layout-Dyrs0MhC.js";import lt from"./UnitCreateDrawer-D28aCAJv.js";import dt from"./UnitEditDrawer-B2D20JsQ.js";import ut from"./Notification-B5AG0SK7.js";import ht from"./ImportStatsCard-DZ2w9oo6.js";import ft from"./ImportModal-BaQYTTza.js";import L from"./FlashMessage-h6UHJSDK.js";import gt from"./UnitsFilter-DBxTiYrJ.js";import xt from"./UnitsTable-CI-8ENMl.js";import St from"./Pagination-Bwfv9-Ch.js";import{useNotification as yt}from"./useNotification-PY0-sBN3.js";import{f as Ct}from"./format-PYUiRpxY.js";import{D as jt}from"./download-BISvIJJV.js";import{U as _t}from"./upload-CNG7Os9F.js";import{P as bt}from"./plus-Dr8pi5nE.js";import"./app-B1OP9MFD.js";import"./index-B4JvrASg.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CKW8D5J0.js";import"./index-BWJ0fZlj.js";import"./index-df1YLpcl.js";import"./index-wsGo_tiU.js";import"./index-LvlgiWdi.js";import"./index-D7NAAONM.js";import"./x-CW_SbUiO.js";import"./createLucideIcon-7kSuh4z9.js";import"./index-Dc_FVRD7.js";import"./index-CnOa-MOf.js";import"./index-5ce13En_.js";import"./index-D69JG4aD.js";import"./collapsible-BKCek11j.js";import"./chevron-right-pfan_4Jt.js";import"./index-Uin3X5ek.js";import"./log-out-BzPI9mBJ.js";import"./chevrons-up-down-CfF2yZbR.js";import"./app-logo-icon-CAoiBjM8.js";import"./house-TZOfA7LO.js";import"./building-DsEtYnfD.js";import"./users-BLlpWDgX.js";import"./wrench-CT0OfqLx.js";import"./credit-card-CH7bmEPL.js";import"./dollar-sign-BHC8XRqH.js";import"./file-text-BtoeH6mv.js";import"./triangle-alert-BiELoiYx.js";import"./bell-BaWZy_Rc.js";import"./drawer-vn5In2pd.js";import"./CitySelection-C0rTL8cN.js";import"./label-DwnzeD4h.js";import"./popover-BEQRNvy0.js";import"./command-BsAkKql8.js";import"./search-Bh1y_imo.js";import"./check-Xlj0_DVN.js";import"./PropertySelection-caJ-j_ZN.js";import"./UnitDetails-cBHmMjDA.js";import"./input-BCr8ZI70.js";import"./TenantDetails-I9-oOng0.js";import"./LeaseDates-CoiWQim-.js";import"./calendar-FSzcnI0c.js";import"./chevron-left-BaC6T1ID.js";import"./chevron-down-DZk5AEb3.js";import"./calendar-BfOPHJgp.js";import"./UnitSpecifications-DFsD_8v0.js";import"./LeaseStatus-Gib9_0yq.js";import"./radioGroup-HWuSDrOX.js";import"./index-SVWUaHiW.js";import"./FinancialInformation-DVT3DSOE.js";import"./UtilityInformation-CfmeOnPN.js";import"./InsuranceInformation-CbGKe2vK.js";import"./NewLease-BCCfNiRx.js";import"./CityPropertySelector-DtqoU2kK.js";import"./FormSection-B-MLQLAo.js";import"./UnitDetailsFields-CJ2kv9x1.js";import"./LeaseInformationFields-B16ochX2.js";import"./DatePickerField-2PKU2NQR.js";import"./FinancialFields-C3-nyZpT.js";import"./UtilitiesFields-CcZtxOmJ.js";import"./InsuranceFields-CkxullFs.js";import"./CalculatedValuesDisplay-BgwI9Lin.js";import"./circle-alert-CIAs1HED.js";import"./circle-x-DZ52fbTP.js";import"./circle-check-big-BBvw8qnr.js";import"./file-spreadsheet-CbE_WbA8.js";import"./loader-circle-1EF3LUT2.js";import"./select-IIwc6umI.js";import"./chevron-up-eAQBr70u.js";import"./CityAutocomplete-BSzlIduw.js";import"./PropertyAutocomplete-BWSHcfsU.js";import"./badge-_xk2rKPu.js";import"./table-D8H1Mca3.js";import"./square-pen-ByTUf2-8.js";import"./trash-2-Dnt6KKQ0.js";const N=(s,c="-")=>{if(!s)return c;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return c;const[,d,u,a]=l,f=new Date(Number(d),Number(u)-1,Number(a));return Ct(f,"P")},Pt=(s,c="units.csv")=>{const d=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),u=new Blob([d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),f=URL.createObjectURL(u);a.setAttribute("href",f),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(f)};function ur({units:s,filters:c,cities:l,properties:d,importStats:u}){const{hasPermission:a,hasAnyPermission:f,hasAllPermissions:r}=mt(),[,E]=i.useState(c),[n,I]=i.useState(c),[x,D]=i.useState(String(s?.per_page??"15")),[U,$]=i.useState(!1),[A,C]=i.useState(!1),[O,T]=i.useState(!!u),[R,v]=i.useState(!1),[V,F]=i.useState(!1),[k,M]=i.useState(null),{flash:y}=st().props,[B,j]=i.useState(n.city||""),[H,_]=i.useState(n.property||""),{notification:b,showNotification:P,hideNotification:z}=yt(),h=ot({file:null,skip_duplicates:!0,update_existing:!1}),S=(t,o)=>{I({...n,[t]:o})},q=t=>{j(t),S("city",t)},G=t=>{j(t),S("city",t)},J=t=>{_(t),S("property",t)},K=t=>{_(t.property_name),S("property",t.property_name)},Q=()=>{E(n);const t={};Object.entries(n).forEach(([o,p])=>{p!=null&&p!==""&&(t[o]=String(p))}),t.per_page=String(x),g.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},W=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:"",is_new_lease:""};I(t),E(t),j(""),_(""),D("15"),g.get(route("units.index"),{per_page:"15"},{preserveState:!0,preserveScroll:!0})},X=t=>{if(confirm("Are you sure you want to delete this unit?")){const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),g.visit(route("units.destroy",t.id),{method:"delete",data:{redirect:{filters:o,per_page:String(x),page:String(s?.current_page??1)}},preserveState:!0,preserveScroll:!0})}},Y=t=>{M(t),F(!0)},Z=()=>{g.reload({only:["units","statistics"]})},tt=()=>{},et=()=>{if(s.data.length===0){alert("No data to export");return}$(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;Pt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{$(!1)}},rt=i.useCallback(t=>{h.setData("file",t),g.post(route("units.import"),{file:t,skip_duplicates:h.data.skip_duplicates,update_existing:h.data.update_existing},{forceFormData:!0,onSuccess:()=>{C(!1),h.reset(),P("success","CSV file imported successfully!")},onError:o=>{const p=o.file||"Failed to import CSV file. Please try again.";P("error",p)},onFinish:()=>{h.clearErrors()}})},[h,P]);return e.jsxs(ct,{children:[e.jsx(it,{title:"Units"}),b&&e.jsx(ut,{type:b.type,message:b.message,onClose:z}),e.jsx(ft,{isOpen:A,onClose:()=>C(!1),onSubmit:rt,isLoading:h.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx(L,{type:"success",message:y?.success}),y?.error&&e.jsx(L,{type:"error",message:y?.error}),O&&u&&e.jsx(ht,{stats:u,onClose:()=>T(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:et,disabled:U||s.data.length===0,className:"flex items-center",children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),U?"Exporting...":"Export CSV"]}),a("units.import")&&e.jsxs(w,{onClick:()=>C(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),f(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>v(!0),children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(at,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(nt,{children:e.jsx(gt,{filters:n,cities:l||[],properties:d||[],cityInput:B,propertyInput:H,onFilterChange:S,onCityInputChange:q,onCitySelect:G,onPropertyInputChange:J,onPropertySelect:K,onSearch:Q,onClear:W})}),e.jsxs(pt,{children:[e.jsx(xt,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:a("units.destroy"),onEdit:Y,onDelete:X}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(St,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,from:s.from,to:s.to,total:s.total,perPage:x,onPerPageChange:t=>{D(t);const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),o.per_page=String(t),g.get(route("units.index"),o,{preserveState:!0,preserveScroll:!0})}})]})]})]})}),e.jsx(lt,{open:R,onOpenChange:v,cities:l||[],properties:d||[],onSuccess:tt,redirectState:{filters:n,per_page:x,page:s?.current_page??1}}),k&&e.jsx(dt,{unit:k,cities:l||[],properties:d||[],open:V,onOpenChange:F,onSuccess:Z,redirectState:{filters:n,per_page:x,page:s?.current_page??1}})]})}export{ur as default};
