import{r as n,b as ue,j as s}from"./app-XlMZG7vD.js";import{B as $}from"./button-D56PIbu9.js";import{D as ce,a as _e,b as me}from"./drawer-B7-2XtV2.js";import fe from"./CitySelector-Dx-wBkUj.js";import ge from"./PropertySelector-D5WjCbmy.js";import be from"./UnitSelector-Cf8V0fTl.js";import pe from"./VendorSelector-BZQleqfb.js";import P from"./DatePickerField-DKCRptxS.js";import H from"./TextAreaField-CsIbTfUt.js";import he from"./StatusRadioGroup-DDGnMbV-.js";import ve from"./UrgencyRadioGroup-BUa6bXIm.js";import"./app-D9zByHv3.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./popover-DR8Y8CsW.js";import"./index-CTF06pqo.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./FormSection-BMkTEQQv.js";import"./label-BKN3erGN.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./check-ZO7ekD6P.js";import"./calendar-D02iCkay.js";import"./format-PYUiRpxY.js";import"./chevron-left-DiIjHAK0.js";import"./chevron-right-By2R6jNh.js";import"./chevron-down-Dqt3V4Kg.js";import"./calendar-CGMbx-hL.js";import"./radioGroup-DrlpglLG.js";import"./index-D8BBDizX.js";import"./index-DdpYxxi8.js";function ot({task:e,cities:J,units:K,vendors:S,unitsByCity:D,propertiesByCity:g,unitsByProperty:u,filters:L,open:M,onOpenChange:T,onSuccess:Q}){const C=n.useRef(null),x=n.useRef(null),V=n.useRef(null),E=n.useRef(null),j=n.useRef(null),[W,b]=n.useState(""),[X,c]=n.useState(""),[Y,m]=n.useState(""),[Z,p]=n.useState(""),[B,h]=n.useState(""),[N,_]=n.useState([]),[ee,f]=n.useState([]),[F,y]=n.useState([]),[l,U]=n.useState(e.city||""),[q,R]=n.useState(e.property_name||""),[,v]=n.useState(e.unit_name||""),[,w]=n.useState(e.vendor_name||""),[k,te]=n.useState({task_submission_date:!1,any_scheduled_visits:!1,task_ending_date:!1}),A=(t,r)=>{te(a=>({...a,[t]:r}))},I=t=>{const r=S.find(a=>a.vendor_name===t);return r?r.id.toString():""},O=t=>{const r=K.find(a=>a.unit_name===t);return r?r.id.toString():""},{data:i,setData:o,put:re,processing:G,errors:d,transform:ne}=ue({vendor_id:I(e.vendor_name||""),unit_id:O(e.unit_name||""),task_submission_date:e.task_submission_date??"",assigned_tasks:e.assigned_tasks??"",any_scheduled_visits:e.any_scheduled_visits??"",notes:e.notes??"",task_ending_date:e.task_ending_date??"",status:e.status??"",urgent:e.urgent??"No"});n.useEffect(()=>{o({vendor_id:I(e.vendor_name||""),unit_id:O(e.unit_name||""),task_submission_date:e.task_submission_date??"",assigned_tasks:e.assigned_tasks??"",any_scheduled_visits:e.any_scheduled_visits??"",notes:e.notes??"",task_ending_date:e.task_ending_date??"",status:e.status??"",urgent:e.urgent??"No"}),U(e.city||""),R(e.property_name||""),v(e.unit_name||""),w(e.vendor_name||"")},[e]),n.useEffect(()=>{e.city?(g[e.city]?f(g[e.city]):f([]),y(S),e.property_name&&u[e.city]&&u[e.city][e.property_name]?_(u[e.city][e.property_name]):D[e.city]?_(D[e.city]):_([])):(f([]),y([]),_([]))},[e.city,e.property_name,D,g,u,S]);const se=t=>{U(t),R(""),v(""),w(""),o("unit_id",""),o("vendor_id",""),b(""),c(""),m(""),t?(g[t]?f(g[t]):f([]),y(S)):(f([]),y([])),_([])},ie=t=>{R(t),v(""),o("unit_id",""),c(""),l&&t&&u[l]&&u[l][t]?_(u[l][t]):_([])},oe=t=>{const r=N.find(a=>a.id.toString()===t);r&&(v(r.unit_name),o("unit_id",t),c(""))},ae=t=>{const r=F.find(a=>a.id.toString()===t);r&&(w(r.vendor_name),o("vendor_id",t),m(""))},de=t=>{o("assigned_tasks",t.target.value),h("")},z=t=>{t.preventDefault(),b(""),c(""),m(""),p(""),h("");let r=!1;(!l||l.trim()==="")&&(b("Please select a city before submitting the form."),C.current&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.unit_id||i.unit_id.trim()==="")&&(c("Please select a unit before submitting the form."),x.current&&(x.current.focus(),x.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.vendor_id||i.vendor_id.trim()==="")&&(m("Please select a vendor before submitting the form."),V.current&&(V.current.focus(),V.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.task_submission_date||i.task_submission_date.trim()==="")&&(p("Please select a task submission date before submitting the form."),E.current&&(E.current.focus(),E.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.assigned_tasks||i.assigned_tasks.trim()==="")&&(h("Please enter assigned tasks before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),!r&&(ne(a=>({...a,redirect_filters:{...L}})),re(route("vendor-task-tracker.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{b(""),c(""),m(""),p(""),h(""),T(!1),Q?.()}}))},le=()=>{o({vendor_id:I(e.vendor_name||""),unit_id:O(e.unit_name||""),task_submission_date:e.task_submission_date??"",assigned_tasks:e.assigned_tasks??"",any_scheduled_visits:e.any_scheduled_visits??"",notes:e.notes??"",task_ending_date:e.task_ending_date??"",status:e.status??"",urgent:e.urgent??"No"}),U(e.city||""),R(e.property_name||""),v(e.unit_name||""),w(e.vendor_name||""),b(""),c(""),m(""),p(""),h(""),T(!1)};return s.jsx(ce,{open:M,onOpenChange:T,modal:!1,children:s.jsx(_e,{size:"half",title:`Edit Vendor Task #${e.id}`,children:s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx("div",{className:"flex-1 overflow-auto p-6",children:s.jsxs("form",{onSubmit:z,className:"space-y-4",children:[s.jsx(fe,{cities:J,selectedCity:l,onCityChange:se,cityRef:C,error:d.city,validationError:W}),s.jsx(ge,{properties:ee,selectedProperty:q,onPropertyChange:ie,disabled:!l}),s.jsx(be,{units:N,selectedUnitId:i.unit_id,onUnitChange:oe,unitRef:x,disabled:!q,error:d.unit_id,validationError:X}),s.jsx(pe,{vendors:F,selectedVendorId:i.vendor_id,onVendorChange:ae,vendorRef:V,disabled:!l,error:d.vendor_id,validationError:Y}),s.jsx(P,{label:"Task Submission Date",required:!0,borderColor:"border-l-orange-500",value:i.task_submission_date,onChange:t=>{o("task_submission_date",t),p("")},dateRef:E,error:d.task_submission_date,validationError:Z,calendarOpen:k.task_submission_date,onCalendarOpenChange:t=>A("task_submission_date",t)}),s.jsx(P,{label:"Any Scheduled Visits",borderColor:"border-l-emerald-500",value:i.any_scheduled_visits,onChange:t=>o("any_scheduled_visits",t),error:d.any_scheduled_visits,calendarOpen:k.any_scheduled_visits,onCalendarOpenChange:t=>A("any_scheduled_visits",t),allowClear:!0}),s.jsx(P,{label:"Task Ending Date",borderColor:"border-l-teal-500",value:i.task_ending_date,onChange:t=>o("task_ending_date",t),error:d.task_ending_date,calendarOpen:k.task_ending_date,onCalendarOpenChange:t=>A("task_ending_date",t),allowClear:!0}),s.jsx(H,{label:"Assigned Tasks",required:!0,borderColor:"border-l-indigo-500",value:i.assigned_tasks,onChange:de,textAreaRef:j,placeholder:"Describe the assigned tasks...",rows:3,error:d.assigned_tasks,validationError:B}),s.jsx(H,{label:"Notes",borderColor:"border-l-pink-500",value:i.notes,onChange:t=>o("notes",t.target.value),placeholder:"Enter any additional notes...",rows:3,error:d.notes}),s.jsx(he,{value:i.status,onChange:t=>o("status",t),error:d.status}),s.jsx(ve,{value:i.urgent,onChange:t=>o("urgent",t),error:d.urgent})]})}),s.jsx(me,{children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx($,{type:"button",variant:"outline",onClick:le,className:"flex-1",children:"Cancel"}),s.jsx($,{type:"submit",onClick:z,disabled:G,className:"flex-1",children:G?"Updatingâ€¦":"Update Task"})]})})]})})})}export{ot as default};
