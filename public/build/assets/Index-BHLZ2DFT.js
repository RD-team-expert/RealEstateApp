import{r as n,u as B,j as t,H as M,a as l}from"./app-ouZqxB1_.js";import{C as z,b as G}from"./card-BzHR4zj2.js";import{u as J}from"./usePermissions-CgTmmj4S.js";import{A as K}from"./app-layout-hh4BSFp7.js";import W from"./VendorCreateDrawer-D5obxs2Z.js";import X from"./VendorEditDrawer-DvAvW2uM.js";import Y from"./FlashMessages-D9sMLM7o.js";import Z from"./PageHeader-DVeMOLfy.js";import ee from"./VendorFilters-CPYshPT-.js";import te from"./VendorTable-BtYQBRoU.js";import re from"./VendorPagination-L6Htc0IC.js";import"./app-CsCti_B1.js";import"./utils-CBfrqCZ4.js";import"./index-ChCgVrQ9.js";import"./index-CdJFUDDL.js";import"./button-Dwk07ddD.js";import"./index-D_5cRLds.js";import"./index-CBrQgTKF.js";import"./index-DZ6Q_eM6.js";import"./index-B409lPMy.js";import"./index-Cw-58lmC.js";import"./index-L_KZmfdx.js";import"./x-C6lwu6z7.js";import"./createLucideIcon-D2D4_K7R.js";import"./index-Dc_FVRD7.js";import"./index-BMcOUver.js";import"./index-D8RbbIhn.js";import"./index-Btvi_Rs9.js";import"./collapsible-BwAUb3LI.js";import"./chevron-right-DK0aPss0.js";import"./index-XAL2DKQ_.js";import"./log-out-D2oDbh7f.js";import"./chevrons-up-down-BP70ShdQ.js";import"./app-logo-icon-CTS5saan.js";import"./house-BWlu7WDR.js";import"./building-CmpXhYjP.js";import"./users-BiWLNhUw.js";import"./wrench-BzFAA3y4.js";import"./credit-card-DvEGg_rY.js";import"./dollar-sign-DHkBemQX.js";import"./file-text-BT_oga12.js";import"./triangle-alert-Eu4YVppC.js";import"./bell-CFZ0fo-F.js";import"./drawer-By3Utn4a.js";import"./CityField-BpiVhp-G.js";import"./label-DuRYAP1m.js";import"./popover-HByMxBFn.js";import"./command-Bvk0WKej.js";import"./search-K6eFBQan.js";import"./VendorNameField-BWV5KREX.js";import"./input-Be-glciT.js";import"./PhoneNumberField-Bsu6zYi4.js";import"./plus-D6FaG-uq.js";import"./trash-2-DfkHb-TA.js";import"./EmailField-D0nj4dzF.js";import"./ServiceTypeField-DYIzWxpZ.js";import"./select-CiYdqFJh.js";import"./index-DfGrYlP0.js";import"./chevron-down-DJ1Ff5Fx.js";import"./check-Ef_HP5Pc.js";import"./chevron-up-BPU5s7__.js";import"./CityField-BXDSC-zx.js";import"./VendorNameField-IQ7KIhYt.js";import"./PhoneNumberField-Ckadbyiz.js";import"./EmailField-DIRfvPbU.js";import"./ServiceTypeField-8-1fU-Jm.js";import"./download-BGHOZyb0.js";import"./table-BVHgrT9O.js";import"./VendorTableRow-CwrsT7SF.js";import"./square-pen-DdrodMIC.js";const oe=(i,a="vendors.csv")=>{const c=["ID","City","Vendor Name","Number","Email","Service Type"],p=r=>!r||!Array.isArray(r)||r.length===0?"":r.join("; "),y=[c.join(","),...i.map(r=>[r.id,`"${r.city?.city||"N/A"}"`,`"${r.vendor_name}"`,`"${p(r.number)}"`,`"${p(r.email)}"`,`"${p(r.service_type)}"`].join(","))].join(`
`),u=new Blob([y],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)};function jt({vendors:i,filters:a,cities:c}){const[,p]=n.useState(a),[y,u]=n.useState(!1),[o,d]=n.useState(!1),[r,j]=n.useState(!1),[V,A]=n.useState(null),{flash:F}=B().props,{hasPermission:C,hasAllPermissions:_}=J(),[g,w]=n.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[v,N]=n.useState(a?.per_page?.toString?.()??"15"),[O,h]=n.useState(!1),f=(e,s)=>{w(m=>({...m,[e]:s}))},R=e=>{const s=e.target.value;f("city",s),h(s.length>0)},k=e=>{f("city",e.city),h(!1)},I=()=>{const e={...g,per_page:v};p(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},T=()=>{const e={city:"",vendor_name:""};w(e),p(e),h(!1),l.get(route("vendors.index"),{per_page:v},{preserveState:!0,preserveScroll:!0})},L=e=>{const s=e.target.value;N(s);const m={...g,per_page:s};l.get(route("vendors.index"),m,{preserveState:!0,preserveScroll:!0})},$=()=>{if(i.data.length===0){alert("No data to export");return}u(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{u(!1)}},U=e=>{if(!confirm("Are you sure you want to delete this vendor?"))return;const m=(()=>{try{const x=new URLSearchParams(window.location.search),S=["city","city_id","vendor_name","number","email","per_page","page"],E={};return S.forEach(P=>{const D=x.get(P);D!==null&&(E[P]=D)}),E}catch{return{}}})(),b={};[["city","filter_city"],["city_id","filter_city_id"],["vendor_name","filter_vendor_name"],["number","filter_number"],["email","filter_email"],["per_page","filter_per_page"],["page","filter_page"]].forEach(([x,S])=>{m[x]!==void 0&&(b[S]=m[x])}),l.delete(route("vendors.destroy",e.id),{preserveScroll:!0,preserveState:!0,data:b})},H=()=>{l.reload()},q=e=>{A(e),j(!0)},Q=()=>{l.reload()};return t.jsxs(K,{children:[t.jsx(M,{title:"Vendors"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(Y,{flash:F}),t.jsx(Z,{hasExportPermission:C("vendor.export"),hasCreatePermissions:_(["vendors.create","vendors.store"]),isExporting:y,onExport:$,onAddVendor:()=>d(!0)}),t.jsx(z,{children:t.jsxs(G,{className:"p-6",children:[t.jsx(ee,{tempFilters:g,cities:c,showCityDropdown:O,onTempFilterChange:f,onCityInputChange:R,onCitySelect:k,onSearchClick:I,onClearFilters:T,setShowCityDropdown:h}),t.jsx(te,{vendors:i.data,hasEditPermissions:_(["vendors.edit","vendors.update"]),hasDeletePermission:C("vendors.destroy"),onEditVendor:q,onDeleteVendor:U}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),t.jsxs("select",{value:v,onChange:L,className:"rounded-md border border-input bg-background px-2 py-1 text-sm shadow-sm focus:outline-none",children:[t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"all",children:"All"})]})]}),t.jsx(re,{links:i.links})]})]})})]})}),t.jsx(W,{cities:c,open:o,onOpenChange:d,onSuccess:H}),t.jsx(X,{cities:c,open:r,onOpenChange:j,vendor:V,onSuccess:Q})]})}export{jt as default};
