import{r as i,u as tt,b as et,a as h,j as e,H as rt}from"./app-mUrH0ynJ.js";import{B as w}from"./button-BFBNYzQ-.js";import{C as st,a as ot,b as it}from"./card-D_RIkHPn.js";import{u as at}from"./usePermissions-BawB_cjI.js";import{A as nt}from"./app-layout-CXK9X9au.js";import mt from"./UnitCreateDrawer-CJR6OHat.js";import pt from"./UnitEditDrawer-CHD5wYSh.js";import ct from"./Notification-B561q2zT.js";import lt from"./ImportStatsCard-f_nC6kim.js";import dt from"./ImportModal-DpYxKQpT.js";import $ from"./FlashMessage-bOBvehfe.js";import ut from"./UnitsFilter-BUliX9p-.js";import ht from"./UnitsTable-CmMXRRC2.js";import ft from"./Pagination-v40X_JvO.js";import{useNotification as xt}from"./useNotification-DClBz9RD.js";import{f as yt}from"./format-PYUiRpxY.js";import{D as gt}from"./download-tURfbWWG.js";import{U as St}from"./upload-DN0aTFGZ.js";import{P as Ct}from"./plus-Vhp6TgB7.js";import"./app-BxoA0TtB.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./index-Dc_FVRD7.js";import"./index-CXBw7cFo.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./index-I5U3wwZt.js";import"./collapsible-DR70Hr7v.js";import"./chevron-right-o746ehSI.js";import"./index-DK4fbPLM.js";import"./log-out-CXDwqi9T.js";import"./chevrons-up-down-FHN_82j5.js";import"./app-logo-icon-afD3Sqey.js";import"./house-Bx2Ik4FM.js";import"./building-uSWxfBdk.js";import"./users-C2kYwBw2.js";import"./wrench-Cq_dpeQy.js";import"./credit-card-Bcb_2PMm.js";import"./dollar-sign-BB476t67.js";import"./file-text-CjfNfFxM.js";import"./triangle-alert-Dr9RWMLY.js";import"./bell-ch4AgGU_.js";import"./drawer-B7FkQmZP.js";import"./CitySelection-zD68rAwP.js";import"./label-DmNL2-zA.js";import"./select-NL-VGbzo.js";import"./index-p6YNWFgp.js";import"./chevron-down-CcniYHCH.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./PropertySelection-sJcmk77w.js";import"./UnitDetails-Do-dcbYo.js";import"./input-Bo52L6_R.js";import"./TenantDetails-8MWCEdRu.js";import"./LeaseDates-BaHTN6xU.js";import"./calendar-DAc8iCNl.js";import"./chevron-left-Bx0Sy0a0.js";import"./popover-B07j7TfD.js";import"./calendar-e6qKYHCo.js";import"./UnitSpecifications-DB8k9AxI.js";import"./LeaseStatus-O38z0lfi.js";import"./radioGroup-DvkZrWpP.js";import"./FinancialInformation-CLI4SGzx.js";import"./UtilityInformation-BlLTmEdZ.js";import"./InsuranceInformation-ChuGebRx.js";import"./CityPropertySelector-CCS19dDh.js";import"./FormSection-CMKTGIuv.js";import"./UnitDetailsFields-DPQSbe-U.js";import"./LeaseInformationFields-CDS4GKpe.js";import"./DatePickerField-BOQHTPEB.js";import"./FinancialFields-DrrnuA4t.js";import"./UtilitiesFields-d32XMmC4.js";import"./InsuranceFields-BI1i1fGh.js";import"./CalculatedValuesDisplay-BaUZaCLk.js";import"./circle-alert-B4oHAxZv.js";import"./circle-x-Cxoqe6fh.js";import"./circle-check-big-PZXwy0Bk.js";import"./file-spreadsheet-DX_zq0xC.js";import"./loader-circle-BjljqF34.js";import"./CityAutocomplete-CFW41Jxm.js";import"./PropertyAutocomplete-Btkjs9_A.js";import"./search-BHqZNlG5.js";import"./badge-CXaZ35ua.js";import"./table-DpihfFkM.js";import"./square-pen-3gz5SX3m.js";import"./trash-2-PUmSVtRb.js";const N=(s,a="-")=>{if(!s)return a;const n=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!n)return a;const[,m,p,o]=n,l=new Date(Number(m),Number(p)-1,Number(o));return yt(l,"P")},jt=(s,a="units.csv")=>{const m=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),p=new Blob([m],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(p);o.setAttribute("href",l),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)};function pr({units:s,filters:a,cities:n,properties:m,importStats:p}){const{hasPermission:o,hasAnyPermission:l,hasAllPermissions:r}=at(),[,_]=i.useState(a),[d,E]=i.useState(a),[P,I]=i.useState(!1),[F,g]=i.useState(!1),[k,L]=i.useState(!!p),[A,D]=i.useState(!1),[O,U]=i.useState(!1),[v,T]=i.useState(null),{flash:y}=tt().props,[R,S]=i.useState(d.city||""),[V,C]=i.useState(d.property||""),{notification:j,showNotification:b,hideNotification:M}=xt(),c=et({file:null,skip_duplicates:!0,update_existing:!1}),f=(t,x)=>{E({...d,[t]:x})},B=t=>{S(t),f("city",t)},H=t=>{S(t),f("city",t)},z=t=>{C(t),f("property",t)},q=t=>{C(t.property_name),f("property",t.property_name)},G=()=>{_(d);const t={};Object.entries(d).forEach(([x,u])=>{u!=null&&u!==""&&(t[x]=String(u))}),h.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},J=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:""};E(t),_(t),S(""),C(""),h.get(route("units.index"),{},{preserveState:!0,preserveScroll:!0})},K=t=>{confirm("Are you sure you want to delete this unit?")&&h.delete(route("units.destroy",t.id))},Q=t=>{T(t),U(!0)},W=()=>{h.reload({only:["units","statistics"]})},X=()=>{h.reload({only:["units","statistics"]})},Y=()=>{if(s.data.length===0){alert("No data to export");return}I(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;jt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{I(!1)}},Z=i.useCallback(t=>{c.setData("file",t),h.post(route("units.import"),{file:t,skip_duplicates:c.data.skip_duplicates,update_existing:c.data.update_existing},{forceFormData:!0,onSuccess:()=>{g(!1),c.reset(),b("success","CSV file imported successfully!")},onError:x=>{const u=x.file||"Failed to import CSV file. Please try again.";b("error",u)},onFinish:()=>{c.clearErrors()}})},[c,b]);return e.jsxs(nt,{children:[e.jsx(rt,{title:"Units"}),j&&e.jsx(ct,{type:j.type,message:j.message,onClose:M}),e.jsx(dt,{isOpen:F,onClose:()=>g(!1),onSubmit:Z,isLoading:c.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx($,{type:"success",message:y?.success}),y?.error&&e.jsx($,{type:"error",message:y?.error}),k&&p&&e.jsx(lt,{stats:p,onClose:()=>L(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:Y,disabled:P||s.data.length===0,className:"flex items-center",children:[e.jsx(gt,{className:"mr-2 h-4 w-4"}),P?"Exporting...":"Export CSV"]}),o("units.import")&&e.jsxs(w,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(St,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),l(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>D(!0),children:[e.jsx(Ct,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(st,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(ot,{children:e.jsx(ut,{filters:d,cities:n||[],properties:m||[],cityInput:R,propertyInput:V,onFilterChange:f,onCityInputChange:B,onCitySelect:H,onPropertyInputChange:z,onPropertySelect:q,onSearch:G,onClear:J})}),e.jsxs(it,{children:[e.jsx(ht,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:o("units.destroy"),onEdit:Q,onDelete:K}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(ft,{links:s.links,currentPage:s.current_page,lastPage:s.last_page}),e.jsxs("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total||0," units"]})]})]})]})}),e.jsx(mt,{open:A,onOpenChange:D,cities:n||[],properties:m||[],onSuccess:X}),v&&e.jsx(pt,{unit:v,cities:n||[],properties:m||[],open:O,onOpenChange:U,onSuccess:W})]})}export{pr as default};
