import{r as c,u as T,j as o,H as R,a as m}from"./app-BSOlzI_M.js";import{A as k}from"./app-layout-BU6wzt8Q.js";import{C as H,a as U,b as M}from"./card-lrH58jzJ.js";import{u as V}from"./usePermissions-DDr8nGFF.js";import B from"./PropertyCreateDrawer-BQ_DqjvE.js";import Q from"./PropertyEditDrawer-BPx-CUzg.js";import q from"./PropertyPageHeader-CuBNtWpP.js";import z from"./PropertyFilters-zTjaNOHW.js";import G from"./PropertyTable-CEcQQwUM.js";import J from"./PropertyEmptyState-BTYsCpnh.js";import K from"./FlashMessages-CVthyIm7.js";import W from"./PropertyPagination-BA2D_FEB.js";import"./app-D9zByHv3.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-D2rKFPK1.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./index-Dc_FVRD7.js";import"./index-CJ72cHre.js";import"./index-C4PIvpnm.js";import"./index-D4B3QgQ6.js";import"./collapsible-BeIaK3gz.js";import"./chevron-right-DU-yjHU5.js";import"./index-p7EaCzMM.js";import"./log-out-CU7fAD8S.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./app-logo-icon-Chz0QK53.js";import"./house-A7z-bt3N.js";import"./building-X8V0cPLX.js";import"./users-BZ-W0K9D.js";import"./wrench-AB0PbR3c.js";import"./credit-card-Dh1t_toN.js";import"./dollar-sign-CX6g00Px.js";import"./file-text-XuiuEW0Z.js";import"./triangle-alert-EDCPZCCy.js";import"./bell-CjUavl-i.js";import"./drawer-B6ZRXvIZ.js";import"./CitySelectionSection-Vh-w3uTu.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./command-CBR154ui.js";import"./search-BcNZ_u8M.js";import"./map-pin-57um3dcz.js";import"./check-BE4k6INO.js";import"./PropertySelectionSection-B2eXcpev.js";import"./alert-rYXkK_B5.js";import"./building-2-BzsejGVV.js";import"./circle-alert-CDOkMJ4H.js";import"./InsuranceCompanySection-DLdUDTi0.js";import"./input-DWv8_Yxn.js";import"./shield-CtVmy-S8.js";import"./AmountPolicySection-D33WWwVC.js";import"./DatesSection-DA9DPxaf.js";import"./calendar-CthI5zTo.js";import"./NotesSection-B39w3HFM.js";import"./textarea-VkyOez7F.js";import"./InsuranceCompanyField-CXrNleah.js";import"./AmountPolicyFields-Dj9sQtVG.js";import"./DateFields--yQiN70j.js";import"./NotesField-f8I_s37N.js";import"./download-DpLM-FVr.js";import"./plus-DpdyZws7.js";import"./table-D6Ykx5nO.js";import"./PropertyTableRow-CDZRBC2x.js";import"./PropertyStatusBadge-DdxCZkwz.js";import"./badge-Bc6JwGPl.js";import"./PropertyDaysLeftBadge-Dqy7Uab9.js";import"./eye-D6dEBVIw.js";import"./square-pen-BbbP7D49.js";import"./trash-2-CnyQPA5D.js";import"./pagination-gtbI_ymV.js";import"./chevron-left-CVo-4b8C.js";import"./select-Ckv1zRlQ.js";import"./index-C4dPa-2_.js";import"./chevron-down--Oeingn_.js";import"./chevron-up-RzjEL1k0.js";const X=(t,l="properties.csv")=>{const d=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],u=i=>{const h=new Date,x=new Date(i).getTime()-h.getTime();return Math.ceil(x/(1e3*60*60*24))},f=[d.join(","),...t.map(i=>[i.id,`"${i.property?.property_name||"N/A"}"`,`"${i.insurance_company_name}"`,`"${i.formatted_amount}"`,`"${i.effective_date}"`,`"${i.policy_number}"`,`"${i.expiration_date}"`,u(i.expiration_date),`"${i.status}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),r=URL.createObjectURL(g);p.setAttribute("href",r),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r)};function vt({properties:t,filters:l,cities:d=[],availableProperties:u=[]}){const{hasPermission:f,hasAnyPermission:g,hasAllPermissions:p}=V(),[r,i]=c.useState(l),[h,y]=c.useState(!1),[x,_]=c.useState(!1),[b,S]=c.useState(!1),[D,w]=c.useState(null),{flash:j}=T().props,n=l?.per_page??t.per_page,P=()=>{const e={};return t.current_page&&t.current_page>1&&(e.page=t.current_page.toString()),n&&(e.per_page=n.toString()),Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),e},E=()=>{const e={};return r.property_name&&(e.filter_property_name=String(r.property_name)),r.insurance_company_name&&(e.filter_insurance_company_name=String(r.insurance_company_name)),r.policy_number&&(e.filter_policy_number=String(r.policy_number)),typeof r.status<"u"&&r.status!==null&&(e.filter_status=String(r.status)),n&&(e.filter_per_page=String(n)),t.current_page&&t.current_page>1&&(e.filter_page=String(t.current_page)),e},C=(e,a)=>{const s={...r,[e]:a};i(s)},v=()=>{const e={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),n&&(e.per_page=n.toString()),m.get(route("properties-info.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{i({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};n&&(a.per_page=n.toString()),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},F=e=>{confirm("Are you sure you want to delete this property?")&&m.delete(route("properties-info.destroy",e.id),{data:E(),preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}y(!0);try{const e=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;X(t.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{y(!1)}},I=()=>{S(!1),m.get(route("properties-info.index"),P(),{preserveState:!0,preserveScroll:!0})},N=e=>{w(e),S(!0)},$=e=>{const a=P();delete a.page,a.per_page=e.toString(),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=e=>{const a=P();m.get(route("properties-info.show",e.id),a,{preserveState:!1})};return o.jsxs(k,{children:[o.jsx(R,{title:"Properties Insurance"}),o.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:o.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o.jsx(K,{success:j?.success,error:j?.error}),o.jsx(q,{onExport:O,onAddProperty:()=>_(!0),isExporting:h,hasExportData:t.data.length>0,canCreate:p(["properties.create","properties.store"])}),o.jsxs(H,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(U,{children:o.jsx(z,{filters:r,onFilterChange:C,onSearch:v,onClear:A})}),o.jsxs(M,{children:[o.jsx(G,{properties:t.data,onEdit:N,onDelete:F,onShow:L,canEdit:p(["properties.update","properties.edit"]),canDelete:f("properties.destroy"),canShow:f("properties.show"),hasAnyActionPermission:g(["properties.destroy","properties.update","properties.edit","properties.show"])}),t.data.length===0&&o.jsx(J,{}),t.data.length>0&&o.jsx(W,{paginatedData:t,currentPerPage:n||15,onPerPageChange:$})]})]})]})}),o.jsx(B,{open:x,onOpenChange:_,cities:d,availableProperties:u,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15}),D&&o.jsx(Q,{open:b,onOpenChange:S,property:D,availableProperties:u,onSuccess:I,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15,cities:d})]})}export{vt as default};
