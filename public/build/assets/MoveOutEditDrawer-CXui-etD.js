import{r as o,b as pe,j as e}from"./app-DVDXdM1j.js";import{B as N}from"./createLucideIcon-f9blZpYt.js";import{P as $,a as q,b as H,C as J,p as be}from"./popover-GGagVvOt.js";import{D as fe,a as je,b as ge}from"./drawer-xioPoqbP.js";import{I as D}from"./input-CAZvlv5n.js";import{L as d}from"./label-Bq1y09-X.js";import{S as E,a as V,b as R,c as M,d as T}from"./select-TGrDkT3T.js";import{T as Q}from"./textarea-BRRaEa3f.js";import{R as X}from"./radioGroup-Cj9qUiCJ.js";import{C as Z}from"./calendar-UWhjVqRM.js";import{f as h,i as v}from"./format-PYUiRpxY.js";import"./app-CjmCCaLt.js";import"./chevron-right-Jq5zNY5a.js";import"./chevron-up-BWfV-rK5.js";import"./index-DdPbNFmK.js";import"./index-r4aKh8Jv.js";import"./index-u4YCQuA6.js";import"./index-CgivZZgh.js";import"./index-B6MCHojI.js";import"./index-Bh7wV6bP.js";import"./index-CgpEdb5b.js";import"./index-DWj7wjkv.js";function Ke({cities:U,properties:B,propertiesByCityId:x,unitsByPropertyId:p,tenantsByUnitId:b,allUnits:L,tenantsData:O,moveOut:a,open:ie,onOpenChange:ee,onSuccess:de}){const y=o.useRef(null),k=o.useRef(null),C=o.useRef(null),S=o.useRef(null),[u,c]=o.useState({city:"",property:"",unit:"",tenant:""}),[I,te]=o.useState(null),[A,Y]=o.useState(null),[z,w]=o.useState(null),[se,f]=o.useState(null),[oe,G]=o.useState([]),[ce,P]=o.useState([]),[ae,j]=o.useState([]),[K,F]=o.useState({move_out_date:!1,date_lease_ending_on_buildium:!1,date_utility_put_under_our_name:!1}),_=t=>{if(!(!t||t.trim()===""))try{const s=be(t,"yyyy-MM-dd",new Date);if(v(s))return s;const n=new Date(t);return v(n)?n:void 0}catch(s){console.warn("Date parsing error:",s);return}},{data:r,setData:i,put:ue,processing:le,errors:l}=pe({tenant_id:a.tenant_id||null,move_out_date:a.move_out_date||"",lease_status:a.lease_status||"",date_lease_ending_on_buildium:a.date_lease_ending_on_buildium||"",keys_location:a.keys_location||"",utilities_under_our_name:a.utilities_under_our_name||"",date_utility_put_under_our_name:a.date_utility_put_under_our_name||"",walkthrough:a.walkthrough||"",repairs:a.repairs||"",send_back_security_deposit:a.send_back_security_deposit||"",notes:a.notes||"",cleaning:a.cleaning||"",list_the_unit:a.list_the_unit||"",move_out_form:a.move_out_form||""});o.useEffect(()=>{if(a&&L){const t=L.find(s=>s.unit_name===a.units_name);if(t){const s=U.find(g=>g.city===a.city_name),n=B.find(g=>g.property_name===a.property_name);s&&(te(s.id),x[s.id]&&G(x[s.id])),n&&(Y(n.id),p[n.id]&&P(p[n.id])),w(t.id),b[t.id]&&j(b[t.id]);const m=O.find(g=>g.full_name===a.tenants_name);m&&(f(m.id),i("tenant_id",m.id))}}},[a,L,U,B,x,p,b,O]);const me=t=>{const s=parseInt(t);te(s),Y(null),w(null),f(null),i("tenant_id",null),c(n=>({...n,city:"",property:"",unit:"",tenant:""})),s&&x[s]?G(x[s]):G([]),P([]),j([])},_e=t=>{const s=parseInt(t);Y(s),w(null),f(null),i("tenant_id",null),c(n=>({...n,property:"",unit:"",tenant:""})),s&&p[s]?P(p[s]):P([]),j([])},he=t=>{const s=parseInt(t);w(s),f(null),i("tenant_id",null),c(n=>({...n,unit:"",tenant:""})),s&&b[s]?j(b[s]):j([])},xe=t=>{const s=parseInt(t),n=ae.find(m=>m.id===s);n&&(f(s),i("tenant_id",n.id),c(m=>({...m,tenant:""})))},W=t=>{F(s=>({...s,[t]:!s[t]}))},ne=t=>{t.preventDefault(),c({city:"",property:"",unit:"",tenant:""});let s=!1;I||(c(n=>({...n,city:"Please select a city before submitting the form."})),y.current&&(y.current.focus(),y.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),A||(c(n=>({...n,property:"Please select a property before submitting the form."})),k.current&&(k.current.focus(),k.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),z||(c(n=>({...n,unit:"Please select a unit before submitting the form."})),C.current&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),(!se||!r.tenant_id)&&(c(n=>({...n,tenant:"Please select a tenant before submitting the form."})),S.current&&(S.current.focus(),S.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),!s&&ue(route("move-out.update",a.id),{onSuccess:()=>{re(),de?.()}})},re=()=>{i({tenant_id:a.tenant_id||null,move_out_date:a.move_out_date||"",lease_status:a.lease_status||"",date_lease_ending_on_buildium:a.date_lease_ending_on_buildium||"",keys_location:a.keys_location||"",utilities_under_our_name:a.utilities_under_our_name||"",date_utility_put_under_our_name:a.date_utility_put_under_our_name||"",walkthrough:a.walkthrough||"",repairs:a.repairs||"",send_back_security_deposit:a.send_back_security_deposit||"",notes:a.notes||"",cleaning:a.cleaning||"",list_the_unit:a.list_the_unit||"",move_out_form:a.move_out_form||""}),c({city:"",property:"",unit:"",tenant:""}),ee(!1)};return e.jsx(fe,{open:ie,onOpenChange:ee,modal:!1,children:e.jsx(je,{size:"half",title:"Edit Move-Out Record",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"city_name",className:"text-base font-semibold",children:"City *"})}),e.jsxs(E,{onValueChange:me,value:I?.toString()||"",children:[e.jsx(V,{ref:y,children:e.jsx(R,{placeholder:"Select city"})}),e.jsx(M,{children:U?.map(t=>e.jsx(T,{value:t.id.toString(),children:t.city},t.id))||[]})]}),u.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.city})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"property_name",className:"text-base font-semibold",children:"Property Name *"})}),e.jsxs(E,{onValueChange:_e,value:A?.toString()||"",disabled:!I,children:[e.jsx(V,{ref:k,children:e.jsx(R,{placeholder:"Select property"})}),e.jsx(M,{children:oe?.map(t=>e.jsx(T,{value:t.id.toString(),children:t.property_name},t.id))||[]})]}),u.property&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.property})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"units_name",className:"text-base font-semibold",children:"Unit Name *"})}),e.jsxs(E,{onValueChange:he,value:z?.toString()||"",disabled:!A,children:[e.jsx(V,{ref:C,children:e.jsx(R,{placeholder:"Select unit"})}),e.jsx(M,{children:ce?.map(t=>e.jsx(T,{value:t.id.toString(),children:t.unit_name},t.id))||[]})]}),u.unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.unit})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"tenants_name",className:"text-base font-semibold",children:"Tenant Name *"})}),e.jsxs(E,{onValueChange:xe,value:se?.toString()||"",disabled:!z,children:[e.jsx(V,{ref:S,children:e.jsx(R,{placeholder:"Select tenant"})}),e.jsx(M,{children:ae?.map(t=>e.jsx(T,{value:t.id.toString(),children:t.full_name},t.id))||[]})]}),u.tenant&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:u.tenant})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-red-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"move_out_date",className:"text-base font-semibold",children:"Move Out Date"})}),e.jsxs($,{open:K.move_out_date,onOpenChange:()=>W("move_out_date"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),r.move_out_date&&r.move_out_date.trim()!==""?(()=>{const t=_(r.move_out_date);return t?h(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(H,{className:"w-auto p-0",children:e.jsx(J,{mode:"single",selected:_(r.move_out_date),onSelect:t=>{t&&v(t)&&(i("move_out_date",h(t,"yyyy-MM-dd")),F(s=>({...s,move_out_date:!1})))},initialFocus:!0})})]}),l.move_out_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.move_out_date})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-yellow-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"lease_status",className:"text-base font-semibold",children:"Lease Status"})}),e.jsx(D,{id:"lease_status",value:r.lease_status,onChange:t=>i("lease_status",t.target.value),placeholder:"Enter lease status"}),l.lease_status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.lease_status})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"date_lease_ending_on_buildium",className:"text-base font-semibold",children:"Date Lease Ending on Buildium"})}),e.jsxs($,{open:K.date_lease_ending_on_buildium,onOpenChange:()=>W("date_lease_ending_on_buildium"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),r.date_lease_ending_on_buildium&&r.date_lease_ending_on_buildium.trim()!==""?(()=>{const t=_(r.date_lease_ending_on_buildium);return t?h(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(H,{className:"w-auto p-0",children:e.jsx(J,{mode:"single",selected:_(r.date_lease_ending_on_buildium),onSelect:t=>{t&&v(t)&&(i("date_lease_ending_on_buildium",h(t,"yyyy-MM-dd")),F(s=>({...s,date_lease_ending_on_buildium:!1})))},initialFocus:!0})})]}),l.date_lease_ending_on_buildium&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_lease_ending_on_buildium})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-cyan-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"keys_location",className:"text-base font-semibold",children:"Keys Location"})}),e.jsx(D,{id:"keys_location",value:r.keys_location,onChange:t=>i("keys_location",t.target.value),placeholder:"Enter keys location"}),l.keys_location&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.keys_location})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"utilities_under_our_name",className:"text-base font-semibold",children:"Utilities Under Our Name"})}),e.jsx(X,{value:r.utilities_under_our_name,onValueChange:t=>i("utilities_under_our_name",t),name:"utilities_under_our_name",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),l.utilities_under_our_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.utilities_under_our_name})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"date_utility_put_under_our_name",className:"text-base font-semibold",children:"Date Utility Put Under Our Name"})}),e.jsxs($,{open:K.date_utility_put_under_our_name,onOpenChange:()=>W("date_utility_put_under_our_name"),children:[e.jsx(q,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),r.date_utility_put_under_our_name&&r.date_utility_put_under_our_name.trim()!==""?(()=>{const t=_(r.date_utility_put_under_our_name);return t?h(t,"PPP"):"Pick a date"})():"Pick a date"]})}),e.jsx(H,{className:"w-auto p-0",children:e.jsx(J,{mode:"single",selected:_(r.date_utility_put_under_our_name),onSelect:t=>{t&&v(t)&&(i("date_utility_put_under_our_name",h(t,"yyyy-MM-dd")),F(s=>({...s,date_utility_put_under_our_name:!1})))},initialFocus:!0})})]}),l.date_utility_put_under_our_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date_utility_put_under_our_name})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"walkthrough",className:"text-base font-semibold",children:"Walkthrough"})}),e.jsx(Q,{id:"walkthrough",value:r.walkthrough,onChange:t=>i("walkthrough",t.target.value),placeholder:"Enter walkthrough details",className:"min-h-[100px]"}),l.walkthrough&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.walkthrough})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-lime-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"repairs",className:"text-base font-semibold",children:"Repairs"})}),e.jsx(Q,{id:"repairs",value:r.repairs,onChange:t=>i("repairs",t.target.value),placeholder:"Enter repair details",className:"min-h-[80px]"}),l.repairs&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.repairs})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-amber-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"send_back_security_deposit",className:"text-base font-semibold",children:"Send Back Security Deposit"})}),e.jsx(D,{id:"send_back_security_deposit",value:r.send_back_security_deposit,onChange:t=>i("send_back_security_deposit",t.target.value),placeholder:"Enter security deposit details"}),l.send_back_security_deposit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.send_back_security_deposit})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-slate-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx(Q,{id:"notes",value:r.notes,onChange:t=>i("notes",t.target.value),placeholder:"Enter additional notes",className:"min-h-[100px]"}),l.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notes})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-violet-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"cleaning",className:"text-base font-semibold",children:"Cleaning"})}),e.jsx(X,{value:r.cleaning,onValueChange:t=>i("cleaning",t),name:"cleaning",options:[{value:"cleaned",label:"Cleaned"},{value:"uncleaned",label:"Uncleaned"}]}),l.cleaning&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.cleaning})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-rose-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"list_the_unit",className:"text-base font-semibold",children:"List the Unit"})}),e.jsx(D,{id:"list_the_unit",value:r.list_the_unit,onChange:t=>i("list_the_unit",t.target.value),placeholder:"Enter unit listing details"}),l.list_the_unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.list_the_unit})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-fuchsia-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(d,{htmlFor:"move_out_form",className:"text-base font-semibold",children:"Move Out Form"})}),e.jsx(X,{value:r.move_out_form,onValueChange:t=>i("move_out_form",t),name:"move_out_form",options:[{value:"filled",label:"Filled"},{value:"not filled",label:"Not Filled"}]}),l.move_out_form&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.move_out_form})]})]})}),e.jsx(ge,{children:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx(N,{type:"button",variant:"outline",onClick:re,className:"flex-1",children:"Cancel"}),e.jsx(N,{type:"submit",onClick:ne,disabled:le,className:"flex-1",children:le?"Updating...":"Update Move-Out Record"})]})})]})})})}export{Ke as default};
