import{r as n,b as me,j as e}from"./app-Dn1r5IbR.js";import{B as $}from"./button-DoJlCKhy.js";import{P as ue,a as xe,b as pe,C as he,p as fe}from"./popover-CuJpm8qA.js";import{D as je,a as be,b as ve}from"./drawer-BbQvx4Pm.js";import{I as X}from"./input-DJHjvjS7.js";import{T as Ne}from"./textarea-9P0dwNYy.js";import{L as m}from"./label-CyLYjr_a.js";import{S as w,a as D,b as T,c as V,d as R}from"./select-BPfsX62k.js";import{C as ge}from"./circle-alert-tTPA0evf.js";import{C as Se}from"./calendar-Xujg-VPa.js";import{i as Ce,f as Y}from"./format-PYUiRpxY.js";import"./app-BmbQfT0_.js";import"./index-DF1-xgR-.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-ezkluWMI.js";import"./chevron-right-BXKQFlIK.js";import"./chevron-down-Bfpn-qjr.js";import"./index-cId8iuZu.js";import"./index-C5yiDUFi.js";import"./index-CGaG4LkD.js";import"./index-BHn9DcD9.js";import"./index-WPnjh8bd.js";import"./index-IWqIVFcu.js";import"./index-q0Alrdsu.js";import"./index-C_Yr3VBI.js";import"./index-Dc_FVRD7.js";import"./index-qhuad6ry.js";import"./index-BV3nWfAJ.js";import"./x-BwrjvaMS.js";import"./index-rczzAiLR.js";import"./index-h5kqUyi-.js";import"./index-C0T19-Xq.js";import"./check-CZby3Z4H.js";import"./chevron-up-CyiongBQ.js";function rt({cities:A,properties:L,propertiesByCityId:h,unitsByPropertyId:f,tenantsByUnitId:j,allUnits:E,tenantsData:U,paymentPlan:r,open:Z,onOpenChange:z,onSuccess:B}){const[k,O]=n.useState(null),[P,g]=n.useState(null),[M,b]=n.useState(null),[q,x]=n.useState(null),[ee,S]=n.useState([]),[te,v]=n.useState([]),[G,p]=n.useState([]),[c,o]=n.useState({city:"",property:"",unit:"",tenant:""}),[se,I]=n.useState(!1),[H]=n.useState(r.paid),C=n.useRef(null),y=n.useRef(null),_=n.useRef(null),F=n.useRef(null),{data:l,setData:i,put:ae,processing:J,errors:d}=me({tenant_id:r.tenant_id,amount:r.amount,dates:r.dates,paid:r.paid,notes:r.notes||""}),K=t=>{if(!t||t.trim()==="")return null;try{const s=fe(t,"yyyy-MM-dd",new Date);return Ce(s)?s:null}catch(s){return console.warn("Failed to parse date:",t,s),null}},re=t=>{const s=K(t);return s?Y(s,"PPP"):"Pick a date"};n.useEffect(()=>{if(r&&E){const t=E.find(s=>s.unit_name===r.unit);if(t){const s=A.find(N=>N.city===r.city_name),a=L.find(N=>N.property_name===r.property);s&&(O(s.id),h[s.id]&&S(h[s.id])),a&&(g(a.id),f[a.id]&&v(f[a.id])),b(t.id),j[t.id]&&p(j[t.id]);const u=U.find(N=>N.full_name===r.tenant);u&&(x(u.id),i("tenant_id",u.id))}}},[r,E,A,L,h,f,j,U]);const ne=t=>{const s=parseInt(t);O(s),g(null),b(null),x(null),i("tenant_id",null),o(a=>({...a,city:"",property:"",unit:"",tenant:""})),s&&h[s]?S(h[s]):S([]),v([]),p([])},le=t=>{const s=parseInt(t);g(s),b(null),x(null),i("tenant_id",null),o(a=>({...a,property:"",unit:"",tenant:""})),s&&f[s]?v(f[s]):v([]),p([])},ie=t=>{const s=parseInt(t);b(s),x(null),i("tenant_id",null),o(a=>({...a,unit:"",tenant:""})),s&&j[s]?p(j[s]):p([])},oe=t=>{const s=parseInt(t),a=G.find(u=>u.id===s);a&&(x(s),i("tenant_id",a.id),o(u=>({...u,tenant:""})))},de=t=>{t&&(i("dates",Y(t,"yyyy-MM-dd")),I(!1))},Q=t=>{t.preventDefault(),o({city:"",property:"",unit:"",tenant:""});let s=!1;k||(o(a=>({...a,city:"Please select a city before submitting the form."})),C.current&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),P||(o(a=>({...a,property:"Please select a property before submitting the form."})),y.current&&(y.current.focus(),y.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),M||(o(a=>({...a,unit:"Please select a unit before submitting the form."})),_.current&&(_.current.focus(),_.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),(!q||!l.tenant_id)&&(o(a=>({...a,tenant:"Please select a tenant before submitting the form."})),F.current&&(F.current.focus(),F.current.scrollIntoView({behavior:"smooth",block:"center"})),s=!0),!s&&ae(route("payment-plans.update",r.id),{onSuccess:()=>{W(),B?.()}})},W=()=>{i({tenant_id:r.tenant_id,amount:r.amount,dates:r.dates,paid:r.paid,notes:r.notes||""}),O(null),g(null),b(null),x(null),S([]),v([]),p([]),o({city:"",property:"",unit:"",tenant:""}),I(!1),z(!1)},ce=t=>{const s=parseFloat(t.target.value)||0;i("amount",s),l.paid>s&&i("paid",s)};return e.jsx(je,{open:Z,onOpenChange:z,modal:!1,children:e.jsx(be,{size:"half",title:"Edit Payment Plan",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-muted bg-muted/20 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Original Payment Plan"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tenant:"})," ",r.tenant]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Property:"})," ",r.property]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit:"})," ",r.unit]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"City:"})," ",r.city_name]})]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(w,{onValueChange:ne,value:k?.toString()||"",children:[e.jsx(D,{ref:C,children:e.jsx(T,{placeholder:"Select city"})}),e.jsx(V,{children:A.map(t=>e.jsx(R,{value:t.id.toString(),children:t.city},t.id))})]}),c.city&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.city})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"property",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(w,{onValueChange:le,value:P?.toString()||"",disabled:!k,children:[e.jsx(D,{ref:y,children:e.jsx(T,{placeholder:"Select property"})}),e.jsx(V,{children:ee.map(t=>e.jsx(R,{value:t.id.toString(),children:t.property_name},t.id))})]}),c.property&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.property})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"unit",className:"text-base font-semibold",children:"Unit *"})}),e.jsxs(w,{onValueChange:ie,value:M?.toString()||"",disabled:!P,children:[e.jsx(D,{ref:_,children:e.jsx(T,{placeholder:"Select unit"})}),e.jsx(V,{children:te.map(t=>e.jsx(R,{value:t.id.toString(),children:t.unit_name},t.id))})]}),c.unit&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.unit})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"tenant",className:"text-base font-semibold",children:"Tenant *"})}),e.jsxs(w,{onValueChange:oe,value:q?.toString()||"",disabled:!M,children:[e.jsx(D,{ref:F,children:e.jsx(T,{placeholder:"Select tenant"})}),e.jsx(V,{children:G.map(t=>e.jsx(R,{value:t.id.toString(),children:t.full_name},t.id))})]}),d.tenant_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.tenant_id}),c.tenant&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.tenant})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-red-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"dates",className:"text-base font-semibold",children:"Payment Date *"})}),e.jsxs(ue,{open:se,onOpenChange:I,modal:!1,children:[e.jsx(xe,{asChild:!0,children:e.jsxs($,{variant:"outline",className:`w-full justify-start text-left font-normal ${!l.dates&&"text-muted-foreground"}`,children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),re(l.dates)]})}),e.jsx(pe,{className:"w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(he,{mode:"single",selected:K(l.dates)||void 0,onSelect:de,initialFocus:!0})})]}),d.dates&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.dates})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"amount",className:"text-base font-semibold",children:"Total Amount *"})}),e.jsx(X,{id:"amount",type:"number",step:"0.01",min:H,value:l.amount||"",onChange:ce,placeholder:"0.00"}),d.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.amount}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Minimum amount: $",Number(H||0).toFixed(2)," (already paid)"]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"paid",className:"text-base font-semibold",children:"Paid Amount"})}),e.jsx(X,{id:"paid",type:"number",step:"0.01",min:"0",max:l.amount||void 0,value:l.paid||"",onChange:t=>{const s=parseFloat(t.target.value)||0,a=Math.min(s,l.amount||0);i("paid",a)},placeholder:"0.00"}),d.paid&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.paid}),l.amount>0&&e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Remaining: $",((l.amount||0)-(l.paid||0)).toFixed(2)]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-slate-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(m,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx(Ne,{id:"notes",value:l.notes||"",onChange:t=>i("notes",t.target.value),rows:3,placeholder:"Enter any additional notes...",maxLength:1e3}),d.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.notes}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:[(l.notes||"").length,"/1000 characters"]})]})]})}),e.jsx(ve,{children:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx($,{type:"button",variant:"outline",onClick:W,className:"flex-1",children:"Cancel"}),e.jsx($,{type:"submit",onClick:Q,disabled:J,className:"flex-1",children:J?"Updating...":"Update Payment Plan"})]})})]})})})}export{rt as default};
