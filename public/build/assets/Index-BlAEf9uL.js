import{r as a,u as R,b as V,a as u,j as e,H as q}from"./app-DfhMz46N.js";import{C as B,a as z,b as G}from"./card-DnYtlxUS.js";import{u as J}from"./usePermissions-CxLN4YG6.js";import{A as K}from"./app-layout-CkBdeP0R.js";import Q from"./TenantCreateDrawer-Dw8d4UHw.js";import W from"./TenantEditDrawer-BJeAVYKU.js";import{FlashMessages as X}from"./FlashMessages-CF6Ptkri.js";import{ImportModal as Y}from"./ImportModal-LUVeMtQ3.js";import{ImportStatsCard as Z}from"./ImportStatsCard-mV09KKhr.js";import{Notification as ee}from"./Notification-VlonesfU.js";import{TenantFilters as te}from"./TenantFilters-BvGdbvIc.js";import{TenantPageHeader as re}from"./TenantPageHeader-B26KRXkW.js";import{TenantTable as oe}from"./TenantTable-D1srQ03x.js";import{useNotification as se}from"./useNotification-CqyLVrhV.js";import"./app-B7C1jyr3.js";import"./utils-CBfrqCZ4.js";import"./index-DCi-Xv1e.js";import"./index-CdJFUDDL.js";import"./button-D70ZdTAE.js";import"./index-BQKCx-PJ.js";import"./index-CBYZjZBF.js";import"./index-Be_qgOKl.js";import"./index-Bd9tPrb_.js";import"./index-DV6UInPh.js";import"./index-BTxfuEuk.js";import"./x-DZ3FO5Wj.js";import"./createLucideIcon-DgVEEFYv.js";import"./index-Dc_FVRD7.js";import"./index-Ct5EcCoK.js";import"./index-CubYnoId.js";import"./index-DLswfCi4.js";import"./collapsible-CxKi9m-H.js";import"./chevron-right-BW9owo_I.js";import"./index-PkKgVJHn.js";import"./log-out-wHczke_X.js";import"./chevrons-up-down-JgGBqF6F.js";import"./app-logo-icon-5xx7lIbL.js";import"./house-C6-1wI8m.js";import"./building-Dgb3xTR3.js";import"./users-ejwhL9u9.js";import"./wrench-BBDdmO44.js";import"./credit-card-muz8icID.js";import"./dollar-sign-CLLUuUfb.js";import"./file-text-jifTgd3g.js";import"./triangle-alert-DYFGciiD.js";import"./bell-C7uwicu3.js";import"./drawer-DfcxSr7r.js";import"./CitySelectionSection-4qe4cVTm.js";import"./label-DcH_3_W8.js";import"./select-CjXVIajk.js";import"./index-DbgZyH5A.js";import"./chevron-down-VWfm6OW2.js";import"./check-CordmqsZ.js";import"./chevron-up-dLBEGKat.js";import"./PropertySelectionSection-CuylXpqT.js";import"./UnitSelectionSection-CYm0qXY0.js";import"./PersonalInformationSection-DHl9aYNt.js";import"./FormField-B-rnDBvT.js";import"./input-BxpY_ptm.js";import"./ContactInformationSection-D0fQRqnq.js";import"./PaymentAndPreferencesSection-_wbpSR8V.js";import"./RadioGroupField-SD_iSw8i.js";import"./radioGroup-D6vUyOHk.js";import"./AssistanceSection-CmvUf3Ty.js";import"./LocationSection-DHFSLgeE.js";import"./PersonalInfoSection-D6hP9uWn.js";import"./ContactInfoSection-CFY6o4rF.js";import"./PreferencesSection-BZyJLBBL.js";import"./AssistanceSection-D8BzgQNj.js";import"./file-spreadsheet-BMLvGVWN.js";import"./upload-CvdiTnKd.js";import"./loader-circle-DI3wdvg7.js";import"./circle-check-big-j4XPXzuB.js";import"./circle-alert-u84mWAtk.js";import"./circle-x-R3mfJh4j.js";import"./search-DDQcn7AF.js";import"./rotate-ccw-HK7Nv64A.js";import"./download-Dlz0wQ4J.js";import"./plus-CSmAj_IW.js";import"./badge-CLj8v7wz.js";import"./table-Cv3zQ3q1.js";import"./square-pen-k3KPWcNg.js";import"./trash-2-CEOusBqN.js";const ie=(o,n="tenants.csv")=>{const m=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...o.map(t=>[t.id,`"${t.city_name||""}"`,`"${t.property_name||""}"`,`"${t.unit_number||""}"`,`"${t.first_name||""}"`,`"${t.last_name||""}"`,`"${(t.street_address_line||"").replace(/"/g,'""')}"`,`"${t.login_email||""}"`,`"${t.alternate_email||""}"`,`"${t.mobile||""}"`,`"${t.emergency_phone||""}"`,`"${t.cash_or_check||""}"`,`"${t.has_insurance||""}"`,`"${t.sensitive_communication||""}"`,`"${t.has_assistance||""}"`,`"${t.assistance_amount||""}"`,`"${(t.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),d=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),c=URL.createObjectURL(d);s.setAttribute("href",c),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};function kt({tenants:o,search:n,cities:l,properties:m,unitsByProperty:d,importStats:s}){const{hasPermission:c,hasAnyPermission:t,hasAllPermissions:g}=J(),[E,y]=a.useState(!1),[N,h]=a.useState(!1),[v,$]=a.useState(!!s),[A,S]=a.useState(!1),[T,j]=a.useState(!1),[b,f]=a.useState(null),{flash:w}=R().props,{notification:x,showNotification:i,hideNotification:D}=se(),p=V({file:null,skip_duplicates:!1}),I=r=>{u.get(route("tenants.index"),{search:r.search,city:r.city,property:r.property,unit_name:r.unitName},{preserveState:!0})},F=()=>{u.get(route("tenants.index"),{},{preserveState:!1,replace:!0})},P=r=>{confirm(`Are you sure you want to archive ${r.first_name} ${r.last_name}? This will hide them from the main list but they can be restored later.`)&&u.patch(route("tenants.archive",r.id),{},{onSuccess:()=>{i("success","Tenant archived successfully!")},onError:()=>{i("error","Failed to archive tenant. Please try again.")}})},k=r=>{f(r),j(!0)},L=()=>{i("success","Tenant updated successfully!"),f(null)},M=()=>{if(o.length===0){alert("No data to export");return}y(!0);try{const r=`tenants-${new Date().toISOString().split("T")[0]}.csv`;ie(o,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},H=a.useCallback((r,C)=>{p.setData({file:r,skip_duplicates:C}),u.post(route("tenants.import.process"),{file:r,skip_duplicates:C},{forceFormData:!0,onSuccess:()=>{h(!1),p.reset(),i("success","CSV file imported successfully!")},onError:_=>{const U=_.file||_.import||"Failed to import CSV file. Please try again.";i("error",U)},onFinish:()=>{p.clearErrors()}})},[p,i]),O=Array.from(new Set(o.map(r=>r.unit_number).filter(Boolean)));return e.jsxs(K,{children:[e.jsx(q,{title:"Tenants"}),x&&e.jsx(ee,{type:x.type,message:x.message,onClose:D}),e.jsx(Y,{isOpen:N,onClose:()=>h(!1),onSubmit:H,isLoading:p.processing}),e.jsx(Q,{open:A,onOpenChange:()=>S(!1),cities:l,properties:m,unitsByProperty:d,onSuccess:()=>i("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(X,{success:w?.success,error:w?.error}),v&&s&&e.jsx(Z,{stats:s,onClose:()=>$(!1)}),e.jsx(re,{onExport:M,onImport:()=>h(!0),onAddNew:()=>S(!0),isExporting:E,hasExportData:o.length>0,canImport:c("tenants.import"),canCreate:g(["tenants.create","tenants.store"])}),e.jsxs(B,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(te,{cities:l,properties:m,uniqueUnitNames:O,onSearch:I,onClear:F,initialFilters:{city:"",property:"",unitName:"",search:n||""}})}),e.jsxs(G,{className:"p-6",children:[e.jsx(oe,{tenants:o,onEdit:k,onDelete:P,canEdit:g(["tenants.edit","tenants.update"]),canDelete:c("tenants.destroy"),showActions:t(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),o.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length," tenant",o.length!==1?"s":"",n&&` matching "${n}"`]})})]})]})]})}),b&&e.jsx(W,{open:T,onOpenChange:()=>{j(!1),f(null)},tenant:b,cities:l,properties:m,unitsByProperty:d,onSuccess:L})]})}export{kt as default};
