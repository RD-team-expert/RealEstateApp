import{r as p,j as i,H as O,a as u}from"./app-BBH7zvDr.js";import{C as P,b as k}from"./card-nXNWfAGy.js";import{u as N}from"./usePermissions-9xbEqhTW.js";import{A as L}from"./app-layout-Dyrs0MhC.js";import U from"./MoveInCreateDrawer-DrG2Q9D-.js";import T from"./MoveInEditDrawer-D8L89nnX.js";import R from"./PageHeader-Dacwb8ji.js";import H from"./MoveInFilters-BQuMo0Nw.js";import V from"./MoveInTable-PpGr8cgR.js";import K from"./EmptyState-GUN4usak.js";import Z from"./PaginationInfo-BFLFUIA5.js";import"./app-B1OP9MFD.js";import"./utils-CBfrqCZ4.js";import"./index-B4JvrASg.js";import"./index-CdJFUDDL.js";import"./button-kQLvnJYc.js";import"./index-CKW8D5J0.js";import"./index-BWJ0fZlj.js";import"./index-df1YLpcl.js";import"./index-wsGo_tiU.js";import"./index-LvlgiWdi.js";import"./index-D7NAAONM.js";import"./x-CW_SbUiO.js";import"./createLucideIcon-7kSuh4z9.js";import"./index-Dc_FVRD7.js";import"./index-CnOa-MOf.js";import"./index-5ce13En_.js";import"./index-D69JG4aD.js";import"./collapsible-BKCek11j.js";import"./chevron-right-pfan_4Jt.js";import"./index-Uin3X5ek.js";import"./log-out-BzPI9mBJ.js";import"./chevrons-up-down-CfF2yZbR.js";import"./app-logo-icon-CAoiBjM8.js";import"./house-TZOfA7LO.js";import"./building-DsEtYnfD.js";import"./users-BLlpWDgX.js";import"./wrench-CT0OfqLx.js";import"./credit-card-CH7bmEPL.js";import"./dollar-sign-BHC8XRqH.js";import"./file-text-BtoeH6mv.js";import"./triangle-alert-BiELoiYx.js";import"./bell-BaWZy_Rc.js";import"./drawer-vn5In2pd.js";import"./CityPropertyUnitSelector-CQL5O4tV.js";import"./label-DwnzeD4h.js";import"./select-IIwc6umI.js";import"./index-SVWUaHiW.js";import"./chevron-down-DZk5AEb3.js";import"./check-Xlj0_DVN.js";import"./chevron-up-eAQBr70u.js";import"./LeaseInformationFields-BgED1tuZ.js";import"./radioGroup-HWuSDrOX.js";import"./DatePickerField-CblA97_m.js";import"./calendar-FSzcnI0c.js";import"./format-PYUiRpxY.js";import"./chevron-left-BaC6T1ID.js";import"./popover-BEQRNvy0.js";import"./calendar-BfOPHJgp.js";import"./PaymentInformationFields-cgjYaabU.js";import"./KeysAndFormsFields-DRXLJNDi.js";import"./InsuranceInformationFields-BUqsqDwa.js";import"./CitySelector-QW_4m2hE.js";import"./FormSection-DkmE6a5m.js";import"./PropertySelector-Dfunt9mr.js";import"./UnitSelector-DXiSHleP.js";import"./LeaseSigningSection-Fkd89yNQ.js";import"./RadioGroupField-CY_54Pgc.js";import"./DatePickerField-Wf6P-L0C.js";import"./MoveInDetailsSection-B-gEmYMF.js";import"./PaymentSection-DseDgM37.js";import"./KeysAndFormsSection-D2Zm4bCO.js";import"./InsuranceSection-o3vwM-0G.js";import"./download-BISvIJJV.js";import"./plus-Dr8pi5nE.js";import"./input-BCr8ZI70.js";import"./search-Bh1y_imo.js";import"./table-D8H1Mca3.js";import"./MoveInTableRow-DSzZFebh.js";import"./badge-_xk2rKPu.js";import"./square-pen-ByTUf2-8.js";import"./trash-2-Dnt6KKQ0.js";const q=(o,c="move-ins.csv")=>{try{const e=t=>{if(!t)return"";try{const s=new Date(t);return isNaN(s.getTime())?"":new Intl.DateTimeFormat(void 0,{year:"numeric",month:"numeric",day:"numeric",timeZone:"UTC"}).format(s)}catch{return t||""}},a=t=>t==null?"":String(t).replace(/"/g,'""'),d=[["ID","City","Property Name","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...o.map(t=>{try{return[t.id||"",`"${a(t.city_name)}"`,`"${a(t.property_name)}"`,`"${a(t.unit_name)}"`,`"${a(t.signed_lease)}"`,`"${e(t.lease_signing_date)}"`,`"${e(t.move_in_date)}"`,`"${a(t.paid_security_deposit_first_month_rent)}"`,`"${e(t.scheduled_paid_time)}"`,`"${a(t.handled_keys)}"`,`"${e(t.move_in_form_sent_date)}"`,`"${a(t.filled_move_in_form)}"`,`"${e(t.date_of_move_in_form_filled)}"`,`"${a(t.submitted_insurance)}"`,`"${e(t.date_of_insurance_expiration)}"`].join(",")}catch(s){return console.error("Error processing move-in row:",t,s),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([d],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),l=URL.createObjectURL(f);return n.setAttribute("href",l),n.setAttribute("download",c),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function _r({moveIns:o,search:c,filters:e,units:a,cities:h,properties:d,unitsByProperty:f}){const[n,l]=p.useState(!1),[t,s]=p.useState(!1),[v,S]=p.useState(!1),[E,D]=p.useState(null),[y,g]=p.useState({city:e?.city||"",property:e?.property||"",search:e?.search||c||""});p.useEffect(()=>{g({city:e?.city||"",property:e?.property||"",search:e?.search||c||""})},[e,c]);const{hasPermission:_,hasAnyPermission:j}=N(),C=r=>{g(r);const m={};r.search?.trim()&&(m.search=r.search.trim()),r.city?.trim()&&(m.city=r.city.trim()),r.property?.trim()&&(m.property=r.property.trim()),u.get(route("move-in.index"),m,{preserveState:!0,preserveScroll:!0})},b=()=>{g({city:"",property:"",search:""}),u.get(route("move-in.index"),{},{preserveState:!0,preserveScroll:!0})},w=r=>{confirm("Are you sure you want to delete this move-in record?")&&u.delete(route("move-in.destroy",r.id))},$=()=>{if(!o||!o.data||o.data.length===0){alert("No data to export");return}l(!0);try{console.log("Exporting move-in data:",o.data);const r=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;q(o.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r);const m=r instanceof Error?r.message:"Unknown error";alert(`Export failed: ${m}. Please check the console for details.`)}finally{l(!1)}},M=()=>{u.reload()},A=()=>{u.reload()},F=r=>{D(r),S(!0)},x=y.search||y.city||y.property;return i.jsxs(L,{children:[i.jsx(O,{title:"Move-In Management"}),i.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:i.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[i.jsx(R,{hasActiveFilters:!!x,isExporting:n,hasData:o?.data&&o.data.length>0,hasCreatePermission:_("move-in.store"),onExport:$,onCreateClick:()=>s(!0)}),i.jsxs(P,{className:"bg-card text-card-foreground shadow-lg",children:[i.jsx(H,{cities:h,properties:d,initialFilters:y,onSearch:C,onClear:b,hasActiveFilters:!!x}),i.jsxs(k,{children:[i.jsx(V,{moveIns:o.data,canEdit:_("move-in.update"),canDelete:_("move-in.destroy"),showActions:j(["move-in.show","move-in.edit","move-in.update","move-in.destroy"]),onEdit:F,onDelete:w}),o.data.length===0&&i.jsx(K,{hasActiveFilters:!!x}),o.meta&&i.jsx(Z,{from:o.meta.from,to:o.meta.to,total:o.meta.total,hasActiveFilters:!!x})]})]})]})}),i.jsx(U,{units:a,cities:h,properties:d,unitsByProperty:f,open:t,onOpenChange:s,onSuccess:M}),E&&i.jsx(T,{moveIn:E,units:a,cities:h,properties:d,unitsByProperty:f,open:v,onOpenChange:S,onSuccess:A})]})}export{_r as default};
