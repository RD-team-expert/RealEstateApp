import{r as i,b as me,j as e}from"./app-BkyZySAt.js";import{B as F}from"./button-DOkiOPMq.js";import{P as ue,a as pe,p as K,b as he,C as fe}from"./popover-D_YIvH1C.js";import{D as xe,a as be,b as ve}from"./drawer-BQHCt03g.js";import{I as R}from"./input-nS05NghJ.js";import{L as c}from"./label-BCoYkVMj.js";import{R as je}from"./radioGroup-DeV4OTT4.js";import{S as I,a as U,b as k,c as M,d as O}from"./select-RK3poDcU.js";import{C as ge}from"./calendar-5wwCpl_0.js";import{f as Q,i as W}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-D3eUMA-Y.js";import"./chevron-right-Dq99BrXh.js";import"./chevron-down-BKwinLVR.js";import"./index-D86DOQfL.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-Zsm6T9Ra.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-DBw3aPE3.js";import"./index-DzIcFn8W.js";import"./x-B9Nlqjs5.js";import"./index-DvetPajZ.js";import"./index-DsMWzC3p.js";import"./index-DEy3YO5y.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";function et({payment:s,units:A,cities:X,unitsByCity:Z,propertiesByCity:ee,open:y,onOpenChange:w,onSuccess:te}){const b=i.useRef(null),v=i.useRef(null),j=i.useRef(null),g=i.useRef(null),N=i.useRef(null),[$,z]=i.useState(""),[B,_]=i.useState(""),[L,u]=i.useState(""),[T,S]=i.useState(""),[Y,C]=i.useState(""),[re,P]=i.useState(!1),[a,E]=i.useState(""),[d,p]=i.useState(""),[h,m]=i.useState(""),{data:n,setData:l,put:se,processing:V,errors:o}=me({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No"});i.useEffect(()=>{s&&y&&(l({date:s.date??"",unit_id:s.unit_id?.toString()??"",owes:s.owes?.toString()??"",paid:s.paid?.toString()??"",status:s.status??"",notes:s.notes??"",reversed_payments:s.reversed_payments??"",permanent:s.permanent??"No"}),E(s.city??""),p(s.property_name??""),m(s.unit_name??""),f())},[s,y]);const f=()=>{z(""),_(""),u(""),S(""),C("")},G=()=>a?ee[a]||[]:[],q=()=>a?d?A.filter(t=>t.city===a&&t.property_name===d).map(t=>t.unit_name):Z[a]||[]:[],ae=(t,r,x)=>{const J=A.find(D=>D.city===t&&D.property_name===r&&D.unit_name===x);return J?J.id:null};i.useEffect(()=>{a&&d&&(G().includes(d)||(p(""),m(""),l(r=>({...r,unit_id:""}))))},[a]),i.useEffect(()=>{d&&h&&(q().includes(h)||(m(""),l(r=>({...r,unit_id:""}))))},[a,d]);const ie=t=>{E(t),p(""),m(""),l(r=>({...r,unit_id:""})),f()},ne=t=>{p(t),m(""),l(r=>({...r,unit_id:""})),_(""),u("")},oe=t=>{if(m(t),u(""),a&&d&&t){const r=ae(a,d,t);r&&l(x=>({...x,unit_id:r.toString()}))}},le=t=>{t&&(l(r=>({...r,date:Q(t,"yyyy-MM-dd")})),S(""),P(!1))},de=t=>{l(r=>({...r,owes:t.target.value})),C("")},H=t=>{t.preventDefault(),f();let r=!1;(!n.date||n.date.trim()==="")&&(S("Please select a date before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!a||a.trim()==="")&&(z("Please select a city before submitting the form."),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!d||d.trim()==="")&&(_("Please select a property before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!h||h.trim()==="")&&(u("Please select a unit before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!n.owes||n.owes.trim()==="")&&(C("Please enter the amount owed before submitting the form."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!n.unit_id||n.unit_id.trim()==="")&&(u("Unable to identify the selected unit. Please try selecting again."),r=!0),!r&&se(route("payments.update",s.id),{onSuccess:()=>{f(),w(!1),te?.()},onError:x=>{console.error("Form submission errors:",x)}})},ce=()=>{s&&(l({date:s.date??"",unit_id:s.unit_id?.toString()??"",owes:s.owes?.toString()??"",paid:s.paid?.toString()??"",status:s.status??"",notes:s.notes??"",reversed_payments:s.reversed_payments??"",permanent:s.permanent??"No"}),E(s.city??""),p(s.property_name??""),m(s.unit_name??"")),f(),P(!1),w(!1)};return e.jsx(xe,{open:y,onOpenChange:w,modal:!1,children:e.jsx(be,{size:"half",title:`Edit Payment #${s.id}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(I,{onValueChange:ie,value:a||void 0,children:[e.jsx(U,{ref:b,children:e.jsx(k,{placeholder:"Select city"})}),e.jsx(M,{children:X?.map(t=>e.jsx(O,{value:t,children:t},t))||[]})]}),o.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.unit_id}),$&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:$})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"property_name",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(I,{onValueChange:ne,value:d||void 0,disabled:!a,children:[e.jsx(U,{ref:v,children:e.jsx(k,{placeholder:a?"Select property":"Select city first"})}),e.jsx(M,{children:G().map(t=>e.jsx(O,{value:t,children:t},t))})]}),B&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:B})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"unit_name",className:"text-base font-semibold",children:"Unit Name *"})}),e.jsxs(I,{onValueChange:oe,value:h||void 0,disabled:!a,children:[e.jsx(U,{ref:j,children:e.jsx(k,{placeholder:a?"Select unit":"Select city first"})}),e.jsx(M,{children:q().map(t=>e.jsx(O,{value:t,children:t},t))})]}),L&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:L})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"date",className:"text-base font-semibold",children:"Date *"})}),e.jsxs(ue,{open:re,onOpenChange:P,modal:!1,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(F,{ref:g,variant:"outline",className:`w-full justify-start text-left font-normal ${!n.date&&"text-muted-foreground"}`,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),n.date?(()=>{try{const t=K(n.date,"yyyy-MM-dd",new Date);return W(t)?Q(t,"PPP"):"Invalid date"}catch{return"Invalid date"}})():"Pick a date"]})}),e.jsx(he,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(fe,{mode:"single",selected:(()=>{try{if(!n.date)return;const t=K(n.date,"yyyy-MM-dd",new Date);return W(t)?t:void 0}catch{return}})(),onSelect:le,initialFocus:!0})})]}),o.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.date}),T&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"owes",className:"text-base font-semibold",children:"Owes *"})}),e.jsx(R,{ref:N,id:"owes",type:"number",step:"0.01",min:"0",value:n.owes,onChange:de,placeholder:"Enter amount owed"}),o.owes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.owes}),Y&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Y})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"paid",className:"text-base font-semibold",children:"Paid"})}),e.jsx(R,{id:"paid",type:"number",step:"0.01",min:"0",value:n.paid,onChange:t=>l(r=>({...r,paid:t.target.value})),placeholder:"Enter amount paid"}),o.paid&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.paid})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-cyan-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"permanent",className:"text-base font-semibold",children:"Permanent *"})}),e.jsx(je,{value:n.permanent,onValueChange:t=>l(r=>({...r,permanent:t})),name:"permanent",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),o.permanent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.permanent})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"reversed_payments",className:"text-base font-semibold",children:"Reversed Payments?"})}),e.jsx(R,{id:"reversed_payments",value:n.reversed_payments,onChange:t=>l(r=>({...r,reversed_payments:t.target.value})),placeholder:"Enter reversed payments information"}),o.reversed_payments&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.reversed_payments})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none",value:n.notes,onChange:t=>l(r=>({...r,notes:t.target.value})),rows:3,placeholder:"Enter any additional notes..."}),o.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.notes})]}),!1]})}),e.jsx(ve,{className:"border-t bg-muted/50 p-4",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(F,{type:"button",variant:"outline",onClick:ce,disabled:V,children:"Cancel"}),e.jsx(F,{type:"submit",onClick:H,disabled:V,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:V?"Updating...":"Update Payment"})]})})]})})})}export{et as default};
