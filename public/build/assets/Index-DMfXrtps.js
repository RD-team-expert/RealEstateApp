import{r as a,j as e,H as ve,L as Ce,a as _}from"./app-DVDXdM1j.js";import{B as g}from"./badge-DTS1K3_X.js";import{B as f}from"./createLucideIcon-f9blZpYt.js";import{C as ke,a as Se,b as De}from"./card-Bwe2NU3A.js";import{I as D}from"./input-CAZvlv5n.js";import{P as Ee,T as Le,a as Re,b as Q,c as d,d as Ae,e as l,f as Te}from"./table-0dU4KNKP.js";import{u as $e,A as Ue}from"./app-layout-BgOFzUm7.js";import Pe from"./MoveOutCreateDrawer-Dt-CQmZT.js";import ze from"./MoveOutEditDrawer-CXui-etD.js";import{D as Ie}from"./download-wHB0yVVw.js";import{C as E}from"./chevron-up-BWfV-rK5.js";import{S as Fe}from"./search-Cj-1Tgsr.js";import{X as Me}from"./index-u4YCQuA6.js";import{E as Be}from"./eye-CmmvMCNK.js";import{S as He}from"./square-pen-Gduccuzo.js";import{f as Ve}from"./format-PYUiRpxY.js";import"./app-CjmCCaLt.js";import"./index-CgivZZgh.js";import"./index-DdPbNFmK.js";import"./index-B6MCHojI.js";import"./index-Bh7wV6bP.js";import"./index-r4aKh8Jv.js";import"./index-CgpEdb5b.js";import"./collapsible-C9LSRdIZ.js";import"./chevron-right-Jq5zNY5a.js";import"./log-out-CclgnUl6.js";import"./app-logo-icon-BKweUuHy.js";import"./house-AQu3AgIJ.js";import"./building-BHVhuuix.js";import"./users-BcbQvnsY.js";import"./wrench-DEIL3bF0.js";import"./credit-card-DCM1AG9P.js";import"./dollar-sign-BHdix2xf.js";import"./file-text-BqsQ4w8u.js";import"./triangle-alert-D9ulod1h.js";import"./bell-BaW5Lw9J.js";import"./popover-GGagVvOt.js";import"./drawer-xioPoqbP.js";import"./label-Bq1y09-X.js";import"./select-TGrDkT3T.js";import"./index-DWj7wjkv.js";import"./textarea-BRRaEa3f.js";import"./radioGroup-Cj9qUiCJ.js";import"./calendar-UWhjVqRM.js";const j=(s,c="-")=>{if(!s)return c;const o=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!o)return c;const[,p,m,N]=o,u=new Date(Number(p),Number(m)-1,Number(N));return Ve(u,"P")},F=s=>{if(!s)return"";const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!c)return"";const[,o,p,m]=c;return`${o}-${p}-${m}`},Ye=(s,c="move-outs.csv")=>{try{const o=t=>t==null?"":String(t).replace(/"/g,'""'),m=[["ID","City Name","Property Name","Unit Name","Tenant Name","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Move Out Form"].join(","),...s.map(t=>{try{return[t.id||"",`"${o(t.city_name)}"`,`"${o(t.property_name)}"`,`"${o(t.units_name)}"`,`"${o(t.tenants_name)}"`,`"${j(t.move_out_date,"")}"`,`"${o(t.lease_status)}"`,`"${j(t.date_lease_ending_on_buildium,"")}"`,`"${o(t.keys_location)}"`,`"${o(t.utilities_under_our_name)}"`,`"${j(t.date_utility_put_under_our_name,"")}"`,`"${o(t.walkthrough)}"`,`"${o(t.repairs)}"`,`"${o(t.send_back_security_deposit)}"`,`"${o(t.notes)}"`,`"${o(t.cleaning)}"`,`"${o(t.list_the_unit)}"`,`"${o(t.move_out_form)}"`].join(",")}catch(w){return console.error("Error processing move-out row:",t,w),""}}).filter(t=>t!=="")].join(`
`),N=new Blob([m],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),h=URL.createObjectURL(N);return u.setAttribute("href",h),u.setAttribute("download",c),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h),!0}catch(o){throw console.error("CSV Export Error:",o),o}};function Ur({moveOuts:s,cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,allUnits:u,tenantsData:h}){const[t,w]=a.useState(!1),[Z,M]=a.useState(!1),[O,B]=a.useState(!1),[y,ee]=a.useState(null),[i,H]=a.useState({city:"",property:"",unit:"",tenant:""}),[,V]=a.useState({city:"",property:"",unit:"",tenant:""}),[re,v]=a.useState(!1),[te,C]=a.useState(!1),[oe,k]=a.useState(!1),[ne,S]=a.useState(!1),L=a.useRef(null),R=a.useRef(null),A=a.useRef(null),T=a.useRef(null),$=a.useRef(null),U=a.useRef(null),P=a.useRef(null),z=a.useRef(null);a.useEffect(()=>{const r=n=>{L.current&&!L.current.contains(n.target)&&$.current&&!$.current.contains(n.target)&&v(!1),R.current&&!R.current.contains(n.target)&&U.current&&!U.current.contains(n.target)&&C(!1),A.current&&!A.current.contains(n.target)&&P.current&&!P.current.contains(n.target)&&k(!1),T.current&&!T.current.contains(n.target)&&z.current&&!z.current.contains(n.target)&&S(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const x=(r,n)=>{H(I=>({...I,[r]:n}))},se=r=>{x("city",r.city),v(!1)},ae=r=>{const n=r.target.value;x("city",n),v(n.length>0)},de=r=>{const n=r.target.value;x("property",n),C(n.length>0)},le=r=>{x("property",r.property_name),C(!1)},ie=r=>{const n=r.target.value;x("unit",n),k(n.length>0)},ce=r=>{x("unit",r.unit_name),k(!1)},ue=r=>{const n=r.target.value;x("tenant",n),S(n.length>0)},me=r=>{x("tenant",r.full_name),S(!1)},xe=()=>{V(i);const r=c.find(b=>b.city===i.city),n=o.find(b=>b.property_name===i.property),I=u.find(b=>b.unit_name===i.unit),we=h.find(b=>b.full_name===i.tenant);_.get(route("move-out.index"),{city_id:r?.id||null,property_id:n?.id||null,unit_id:I?.id||null,tenant_id:we?.id||null},{preserveState:!0})},pe=()=>{H({city:"",property:"",unit:"",tenant:""}),V({city:"",property:"",unit:"",tenant:""}),_.get(route("move-out.index"),{},{preserveState:!1})},he=r=>{confirm("Are you sure you want to delete this move-out record?")&&_.delete(route("move-out.destroy",r.id))},be=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}w(!0);try{console.log("Exporting move-out data:",s.data);const r=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;Ye(s.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}. Please check the console for details.`)}finally{w(!1)}},ge=()=>{_.reload()},fe=()=>{_.reload()},Ne=r=>{ee(r),B(!0)},je=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="Yes"?"default":"secondary",className:r==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:r}),ye=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="cleaned"?"default":"secondary",className:r==="cleaned"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",children:r}),_e=r=>r===null?e.jsx(g,{variant:"outline",children:"N/A"}):e.jsx(g,{variant:r==="filled"?"default":"secondary",className:r==="filled"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:r}),{hasPermission:Y,hasAnyPermission:K,hasAllPermissions:W}=$e(),q=c.filter(r=>r.city.toLowerCase().includes(i.city.toLowerCase())),X=o.filter(r=>r.property_name.toLowerCase().includes(i.property.toLowerCase())),G=u.filter(r=>r.unit_name.toLowerCase().includes(i.unit.toLowerCase())),J=h.filter(r=>r.full_name.toLowerCase().includes(i.tenant.toLowerCase()));return e.jsxs(Ue,{children:[e.jsx(ve,{title:"Move-Out Management"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Move-Out Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:be,disabled:t||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),t?"Exporting...":"Export CSV"]}),W(["move-out.create","move-out.store"])&&e.jsxs(f,{onClick:()=>M(!0),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Add Move-Out Record"]})]})]}),e.jsxs(ke,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(Se,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:$,type:"text",placeholder:"City",value:i.city,onChange:ae,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),re&&q.length>0&&e.jsx("div",{ref:L,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:q.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>se(r),children:r.city},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:U,type:"text",placeholder:"Property",value:i.property,onChange:de,onFocus:()=>C(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),te&&X.length>0&&e.jsx("div",{ref:R,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:X.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>le(r),children:r.property_name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:P,type:"text",placeholder:"Unit",value:i.unit,onChange:ie,onFocus:()=>k(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&G.length>0&&e.jsx("div",{ref:A,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:G.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(r),children:r.unit_name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:z,type:"text",placeholder:"Tenant",value:i.tenant,onChange:ue,onFocus:()=>S(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&J.length>0&&e.jsx("div",{ref:T,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>me(r),children:r.full_name},r.id))})]}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:xe,variant:"default",className:"flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(f,{onClick:pe,variant:"outline",className:"flex items-center",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(De,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(Le,{className:"border-collapse rounded-md border border-border",children:[e.jsx(Re,{children:e.jsxs(Q,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Tenant Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Move Out Date"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Status"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Lease Ending on Buildium"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Keys Location"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Utilities Under Our Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date Utility Put Under Our Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Walkthrough"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Repairs"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Send Back Security Deposit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Notes"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Cleaning"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"List the Unit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Move Out Form"}),K(["move-out.show","move-out.edit","move-out.update","move-out.destroy"])&&e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(Ae,{children:s.data.map(r=>e.jsxs(Q,{className:"border-border hover:bg-muted/50",children:[e.jsx(l,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city_name||"N/A"}),e.jsx(l,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property_name||"N/A"}),e.jsx(l,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.units_name||"N/A"}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.tenants_name||"N/A"}),e.jsx(l,{className:"border border-border text-center text-foreground",children:j(r.move_out_date)}),e.jsx(l,{className:"border border-border text-center",children:r.lease_status?e.jsx(g,{variant:"outline",children:r.lease_status}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center text-foreground",children:j(r.date_lease_ending_on_buildium)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.keys_location||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:je(r.utilities_under_our_name)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:j(r.date_utility_put_under_our_name)}),e.jsx(l,{className:"border border-border text-center",children:r.walkthrough?e.jsx("div",{className:"max-w-32 truncate",title:r.walkthrough,children:r.walkthrough}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:r.repairs?e.jsx("div",{className:"max-w-24 truncate",title:r.repairs,children:r.repairs}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.send_back_security_deposit||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:r.notes?e.jsx("div",{className:"max-w-24 truncate",title:r.notes,children:r.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:ye(r.cleaning)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.list_the_unit||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:_e(r.move_out_form)}),K(["move-out.show","move-out.edit","move-out.update","move-out.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[Y("move-out.show")&&e.jsx(Ce,{href:route("move-out.show",r.id),children:e.jsx(f,{variant:"outline",size:"sm",children:e.jsx(Be,{className:"h-4 w-4"})})}),W(["move-out.edit","move-out.update"])&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Ne(r),children:e.jsx(He,{className:"h-4 w-4"})}),Y("move-out.destroy")&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>he(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Te,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No move-out records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})]})}),e.jsx(Pe,{cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,tenantsData:h,open:Z,onOpenChange:M,onSuccess:ge}),y&&e.jsx(ze,{cities:c,properties:o,propertiesByCityId:p,unitsByPropertyId:m,tenantsByUnitId:N,allUnits:u,tenantsData:h,moveOut:{...y,move_out_date:F(y.move_out_date),date_lease_ending_on_buildium:F(y.date_lease_ending_on_buildium),date_utility_put_under_our_name:F(y.date_utility_put_under_our_name)},open:O,onOpenChange:B,onSuccess:fe})]})}export{Ur as default};
