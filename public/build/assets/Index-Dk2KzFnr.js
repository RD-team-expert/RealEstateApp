import{r as a,j as r,H as re,a as S}from"./app-XlMZG7vD.js";import{B as R}from"./button-D56PIbu9.js";import{C as ne,a as oe,b as se}from"./card-BeQJ7hrb.js";import{T as ae,d as ie}from"./table-Dsn5Ek_l.js";import{u as le}from"./usePermissions-C5sl0_76.js";import{A as pe}from"./app-layout-CGrAe6KQ.js";import ce from"./OffersAndRenewalsCreateDrawer-DU6NVM3Z.js";import de from"./OffersAndRenewalsEditDrawer-DlJAJcz8.js";import{EmptyState as me}from"./EmptyState-C3pmh6KE.js";import{FilterBar as ue}from"./FilterBar-1nPHjEAb.js";import{PageHeader as ge}from"./PageHeader-CBSPqZbQ.js";import{TabNavigation as xe}from"./TabNavigation-Dijr7dsZ.js";import{OffersTableHeader as he}from"./TableHeader-D73KHDWz.js";import{OffersTableRow as fe}from"./TableRow-BD5DaiD9.js";import{f as we}from"./format-PYUiRpxY.js";import"./app-D9zByHv3.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./drawer-B7-2XtV2.js";import"./CascadingSelectors-v4uIxx2W.js";import"./label-BKN3erGN.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./input-nhBJFe9F.js";import"./check-ZO7ekD6P.js";import"./OfferInformationSection-6c7cgaH8.js";import"./DatePickerField-CyM2s-iI.js";import"./calendar-D02iCkay.js";import"./chevron-left-DiIjHAK0.js";import"./chevron-down-Dqt3V4Kg.js";import"./calendar-CGMbx-hL.js";import"./RadioGroupField-D3gQUT3l.js";import"./radioGroup-DrlpglLG.js";import"./index-DdpYxxi8.js";import"./AcceptanceSection-0aQIPZiH.js";import"./LeaseInformationSection-JIChmC4W.js";import"./RenewalInformationSection-CLm4GHMo.js";import"./AdditionalFieldsSection-DJSR5yXS.js";import"./DateOfDeclineSection-BjpisEzB.js";import"./CitySelector-DytLvUOj.js";import"./PropertySelector-BOHgKC1e.js";import"./UnitSelector-DodSD88o.js";import"./TenantSelector-C5HoBqA8.js";import"./DatePickerField-Bu1KZc1Y.js";import"./RadioGroupField-DsmX6Yo7.js";import"./TextAreaField-BR_aEAXY.js";import"./DateOfDeclineSectionEdit-D_6P87Xi.js";import"./download-AfMUchev.js";import"./plus-Brzm8xdb.js";import"./badge-amDNRRn_.js";import"./eye-L6iv3Y43.js";import"./square-pen-DJiq7j_0.js";import"./trash-2-CisDGbUX.js";const y=(n,p="-")=>{if(!n)return p;const h=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!h)return p;const[,o,c,_]=h,f=new Date(Number(o),Number(c)-1,Number(_));return we(f,"P")},ye=(n,p,h="offers-renewals.csv")=>{try{const o=t=>t==null?"":String(t).replace(/"/g,'""');let c=["ID","City","Property","Unit","Tenant"];(p==="offers"||p==="both")&&(c=c.concat(["Date Sent Offer","Status","Date of Acceptance","Offer Last Notice Sent","Offer Notice Kind"])),(p==="renewals"||p==="both")&&(c=c.concat(["Lease Sent","Date Sent Lease","Lease Signed","Date Signed","Renewal Last Notice Sent","Renewal Notice Kind","Notes"])),c=c.concat(["How Many Days Left","Expired","Other Tenants","Date of Decline"]);const _=[c.join(","),...n.map(t=>{try{let l=[t.id||"",`"${o(t.city_name)}"`,`"${o(t.property)}"`,`"${o(t.unit)}"`,`"${o(t.tenant)}"`];return(p==="offers"||p==="both")&&(l=l.concat([`"${y(t.date_sent_offer,"")}"`,`"${o(t.status)}"`,`"${y(t.date_of_acceptance,"")}"`,`"${y(t.last_notice_sent,"")}"`,`"${o(t.notice_kind)}"`])),(p==="renewals"||p==="both")&&(l=l.concat([`"${o(t.lease_sent)}"`,`"${y(t.date_sent_lease,"")}"`,`"${o(t.lease_signed)}"`,`"${y(t.date_signed,"")}"`,`"${y(t.last_notice_sent_2,"")}"`,`"${o(t.notice_kind_2)}"`,`"${o(t.notes)}"`])),l=l.concat([`"${o(String(t.how_many_days_left))}"`,`"${o(t.expired)}"`,`"${o(t.other_tenants)}"`,`"${y(t.date_of_decline,"")}"`]),l.join(",")}catch(l){return console.error("Error processing offer row:",t,l),""}}).filter(t=>t!=="")].join(`
`),f=new Blob([_],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),u=URL.createObjectURL(f);return d.setAttribute("href",u),d.setAttribute("download",h),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u),!0}catch(o){throw console.error("CSV Export Error:",o),o}},Jt=({offers:n,hierarchicalData:p,filterCityNames:h,filterPropertyNames:o,filterUnitNames:c,filterTenantNames:_,perPage:f,city_name:d,property_name:u,unit_name:t,tenant_name:l})=>{const[b,k]=a.useState("offers"),[T,E]=a.useState(!1),[F,$]=a.useState(!1),[H,D]=a.useState(!1),[N,I]=a.useState(null),[s,v]=a.useState({city:d||"",property:u||"",unit:t||"",tenant:l||""}),[,C]=a.useState({city:d||"",property:u||"",unit:t||"",tenant:l||""});a.useEffect(()=>{v({city:d||"",property:u||"",unit:t||"",tenant:l||""}),C({city:d||"",property:u||"",unit:t||"",tenant:l||""})},[d,u,t,l]);const i=a.useMemo(()=>!!(n&&n.data&&Array.isArray(n.data)),[n]),w=a.useMemo(()=>n?Array.isArray(n)?n:i?n.data:[]:[],[n,i]),g=a.useMemo(()=>{if(!i)return 1;const e=n;return e.current_page??e?.meta?.current_page??1},[n,i]),O=a.useMemo(()=>{if(!i)return 1;const e=n;return e.last_page??e?.meta?.last_page??1},[n,i]),U=a.useMemo(()=>{if(i){const e=n;return e.total??e?.meta?.total??e.data.length}return w.length},[n,w,i]),B=a.useMemo(()=>{if(i){const e=n;return e.from??e?.meta?.from??0}return w.length?1:0},[n,w,i]),V=a.useMemo(()=>{if(i){const e=n;return e.to??e?.meta?.to??e.data.length}return w.length},[n,w,i]),m=a.useMemo(()=>{const e=typeof f<"u"?f:i?n?.per_page??n?.meta?.per_page:15,j=String(e).toLowerCase();if(j==="all")return"all";const L=parseInt(j,10);return Number.isNaN(L)?"15":String(L)},[f,i,n]),z=a.useMemo(()=>h||[],[h]),K=a.useMemo(()=>o||[],[o]),q=a.useMemo(()=>c||[],[c]),G=a.useMemo(()=>_||[],[_]),x=w,J=e=>{const j=e==="all"?"all":parseInt(e,10);S.get(route("offers_and_renewals.index"),{city_name:s.city||void 0,property_name:s.property||void 0,unit_name:s.unit||void 0,tenant_name:s.tenant||void 0,per_page:j,page:1},{preserveState:!0})},P=e=>{e<1||i&&e>O||S.get(route("offers_and_renewals.index"),{city_name:s.city||void 0,property_name:s.property||void 0,unit_name:s.unit||void 0,tenant_name:s.tenant||void 0,page:e,per_page:m},{preserveState:!0})},Q=()=>{C(s),S.get(route("offers_and_renewals.index"),{city_name:s.city||null,property_name:s.property||null,unit_name:s.unit||null,tenant_name:s.tenant||null,page:1,per_page:m},{preserveState:!0})},W=()=>{v({city:"",property:"",unit:"",tenant:""}),C({city:"",property:"",unit:"",tenant:""}),S.get(route("offers_and_renewals.index"),{per_page:m},{preserveState:!1})},X=e=>{if(window.confirm("Are you sure you want to delete this offer? This action cannot be undone.")){const j={city_name:s.city||"",property_name:s.property||"",unit_name:s.unit||"",tenant_name:s.tenant||"",per_page:m,page:g};S.delete(route("offers_and_renewals.destroy",e.id),{data:j,preserveScroll:!0,preserveState:!0})}},Y=e=>{I(e),D(!0)},Z=()=>{if(!x||x.length===0){alert("No data to export");return}E(!0);try{console.log("Exporting offers and renewals data:",x);const e=`offers-renewals-${b}-${new Date().toISOString().split("T")[0]}.csv`;ye(x,b,e),console.log("Export completed successfully")}catch(e){console.error("Export failed:",e),alert(`Export failed: ${e instanceof Error?e.message:"Unknown error"}. Please check the console for details.`)}finally{E(!1)}},{hasPermission:A,hasAnyPermission:ee,hasAllPermissions:M}=le(),te={canView:A("offers-and-renewals.show"),canEdit:M(["offers-and-renewals.edit","offers-and-renewals.update"]),canDelete:A("offers-and-renewals.destroy")};return r.jsxs(pe,{children:[r.jsx(re,{title:"Offers and Renewals"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(ge,{onExport:Z,onAddNew:()=>$(!0),isExporting:T,hasData:x.length>0,canCreate:M(["offers-and-renewals.create","offers-and-renewals.store"])}),r.jsxs(ne,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsxs(oe,{children:[r.jsx(ue,{cities:z,properties:K,units:q,tenants:G,tempFilters:s,onTempFiltersChange:v,onSearch:Q,onClear:W}),r.jsx(xe,{activeTab:b,onTabChange:k})]}),r.jsxs(se,{children:[r.jsx("div",{className:"relative overflow-x-auto",children:r.jsxs(ae,{className:"border-collapse rounded-md border border-border",children:[r.jsx(he,{activeTab:b,hasPermissions:ee(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])}),r.jsx(ie,{children:x.map(e=>r.jsx(fe,{offer:e,activeTab:b,onEdit:Y,onDelete:X,permissions:te,currentFilters:s,perPage:m,page:g},e.id))})]})}),x.length===0&&r.jsx(me,{}),r.jsxs("div",{className:"mt-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",B??0,"-",V??x.length," of ",U]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("label",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),r.jsxs("select",{className:"rounded-md border border-border bg-background p-1 text-sm",value:m,onChange:e=>J(e.target.value),children:[r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"30",children:"30"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(R,{variant:"outline",size:"sm",onClick:()=>P(g-1),disabled:!i||g<=1||m==="all",children:"Previous"}),r.jsx(R,{variant:"outline",size:"sm",onClick:()=>P(g+1),disabled:!i||g>=O||m==="all",children:"Next"})]})]})]})]})]})]})}),r.jsx(ce,{hierarchicalData:p,open:F,onOpenChange:$,currentFilters:s,perPage:m,page:g}),N&&r.jsx(de,{offer:N,hierarchicalData:p,open:H,onOpenChange:D,currentFilters:s,perPage:m,page:g,onSuccess:()=>{S.reload()}})]})};export{Jt as default};
