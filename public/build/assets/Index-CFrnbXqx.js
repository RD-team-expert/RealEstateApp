import{r as c,u as T,j as o,H as R,a as m}from"./app-XlMZG7vD.js";import{A as k}from"./app-layout-CGrAe6KQ.js";import{C as H,a as U,b as M}from"./card-BeQJ7hrb.js";import{u as V}from"./usePermissions-C5sl0_76.js";import B from"./PropertyCreateDrawer-DzxxEqoD.js";import Q from"./PropertyEditDrawer-DQcrOnVg.js";import q from"./PropertyPageHeader-BNAFWaTP.js";import z from"./PropertyFilters-TUhXn4-i.js";import G from"./PropertyTable-CP5FQ-ek.js";import J from"./PropertyEmptyState-CBVKtSnV.js";import K from"./FlashMessages-DccXIPeT.js";import W from"./PropertyPagination-BLT3C0FX.js";import"./app-D9zByHv3.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-D56PIbu9.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./drawer-B7-2XtV2.js";import"./CitySelectionSection-wcSA5EGy.js";import"./label-BKN3erGN.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./map-pin-DmthUSKJ.js";import"./check-ZO7ekD6P.js";import"./PropertySelectionSection-B62lNaDI.js";import"./alert-CQxLA4ki.js";import"./building-2-DysG-3uP.js";import"./circle-alert-DMsAqMEY.js";import"./InsuranceCompanySection-DLq6M1tJ.js";import"./input-nhBJFe9F.js";import"./shield-CO_FGJ1n.js";import"./AmountPolicySection-Bt_DDs7z.js";import"./DatesSection-DnkcRPcl.js";import"./calendar-CGMbx-hL.js";import"./NotesSection-BM3s7R0a.js";import"./textarea-DWy2J22q.js";import"./InsuranceCompanyField-CFh9WSn0.js";import"./AmountPolicyFields-BepsG-C5.js";import"./DateFields-DBoww6-4.js";import"./NotesField-Dc0tv8jf.js";import"./download-AfMUchev.js";import"./plus-Brzm8xdb.js";import"./table-Dsn5Ek_l.js";import"./PropertyTableRow-g0SwAZk5.js";import"./PropertyStatusBadge-xbzk3zw3.js";import"./badge-amDNRRn_.js";import"./PropertyDaysLeftBadge-5paKMRoN.js";import"./eye-L6iv3Y43.js";import"./square-pen-DJiq7j_0.js";import"./trash-2-CisDGbUX.js";import"./pagination-BjxRxdxL.js";import"./chevron-left-DiIjHAK0.js";import"./select-C9mJLkAA.js";import"./index-DdpYxxi8.js";import"./chevron-down-Dqt3V4Kg.js";import"./chevron-up-COk4jH4h.js";const X=(t,l="properties.csv")=>{const d=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],u=i=>{const h=new Date,x=new Date(i).getTime()-h.getTime();return Math.ceil(x/(1e3*60*60*24))},f=[d.join(","),...t.map(i=>[i.id,`"${i.property?.property_name||"N/A"}"`,`"${i.insurance_company_name}"`,`"${i.formatted_amount}"`,`"${i.effective_date}"`,`"${i.policy_number}"`,`"${i.expiration_date}"`,u(i.expiration_date),`"${i.status}"`].join(","))].join(`
`),g=new Blob([f],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),r=URL.createObjectURL(g);p.setAttribute("href",r),p.setAttribute("download",l),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r)};function vt({properties:t,filters:l,cities:d=[],availableProperties:u=[]}){const{hasPermission:f,hasAnyPermission:g,hasAllPermissions:p}=V(),[r,i]=c.useState(l),[h,y]=c.useState(!1),[x,_]=c.useState(!1),[b,S]=c.useState(!1),[D,w]=c.useState(null),{flash:j}=T().props,n=l?.per_page??t.per_page,P=()=>{const e={};return t.current_page&&t.current_page>1&&(e.page=t.current_page.toString()),n&&(e.per_page=n.toString()),Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),e},E=()=>{const e={};return r.property_name&&(e.filter_property_name=String(r.property_name)),r.insurance_company_name&&(e.filter_insurance_company_name=String(r.insurance_company_name)),r.policy_number&&(e.filter_policy_number=String(r.policy_number)),typeof r.status<"u"&&r.status!==null&&(e.filter_status=String(r.status)),n&&(e.filter_per_page=String(n)),t.current_page&&t.current_page>1&&(e.filter_page=String(t.current_page)),e},C=(e,a)=>{const s={...r,[e]:a};i(s)},v=()=>{const e={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(e[a]=String(s))}),n&&(e.per_page=n.toString()),m.get(route("properties-info.index"),e,{preserveState:!0,preserveScroll:!0})},A=()=>{i({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};n&&(a.per_page=n.toString()),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},F=e=>{confirm("Are you sure you want to delete this property?")&&m.delete(route("properties-info.destroy",e.id),{data:E(),preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}y(!0);try{const e=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;X(t.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{y(!1)}},I=()=>{S(!1),m.get(route("properties-info.index"),P(),{preserveState:!0,preserveScroll:!0})},N=e=>{w(e),S(!0)},$=e=>{const a=P();delete a.page,a.per_page=e.toString(),m.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=e=>{const a=P();m.get(route("properties-info.show",e.id),a,{preserveState:!1})};return o.jsxs(k,{children:[o.jsx(R,{title:"Properties Insurance"}),o.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:o.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o.jsx(K,{success:j?.success,error:j?.error}),o.jsx(q,{onExport:O,onAddProperty:()=>_(!0),isExporting:h,hasExportData:t.data.length>0,canCreate:p(["properties.create","properties.store"])}),o.jsxs(H,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(U,{children:o.jsx(z,{filters:r,onFilterChange:C,onSearch:v,onClear:A})}),o.jsxs(M,{children:[o.jsx(G,{properties:t.data,onEdit:N,onDelete:F,onShow:L,canEdit:p(["properties.update","properties.edit"]),canDelete:f("properties.destroy"),canShow:f("properties.show"),hasAnyActionPermission:g(["properties.destroy","properties.update","properties.edit","properties.show"])}),t.data.length===0&&o.jsx(J,{}),t.data.length>0&&o.jsx(W,{paginatedData:t,currentPerPage:n||15,onPerPageChange:$})]})]})]})}),o.jsx(B,{open:x,onOpenChange:_,cities:d,availableProperties:u,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15}),D&&o.jsx(Q,{open:b,onOpenChange:S,property:D,availableProperties:u,onSuccess:I,currentFilters:r,currentPage:t.current_page||1,currentPerPage:n||15,cities:d})]})}export{vt as default};
