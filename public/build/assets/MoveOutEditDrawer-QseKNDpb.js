import{r as a,b as H,j as r}from"./app-Dn1r5IbR.js";import{D as I,a as J,b as K}from"./drawer-BbQvx4Pm.js";import{B as F}from"./button-DoJlCKhy.js";import{LocationSelectionFields as Q}from"./LocationSelectionFields-DeL-mM2x.js";import{MoveOutDateFields as W}from"./MoveOutDateFields-D2l-EUDd.js";import{MoveOutDetailsFields as X}from"./MoveOutDetailsFields--KcmvyX2.js";import{MoveOutStatusFields as Y}from"./MoveOutStatusFields-CMWQDP2X.js";import"./app-BmbQfT0_.js";import"./index-C_Yr3VBI.js";import"./index-Dc_FVRD7.js";import"./index-DF1-xgR-.js";import"./index-cId8iuZu.js";import"./index-WPnjh8bd.js";import"./index-qhuad6ry.js";import"./index-C5yiDUFi.js";import"./index-CGaG4LkD.js";import"./index-BHn9DcD9.js";import"./index-BV3nWfAJ.js";import"./utils-CBfrqCZ4.js";import"./x-BwrjvaMS.js";import"./createLucideIcon-ezkluWMI.js";import"./label-CyLYjr_a.js";import"./input-DJHjvjS7.js";import"./select-BPfsX62k.js";import"./index-rczzAiLR.js";import"./index-h5kqUyi-.js";import"./index-IWqIVFcu.js";import"./index-q0Alrdsu.js";import"./index-C0T19-Xq.js";import"./chevron-down-Bfpn-qjr.js";import"./check-CZby3Z4H.js";import"./chevron-up-CyiongBQ.js";import"./popover-CuJpm8qA.js";import"./format-PYUiRpxY.js";import"./chevron-right-BXKQFlIK.js";import"./calendar-Xujg-VPa.js";import"./radioGroup-Dyu-l9CF.js";import"./textarea-9P0dwNYy.js";function Pt({cities:c,properties:g,propertiesByCityId:l,unitsByPropertyId:u,allUnits:d,moveOut:t,open:M,onOpenChange:C,onSuccess:P}){const p=a.useRef(null),f=a.useRef(null),m=a.useRef(null),[U,o]=a.useState({city:"",property:"",unit:""}),[w,S]=a.useState(null),[D,x]=a.useState(null),[E,h]=a.useState(null),[V,j]=a.useState([]),[z,y]=a.useState([]),{data:_,setData:s,put:L,processing:N,errors:b}=H({unit_id:t.unit_id||null,tenants:t.tenants||"",move_out_date:t.move_out_date||"",lease_status:t.lease_status||"",date_lease_ending_on_buildium:t.date_lease_ending_on_buildium||"",keys_location:t.keys_location||"",utilities_under_our_name:t.utilities_under_our_name||"",date_utility_put_under_our_name:t.date_utility_put_under_our_name||"",walkthrough:t.walkthrough||"",repairs:t.repairs||"",send_back_security_deposit:t.send_back_security_deposit||"",notes:t.notes||"",cleaning:t.cleaning||"",list_the_unit:t.list_the_unit||"",move_out_form:t.move_out_form||"",utility_type:t.utility_type||""});a.useEffect(()=>{if(t&&d&&Array.isArray(d)&&Array.isArray(c)&&Array.isArray(g)){const n=d.find(e=>e.unit_name===t.unit_name);if(n){const e=c.find(k=>k.city===t.city_name),i=g.find(k=>k.property_name===t.property_name);e&&(S(e.id),l&&l[e.id]&&j(l[e.id])),i&&(x(i.id),u&&u[i.id]&&y(u[i.id])),h(n.id),s("unit_id",n.id)}}},[t,d,c,g,l,u]);const T=n=>{const e=parseInt(n);S(e),x(null),h(null),s("unit_id",null),o(i=>({...i,city:"",property:"",unit:""})),e&&l[e]?j(l[e]):j([]),y([])},q=n=>{const e=parseInt(n);x(e),h(null),s("unit_id",null),o(i=>({...i,property:"",unit:""})),e&&u[e]?y(u[e]):y([])},G=n=>{const e=parseInt(n);h(e),s("unit_id",e),o(i=>({...i,unit:""}))},R=n=>{n.preventDefault(),o({city:"",property:"",unit:""});let e=!1;w||(o(i=>({...i,city:"Please select a city before submitting the form."})),p.current&&(p.current.focus(),p.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),D||(o(i=>({...i,property:"Please select a property before submitting the form."})),f.current&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),(!E||!_.unit_id)&&(o(i=>({...i,unit:"Please select a unit before submitting the form."})),m.current&&(m.current.focus(),m.current.scrollIntoView({behavior:"smooth",block:"center"})),e=!0),!e&&L(route("move-out.update",t.id),{onSuccess:()=>{A(),P?.()}})},A=()=>{s({unit_id:t.unit_id||null,tenants:t.tenants||"",move_out_date:t.move_out_date||"",lease_status:t.lease_status||"",date_lease_ending_on_buildium:t.date_lease_ending_on_buildium||"",keys_location:t.keys_location||"",utilities_under_our_name:t.utilities_under_our_name||"",date_utility_put_under_our_name:t.date_utility_put_under_our_name||"",walkthrough:t.walkthrough||"",repairs:t.repairs||"",send_back_security_deposit:t.send_back_security_deposit||"",notes:t.notes||"",cleaning:t.cleaning||"",list_the_unit:t.list_the_unit||"",move_out_form:t.move_out_form||"",utility_type:t.utility_type||""}),o({city:"",property:"",unit:""}),C(!1)};return r.jsx(I,{open:M,onOpenChange:C,modal:!1,children:r.jsx(J,{size:"half",title:"Edit Move-Out Record",children:r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"flex-1 overflow-auto p-6",children:r.jsxs("form",{onSubmit:R,className:"space-y-4",children:[r.jsx(Q,{cities:c,availableProperties:V,availableUnits:z,selectedCity:w,selectedProperty:D,selectedUnit:E,validationErrors:U,cityRef:p,propertyRef:f,unitRef:m,onCityChange:T,onPropertyChange:q,onUnitChange:G,tenants:_.tenants,tenantsError:b.tenants,onTenantsChange:n=>s("tenants",n)}),r.jsx(W,{data:_,errors:b,onDataChange:s}),r.jsx(X,{data:_,errors:b,onDataChange:s}),r.jsx(Y,{data:_,errors:b,onDataChange:s})]})}),r.jsx(K,{children:r.jsxs("div",{className:"flex gap-2 w-full",children:[r.jsx(F,{type:"button",variant:"outline",onClick:A,className:"flex-1",children:"Cancel"}),r.jsx(F,{type:"submit",onClick:R,disabled:N,className:"flex-1",children:N?"Updating...":"Update Move-Out Record"})]})})]})})})}export{Pt as default};
