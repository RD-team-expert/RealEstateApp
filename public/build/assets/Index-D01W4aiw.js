import{r as n,j as e,H as je,L as Ne,a as N}from"./app-nUSYw4ai.js";import{u as we,A as ve}from"./app-layout-SVUR4mDr.js";import{B as f}from"./createLucideIcon-C5GD6QeA.js";import{I as D}from"./input-OhVo65AQ.js";import{C as Ce,a as Se,b as ke}from"./card-Nz8H8S7P.js";import{P as Pe,T as De,a as Ee,b as W,c as i,d as _e,e as c,f as Re}from"./table-DNmiDd_k.js";import{B as w}from"./badge-D3YraplM.js";import Te from"./PaymentPlanCreateDrawer-CE2qLE5J.js";import Le from"./PaymentPlanEditDrawer-DX3d8Nlx.js";import{D as ze}from"./download-Cfi3vdAl.js";import{C as E}from"./chevron-up-BHOYq5G1.js";import{S as Ae}from"./search-D9q-g70L.js";import{X as Ue}from"./index-5YpAK82Y.js";import{E as Ie}from"./eye-Bt0sbOX4.js";import{S as Fe}from"./square-pen-BsWDWlPj.js";import{f as Oe}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-UYkM-lg7.js";import"./index-nh9QAngE.js";import"./index-DbaH1TRh.js";import"./index-DGbRjXgX.js";import"./index-CedKduyQ.js";import"./index-BKS2-tOY.js";import"./collapsible-BaDJNkTm.js";import"./chevron-right-uK37_yne.js";import"./log-out-Ct0Az9_H.js";import"./app-logo-icon-kFXdOc6h.js";import"./house-0n7o0-rx.js";import"./building-BIZdrc6N.js";import"./users-BhWwggl0.js";import"./wrench-SwJ0VGsJ.js";import"./credit-card-BdaPoiio.js";import"./dollar-sign-DvmVu0rD.js";import"./file-text-B1Xrnfk_.js";import"./triangle-alert-DaU4wCbf.js";import"./bell-BOTwwMit.js";import"./popover-CMnBhXYh.js";import"./drawer-ikeMES7v.js";import"./label-DtPmPEai.js";import"./select-PjIVfLW0.js";import"./index-mn3Hv6wy.js";import"./textarea-CS9Q9qGG.js";import"./calendar-C-0kt65W.js";import"./circle-alert-CxetrKCW.js";const Y=(s,u="-")=>{if(!s)return u;const a=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!a)return u;const[,l,b,y]=a,x=new Date(Number(l),Number(b)-1,Number(y));return Oe(x,"P")},$e=(s,u="payment-plans.csv")=>{try{const a=r=>r==null||isNaN(r)?"0.00":Number(r).toFixed(2),l=r=>r==null?"":String(r).replace(/"/g,'""'),b=r=>Y(r,""),x=[["ID","City","Property","Unit","Tenant","Amount","Paid","Left to Pay","Status","Date","Notes"].join(","),...s.map(r=>{try{return[r.id||"",`"${l(r.city_name)}"`,`"${l(r.property)}"`,`"${l(r.unit)}"`,`"${l(r.tenant)}"`,a(r.amount),a(r.paid),a(r.left_to_pay),`"${l(r.status)}"`,`"${b(r.dates)}"`,`"${l(r.notes)}"`].join(",")}catch(v){return console.error("Error processing payment plan row:",r,v),""}}).filter(r=>r!=="")].join(`
`),g=new Blob([x],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),j=URL.createObjectURL(g);return m.setAttribute("href",j),m.setAttribute("download",u),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(j),!0}catch(a){throw console.error("CSV Export Error:",a),a}};function Rt({paymentPlans:s,cities:u,properties:a,propertiesByCityId:l,unitsByPropertyId:b,tenantsByUnitId:y,allUnits:x,tenantsData:g}){const{hasPermission:m,hasAnyPermission:j,hasAllPermissions:r}=we(),[v,$]=n.useState(!1),[Z,H]=n.useState(!1),[ee,B]=n.useState(!1),[V,q]=n.useState(null),[d,M]=n.useState({city:"",property:"",unit:"",tenant:""}),[,X]=n.useState({city:"",property:"",unit:"",tenant:""}),[te,C]=n.useState(!1),[re,S]=n.useState(!1),[oe,k]=n.useState(!1),[ne,P]=n.useState(!1),_=n.useRef(null),R=n.useRef(null),T=n.useRef(null),L=n.useRef(null),z=n.useRef(null),A=n.useRef(null),U=n.useRef(null),I=n.useRef(null);n.useEffect(()=>{const t=o=>{_.current&&!_.current.contains(o.target)&&z.current&&!z.current.contains(o.target)&&C(!1),R.current&&!R.current.contains(o.target)&&A.current&&!A.current.contains(o.target)&&S(!1),T.current&&!T.current.contains(o.target)&&U.current&&!U.current.contains(o.target)&&k(!1),L.current&&!L.current.contains(o.target)&&I.current&&!I.current.contains(o.target)&&P(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const p=(t,o)=>{M(O=>({...O,[t]:o}))},se=t=>{p("city",t.city),C(!1)},ae=t=>{const o=t.target.value;p("city",o),C(o.length>0)},de=t=>{const o=t.target.value;p("property",o),S(o.length>0)},le=t=>{p("property",t.property_name),S(!1)},ie=t=>{const o=t.target.value;p("unit",o),k(o.length>0)},ce=t=>{p("unit",t.unit_name),k(!1)},ue=t=>{const o=t.target.value;p("tenant",o),P(o.length>0)},me=t=>{p("tenant",t.full_name),P(!1)},pe=()=>{X(d);const t=u.find(h=>h.city===d.city),o=a.find(h=>h.property_name===d.property),O=x.find(h=>h.unit_name===d.unit),ye=g.find(h=>h.full_name===d.tenant);N.get(route("payment-plans.index"),{city_id:t?.id||null,property_id:o?.id||null,unit_id:O?.id||null,tenant_id:ye?.id||null},{preserveState:!0})},xe=()=>{M({city:"",property:"",unit:"",tenant:""}),X({city:"",property:"",unit:"",tenant:""}),N.get(route("payment-plans.index"),{},{preserveState:!1})},he=t=>{confirm("Are you sure you want to delete this payment plan?")&&N.delete(`/payment-plans/${t.id}`)},fe=t=>{q(t),B(!0)},be=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}$(!0);try{console.log("Exporting payment plans data:",s.data);const t=`payment-plans-${new Date().toISOString().split("T")[0]}.csv`;$e(s.data,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t instanceof Error?t.message:"Unknown error"}. Please check the console for details.`)}finally{$(!1)}},F=t=>t===null?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(t)),ge=t=>{if(!t)return e.jsx(w,{variant:"outline",children:"N/A"});switch(t){case"Paid":return e.jsx(w,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"Paid"});case"Paid Partly":return e.jsx(w,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:"Paid Partly"});case"Didn't Pay":return e.jsx(w,{variant:"destructive",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",children:"Didn't Pay"});default:return e.jsx(w,{variant:"outline",children:t})}},G=u.filter(t=>t.city.toLowerCase().includes(d.city.toLowerCase())),J=a.filter(t=>t.property_name.toLowerCase().includes(d.property.toLowerCase())),K=x.filter(t=>t.unit_name.toLowerCase().includes(d.unit.toLowerCase())),Q=g.filter(t=>t.full_name.toLowerCase().includes(d.tenant.toLowerCase()));return e.jsxs(ve,{children:[e.jsx(je,{title:"Payment Plans"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Payment Plans Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:be,disabled:v||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),v?"Exporting...":"Export CSV"]}),r(["payment-plans.create","payment-plans.store"])&&e.jsxs(f,{onClick:()=>H(!0),children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Add Payment Plan"]})]})]}),e.jsxs(Ce,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(Se,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:z,type:"text",placeholder:"City",value:d.city,onChange:ae,onFocus:()=>C(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),te&&G.length>0&&e.jsx("div",{ref:_,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:G.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>se(t),children:t.city},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:A,type:"text",placeholder:"Property",value:d.property,onChange:de,onFocus:()=>S(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),re&&J.length>0&&e.jsx("div",{ref:R,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>le(t),children:t.property_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:U,type:"text",placeholder:"Unit",value:d.unit,onChange:ie,onFocus:()=>k(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&K.length>0&&e.jsx("div",{ref:T,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:K.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(t),children:t.unit_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{ref:I,type:"text",placeholder:"Tenant",value:d.tenant,onChange:ue,onFocus:()=>P(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(E,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&Q.length>0&&e.jsx("div",{ref:L,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Q.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>me(t),children:t.full_name},t.id))})]}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:pe,variant:"default",className:"flex items-center",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(f,{onClick:xe,variant:"outline",className:"flex items-center",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(ke,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(De,{className:"border-collapse rounded-md border border-border",children:[e.jsx(Ee,{children:e.jsxs(W,{className:"border-border",children:[e.jsx(i,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(i,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(i,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit"}),e.jsx(i,{className:"sticky left-[390px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Tenant"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground text-right",children:"Amount"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground text-right",children:"Paid"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground text-right",children:"Left to Pay"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Date"}),e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Note"}),j(["payment-plans.show","payment-plans.edit","payment-plans.update","payment-plans.destroy"])&&e.jsx(i,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(_e,{children:s.data.map(t=>e.jsxs(W,{className:"border-border hover:bg-muted/50",children:[e.jsx(c,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.city_name||"N/A"}),e.jsx(c,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.property}),e.jsx(c,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.unit}),e.jsx(c,{className:"sticky left-[390px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.tenant}),e.jsx(c,{className:"border border-border text-center font-medium text-blue-600 dark:text-blue-400",children:F(t.amount)}),e.jsx(c,{className:"border border-border text-center text-green-600 dark:text-green-400",children:F(t.paid)}),e.jsx(c,{className:"border border-border text-center font-medium text-red-600 dark:text-red-400",children:F(t.left_to_pay)}),e.jsx(c,{className:"border border-border text-center",children:ge(t.status)}),e.jsx(c,{className:"border border-border text-center text-foreground",children:Y(t.dates)||"N/A"}),e.jsx(c,{className:"border border-border text-center",children:t.notes?e.jsx("div",{className:"max-w-24 truncate",title:t.notes,children:t.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),j(["payment-plans.show","payment-plans.edit","payment-plans.update","payment-plans.destroy"])&&e.jsx(c,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[m("payment-plans.show")&&e.jsx(Ne,{href:route("payment-plans.show",t.id),children:e.jsx(f,{variant:"outline",size:"sm",children:e.jsx(Ie,{className:"h-4 w-4"})})}),r(["payment-plans.update","payment-plans.edit"])&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>fe(t),children:e.jsx(Fe,{className:"h-4 w-4"})}),m("payment-plans.destroy")&&e.jsx(f,{variant:"outline",size:"sm",onClick:()=>he(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(Re,{className:"h-4 w-4"})})]})})]},t.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No payment plans found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]})]})]})]})}),e.jsx(Te,{cities:u,properties:a,propertiesByCityId:l,unitsByPropertyId:b,tenantsByUnitId:y,tenantsData:g,open:Z,onOpenChange:H,onSuccess:()=>{N.reload()}}),V&&e.jsx(Le,{paymentPlan:V,cities:u,properties:a,propertiesByCityId:l,unitsByPropertyId:b,tenantsByUnitId:y,allUnits:x,tenantsData:g,open:ee,onOpenChange:B,onSuccess:()=>{N.reload(),q(null)}})]})}export{Rt as default};
