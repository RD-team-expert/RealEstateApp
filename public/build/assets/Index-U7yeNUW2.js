import{r as a,j as e,H as ve,L as we,a as E}from"./app-DVDXdM1j.js";import{B as b}from"./badge-DTS1K3_X.js";import{B as g}from"./createLucideIcon-f9blZpYt.js";import{C as _e,a as Ce,b as Se}from"./card-Bwe2NU3A.js";import{I as R}from"./input-CAZvlv5n.js";import{P as ke,T as Ee,a as De,b as ee,c as d,d as Re,e as c,f as Te}from"./table-0dU4KNKP.js";import{u as Ae,A as Pe}from"./app-layout-BgOFzUm7.js";import $e from"./NoticeAndEvictionsCreateDrawer-Bl5OWdi2.js";import Le from"./NoticeAndEvictionsEditDrawer-8wbgU4v2.js";import{D as Ie}from"./download-wHB0yVVw.js";import{C as T}from"./chevron-up-BWfV-rK5.js";import{S as ze}from"./search-Cj-1Tgsr.js";import{X as Ue}from"./index-u4YCQuA6.js";import{E as Oe}from"./eye-CmmvMCNK.js";import{S as Fe}from"./square-pen-Gduccuzo.js";import{f as He}from"./format-PYUiRpxY.js";import"./app-CjmCCaLt.js";import"./index-CgivZZgh.js";import"./index-DdPbNFmK.js";import"./index-B6MCHojI.js";import"./index-Bh7wV6bP.js";import"./index-r4aKh8Jv.js";import"./index-CgpEdb5b.js";import"./collapsible-C9LSRdIZ.js";import"./chevron-right-Jq5zNY5a.js";import"./log-out-CclgnUl6.js";import"./app-logo-icon-BKweUuHy.js";import"./house-AQu3AgIJ.js";import"./building-BHVhuuix.js";import"./users-BcbQvnsY.js";import"./wrench-DEIL3bF0.js";import"./credit-card-DCM1AG9P.js";import"./dollar-sign-BHdix2xf.js";import"./file-text-BqsQ4w8u.js";import"./triangle-alert-D9ulod1h.js";import"./bell-BaW5Lw9J.js";import"./popover-GGagVvOt.js";import"./drawer-xioPoqbP.js";import"./label-Bq1y09-X.js";import"./radioGroup-Cj9qUiCJ.js";import"./index-DWj7wjkv.js";import"./select-TGrDkT3T.js";import"./calendar-UWhjVqRM.js";const N=(i,l="-")=>{if(!i)return l;const r=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!r)return l;const[,x,u,y]=r,m=new Date(Number(x),Number(u)-1,Number(y));return He(m,"P")},B=i=>{if(!i)return"";const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!l)return"";const[,r,x,u]=l;return`${r}-${x}-${u}`},Be=(i,l="notice-evictions.csv")=>{try{const r=n=>n==null?"":String(n).replace(/"/g,'""'),u=[["ID","Unit Name","City Name","Property Name","Tenants Name","Status","Date","Type of Notice","Have An Exception","Note","Evictions","Sent to Attorney","Hearing Dates","Evicted/Payment Plan","If Left","Writ Date"].join(","),...i.map(n=>{try{return[n.id||"",`"${r(n.unit_name)}"`,`"${r(n.city_name)}"`,`"${r(n.property_name)}"`,`"${r(n.tenants_name)}"`,`"${r(n.status)}"`,`"${N(n.date,"")}"`,`"${r(n.type_of_notice)}"`,`"${r(n.have_an_exception)}"`,`"${r(n.note)}"`,`"${r(n.evictions)}"`,`"${r(n.sent_to_atorney)}"`,`"${N(n.hearing_dates,"")}"`,`"${r(n.evected_or_payment_plan)}"`,`"${r(n.if_left)}"`,`"${N(n.writ_date,"")}"`].join(",")}catch(v){return console.error("Error processing record row:",n,v),""}}).filter(n=>n!=="")].join(`
`),y=new Blob([u],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),j=URL.createObjectURL(y);return m.setAttribute("href",j),m.setAttribute("download",l),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(j),!0}catch(r){throw console.error("CSV Export Error:",r),r}},At=({records:i,cities:l=[],properties:r=[],units:x=[],tenants:u=[],notices:y=[]})=>{const[m,j]=a.useState(!1),[n,v]=a.useState(!1),[te,A]=a.useState(!1),[w,V]=a.useState(null),[s,Y]=a.useState({city:"",property:"",unit:"",tenant:""}),[,W]=a.useState({city:"",property:"",unit:"",tenant:""}),[re,_]=a.useState(!1),[ne,C]=a.useState(!1),[oe,S]=a.useState(!1),[se,k]=a.useState(!1),P=a.useRef(null),$=a.useRef(null),L=a.useRef(null),I=a.useRef(null),z=a.useRef(null),U=a.useRef(null),O=a.useRef(null),F=a.useRef(null);a.useEffect(()=>{const t=o=>{P.current&&!P.current.contains(o.target)&&z.current&&!z.current.contains(o.target)&&_(!1),$.current&&!$.current.contains(o.target)&&U.current&&!U.current.contains(o.target)&&C(!1),L.current&&!L.current.contains(o.target)&&O.current&&!O.current.contains(o.target)&&S(!1),I.current&&!I.current.contains(o.target)&&F.current&&!F.current.contains(o.target)&&k(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const f=(t,o)=>{Y(D=>({...D,[t]:o}))},ae=t=>{f("city",t.city),_(!1)},ie=t=>{const o=t.target.value;f("city",o),_(o.length>0)},de=t=>{const o=t.target.value;f("property",o),C(o.length>0)},ce=t=>{f("property",t.property_name),C(!1)},le=t=>{const o=t.target.value;f("unit",o),S(o.length>0)},me=t=>{f("unit",t.unit_name),S(!1)},ue=t=>{const o=t.target.value;f("tenant",o),k(o.length>0)},xe=t=>{f("tenant",t.full_name),k(!1)},pe=()=>{W(s);const t=l.find(h=>h.city===s.city),o=r.find(h=>h.property_name===s.property),D=x.find(h=>h.unit_name===s.unit),Z=u.find(h=>h.full_name===s.tenant),p={};t?.id?p.city_id=t.id:s.city.trim()&&(p.city_name=s.city.trim()),o?.id?p.property_id=o.id:s.property.trim()&&(p.property_name=s.property.trim()),D?.id?p.unit_id=D.id:s.unit.trim()&&(p.unit_name=s.unit.trim()),Z?.id?p.tenant_id=Z.id:s.tenant.trim()&&(p.tenant_name=s.tenant.trim()),E.get(route("notice_and_evictions.index"),p,{preserveState:!0})},fe=()=>{Y({city:"",property:"",unit:"",tenant:""}),W({city:"",property:"",unit:"",tenant:""}),_(!1),C(!1),S(!1),k(!1),E.get(route("notice_and_evictions.index"),{},{preserveState:!1})},he=t=>{window.confirm("Delete this record? This cannot be undone.")&&E.delete(`/notice_and_evictions/${t.id}`)},be=t=>{V(t),A(!0)},ge=()=>{A(!1),V(null),E.reload()},ye=()=>{v(!1),E.reload()},Ne=()=>{if(!i||i.length===0){alert("No data to export");return}j(!0);try{console.log("Exporting notice and evictions data:",i);const t=`notice-evictions-${new Date().toISOString().split("T")[0]}.csv`;Be(i,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t instanceof Error?t.message:"Unknown error"}. Please check the console for details.`)}finally{j(!1)}},je=t=>{if(!t)return e.jsx(b,{variant:"outline",children:"N/A"});switch(t.toLowerCase()){case"active":return e.jsx(b,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:t});case"pending":return e.jsx(b,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:t});case"closed":return e.jsx(b,{variant:"outline",className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t});default:return e.jsx(b,{variant:"default",children:t})}},H=t=>!t||t==="-"?e.jsx(b,{variant:"outline",children:"N/A"}):e.jsx(b,{variant:t==="Yes"?"default":"secondary",className:t==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t}),{hasPermission:q,hasAnyPermission:X,hasAllPermissions:G}=Ae(),J=l.filter(t=>t.city.toLowerCase().includes(s.city.toLowerCase())),K=r.filter(t=>t.property_name.toLowerCase().includes(s.property.toLowerCase())),M=x.filter(t=>t.unit_name.toLowerCase().includes(s.unit.toLowerCase())),Q=u.filter(t=>t.full_name.toLowerCase().includes(s.tenant.toLowerCase()));return e.jsxs(Pe,{children:[e.jsx(ve,{title:"Notice & Evictions"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Notice & Evictions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:Ne,disabled:m||!i||i.length===0,className:"flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),m?"Exporting...":"Export CSV"]}),G(["notice-and-evictions.create","notice-and-evictions.store"])&&e.jsxs(g,{onClick:()=>v(!0),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Add Record"]})]})]}),e.jsxs(_e,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(Ce,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{ref:z,type:"text",placeholder:"City",value:s.city,onChange:ie,onFocus:()=>_(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(T,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),re&&J.length>0&&e.jsx("div",{ref:P,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:J.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ae(t),children:t.city},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{ref:U,type:"text",placeholder:"Property",value:s.property,onChange:de,onFocus:()=>C(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(T,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),ne&&K.length>0&&e.jsx("div",{ref:$,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:K.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>ce(t),children:t.property_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{ref:O,type:"text",placeholder:"Unit",value:s.unit,onChange:le,onFocus:()=>S(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(T,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),oe&&M.length>0&&e.jsx("div",{ref:L,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:M.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>me(t),children:t.unit_name},t.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{ref:F,type:"text",placeholder:"Tenant",value:s.tenant,onChange:ue,onFocus:()=>k(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(T,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),se&&Q.length>0&&e.jsx("div",{ref:I,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:Q.map(t=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>xe(t),children:t.full_name},t.id))})]}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:pe,variant:"default",className:"flex items-center",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(g,{onClick:fe,variant:"outline",className:"flex items-center",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(Se,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(Ee,{className:"border-collapse rounded-md border border-border",children:[e.jsx(De,{children:e.jsxs(ee,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City Name"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property Name"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit Name"}),e.jsx(d,{className:"sticky left-[390px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Tenants Name"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Status"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Date"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Type of Notice"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Have An Exception?"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Note"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Evictions"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Sent to Attorney"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Hearing Dates"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Evicted/Payment Plan"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"If Left?"}),e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Writ Date"}),X(["notice-and-evictions.show","notice-and-evictions.edit","notice-and-evictions.update","notice-and-evictions.destroy"])&&e.jsx(d,{className:"text-muted-foreground border border-border bg-muted",children:"Actions"})]})}),e.jsx(Re,{children:i.map(t=>e.jsxs(ee,{className:"border-border hover:bg-muted/50",children:[e.jsx(c,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.city_name||"N/A"}),e.jsx(c,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.property_name||"N/A"}),e.jsx(c,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.unit_name||"N/A"}),e.jsx(c,{className:"sticky left-[390px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:t.tenants_name||"N/A"}),e.jsx(c,{className:"border border-border text-center",children:je(t.status??null)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:N(t.date)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:t.type_of_notice||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(c,{className:"border border-border text-center",children:H(t.have_an_exception??null)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:t.note?e.jsx("div",{className:"max-w-24 truncate",title:t.note,children:t.note}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(c,{className:"text-foreground border border-border text-center",children:t.evictions||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(c,{className:"border border-border text-center",children:H(t.sent_to_atorney??null)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:N(t.hearing_dates)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:t.evected_or_payment_plan||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(c,{className:"border border-border text-center",children:H(t.if_left??null)}),e.jsx(c,{className:"text-foreground border border-border text-center",children:N(t.writ_date)}),X(["notice-and-evictions.show","notice-and-evictions.edit","notice-and-evictions.update","notice-and-evictions.destroy"])&&e.jsx(c,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[q("notice-and-evictions.show")&&e.jsx(we,{href:`/notice_and_evictions/${t.id}`,children:e.jsx(g,{variant:"outline",size:"sm",children:e.jsx(Oe,{className:"h-4 w-4"})})}),G(["notice-and-evictions.edit","notice-and-evictions.update"])&&e.jsx(g,{variant:"outline",size:"sm",onClick:()=>be(t),children:e.jsx(Fe,{className:"h-4 w-4"})}),q("notice-and-evictions.destroy")&&e.jsx(g,{variant:"outline",size:"sm",onClick:()=>he(t),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Te,{className:"h-4 w-4"})})]})})]},t.id))})]})}),i.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",i.length," records"]})})]})]})]})}),e.jsx($e,{open:n,onOpenChange:v,cities:l,properties:r,units:x,tenants:u,notices:y,onSuccess:ye}),w&&e.jsx(Le,{record:{...w,date:B(w.date),hearing_dates:B(w.hearing_dates),writ_date:B(w.writ_date)},cities:l,properties:r,units:x,tenants:u,notices:y,open:te,onOpenChange:A,onSuccess:ge})]})};export{At as default};
