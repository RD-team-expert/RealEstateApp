import{r as g,j as r,H as W,a as m}from"./app-B8FMPvUf.js";import{C as q,a as z,b as G}from"./card-EXxUjTX3.js";import{u as J}from"./usePermissions-DDZJFyXm.js";import{A as Q}from"./app-layout-HHYyJByv.js";import X from"./MoveOutCreateDrawer-DWfO8d93.js";import Y from"./MoveOutEditDrawer-CKGlCXzz.js";import Z from"./MoveOutEmptyState-CpW3ia4t.js";import O from"./MoveOutFilters-CVOq0wdO.js";import tt from"./MoveOutPageHeader-D4D60uK7.js";import et from"./MoveOutPagination-BtU9IfNS.js";import rt from"./MoveOutTable-vXUhXnw7.js";import{f as ot}from"./format-PYUiRpxY.js";import"./app-BrEbHAEe.js";import"./utils-CBfrqCZ4.js";import"./index-C_zQ9kkn.js";import"./index-CdJFUDDL.js";import"./button-DIZZiQM7.js";import"./index-fZywndxp.js";import"./index-CA_GOVUL.js";import"./index-Ci8SDCQb.js";import"./index-beSbUtJq.js";import"./index-CAMxjZm0.js";import"./index-3cnTBEqV.js";import"./x-krc9GB28.js";import"./createLucideIcon-C8-5KvOO.js";import"./index-Dc_FVRD7.js";import"./index-CvXZud_l.js";import"./index-9ieSGg2S.js";import"./index-FBpxi8-r.js";import"./collapsible-B8ysPJO2.js";import"./chevron-right-Ccb_WXJ_.js";import"./index-CguEkJq1.js";import"./log-out-C7Qs6DQr.js";import"./chevrons-up-down-BYxCyuCA.js";import"./app-logo-icon-CSXqq2B0.js";import"./house-BhACoC05.js";import"./building-T1TlENmS.js";import"./users-BhQQ2ox-.js";import"./wrench-Bs6df7J9.js";import"./credit-card-kB1xV1X0.js";import"./dollar-sign-nEWKnOrO.js";import"./file-text-fZr-uypS.js";import"./triangle-alert-D75nVc_W.js";import"./bell-DPKgkAwl.js";import"./drawer-By-qy253.js";import"./LocationSection-DHX-CKJ9.js";import"./FormField-BB_QbiaX.js";import"./label-mSIjHkAE.js";import"./TextInputField-FD8BVRQT.js";import"./input-DGLwPUn8.js";import"./popover-BMQC-RgO.js";import"./command-Byz7UfAg.js";import"./search-CLz9Z_Gu.js";import"./check-BVaiT64F.js";import"./DateFieldsSection-CH9KHAfm.js";import"./DatePickerField-BIygKQ9Q.js";import"./calendar-CzDWs5lf.js";import"./chevron-left-nbVEm8OA.js";import"./chevron-down-C7VOkDBv.js";import"./calendar-DesMu7qT.js";import"./PropertyDetailsSection-KU-UA0tr.js";import"./RadioGroupField-D963LPsH.js";import"./radioGroup-CuIQOkQ9.js";import"./index-BlkGWg27.js";import"./TextAreaField--R4tWc5y.js";import"./textarea-fJ4locy1.js";import"./StatusFieldsSection-bVw1BU4v.js";import"./LocationSelectionFields-DGJmA-U7.js";import"./MoveOutDateFields-BHASrh9m.js";import"./MoveOutDetailsFields-DiPOeUmg.js";import"./MoveOutStatusFields-xUIXoPqw.js";import"./download-v-3Aavkk.js";import"./plus-C7KcOOhZ.js";import"./table-CzYBox4s.js";import"./MoveOutTableRow-DyzuX9Xm.js";import"./badge-BGMBzjbn.js";import"./eye-DzrUIE3a.js";import"./square-pen-XBIJ3w8-.js";import"./trash-2-wJCybp_G.js";const _=(i,a="-")=>{if(!i)return a;const e=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!e)return a;const[,d,c,u]=e,s=new Date(Number(d),Number(c)-1,Number(u));return ot(s,"P")},b=i=>{if(!i)return"";const a=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!a)return"";const[,e,d,c]=a;return`${e}-${d}-${c}`},it=(i,a="move-outs.csv")=>{try{const e=t=>t==null?"":String(t).replace(/"/g,'""'),c=[["ID","City Name","Property Name","Unit Name","Tenants","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","All The Devices Are Off","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Renter","Move Out Form","Utility Type"].join(","),...i.map(t=>{try{return[t.id||"",`"${e(t.city_name)}"`,`"${e(t.property_name)}"`,`"${e(t.unit_name)}"`,`"${e(t.tenants)}"`,`"${_(t.move_out_date,"")}"`,`"${e(t.lease_status)}"`,`"${_(t.date_lease_ending_on_buildium,"")}"`,`"${e(t.keys_location)}"`,`"${e(t.utilities_under_our_name)}"`,`"${_(t.date_utility_put_under_our_name,"")}"`,`"${e(t.walkthrough)}"`,`"${e(t.all_the_devices_are_off)}"`,`"${e(t.repairs)}"`,`"${e(t.send_back_security_deposit)}"`,`"${e(t.notes)}"`,`"${e(t.cleaning)}"`,`"${e(t.list_the_unit)}"`,`"${e(t.renter)}"`,`"${e(t.move_out_form)}"`,`"${e(t.utility_type)}"`].join(",")}catch(x){return console.error("Error processing move-out row:",t,x),""}}).filter(t=>t!=="")].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),h=URL.createObjectURL(u);return s.setAttribute("href",h),s.setAttribute("download",a),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(h),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Ne({moveOuts:i,cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,filterCities:s,filterProperties:h,filterUnits:t,perPage:x}){const[D,$]=g.useState(!1),[N,C]=g.useState(!1),[U,P]=g.useState(!1),[y,L]=g.useState(null),[p,M]=g.useState(x??"15"),{hasPermission:R,hasAnyPermission:k,hasAllPermissions:E}=J(),f=typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,n={city:f.get("city")||void 0,property:f.get("property")||void 0,unit:f.get("unit")||void 0},S=i?.meta?.current_page??1,A=o=>{m.get(route("move-out.index"),{city:o.city_id,property:o.property_id,unit:o.unit_id,perPage:p},{preserveState:!0,preserveScroll:!0})},F=()=>{m.get(route("move-out.index"),{perPage:p},{preserveState:!1,preserveScroll:!0})},T=o=>{confirm("Are you sure you want to delete this move-out record?")&&m.delete(route("move-out.destroy",o.id),{data:{redirect_city:n.city??null,redirect_property:n.property??null,redirect_unit:n.unit??null,redirect_page:String(S),redirect_perPage:p},preserveState:!0,preserveScroll:!0})},I=o=>{M(o);const l=new URLSearchParams(window.location.search),v=l.get("city"),w=l.get("property"),j=l.get("unit");m.get(route("move-out.index"),{city:v||void 0,property:w||void 0,unit:j||void 0,perPage:o},{preserveState:!0,preserveScroll:!0})},H=()=>{if(!i||!i.data||i.data.length===0){alert("No data to export");return}$(!0);try{const o=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;it(i.data,o)}catch(o){console.error("Export failed:",o),alert(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}finally{$(!1)}},V=()=>{m.reload()},B=()=>{m.reload()},K=o=>{L(o),P(!0)};return r.jsxs(Q,{children:[r.jsx(W,{title:"Move-Out Management"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(tt,{hasCreatePermission:E(["move-out.create","move-out.store"]),isExporting:D,hasData:i?.data&&i.data.length>0,onExport:H,onAddNew:()=>C(!0)}),r.jsxs(q,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(z,{children:r.jsx(O,{cities:s,properties:h,allUnits:t,initialFilters:{city:n.city??"",property:n.property??"",unit:n.unit??""},onSearch:A,onClear:F})}),r.jsx(G,{children:i.data.length>0?r.jsxs(r.Fragment,{children:[r.jsx(rt,{moveOuts:i.data,formatDateOnly:_,hasPermission:R,hasAnyPermission:k,hasAllPermissions:E,onEdit:K,onDelete:T,filters:{city:n.city??void 0,property:n.property??void 0,unit:n.unit??void 0,perPage:p}}),i.meta&&r.jsx(et,{meta:i.meta,perPage:p,onPageChange:o=>{const l=new URLSearchParams(window.location.search),v=l.get("city"),w=l.get("property"),j=l.get("unit");m.get(route("move-out.index"),{city:v||void 0,property:w||void 0,unit:j||void 0,page:o,perPage:p},{preserveState:!0,preserveScroll:!0})}}),r.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),r.jsxs("select",{value:p,onChange:o=>I(o.target.value),className:"h-9 rounded-md border border-input bg-background px-3 text-sm text-foreground",children:[r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"30",children:"30"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]})]})]}):r.jsx(Z,{})})]})]})}),r.jsx(X,{cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,open:N,onOpenChange:C,onSuccess:V,redirectContext:{city:n.city??null,property:n.property??null,unit:n.unit??null,page:String(S),perPage:p}}),y&&r.jsx(Y,{cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,moveOut:{...y,move_out_date:b(y.move_out_date),date_lease_ending_on_buildium:b(y.date_lease_ending_on_buildium),date_utility_put_under_our_name:b(y.date_utility_put_under_our_name)},open:U,onOpenChange:P,onSuccess:B,redirectContext:{city:n.city??null,property:n.property??null,unit:n.unit??null,page:String(S),perPage:p}},y.id)]})}export{Ne as default};
