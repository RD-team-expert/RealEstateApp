import{r as p,u as z,j as o,H as G,a as _}from"./app-XlMZG7vD.js";import{C as J,a as K,b as Q}from"./card-BeQJ7hrb.js";import{u as W}from"./usePermissions-C5sl0_76.js";import{A as X}from"./app-layout-CGrAe6KQ.js";import Y from"./ApplicationCreateDrawer-D2Mw7IGW.js";import Z from"./ApplicationEditDrawer-DRyeJKt4.js";import tt from"./ApplicationsTable-DBJE6DpC.js";import rt from"./EmptyState-DetG5QcB.js";import et from"./FilterBar-8e0J2kCg.js";import ot from"./FlashMessages-BhgdVHKb.js";import it from"./PageHeader-0qBovLkS.js";import st from"./Pagination-BVFdWGrR.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./button-D56PIbu9.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./drawer-B7-2XtV2.js";import"./CityPropertyUnitSelector-CbqTrucw.js";import"./label-BKN3erGN.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./check-ZO7ekD6P.js";import"./ApplicantInformationSection-BcHs1kVI.js";import"./input-nhBJFe9F.js";import"./select-C9mJLkAA.js";import"./index-DdpYxxi8.js";import"./chevron-down-Dqt3V4Kg.js";import"./chevron-up-COk4jH4h.js";import"./application-CnwOiERd.js";import"./StatusAndDateSection-CoaPVmfz.js";import"./calendar-D02iCkay.js";import"./format-PYUiRpxY.js";import"./chevron-left-DiIjHAK0.js";import"./radioGroup-DrlpglLG.js";import"./calendar-CGMbx-hL.js";import"./AdditionalDetailsSection-Dfm1ehOE.js";import"./ApplicantInformationFields-CDbqImMM.js";import"./AttachmentField-CxOGmzfP.js";import"./rotate-ccw-CM7agk7Y.js";import"./CityPropertyUnitSelector-QvWDCKuS.js";import"./CurrentSelectionDisplay-3aTwKROb.js";import"./StageAndNotesFields-D160_IM3.js";import"./StatusAndDateFields-DnGbP5Ez.js";import"./table-Dsn5Ek_l.js";import"./ApplicationsTableRow-CAPsXJn6.js";import"./badge-amDNRRn_.js";import"./eye-L6iv3Y43.js";import"./square-pen-DJiq7j_0.js";import"./trash-2-CisDGbUX.js";import"./download-AfMUchev.js";import"./plus-Brzm8xdb.js";import"./pagination-BjxRxdxL.js";const at=(e,m="applications.csv")=>{try{const i=t=>t==null?"":String(t).replace(/"/g,'""'),u=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),g=t=>!t||t.length===0?"":t.map(n=>n.name).join("; "),f=[["ID","City","Property","Unit","Name","Co-signer","Status","Applicant Applied From","Date","Stage in Progress","Notes","Attachments Count","Attachment Names"].join(","),...e.map(t=>{try{return[t.id||"",`"${i(t.city)}"`,`"${i(t.property)}"`,`"${i(t.unit_name)}"`,`"${i(t.name)}"`,`"${i(t.co_signer)}"`,`"${i(t.status)}"`,`"${i(t.applicant_applied_from)}"`,`"${u(t.date)}"`,`"${i(t.stage_in_progress)}"`,`"${i(t.notes)}"`,t.attachments?.length||0,`"${g(t.attachments)}"`].join(",")}catch(n){return console.error("Error processing application row:",t,n),""}}).filter(t=>t!=="")].join(`
`),h=new Blob([f],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),c=URL.createObjectURL(h);return a.setAttribute("href",c),a.setAttribute("download",m),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(c),!0}catch(i){throw console.error("CSV Export Error:",i),i}};function Nr({applications:e,filters:m,cities:i,properties:u,units:g,filterCities:y,filterProperties:f,filterUnits:h}){const[a,c]=p.useState(!1),[t,n]=p.useState(!1),[S,E]=p.useState(null),[b,j]=p.useState(!1),{flash:w}=z().props,{hasPermission:A,hasAnyPermission:C,hasAllPermissions:F}=W(),[s,x]=p.useState({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),P=m?.per_page?String(m.per_page):String(e?.per_page??15),[l,D]=p.useState(P===String(e?.total??"")?"all":P);p.useEffect(()=>{const r=m||{};x({city:r.city||"",property:r.property||"",unit:r.unit||"",name:r.name||"",applicant_applied_from:r.applicant_applied_from||""})},[m]);const $=r=>{x(r),_.get(route("applications.index"),{...r,per_page:l,page:1},{preserveState:!0,preserveScroll:!0})},v=()=>{x({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),D("15"),_.get(route("applications.index"),{per_page:"15",page:1},{preserveState:!1})},O=r=>{confirm("Are you sure you want to delete this application?")&&_.delete(route("applications.destroy",r.id),{data:{filter_city:s.city||"",filter_property:s.property||"",filter_unit:s.unit||"",filter_name:s.name||"",filter_applicant_applied_from:s.applicant_applied_from||"",per_page:l,page:e.current_page},preserveState:!0,preserveScroll:!0})},k=()=>{if(!e||!e.data||e.data.length===0){alert("No data to export");return}j(!0);try{const r=`applications-${new Date().toISOString().split("T")[0]}.csv`;at(e.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}`)}finally{j(!1)}},N=()=>{c(!1)},I=()=>{n(!1),E(null)},U=r=>{E(r),n(!0)},L=(y||[]).map((r,d)=>({id:d+1,name:r})),R={0:(f||[]).map((r,d)=>({id:d+1,name:r,city_id:0}))},H={0:(h||[]).map((r,d)=>({id:d+1,name:r,property_id:0}))},V=F(["applications.create","applications.store"]),T=A("applications.show"),B=C(["applications.edit","applications.update"]),M=A("applications.destroy"),q=C(["applications.show","applications.edit","applications.update","applications.destroy"]);return o.jsxs(X,{children:[o.jsx(G,{title:"Applications"}),o.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:o.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[o.jsx(ot,{success:w?.success,error:w?.error}),o.jsx(it,{onExport:k,onAddNew:()=>c(!0),isExporting:b,hasExportData:!!(e?.data&&e.data.length>0),hasCreatePermission:V}),o.jsxs(J,{className:"bg-card text-card-foreground shadow-lg",children:[o.jsx(K,{children:o.jsx(et,{cities:L,properties:R,units:H,initialFilters:s,onSearch:$,onClear:v})}),o.jsx(Q,{children:e.data.length>0?o.jsxs(o.Fragment,{children:[o.jsx(tt,{applications:e.data,onEdit:U,onDelete:O,hasViewPermission:T,hasEditPermission:B,hasDeletePermission:M,hasAnyActionPermission:q,filters:s}),o.jsx(st,{links:e.links,meta:{current_page:e.current_page,last_page:e.last_page,per_page:e.per_page,total:e.total,from:e.from,to:e.to},filters:s,perPage:l,onPerPageChange:D})]}):o.jsx(rt,{})})]})]})}),o.jsx(Y,{cities:i,properties:u,units:g,open:a,onOpenChange:c,onSuccess:N,currentFilters:s,perPage:l,page:e.current_page}),S&&o.jsx(Z,{application:S,cities:i,properties:u,units:g,open:t,onOpenChange:n,onSuccess:I,currentFilters:s,perPage:l,page:e.current_page})]})}export{Nr as default};
