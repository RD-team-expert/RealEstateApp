import{r as i,u as st,b as ot,a as g,j as e,H as it}from"./app-C2rmVmHv.js";import{B as w}from"./button-VjjEP6Vi.js";import{C as at,a as nt,b as pt}from"./card-BCawuU56.js";import{u as mt}from"./usePermissions-DlQTT3jc.js";import{A as ct}from"./app-layout-CcTM2koj.js";import lt from"./UnitCreateDrawer-5FBoDN0A.js";import dt from"./UnitEditDrawer-kkFefCU1.js";import ut from"./Notification-D-PelqPo.js";import ht from"./ImportStatsCard-LkJd7VSU.js";import ft from"./ImportModal-DSaTzAnk.js";import L from"./FlashMessage-BJux_Udw.js";import gt from"./UnitsFilter-6-7d3CzT.js";import xt from"./UnitsTable-DgVNtm_Q.js";import St from"./Pagination-CINK1KCX.js";import{useNotification as yt}from"./useNotification-BckDPO2b.js";import{f as Ct}from"./format-PYUiRpxY.js";import{D as jt}from"./download-RRPPoM3D.js";import{U as _t}from"./upload-9c9LXE4Z.js";import{P as bt}from"./plus-Dp6PyI5R.js";import"./app-Ofegqgfz.js";import"./index-DjZQUolQ.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-Bbv7bqK3.js";import"./index-ChVvoAJ-.js";import"./index-DzsQSqwg.js";import"./index-C3pxZEMX.js";import"./index-B-E9P7_A.js";import"./index-_JNlNNro.js";import"./x-C2ppUAbT.js";import"./createLucideIcon-vG7_p-6g.js";import"./index-Dc_FVRD7.js";import"./index-CZcEh-_6.js";import"./index-CZ2k1_vM.js";import"./index-Dbu0mFfF.js";import"./collapsible-CZ_3skeY.js";import"./chevron-right-472QvEjp.js";import"./index-B1jceYVp.js";import"./log-out-Bl9yuoNL.js";import"./chevrons-up-down-9pvtZBV3.js";import"./app-logo-icon-I1Arm2U_.js";import"./house-Cu6g9NGV.js";import"./building-DnGM2oyN.js";import"./users-y_2O2ydA.js";import"./wrench-Bi6BgLf8.js";import"./credit-card-CJlpjKtZ.js";import"./dollar-sign-e0dBpTUR.js";import"./file-text-CSwIlsvU.js";import"./triangle-alert-CpQEc8Ny.js";import"./bell-y7p10Xnz.js";import"./drawer-D0-Vx3W3.js";import"./CitySelection-BtfrveYA.js";import"./label-Ck9md-qZ.js";import"./popover-BkIdV067.js";import"./command-DMwCmjrB.js";import"./search-D28ecmXm.js";import"./check-DMxaY1KP.js";import"./PropertySelection-CS1hPBxs.js";import"./UnitDetails-DaN5a1_R.js";import"./input-DlixSfKS.js";import"./TenantDetails-BRnGJiUS.js";import"./LeaseDates-DzM1T8GB.js";import"./calendar-BcRRCGMf.js";import"./chevron-left-D-ktVm-a.js";import"./chevron-down-CfuMUa4e.js";import"./calendar-BwHYHWG9.js";import"./UnitSpecifications-D93H9A9Y.js";import"./LeaseStatus-8msqKVbk.js";import"./radioGroup-D5Ix6zMl.js";import"./index-kc4RGjFa.js";import"./FinancialInformation-Bj28eyYz.js";import"./UtilityInformation-Bzx0Xiwo.js";import"./InsuranceInformation-Cl8tP7hk.js";import"./NewLease-6hziAv0F.js";import"./CityPropertySelector-Coxv2mlo.js";import"./FormSection-_vhpXCKs.js";import"./UnitDetailsFields-CcVdZXB-.js";import"./LeaseInformationFields-DZOL-dEv.js";import"./DatePickerField-D0ZW3bVw.js";import"./FinancialFields-BQZ5I8YT.js";import"./UtilitiesFields-NNEtlhxN.js";import"./InsuranceFields-CXuKaLkx.js";import"./CalculatedValuesDisplay-Cc-lrmQE.js";import"./circle-alert-CIZDP6D7.js";import"./circle-x-C5Fy6-G8.js";import"./circle-check-big-Dg2cQoBh.js";import"./file-spreadsheet-C0GVezxY.js";import"./loader-circle-JskuSBbf.js";import"./select-CZv-Yj7g.js";import"./chevron-up-BB7v6AqZ.js";import"./CityAutocomplete-Cua4OLm6.js";import"./PropertyAutocomplete-FlwYfxE_.js";import"./badge--CFw3i9B.js";import"./table-DkXsjxFg.js";import"./square-pen-Bv68EyOt.js";import"./trash-2-CCcs6h2C.js";const N=(s,c="-")=>{if(!s)return c;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return c;const[,d,u,a]=l,f=new Date(Number(d),Number(u)-1,Number(a));return Ct(f,"P")},Pt=(s,c="units.csv")=>{const d=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),u=new Blob([d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),f=URL.createObjectURL(u);a.setAttribute("href",f),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(f)};function ur({units:s,filters:c,cities:l,properties:d,importStats:u}){const{hasPermission:a,hasAnyPermission:f,hasAllPermissions:r}=mt(),[,E]=i.useState(c),[n,I]=i.useState(c),[x,D]=i.useState(String(s?.per_page??"15")),[U,$]=i.useState(!1),[A,C]=i.useState(!1),[O,T]=i.useState(!!u),[R,v]=i.useState(!1),[V,F]=i.useState(!1),[k,M]=i.useState(null),{flash:y}=st().props,[B,j]=i.useState(n.city||""),[H,_]=i.useState(n.property||""),{notification:b,showNotification:P,hideNotification:z}=yt(),h=ot({file:null,skip_duplicates:!0,update_existing:!1}),S=(t,o)=>{I({...n,[t]:o})},q=t=>{j(t),S("city",t)},G=t=>{j(t),S("city",t)},J=t=>{_(t),S("property",t)},K=t=>{_(t.property_name),S("property",t.property_name)},Q=()=>{E(n);const t={};Object.entries(n).forEach(([o,p])=>{p!=null&&p!==""&&(t[o]=String(p))}),t.per_page=String(x),g.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},W=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:"",is_new_lease:""};I(t),E(t),j(""),_(""),D("15"),g.get(route("units.index"),{per_page:"15"},{preserveState:!0,preserveScroll:!0})},X=t=>{if(confirm("Are you sure you want to delete this unit?")){const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),g.visit(route("units.destroy",t.id),{method:"delete",data:{redirect:{filters:o,per_page:String(x),page:String(s?.current_page??1)}},preserveState:!0,preserveScroll:!0})}},Y=t=>{M(t),F(!0)},Z=()=>{g.reload({only:["units","statistics"]})},tt=()=>{},et=()=>{if(s.data.length===0){alert("No data to export");return}$(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;Pt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{$(!1)}},rt=i.useCallback(t=>{h.setData("file",t),g.post(route("units.import"),{file:t,skip_duplicates:h.data.skip_duplicates,update_existing:h.data.update_existing},{forceFormData:!0,onSuccess:()=>{C(!1),h.reset(),P("success","CSV file imported successfully!")},onError:o=>{const p=o.file||"Failed to import CSV file. Please try again.";P("error",p)},onFinish:()=>{h.clearErrors()}})},[h,P]);return e.jsxs(ct,{children:[e.jsx(it,{title:"Units"}),b&&e.jsx(ut,{type:b.type,message:b.message,onClose:z}),e.jsx(ft,{isOpen:A,onClose:()=>C(!1),onSubmit:rt,isLoading:h.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx(L,{type:"success",message:y?.success}),y?.error&&e.jsx(L,{type:"error",message:y?.error}),O&&u&&e.jsx(ht,{stats:u,onClose:()=>T(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:et,disabled:U||s.data.length===0,className:"flex items-center",children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),U?"Exporting...":"Export CSV"]}),a("units.import")&&e.jsxs(w,{onClick:()=>C(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),f(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>v(!0),children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(at,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(nt,{children:e.jsx(gt,{filters:n,cities:l||[],properties:d||[],cityInput:B,propertyInput:H,onFilterChange:S,onCityInputChange:q,onCitySelect:G,onPropertyInputChange:J,onPropertySelect:K,onSearch:Q,onClear:W})}),e.jsxs(pt,{children:[e.jsx(xt,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:a("units.destroy"),onEdit:Y,onDelete:X}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(St,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,from:s.from,to:s.to,total:s.total,perPage:x,onPerPageChange:t=>{D(t);const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),o.per_page=String(t),g.get(route("units.index"),o,{preserveState:!0,preserveScroll:!0})}})]})]})]})}),e.jsx(lt,{open:R,onOpenChange:v,cities:l||[],properties:d||[],onSuccess:tt,redirectState:{filters:n,per_page:x,page:s?.current_page??1}}),k&&e.jsx(dt,{unit:k,cities:l||[],properties:d||[],open:V,onOpenChange:F,onSuccess:Z,redirectState:{filters:n,per_page:x,page:s?.current_page??1}})]})}export{ur as default};
