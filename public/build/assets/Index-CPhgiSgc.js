import{r as x,j as e,H as L,a as g}from"./app-IncGAUEB.js";import{C as R,a as F,b as H}from"./card-hD-4qfcw.js";import{u as q}from"./usePermissions-BWmUIPam.js";import{A as z}from"./app-layout-DdQ-RLDz.js";import G from"./EmptyState-nQPdkCg1.js";import J from"./FilterBar-BUgzqgwR.js";import K from"./PageHeader-DR6lA74W.js";import M from"./PaginationInfo-D_LmieLm.js";import Q from"./TaskTable-cN0n0xgA.js";import W from"./VendorTaskTrackerCreateDrawer-DQ05ZOfS.js";import X from"./VendorTaskTrackerEditDrawer-By2_qnxm.js";import{f as Y}from"./format-PYUiRpxY.js";import"./app-DgqXL21p.js";import"./utils-CBfrqCZ4.js";import"./index-bCzQdt7o.js";import"./index-CdJFUDDL.js";import"./button-BZreYh_c.js";import"./index-CfKQ6yNG.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./index-Dc_FVRD7.js";import"./index-DfV2_jol.js";import"./index-DfBxMdWp.js";import"./index-CoG2tpvC.js";import"./collapsible-CmadTdVI.js";import"./chevron-right-Dv0ELFzT.js";import"./index-X0Rqfk2m.js";import"./log-out-DkEuD3xv.js";import"./chevrons-up-down-D4md56fd.js";import"./app-logo-icon-BCIu8Oaa.js";import"./house-D_snjZK4.js";import"./building-DGN1JdDp.js";import"./users-DR4b9nxK.js";import"./wrench-j2xp49CP.js";import"./credit-card-nxx9uyGn.js";import"./dollar-sign-Do5zHV6l.js";import"./file-text-D45rT7Bs.js";import"./triangle-alert-D4SYorIn.js";import"./bell-c07z0V_k.js";import"./input-BKi6rfRv.js";import"./chevron-down-uas8HWR-.js";import"./search-CFDkSiim.js";import"./download-BTdncQqR.js";import"./plus-BVjqVSDl.js";import"./table-DyrYtZnv.js";import"./TaskTableRow-BLluEcdv.js";import"./badge-ByZ6dyck.js";import"./eye-tPH4cEEh.js";import"./square-pen-PIAnrcOq.js";import"./trash-2-DcRRmtsX.js";import"./drawer-BabOL_dj.js";import"./CitySection-CNWMi26j.js";import"./label-BhALl-XJ.js";import"./popover-D0q3r5CP.js";import"./command-AnX11QHu.js";import"./check-gd2_wZBq.js";import"./PropertySection-CYGVAlfu.js";import"./UnitSection-DOgUFviw.js";import"./VendorSection-OQPDgRMV.js";import"./TaskSubmissionDateSection-DbWw7bkF.js";import"./calendar-UFpA7cIJ.js";import"./chevron-left-WEUqp8UO.js";import"./calendar-CBsjNrh9.js";import"./ScheduledVisitsSection-CRNnMVzK.js";import"./TaskEndingDateSection-C2BKNsiz.js";import"./AssignedTasksSection-CTGBhNyi.js";import"./NotesSection-B-5rN0c9.js";import"./StatusSection-CDk6_fjM.js";import"./radioGroup-BhgCKDH3.js";import"./index-DizBXXCV.js";import"./UrgencySection-B4tSkYvV.js";import"./CitySelector-BdSgKTBC.js";import"./FormSection-DVFIgkKi.js";import"./PropertySelector-BCKtJ9c7.js";import"./UnitSelector-D7TlQrUt.js";import"./VendorSelector-Bx7nsvmD.js";import"./DatePickerField-B9m9GEYW.js";import"./TextAreaField-Dw1wcqev.js";import"./StatusRadioGroup-CmWKru7W.js";import"./UrgencyRadioGroup-DqcZWwg7.js";const h=(t,r="-")=>{if(!t)return r;const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(t);if(!c)return r;const[,d,l,m]=c,u=new Date(Number(d),Number(l)-1,Number(m));return Y(u,"P")},Z=(t,r="vendor-tasks.csv")=>{const d=[["ID","City","Property","Unit Name","Vendor Name","Submission Date","Assigned Tasks","Scheduled Visits","Task End Date","Notes","Status","Urgent"].join(","),...t.map(n=>[n.id,`"${n.city||""}"`,`"${n.property_name||""}"`,`"${n.unit_name||""}"`,`"${n.vendor_name||""}"`,`"${h(n.task_submission_date,"")}"`,`"${(n.assigned_tasks||"").replace(/"/g,'""')}"`,`"${h(n.any_scheduled_visits,"")}"`,`"${h(n.task_ending_date,"")}"`,`"${(n.notes||"").replace(/"/g,'""')}"`,`"${n.status||""}"`,`"${n.urgent}"`].join(","))].join(`
`),l=new Blob([d],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),u=URL.createObjectURL(l);m.setAttribute("href",u),m.setAttribute("download",r),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)};function Tr({tasks:t,filters:r,units:c,cities:d,properties:l,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,vendors:b}){const{hasPermission:v,hasAnyPermission:y,hasAllPermissions:k}=q(),[w,_]=x.useState(!1),[D,f]=x.useState(!1),[C,j]=x.useState(!1),[E,N]=x.useState(null),T=()=>{f(!1)},O=()=>{j(!1),N(null)},P=o=>{N(o),j(!0)},$=o=>{if(confirm("Are you sure you want to archive this task?")){const p={};Object.entries(r).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),g.delete(route("vendor-task-tracker.destroy",o.id),{data:{redirect_filters:p},preserveState:!0,preserveScroll:!0})}},A=()=>{if(t.data.length===0){alert("No data to export");return}_(!0);try{const o=`vendor-tasks-${new Date().toISOString().split("T")[0]}.csv`;Z(t.data,o)}catch(o){console.error("Export failed:",o),alert("Export failed. Please try again.")}finally{_(!1)}},V=o=>{const p={};Object.entries(o).forEach(([a,s])=>{s!=null&&s!==""&&(p[a]=String(s))}),r.per_page&&r.per_page!==""&&(p.per_page=String(r.per_page)),p.page="1",g.get(route("vendor-task-tracker.index"),p,{preserveState:!0,preserveScroll:!0})},I=()=>{const o={};r.per_page&&r.per_page!==""&&(o.per_page=String(r.per_page)),o.page="1",g.get(route("vendor-task-tracker.index"),o,{preserveState:!0,preserveScroll:!0})},U={canView:v("vendor-task-tracker.show"),canEdit:k(["vendor-task-tracker.edit","vendor-task-tracker.update"]),canDelete:v("vendor-task-tracker.destroy"),hasAnyPermission:y(["vendor-task-tracker.show","vendor-task-tracker.edit","vendor-task-tracker.update","vendor-task-tracker.destroy"])};return e.jsxs(z,{children:[e.jsx(L,{title:"Vendor Task Tracker"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(K,{onExport:A,onAddTask:()=>f(!0),isExporting:w,hasExportData:t.data.length>0,canCreate:k(["vendor-task-tracker.create","vendor-task-tracker.store"])}),e.jsxs(R,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(F,{children:e.jsx(J,{filters:r,cities:d,properties:l,units:c,vendors:b,onSearch:V,onClear:I})}),e.jsx(H,{children:t.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Q,{tasks:t.data,formatDateOnly:h,onEdit:P,onDelete:$,permissions:U,filters:r}),e.jsx(M,{meta:t.meta}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Per page:"}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-2 text-sm",value:r.per_page??"15",onChange:o=>{const p=o.target.value,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.per_page=p,a.page="1",g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:[e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"30",children:"30"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"all",children:"All"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)<=1,onClick:()=>{const p=Number(t.meta?.current_page??1)-1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",t.meta?.current_page??1," of ",t.meta?.last_page??1]}),e.jsx("button",{className:"inline-flex h-9 items-center rounded-md border border-input bg-background px-3 text-sm disabled:opacity-50",disabled:(r.per_page??"15")==="all"||(t.meta?.current_page??1)>=(t.meta?.last_page??1),onClick:()=>{const p=Number(t.meta?.current_page??1)+1,a={};Object.entries(r).forEach(([s,i])=>{i!=null&&i!==""&&(a[s]=String(i))}),a.page=String(p),g.get(route("vendor-task-tracker.index"),a,{preserveState:!0,preserveScroll:!0})},children:"Next"})]})]})]}):e.jsx(G,{})})]})]})}),e.jsx(W,{cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:D,onOpenChange:f,onSuccess:T}),E&&e.jsx(X,{task:E,cities:d,properties:l,units:c,vendors:b,unitsByCity:m,propertiesByCity:u,unitsByProperty:n,vendorsByCity:S,filters:r,open:C,onOpenChange:j,onSuccess:O})]})}export{Tr as default};
