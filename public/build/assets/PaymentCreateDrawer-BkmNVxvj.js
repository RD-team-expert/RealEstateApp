import{r as o,b as Q,j as t}from"./app-mUrH0ynJ.js";import{B as F}from"./button-BFBNYzQ-.js";import{D as T,a as W,b as X}from"./drawer-B7FkQmZP.js";import{DateField as Y}from"./DateField-mwox7LGi.js";import{CityField as Z}from"./CityField-CE4MqbZl.js";import{PropertyField as $}from"./PropertyField-D0fpEw_K.js";import{UnitField as ee}from"./UnitField-CGe6ssSg.js";import{FinancialFields as te}from"./FinancialFields-CYAiOcV6.js";import{AssistanceFields as re}from"./AssistanceFields-D6lSzGoc.js";import{PermanentField as ie}from"./PermanentField-r68i4nby.js";import{HiddenField as se}from"./HiddenField-5CH3rNhp.js";import{ReversedPaymentsField as ae}from"./ReversedPaymentsField-BN51duLy.js";import{NotesField as ne}from"./NotesField-iSCf1xOY.js";import{DebugInfo as oe}from"./DebugInfo-CZ2sVshg.js";import"./app-BxoA0TtB.js";import"./index-Co1yv0YL.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-CQgkcMAl.js";import"./index-CgzaaCP9.js";import"./index-Do303mGv.js";import"./index-D9BBn6e9.js";import"./index-bRwiAiPA.js";import"./index-kDRJ7vWo.js";import"./x-BVVw4O5L.js";import"./createLucideIcon-DUXn48BB.js";import"./calendar-DAc8iCNl.js";import"./format-PYUiRpxY.js";import"./chevron-left-Bx0Sy0a0.js";import"./chevron-right-o746ehSI.js";import"./chevron-down-CcniYHCH.js";import"./label-DmNL2-zA.js";import"./popover-B07j7TfD.js";import"./index-DEcWu7_s.js";import"./index-5IheD20q.js";import"./calendar-e6qKYHCo.js";import"./select-NL-VGbzo.js";import"./index-Dc_FVRD7.js";import"./index-DK4fbPLM.js";import"./index-CXBw7cFo.js";import"./index-p6YNWFgp.js";import"./check-nxBTAIc9.js";import"./chevron-up-Cls6AU_3.js";import"./input-Bo52L6_R.js";import"./checkbox-DRw3b_WF.js";import"./index-I5U3wwZt.js";import"./radioGroup-DvkZrWpP.js";function tt({units:v,cities:U,unitsByCity:D,propertiesByCity:A,open:V,onOpenChange:b,onSuccess:N}){const[I,u]=o.useState(""),[H,p]=o.useState(""),[O,d]=o.useState(""),[R,f]=o.useState(""),[k,h]=o.useState(""),[B,z]=o.useState(!1),[i,C]=o.useState(""),[a,y]=o.useState(""),[c,l]=o.useState(""),{data:r,setData:s,post:q,processing:g,errors:m,reset:E}=Q({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:"",is_hidden:!1}),P=()=>i?A[i]||[]:[],j=()=>i?a?v.filter(e=>e.city===i&&e.property_name===a).map(e=>e.unit_name):D[i]||[]:[],G=(e,n,_)=>{const S=v.find(x=>x.city===e&&x.property_name===n&&x.unit_name===_);return S?S.id:null};o.useEffect(()=>{i&&a&&(P().includes(a)||(y(""),l(""),s("unit_id","")))},[i]),o.useEffect(()=>{a&&c&&(j().includes(c)||(l(""),s("unit_id","")))},[i,a]);const J=e=>{C(e),y(""),l(""),s("unit_id",""),u(""),p(""),d("")},K=e=>{y(e),l(""),s("unit_id",""),p(""),d("")},L=e=>{if(l(e),d(""),i&&a&&e){const n=G(i,a,e);n&&s("unit_id",n.toString())}},w=e=>{e.preventDefault(),u(""),p(""),d(""),f(""),h("");let n=!1;(!r.date||r.date.trim()==="")&&(f("Please select a date before submitting the form."),n=!0),(!i||i.trim()==="")&&(u("Please select a city before submitting the form."),n=!0),(!a||a.trim()==="")&&(p("Please select a property before submitting the form."),n=!0),(!c||c.trim()==="")&&(d("Please select a unit before submitting the form."),n=!0),(!r.owes||r.owes.trim()==="")&&(h("Please enter the amount owed before submitting the form."),n=!0),(!r.unit_id||r.unit_id.trim()==="")&&(d("Unable to identify the selected unit. Please try selecting again."),n=!0),!n&&q(route("payments.store"),{onSuccess:()=>{E(),C(""),y(""),l(""),u(""),p(""),d(""),f(""),h(""),b(!1),N?.()},onError:_=>{console.error("Form submission errors:",_)}})},M=()=>{E(),C(""),y(""),l(""),u(""),p(""),d(""),f(""),h(""),b(!1)};return t.jsx(T,{open:V,onOpenChange:b,modal:!1,children:t.jsx(W,{size:"half",title:"Create New Payment",children:t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsxs("form",{onSubmit:w,className:"space-y-4",children:[t.jsx(Z,{cities:U,selectedCity:i,onCityChange:J,validationError:I,unitIdError:m.unit_id}),t.jsx($,{selectedProperty:a,availableProperties:P(),onPropertyChange:K,disabled:!i,validationError:H}),t.jsx(ee,{selectedUnit:c,availableUnits:j(),onUnitChange:L,disabled:!i,validationError:O}),t.jsx(Y,{date:r.date,onDateChange:e=>{s("date",e),f("")},calendarOpen:B,onCalendarOpenChange:z,validationError:R,dateError:m.date}),t.jsx(te,{owes:r.owes,paid:r.paid,onOwesChange:e=>{s("owes",e),h("")},onPaidChange:e=>s("paid",e),owesError:m.owes,paidError:m.paid,owesValidationError:k}),t.jsx(re,{hasAssistance:r.has_assistance,assistanceAmount:r.assistance_amount,assistanceCompany:r.assistance_company,onHasAssistanceChange:e=>s("has_assistance",e),onAssistanceAmountChange:e=>s("assistance_amount",e),onAssistanceCompanyChange:e=>s("assistance_company",e),assistanceAmountError:m.assistance_amount,assistanceCompanyError:m.assistance_company}),t.jsx(ie,{permanent:r.permanent,onPermanentChange:e=>s("permanent",e),error:m.permanent}),t.jsx(se,{isHidden:r.is_hidden,onHiddenChange:e=>s("is_hidden",e)}),t.jsx(ae,{reversedPayments:r.reversed_payments,onReversedPaymentsChange:e=>s("reversed_payments",e),error:m.reversed_payments}),t.jsx(ne,{notes:r.notes,onNotesChange:e=>s("notes",e),error:m.notes}),t.jsx(oe,{unitId:r.unit_id,selectedCity:i,selectedProperty:a,selectedUnit:c})]})}),t.jsx(X,{className:"border-t bg-muted/50 p-4",children:t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(F,{type:"button",variant:"outline",onClick:M,disabled:g,children:"Cancel"}),t.jsx(F,{type:"submit",onClick:w,disabled:g,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:g?"Creating...":"Create Payment"})]})})]})})})}export{tt as default};
