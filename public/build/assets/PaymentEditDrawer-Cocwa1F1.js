import{r as n,b as me,j as e}from"./app-DVDXdM1j.js";import{B as F}from"./createLucideIcon-f9blZpYt.js";import{P as ue,a as pe,p as K,b as he,C as fe}from"./popover-GGagVvOt.js";import{D as xe,a as be,b as ve}from"./drawer-xioPoqbP.js";import{I as R}from"./input-CAZvlv5n.js";import{L as c}from"./label-Bq1y09-X.js";import{R as je}from"./radioGroup-Cj9qUiCJ.js";import{S as I,a as U,b as k,c as M,d as O}from"./select-TGrDkT3T.js";import{C as ge}from"./calendar-UWhjVqRM.js";import{f as Q,i as W}from"./format-PYUiRpxY.js";import"./app-CjmCCaLt.js";import"./chevron-right-Jq5zNY5a.js";import"./chevron-up-BWfV-rK5.js";import"./index-DdPbNFmK.js";import"./index-r4aKh8Jv.js";import"./index-u4YCQuA6.js";import"./index-CgivZZgh.js";import"./index-B6MCHojI.js";import"./index-Bh7wV6bP.js";import"./index-CgpEdb5b.js";import"./index-DWj7wjkv.js";function Le({payment:s,units:A,cities:X,unitsByCity:Z,propertiesByCity:ee,open:y,onOpenChange:w,onSuccess:te}){const b=n.useRef(null),v=n.useRef(null),j=n.useRef(null),g=n.useRef(null),N=n.useRef(null),[$,z]=n.useState(""),[B,_]=n.useState(""),[L,u]=n.useState(""),[T,S]=n.useState(""),[Y,C]=n.useState(""),[re,P]=n.useState(!1),[a,E]=n.useState(""),[d,p]=n.useState(""),[h,m]=n.useState(""),{data:i,setData:o,put:se,processing:V,errors:l}=me({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No"});n.useEffect(()=>{s&&y&&(o({date:s.date??"",unit_id:s.unit_id?.toString()??"",owes:s.owes?.toString()??"",paid:s.paid?.toString()??"",status:s.status??"",notes:s.notes??"",reversed_payments:s.reversed_payments??"",permanent:s.permanent??"No"}),E(s.city??""),p(s.property_name??""),m(s.unit_name??""),f())},[s,y]);const f=()=>{z(""),_(""),u(""),S(""),C("")},G=()=>a?ee[a]||[]:[],q=()=>a?d?A.filter(t=>t.city===a&&t.property_name===d).map(t=>t.unit_name):Z[a]||[]:[],ae=(t,r,x)=>{const J=A.find(D=>D.city===t&&D.property_name===r&&D.unit_name===x);return J?J.id:null};n.useEffect(()=>{a&&d&&(G().includes(d)||(p(""),m(""),o(r=>({...r,unit_id:""}))))},[a]),n.useEffect(()=>{d&&h&&(q().includes(h)||(m(""),o(r=>({...r,unit_id:""}))))},[a,d]);const ne=t=>{E(t),p(""),m(""),o(r=>({...r,unit_id:""})),f()},ie=t=>{p(t),m(""),o(r=>({...r,unit_id:""})),_(""),u("")},le=t=>{if(m(t),u(""),a&&d&&t){const r=ae(a,d,t);r&&o(x=>({...x,unit_id:r.toString()}))}},oe=t=>{t&&(o(r=>({...r,date:Q(t,"yyyy-MM-dd")})),S(""),P(!1))},de=t=>{o(r=>({...r,owes:t.target.value})),C("")},H=t=>{t.preventDefault(),f();let r=!1;(!i.date||i.date.trim()==="")&&(S("Please select a date before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!a||a.trim()==="")&&(z("Please select a city before submitting the form."),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!d||d.trim()==="")&&(_("Please select a property before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!h||h.trim()==="")&&(u("Please select a unit before submitting the form."),j.current&&(j.current.focus(),j.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.owes||i.owes.trim()==="")&&(C("Please enter the amount owed before submitting the form."),N.current&&(N.current.focus(),N.current.scrollIntoView({behavior:"smooth",block:"center"})),r=!0),(!i.unit_id||i.unit_id.trim()==="")&&(u("Unable to identify the selected unit. Please try selecting again."),r=!0),!r&&se(route("payments.update",s.id),{onSuccess:()=>{f(),w(!1),te?.()},onError:x=>{console.error("Form submission errors:",x)}})},ce=()=>{s&&(o({date:s.date??"",unit_id:s.unit_id?.toString()??"",owes:s.owes?.toString()??"",paid:s.paid?.toString()??"",status:s.status??"",notes:s.notes??"",reversed_payments:s.reversed_payments??"",permanent:s.permanent??"No"}),E(s.city??""),p(s.property_name??""),m(s.unit_name??"")),f(),P(!1),w(!1)};return e.jsx(xe,{open:y,onOpenChange:w,modal:!1,children:e.jsx(be,{size:"half",title:`Edit Payment #${s.id}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(I,{onValueChange:ne,value:a||void 0,children:[e.jsx(U,{ref:b,children:e.jsx(k,{placeholder:"Select city"})}),e.jsx(M,{children:X?.map(t=>e.jsx(O,{value:t,children:t},t))||[]})]}),l.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.unit_id}),$&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:$})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"property_name",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(I,{onValueChange:ie,value:d||void 0,disabled:!a,children:[e.jsx(U,{ref:v,children:e.jsx(k,{placeholder:a?"Select property":"Select city first"})}),e.jsx(M,{children:G().map(t=>e.jsx(O,{value:t,children:t},t))})]}),B&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:B})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"unit_name",className:"text-base font-semibold",children:"Unit Name *"})}),e.jsxs(I,{onValueChange:le,value:h||void 0,disabled:!a,children:[e.jsx(U,{ref:j,children:e.jsx(k,{placeholder:a?"Select unit":"Select city first"})}),e.jsx(M,{children:q().map(t=>e.jsx(O,{value:t,children:t},t))})]}),L&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:L})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"date",className:"text-base font-semibold",children:"Date *"})}),e.jsxs(ue,{open:re,onOpenChange:P,modal:!1,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(F,{ref:g,variant:"outline",className:`w-full justify-start text-left font-normal ${!i.date&&"text-muted-foreground"}`,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),i.date?(()=>{try{const t=K(i.date,"yyyy-MM-dd",new Date);return W(t)?Q(t,"PPP"):"Invalid date"}catch{return"Invalid date"}})():"Pick a date"]})}),e.jsx(he,{className:"z-[60] w-auto p-0",onOpenAutoFocus:t=>t.preventDefault(),children:e.jsx(fe,{mode:"single",selected:(()=>{try{if(!i.date)return;const t=K(i.date,"yyyy-MM-dd",new Date);return W(t)?t:void 0}catch{return}})(),onSelect:oe,initialFocus:!0})})]}),l.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.date}),T&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"owes",className:"text-base font-semibold",children:"Owes *"})}),e.jsx(R,{ref:N,id:"owes",type:"number",step:"0.01",min:"0",value:i.owes,onChange:de,placeholder:"Enter amount owed"}),l.owes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.owes}),Y&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Y})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"paid",className:"text-base font-semibold",children:"Paid"})}),e.jsx(R,{id:"paid",type:"number",step:"0.01",min:"0",value:i.paid,onChange:t=>o(r=>({...r,paid:t.target.value})),placeholder:"Enter amount paid"}),l.paid&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.paid})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-cyan-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"permanent",className:"text-base font-semibold",children:"Permanent *"})}),e.jsx(je,{value:i.permanent,onValueChange:t=>o(r=>({...r,permanent:t})),name:"permanent",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),l.permanent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.permanent})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"reversed_payments",className:"text-base font-semibold",children:"Reversed Payments?"})}),e.jsx(R,{id:"reversed_payments",value:i.reversed_payments,onChange:t=>o(r=>({...r,reversed_payments:t.target.value})),placeholder:"Enter reversed payments information"}),l.reversed_payments&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.reversed_payments})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(c,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",className:"w-full rounded-md border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none",value:i.notes,onChange:t=>o(r=>({...r,notes:t.target.value})),rows:3,placeholder:"Enter any additional notes..."}),l.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.notes})]}),!1]})}),e.jsx(ve,{className:"border-t bg-muted/50 p-4",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(F,{type:"button",variant:"outline",onClick:ce,disabled:V,children:"Cancel"}),e.jsx(F,{type:"submit",onClick:H,disabled:V,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:V?"Updating...":"Update Payment"})]})})]})})})}export{Le as default};
