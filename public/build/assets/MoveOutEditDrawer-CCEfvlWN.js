import{r as a,b as J,j as r}from"./app-IncGAUEB.js";import{D as K,a as Q,b as W}from"./drawer-BabOL_dj.js";import{B as F}from"./button-BZreYh_c.js";import{LocationSelectionFields as X}from"./LocationSelectionFields-B-AOYBZU.js";import{MoveOutDateFields as Y}from"./MoveOutDateFields-DcvAwahR.js";import{MoveOutDetailsFields as Z}from"./MoveOutDetailsFields-DGgFjyRz.js";import{MoveOutStatusFields as $}from"./MoveOutStatusFields-C5yNRitP.js";import"./app-DgqXL21p.js";import"./index-CfKQ6yNG.js";import"./index-bCzQdt7o.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./label-BhALl-XJ.js";import"./input-BKi6rfRv.js";import"./popover-D0q3r5CP.js";import"./index-DfBxMdWp.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./chevrons-up-down-D4md56fd.js";import"./check-gd2_wZBq.js";import"./calendar-UFpA7cIJ.js";import"./format-PYUiRpxY.js";import"./chevron-left-WEUqp8UO.js";import"./chevron-right-Dv0ELFzT.js";import"./chevron-down-uas8HWR-.js";import"./calendar-CBsjNrh9.js";import"./radioGroup-BhgCKDH3.js";import"./index-X0Rqfk2m.js";import"./index-DizBXXCV.js";import"./textarea-Dt1hfgQe.js";function Ue({cities:c,properties:x,propertiesByCityId:o,unitsByPropertyId:_,allUnits:p,moveOut:e,open:M,onOpenChange:w,onSuccess:U,redirectContext:u}){const f=a.useRef(null),m=a.useRef(null),h=a.useRef(null),[V,l]=a.useState({city:"",property:"",unit:""}),[D,C]=a.useState(null),[E,j]=a.useState(null),[N,y]=a.useState(null),[z,k]=a.useState([]),[L,b]=a.useState([]),{data:d,setData:s,put:T,processing:R,errors:g,transform:q}=J({unit_id:e.unit_id||null,tenants:e.tenants||"",move_out_date:e.move_out_date||"",lease_status:e.lease_status||"",date_lease_ending_on_buildium:e.date_lease_ending_on_buildium||"",keys_location:e.keys_location||"",utilities_under_our_name:e.utilities_under_our_name||"",date_utility_put_under_our_name:e.date_utility_put_under_our_name||"",walkthrough:e.walkthrough||"",all_the_devices_are_off:e.all_the_devices_are_off||"",repairs:e.repairs||"",send_back_security_deposit:e.send_back_security_deposit||"",notes:e.notes||"",cleaning:e.cleaning||"",list_the_unit:e.list_the_unit||"",renter:e.renter||"",move_out_form:e.move_out_form||"",utility_type:e.utility_type||""});a.useEffect(()=>{if(e&&p&&Array.isArray(p)&&Array.isArray(c)&&Array.isArray(x)){const n=p.find(t=>t.unit_name===e.unit_name);if(n){const t=c.find(S=>S.city===e.city_name),i=x.find(S=>S.property_name===e.property_name);t&&(C(t.id),o&&o[t.id]&&k(o[t.id])),i&&(j(i.id),_&&_[i.id]&&b(_[i.id])),y(n.id),s("unit_id",n.id)}}},[e,p,c,x,o,_]);const G=n=>{const t=parseInt(n);C(t),j(null),y(null),s("unit_id",null),l(i=>({...i,city:"",property:"",unit:""})),t&&o[t]?k(o[t]):k([]),b([])},H=n=>{const t=parseInt(n);j(t),y(null),s("unit_id",null),l(i=>({...i,property:"",unit:""})),t&&_[t]?b(_[t]):b([])},I=n=>{const t=parseInt(n);y(t),s("unit_id",t),l(i=>({...i,unit:""}))},A=n=>{n.preventDefault(),l({city:"",property:"",unit:""});let t=!1;D||(l(i=>({...i,city:"Please select a city before submitting the form."})),f.current&&(f.current.focus(),f.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),E||(l(i=>({...i,property:"Please select a property before submitting the form."})),m.current&&(m.current.focus(),m.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!N||!d.unit_id)&&(l(i=>({...i,unit:"Please select a unit before submitting the form."})),h.current&&(h.current.focus(),h.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),!t&&(q(i=>({...i,move_out_date:i.move_out_date?.trim()?i.move_out_date:null,date_lease_ending_on_buildium:i.date_lease_ending_on_buildium?.trim()?i.date_lease_ending_on_buildium:null,date_utility_put_under_our_name:i.date_utility_put_under_our_name?.trim()?i.date_utility_put_under_our_name:null,redirect_city:u?.city??null,redirect_property:u?.property??null,redirect_unit:u?.unit??null,redirect_page:u?.page??null,redirect_perPage:u?.perPage??null})),T(route("move-out.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{P(),U?.()}}))},P=()=>{s({unit_id:e.unit_id||null,tenants:e.tenants||"",move_out_date:e.move_out_date||"",lease_status:e.lease_status||"",date_lease_ending_on_buildium:e.date_lease_ending_on_buildium||"",keys_location:e.keys_location||"",utilities_under_our_name:e.utilities_under_our_name||"",date_utility_put_under_our_name:e.date_utility_put_under_our_name||"",walkthrough:e.walkthrough||"",all_the_devices_are_off:e.all_the_devices_are_off||"",repairs:e.repairs||"",send_back_security_deposit:e.send_back_security_deposit||"",notes:e.notes||"",cleaning:e.cleaning||"",list_the_unit:e.list_the_unit||"",renter:e.renter||"",move_out_form:e.move_out_form||"",utility_type:e.utility_type||""}),l({city:"",property:"",unit:""}),w(!1)};return r.jsx(K,{open:M,onOpenChange:w,modal:!1,children:r.jsx(Q,{size:"half",title:"Edit Move-Out Record",children:r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"flex-1 overflow-auto p-6",children:r.jsxs("form",{onSubmit:A,className:"space-y-4",children:[r.jsx(X,{cities:c,availableProperties:z,availableUnits:L,selectedCity:D,selectedProperty:E,selectedUnit:N,validationErrors:V,cityRef:f,propertyRef:m,unitRef:h,onCityChange:G,onPropertyChange:H,onUnitChange:I,tenants:d.tenants,tenantsError:g.tenants,onTenantsChange:n=>s("tenants",n)}),r.jsx(Y,{data:d,errors:g,onDataChange:s}),r.jsx(Z,{data:d,errors:g,onDataChange:s}),r.jsx($,{data:d,errors:g,onDataChange:s})]})}),r.jsx(W,{children:r.jsxs("div",{className:"flex gap-2 w-full",children:[r.jsx(F,{type:"button",variant:"outline",onClick:P,className:"flex-1",children:"Cancel"}),r.jsx(F,{type:"submit",onClick:A,disabled:R,className:"flex-1",children:R?"Updating...":"Update Move-Out Record"})]})})]})})})}export{Ue as default};
