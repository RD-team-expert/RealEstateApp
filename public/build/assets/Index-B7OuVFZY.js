import{r as a,u as R,b as V,a as u,j as e,H as q}from"./app-DIEWn7Ix.js";import{C as B,a as z,b as G}from"./card-D0lM0cRg.js";import{u as J}from"./usePermissions-C5kTLoeu.js";import{A as K}from"./app-layout-C9S1njiG.js";import Q from"./TenantCreateDrawer-BVaGTJbS.js";import W from"./TenantEditDrawer-PXTCe0PC.js";import{FlashMessages as X}from"./FlashMessages-B29LltTy.js";import{ImportModal as Y}from"./ImportModal-DWmtpWno.js";import{ImportStatsCard as Z}from"./ImportStatsCard-CJKa4Z4-.js";import{Notification as ee}from"./Notification-CsHw7JDq.js";import{TenantFilters as te}from"./TenantFilters-CZBVeSk2.js";import{TenantPageHeader as re}from"./TenantPageHeader-BPREn00f.js";import{TenantTable as oe}from"./TenantTable-6M9L3-LO.js";import{useNotification as se}from"./useNotification-Dhwehcpb.js";import"./app-ChTVGdbA.js";import"./utils-CBfrqCZ4.js";import"./index-Bt0zfGgm.js";import"./index-CdJFUDDL.js";import"./button-C0qpziZb.js";import"./index-DKA-WKms.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./index-Dc_FVRD7.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-BuLzMHmv.js";import"./collapsible-D1_DD34n.js";import"./chevron-right-lBI-HPj1.js";import"./index-Bp33PYYw.js";import"./log-out-CE4a_W2h.js";import"./chevrons-up-down-wcdr16Hr.js";import"./app-logo-icon-BrLszCI4.js";import"./house-DKj--ObP.js";import"./building-CBRSJYqv.js";import"./users-B43C_7xE.js";import"./wrench-DwJ9zT3b.js";import"./credit-card-D-F9DsZs.js";import"./dollar-sign-CTn_hGqc.js";import"./file-text-BkIwiqXy.js";import"./triangle-alert-mmtwxqk7.js";import"./bell-CBmeO6wA.js";import"./drawer-fqLIckn8.js";import"./CitySelectionSection-gFGoJh5f.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./PropertySelectionSection-g35_xrnk.js";import"./UnitSelectionSection-DWWg3-XL.js";import"./PersonalInformationSection-AjRqso31.js";import"./FormField-D_xWcg2t.js";import"./input-Dp80VBC1.js";import"./ContactInformationSection-B-TPxWMP.js";import"./PaymentAndPreferencesSection-B8RMxxqp.js";import"./RadioGroupField-C2CFTQTE.js";import"./radioGroup-BEE05Kck.js";import"./AssistanceSection-7M17Uv3w.js";import"./LocationSection-B_XHfsSQ.js";import"./PersonalInfoSection-DfU6Rm9c.js";import"./ContactInfoSection-KFwbvaFY.js";import"./PreferencesSection-cX02YP2S.js";import"./AssistanceSection-Cj9bA-Oa.js";import"./file-spreadsheet-cfLteSY8.js";import"./upload-CbKC-Y5O.js";import"./loader-circle-DunDFCHN.js";import"./circle-check-big-CnlFTzVi.js";import"./circle-alert-BKK80Ky4.js";import"./circle-x-CCzLNqA-.js";import"./search-Cudh47UL.js";import"./rotate-ccw-DWQL1Wy9.js";import"./download-C1kHH7o-.js";import"./plus-DhhAwnw0.js";import"./badge-n90aW425.js";import"./table-CvyjvZRw.js";import"./square-pen-BESSjlPV.js";import"./trash-2-BbHlzFlW.js";const ie=(o,n="tenants.csv")=>{const m=[["ID","City","Property Name","Unit Number","First Name","Last Name","Street Address","Login Email","Alternate Email","Mobile","Emergency Phone","Payment Method","Has Insurance","Sensitive Communication","Has Assistance","Assistance Amount","Assistance Company"].join(","),...o.map(t=>[t.id,`"${t.city_name||""}"`,`"${t.property_name||""}"`,`"${t.unit_number||""}"`,`"${t.first_name||""}"`,`"${t.last_name||""}"`,`"${(t.street_address_line||"").replace(/"/g,'""')}"`,`"${t.login_email||""}"`,`"${t.alternate_email||""}"`,`"${t.mobile||""}"`,`"${t.emergency_phone||""}"`,`"${t.cash_or_check||""}"`,`"${t.has_insurance||""}"`,`"${t.sensitive_communication||""}"`,`"${t.has_assistance||""}"`,`"${t.assistance_amount||""}"`,`"${(t.assistance_company||"").replace(/"/g,'""')}"`].join(","))].join(`
`),d=new Blob([m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),c=URL.createObjectURL(d);s.setAttribute("href",c),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};function Lt({tenants:o,search:n,cities:l,properties:m,unitsByProperty:d,importStats:s}){const{hasPermission:c,hasAnyPermission:t,hasAllPermissions:g}=J(),[E,y]=a.useState(!1),[N,h]=a.useState(!1),[v,$]=a.useState(!!s),[A,S]=a.useState(!1),[T,j]=a.useState(!1),[b,f]=a.useState(null),{flash:w}=R().props,{notification:x,showNotification:i,hideNotification:D}=se(),p=V({file:null,skip_duplicates:!1}),I=r=>{u.get(route("tenants.index"),{search:r.search,city:r.city,property:r.property,unit_name:r.unitName},{preserveState:!0})},F=()=>{u.get(route("tenants.index"),{},{preserveState:!1,replace:!0})},P=r=>{confirm(`Are you sure you want to archive ${r.first_name} ${r.last_name}? This will hide them from the main list but they can be restored later.`)&&u.patch(route("tenants.archive",r.id),{},{onSuccess:()=>{i("success","Tenant archived successfully!")},onError:()=>{i("error","Failed to archive tenant. Please try again.")}})},k=r=>{f(r),j(!0)},L=()=>{i("success","Tenant updated successfully!"),f(null)},M=()=>{if(o.length===0){alert("No data to export");return}y(!0);try{const r=`tenants-${new Date().toISOString().split("T")[0]}.csv`;ie(o,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{y(!1)}},H=a.useCallback((r,C)=>{p.setData({file:r,skip_duplicates:C}),u.post(route("tenants.import.process"),{file:r,skip_duplicates:C},{forceFormData:!0,onSuccess:()=>{h(!1),p.reset(),i("success","CSV file imported successfully!")},onError:_=>{const U=_.file||_.import||"Failed to import CSV file. Please try again.";i("error",U)},onFinish:()=>{p.clearErrors()}})},[p,i]),O=Array.from(new Set(o.map(r=>r.unit_number).filter(Boolean)));return e.jsxs(K,{children:[e.jsx(q,{title:"Tenants"}),x&&e.jsx(ee,{type:x.type,message:x.message,onClose:D}),e.jsx(Y,{isOpen:N,onClose:()=>h(!1),onSubmit:H,isLoading:p.processing}),e.jsx(Q,{open:A,onOpenChange:()=>S(!1),cities:l,properties:m,unitsByProperty:d,onSuccess:()=>i("success","Tenant created successfully!")}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(X,{success:w?.success,error:w?.error}),v&&s&&e.jsx(Z,{stats:s,onClose:()=>$(!1)}),e.jsx(re,{onExport:M,onImport:()=>h(!0),onAddNew:()=>S(!0),isExporting:E,hasExportData:o.length>0,canImport:c("tenants.import"),canCreate:g(["tenants.create","tenants.store"])}),e.jsxs(B,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(z,{children:e.jsx(te,{cities:l,properties:m,uniqueUnitNames:O,onSearch:I,onClear:F,initialFilters:{city:"",property:"",unitName:"",search:n||""}})}),e.jsxs(G,{className:"p-6",children:[e.jsx(oe,{tenants:o,onEdit:k,onDelete:P,canEdit:g(["tenants.edit","tenants.update"]),canDelete:c("tenants.destroy"),showActions:t(["tenants.show","tenants.edit","tenants.update","tenants.destroy"])}),o.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No tenants found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex items-center justify-between border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",o.length," tenant",o.length!==1?"s":"",n&&` matching "${n}"`]})})]})]})]})}),b&&e.jsx(W,{open:T,onOpenChange:()=>{j(!1),f(null)},tenant:b,cities:l,properties:m,unitsByProperty:d,onSuccess:L})]})}export{Lt as default};
