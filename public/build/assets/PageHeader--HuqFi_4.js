import{r as p,j as s}from"./app-DfhMz46N.js";import{B as d}from"./button-D70ZdTAE.js";import{u}from"./usePermissions-CxLN4YG6.js";import{f as x}from"./formatDate-B7VkYiMQ.js";import{D as h}from"./download-Dlz0wQ4J.js";import{P as y}from"./plus-CSmAj_IW.js";import"./app-B7C1jyr3.js";import"./index-DCi-Xv1e.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./format-PYUiRpxY.js";import"./createLucideIcon-DgVEEFYv.js";const m=t=>t==null||isNaN(t)?"0.00":Number(t).toFixed(2),n=t=>t==null?"":String(t).replace(/"/g,'""'),g=t=>x(t,""),E=(t,l="payment-plans.csv")=>{try{const i=[["ID","City","Property","Unit","Tenant","Amount","Paid","Left to Pay","Status","Date","Notes"].join(","),...t.map(e=>{try{return[e.id||"",`"${n(e.city_name)}"`,`"${n(e.property)}"`,`"${n(e.unit)}"`,`"${n(e.tenant)}"`,m(e.amount),m(e.paid),m(e.left_to_pay),`"${n(e.status)}"`,`"${g(e.dates)}"`,`"${n(e.notes)}"`].join(",")}catch(f){return console.error("Error processing payment plan row:",e,f),""}}).filter(e=>e!=="")].join(`
`),c=new Blob([i],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),o=URL.createObjectURL(c);return r.setAttribute("href",o),r.setAttribute("download",l),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),!0}catch(a){throw console.error("CSV Export Error:",a),a}};function A({paymentPlans:t,onAddClick:l}){const{hasAllPermissions:a}=u(),[i,c]=p.useState(!1),r=()=>{if(!t||!t.data||t.data.length===0){alert("No data to export");return}c(!0);try{console.log("Exporting payment plans data:",t.data);const o=`payment-plans-${new Date().toISOString().split("T")[0]}.csv`;E(t.data,o),console.log("Export completed successfully")}catch(o){console.error("Export failed:",o),alert(`Export failed: ${o instanceof Error?o.message:"Unknown error"}. Please check the console for details.`)}finally{c(!1)}};return s.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Payment Plans Management"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(d,{variant:"outline",size:"sm",onClick:r,disabled:i||!t?.data||t.data.length===0,className:"flex items-center",children:[s.jsx(h,{className:"mr-2 h-4 w-4"}),i?"Exporting...":"Export CSV"]}),a(["payment-plans.create","payment-plans.store"])&&s.jsxs(d,{onClick:l,children:[s.jsx(y,{className:"mr-2 h-4 w-4"}),"Add Payment Plan"]})]})]})}export{A as default};
