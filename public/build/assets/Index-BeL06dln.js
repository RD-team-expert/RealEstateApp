import{r as c,u as N,j as r,H as T,a as p}from"./app-p7g_f0wo.js";import{A as R}from"./app-layout-DPClFEfr.js";import{C as k,a as H,b as U}from"./card-BzYl35PS.js";import{u as M}from"./usePermissions-CJLv3dp-.js";import V from"./PropertyCreateDrawer-DxRyscFd.js";import B from"./PropertyEditDrawer-W-d_GQ7Z.js";import Q from"./PropertyPageHeader-uzJ7k912.js";import q from"./PropertyFilters-u8ZeBnF0.js";import z from"./PropertyTable-COUOSKFV.js";import G from"./PropertyEmptyState-BOYCoImZ.js";import J from"./FlashMessages-Dy_cHGj7.js";import K from"./PropertyPagination-Cq5GAfcQ.js";import"./app-D9ss4c-j.js";import"./index-6lgmZUbB.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./button-CgWb-OwV.js";import"./index-C9RY0Fne.js";import"./index-H5dANVBP.js";import"./index-DkhO7hde.js";import"./index-soOnB7Xl.js";import"./index-CiElmmUH.js";import"./index-DqXNBRMy.js";import"./x-CLgUf5rt.js";import"./createLucideIcon-DCkjgf37.js";import"./index-Dc_FVRD7.js";import"./index-DBAs5r5h.js";import"./index-DbQ0MNsB.js";import"./index-BFObTlUk.js";import"./index-BUWKjyuJ.js";import"./collapsible-D-5VlHH9.js";import"./chevron-right-DVrPLLPg.js";import"./index-BxQHv4UU.js";import"./log-out-DolkPHtZ.js";import"./chevrons-up-down-KkSb8Z31.js";import"./app-logo-icon-CpLLQQyo.js";import"./house-DG1cwSyn.js";import"./building-Dsvg2gBa.js";import"./users-DUIlRejs.js";import"./wrench-CShl7EQD.js";import"./credit-card-DD1qylaU.js";import"./dollar-sign-BuRVt3W_.js";import"./file-text-CmxpgnvI.js";import"./triangle-alert-BvRY_CAH.js";import"./bell-ZeWLA2EG.js";import"./drawer-BG8f08dK.js";import"./CitySelectionSection-DgZpKT-N.js";import"./label-DYy2JzQ2.js";import"./select-CfH1ySLB.js";import"./index-BAfRhOcu.js";import"./chevron-down-QjJMMFQo.js";import"./check-Cfkty5Qk.js";import"./chevron-up-DNYJO-3s.js";import"./map-pin-BPz7sIg6.js";import"./PropertySelectionSection-D9Ai6nuB.js";import"./alert-CKlPvBxJ.js";import"./building-2-yTwnRHRy.js";import"./circle-alert-BGRUz81p.js";import"./InsuranceCompanySection-BTiaAToA.js";import"./input-DiaYLKYe.js";import"./shield-FYdlzjJa.js";import"./AmountPolicySection-AOEkmBfM.js";import"./DatesSection-D-HObliX.js";import"./calendar-C5PdxC03.js";import"./NotesSection-DtSAbsHM.js";import"./textarea-uGnQwSiz.js";import"./PropertySelectField-DlEPgTFN.js";import"./InsuranceCompanyField-DEnU_4Dq.js";import"./AmountPolicyFields-DFFD1blT.js";import"./DateFields-Cf88vsjW.js";import"./NotesField-BeCahuPG.js";import"./download-B86n1ynC.js";import"./plus-Su-bBcUY.js";import"./search-BU1dLuL3.js";import"./table-Cs4vzKKx.js";import"./PropertyTableRow-CvnvUJAj.js";import"./PropertyStatusBadge-DDps0Cqg.js";import"./badge-I-sz7QIO.js";import"./PropertyDaysLeftBadge-GwN631Lb.js";import"./eye-A0EQotwc.js";import"./square-pen-Cwnx6pJj.js";import"./trash-2-B0CH3TAF.js";import"./pagination-PaZ-hm9M.js";import"./chevron-left-DEQB7mOe.js";const W=(e,g="properties.csv")=>{const f=["ID","Property Name","Insurance Company","Amount","Effective Date","Policy Number","Expiration Date","Days Left","Status"],l=o=>{const x=new Date,y=new Date(o).getTime()-x.getTime();return Math.ceil(y/(1e3*60*60*24))},d=[f.join(","),...e.map(o=>[o.id,`"${o.property?.property_name||"N/A"}"`,`"${o.insurance_company_name}"`,`"${o.formatted_amount}"`,`"${o.effective_date}"`,`"${o.policy_number}"`,`"${o.expiration_date}"`,l(o.expiration_date),`"${o.status}"`].join(","))].join(`
`),h=new Blob([d],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(h);s.setAttribute("href",n),s.setAttribute("download",g),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)};function vt({properties:e,filters:g,cities:f=[],availableProperties:l=[]}){const{hasPermission:d,hasAnyPermission:h,hasAllPermissions:s}=M(),[n,o]=c.useState(g),[x,S]=c.useState(!1),[y,u]=c.useState(!1),[j,P]=c.useState(!1),[_,w]=c.useState(null),{flash:D}=N().props,m=()=>{const t={};return e.current_page&&e.current_page>1&&(t.page=e.current_page.toString()),e.per_page&&(t.per_page=e.per_page.toString()),Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),t},E=(t,a)=>{const i={...n,[t]:a};o(i)},C=()=>{const t={};Object.entries(n).forEach(([a,i])=>{i!=null&&i!==""&&(t[a]=String(i))}),e.per_page&&(t.per_page=e.per_page.toString()),p.get(route("properties-info.index"),t,{preserveState:!0,preserveScroll:!0})},v=()=>{o({property_name:"",insurance_company_name:"",policy_number:"",status:void 0});const a={};e.per_page&&(a.per_page=e.per_page.toString()),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},b=t=>{confirm("Are you sure you want to delete this property?")&&p.delete(route("properties-info.destroy",t.id),{data:m(),preserveState:!0,preserveScroll:!0})},A=()=>{if(e.data.length===0){alert("No data to export");return}S(!0);try{const t=`properties-insurance-${new Date().toISOString().split("T")[0]}.csv`;W(e.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{S(!1)}},F=()=>{u(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},O=()=>{P(!1),p.get(route("properties-info.index"),m(),{preserveState:!0,preserveScroll:!0})},I=t=>{w(t),P(!0)},$=t=>{const a=m();delete a.page,a.per_page=t.toString(),p.get(route("properties-info.index"),a,{preserveState:!0,preserveScroll:!0})},L=t=>{const a=m();p.get(route("properties-info.show",t.id),a,{preserveState:!1})};return r.jsxs(R,{children:[r.jsx(T,{title:"Properties Insurance"}),r.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:r.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[r.jsx(J,{success:D?.success,error:D?.error}),r.jsx(Q,{onExport:A,onAddProperty:()=>u(!0),isExporting:x,hasExportData:e.data.length>0,canCreate:s(["properties.create","properties.store"])}),r.jsxs(k,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(H,{children:r.jsx(q,{filters:n,onFilterChange:E,onSearch:C,onClear:v})}),r.jsxs(U,{children:[r.jsx(z,{properties:e.data,onEdit:I,onDelete:b,onShow:L,canEdit:s(["properties.update","properties.edit"]),canDelete:d("properties.destroy"),canShow:d("properties.show"),hasAnyActionPermission:h(["properties.destroy","properties.update","properties.edit","properties.show"])}),e.data.length===0&&r.jsx(G,{}),e.data.length>0&&r.jsx(K,{paginatedData:e,currentPerPage:e.per_page||15,onPerPageChange:$})]})]})]})}),r.jsx(V,{open:y,onOpenChange:u,cities:f,availableProperties:l,onSuccess:F,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15}),_&&r.jsx(B,{open:j,onOpenChange:P,property:_,availableProperties:l,onSuccess:O,currentFilters:n,currentPage:e.current_page||1,currentPerPage:e.per_page||15})]})}export{vt as default};
