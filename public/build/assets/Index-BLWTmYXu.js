import{r as s,u as T,j as r,H as _,a as l}from"./app-DfhMz46N.js";import{C as $,b as L}from"./card-DnYtlxUS.js";import{u as R}from"./usePermissions-CxLN4YG6.js";import{A as U}from"./app-layout-CkBdeP0R.js";import H from"./VendorCreateDrawer-BDLzCPQF.js";import B from"./VendorEditDrawer-DxHZAW_F.js";import M from"./FlashMessages-45PTvfwY.js";import q from"./PageHeader-Cg76tXNz.js";import z from"./VendorFilters-CK2GmGMb.js";import G from"./VendorTable-BYicYoJe.js";import J from"./VendorPagination--TQ4q2ps.js";import"./app-B7C1jyr3.js";import"./utils-CBfrqCZ4.js";import"./index-DCi-Xv1e.js";import"./index-CdJFUDDL.js";import"./button-D70ZdTAE.js";import"./index-BQKCx-PJ.js";import"./index-CBYZjZBF.js";import"./index-Be_qgOKl.js";import"./index-Bd9tPrb_.js";import"./index-DV6UInPh.js";import"./index-BTxfuEuk.js";import"./x-DZ3FO5Wj.js";import"./createLucideIcon-DgVEEFYv.js";import"./index-Dc_FVRD7.js";import"./index-Ct5EcCoK.js";import"./index-CubYnoId.js";import"./index-DLswfCi4.js";import"./collapsible-CxKi9m-H.js";import"./chevron-right-BW9owo_I.js";import"./index-PkKgVJHn.js";import"./log-out-wHczke_X.js";import"./chevrons-up-down-JgGBqF6F.js";import"./app-logo-icon-5xx7lIbL.js";import"./house-C6-1wI8m.js";import"./building-Dgb3xTR3.js";import"./users-ejwhL9u9.js";import"./wrench-BBDdmO44.js";import"./credit-card-muz8icID.js";import"./dollar-sign-CLLUuUfb.js";import"./file-text-jifTgd3g.js";import"./triangle-alert-DYFGciiD.js";import"./bell-C7uwicu3.js";import"./drawer-DfcxSr7r.js";import"./CityField-DhB1YXcE.js";import"./label-DcH_3_W8.js";import"./select-CjXVIajk.js";import"./index-DbgZyH5A.js";import"./chevron-down-VWfm6OW2.js";import"./check-CordmqsZ.js";import"./chevron-up-dLBEGKat.js";import"./VendorNameField-BmBWzreV.js";import"./input-BxpY_ptm.js";import"./PhoneNumberField-BmrvHOkQ.js";import"./plus-CSmAj_IW.js";import"./trash-2-CEOusBqN.js";import"./EmailField-D9vXxLFo.js";import"./ServiceTypeField-CQ2EWPln.js";import"./CityField-CTvW87FE.js";import"./VendorNameField-DKhNqXd2.js";import"./PhoneNumberField-B4Cwaazo.js";import"./EmailField-icxo1aGW.js";import"./ServiceTypeField-vLhRHebR.js";import"./download-Dlz0wQ4J.js";import"./search-DDQcn7AF.js";import"./table-Cv3zQ3q1.js";import"./VendorTableRow-6HzAXV9r.js";import"./square-pen-k3KPWcNg.js";const K=(i,a="vendors.csv")=>{const p=["ID","City","Vendor Name","Number","Email","Service Type"],n=t=>!t||!Array.isArray(t)||t.length===0?"":t.join("; "),h=[p.join(","),...i.map(t=>[t.id,`"${t.city?.city||"N/A"}"`,`"${t.vendor_name}"`,`"${n(t.number)}"`,`"${n(t.email)}"`,`"${n(t.service_type)}"`].join(","))].join(`
`),d=new Blob([h],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),m=URL.createObjectURL(d);o.setAttribute("href",m),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m)};function mt({vendors:i,filters:a,cities:p}){const[,n]=s.useState(a),[h,d]=s.useState(!1),[o,m]=s.useState(!1),[t,y]=s.useState(!1),[g,j]=s.useState(null),{flash:w}=T().props,{hasPermission:f,hasAllPermissions:v}=R(),[C,S]=s.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[E,c]=s.useState(!1),x=(e,u)=>{S(N=>({...N,[e]:u}))},D=e=>{const u=e.target.value;x("city",u),c(u.length>0)},b=e=>{x("city",e.city),c(!1)},V=()=>{const e={...C};n(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},F=()=>{const e={city:"",vendor_name:""};S(e),n(e),c(!1),l.get(route("vendors.index"),{},{preserveState:!0,preserveScroll:!0})},A=()=>{if(i.data.length===0){alert("No data to export");return}d(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;K(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{d(!1)}},P=e=>{confirm("Are you sure you want to delete this vendor?")&&l.delete(route("vendors.destroy",e.id))},O=()=>{l.reload()},I=e=>{j(e),y(!0)},k=()=>{l.reload()};return r.jsxs(U,{children:[r.jsx(_,{title:"Vendors"}),r.jsx("div",{className:"py-12",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(M,{flash:w}),r.jsx(q,{hasExportPermission:f("vendor.export"),hasCreatePermissions:v(["vendors.create","vendors.store"]),isExporting:h,onExport:A,onAddVendor:()=>m(!0)}),r.jsx($,{children:r.jsxs(L,{className:"p-6",children:[r.jsx(z,{tempFilters:C,cities:p,showCityDropdown:E,onTempFilterChange:x,onCityInputChange:D,onCitySelect:b,onSearchClick:V,onClearFilters:F,setShowCityDropdown:c}),r.jsx(G,{vendors:i.data,hasEditPermissions:v(["vendors.edit","vendors.update"]),hasDeletePermission:f("vendors.destroy"),onEditVendor:I,onDeleteVendor:P}),r.jsx(J,{links:i.links})]})})]})}),r.jsx(H,{cities:p,open:o,onOpenChange:m,onSuccess:O}),r.jsx(B,{cities:p,open:t,onOpenChange:y,vendor:g,onSuccess:k})]})}export{mt as default};
