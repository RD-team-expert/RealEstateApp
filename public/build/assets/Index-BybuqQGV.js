import{r as g,j as r,H as W,a as m}from"./app-XlMZG7vD.js";import{C as q,a as z,b as G}from"./card-BeQJ7hrb.js";import{u as J}from"./usePermissions-C5sl0_76.js";import{A as Q}from"./app-layout-CGrAe6KQ.js";import X from"./MoveOutCreateDrawer-DaSFgbmy.js";import Y from"./MoveOutEditDrawer-DixbPwiw.js";import Z from"./MoveOutEmptyState-D7ODAJxu.js";import O from"./MoveOutFilters-BpiqoH8E.js";import tt from"./MoveOutPageHeader-8AZpIstd.js";import et from"./MoveOutPagination-BTD8rYFT.js";import rt from"./MoveOutTable-De-nmheG.js";import{f as ot}from"./format-PYUiRpxY.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./button-D56PIbu9.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./drawer-B7-2XtV2.js";import"./LocationSection-BAYMqDDS.js";import"./FormField-BqMlDDiJ.js";import"./label-BKN3erGN.js";import"./TextInputField-9sJ7o5dg.js";import"./input-nhBJFe9F.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./check-ZO7ekD6P.js";import"./DateFieldsSection-DailPrFx.js";import"./DatePickerField-Dk1CVkBb.js";import"./calendar-D02iCkay.js";import"./chevron-left-DiIjHAK0.js";import"./chevron-down-Dqt3V4Kg.js";import"./calendar-CGMbx-hL.js";import"./PropertyDetailsSection-DUQt3cUW.js";import"./RadioGroupField-u_0Rr9F5.js";import"./radioGroup-DrlpglLG.js";import"./index-DdpYxxi8.js";import"./TextAreaField-DBS4BfUL.js";import"./textarea-DWy2J22q.js";import"./StatusFieldsSection-pC57H8GK.js";import"./LocationSelectionFields-DmvdMjxH.js";import"./MoveOutDateFields-CQ0jrxQa.js";import"./MoveOutDetailsFields-c4JRqRGa.js";import"./MoveOutStatusFields-BXu7ZCPR.js";import"./download-AfMUchev.js";import"./plus-Brzm8xdb.js";import"./table-Dsn5Ek_l.js";import"./MoveOutTableRow-CCoHoZ0f.js";import"./badge-amDNRRn_.js";import"./eye-L6iv3Y43.js";import"./square-pen-DJiq7j_0.js";import"./trash-2-CisDGbUX.js";const _=(i,a="-")=>{if(!i)return a;const e=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!e)return a;const[,d,c,u]=e,s=new Date(Number(d),Number(c)-1,Number(u));return ot(s,"P")},b=i=>{if(!i)return"";const a=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!a)return"";const[,e,d,c]=a;return`${e}-${d}-${c}`},it=(i,a="move-outs.csv")=>{try{const e=t=>t==null?"":String(t).replace(/"/g,'""'),c=[["ID","City Name","Property Name","Unit Name","Tenants","Move Out Date","Lease Status","Lease Ending on Buildium","Keys Location","Utilities Under Our Name","Date Utility Put Under Our Name","Walkthrough","All The Devices Are Off","Repairs","Send Back Security Deposit","Notes","Cleaning","List the Unit","Renter","Move Out Form","Utility Type"].join(","),...i.map(t=>{try{return[t.id||"",`"${e(t.city_name)}"`,`"${e(t.property_name)}"`,`"${e(t.unit_name)}"`,`"${e(t.tenants)}"`,`"${_(t.move_out_date,"")}"`,`"${e(t.lease_status)}"`,`"${_(t.date_lease_ending_on_buildium,"")}"`,`"${e(t.keys_location)}"`,`"${e(t.utilities_under_our_name)}"`,`"${_(t.date_utility_put_under_our_name,"")}"`,`"${e(t.walkthrough)}"`,`"${e(t.all_the_devices_are_off)}"`,`"${e(t.repairs)}"`,`"${e(t.send_back_security_deposit)}"`,`"${e(t.notes)}"`,`"${e(t.cleaning)}"`,`"${e(t.list_the_unit)}"`,`"${e(t.renter)}"`,`"${e(t.move_out_form)}"`,`"${e(t.utility_type)}"`].join(",")}catch(x){return console.error("Error processing move-out row:",t,x),""}}).filter(t=>t!=="")].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),h=URL.createObjectURL(u);return s.setAttribute("href",h),s.setAttribute("download",a),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(h),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function Ne({moveOuts:i,cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,filterCities:s,filterProperties:h,filterUnits:t,perPage:x}){const[D,$]=g.useState(!1),[N,C]=g.useState(!1),[U,P]=g.useState(!1),[y,L]=g.useState(null),[p,M]=g.useState(x??"15"),{hasPermission:R,hasAnyPermission:k,hasAllPermissions:E}=J(),f=typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams,n={city:f.get("city")||void 0,property:f.get("property")||void 0,unit:f.get("unit")||void 0},S=i?.meta?.current_page??1,A=o=>{m.get(route("move-out.index"),{city:o.city_id,property:o.property_id,unit:o.unit_id,perPage:p},{preserveState:!0,preserveScroll:!0})},F=()=>{m.get(route("move-out.index"),{perPage:p},{preserveState:!1,preserveScroll:!0})},T=o=>{confirm("Are you sure you want to delete this move-out record?")&&m.delete(route("move-out.destroy",o.id),{data:{redirect_city:n.city??null,redirect_property:n.property??null,redirect_unit:n.unit??null,redirect_page:String(S),redirect_perPage:p},preserveState:!0,preserveScroll:!0})},I=o=>{M(o);const l=new URLSearchParams(window.location.search),v=l.get("city"),w=l.get("property"),j=l.get("unit");m.get(route("move-out.index"),{city:v||void 0,property:w||void 0,unit:j||void 0,perPage:o},{preserveState:!0,preserveScroll:!0})},H=()=>{if(!i||!i.data||i.data.length===0){alert("No data to export");return}$(!0);try{const o=`move-outs-${new Date().toISOString().split("T")[0]}.csv`;it(i.data,o)}catch(o){console.error("Export failed:",o),alert(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}finally{$(!1)}},V=()=>{m.reload()},B=()=>{m.reload()},K=o=>{L(o),P(!0)};return r.jsxs(Q,{children:[r.jsx(W,{title:"Move-Out Management"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(tt,{hasCreatePermission:E(["move-out.create","move-out.store"]),isExporting:D,hasData:i?.data&&i.data.length>0,onExport:H,onAddNew:()=>C(!0)}),r.jsxs(q,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(z,{children:r.jsx(O,{cities:s,properties:h,allUnits:t,initialFilters:{city:n.city??"",property:n.property??"",unit:n.unit??""},onSearch:A,onClear:F})}),r.jsx(G,{children:i.data.length>0?r.jsxs(r.Fragment,{children:[r.jsx(rt,{moveOuts:i.data,formatDateOnly:_,hasPermission:R,hasAnyPermission:k,hasAllPermissions:E,onEdit:K,onDelete:T,filters:{city:n.city??void 0,property:n.property??void 0,unit:n.unit??void 0,perPage:p}}),i.meta&&r.jsx(et,{meta:i.meta,perPage:p,onPageChange:o=>{const l=new URLSearchParams(window.location.search),v=l.get("city"),w=l.get("property"),j=l.get("unit");m.get(route("move-out.index"),{city:v||void 0,property:w||void 0,unit:j||void 0,page:o,perPage:p},{preserveState:!0,preserveScroll:!0})}}),r.jsxs("div",{className:"mt-4 flex items-center justify-end gap-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),r.jsxs("select",{value:p,onChange:o=>I(o.target.value),className:"h-9 rounded-md border border-input bg-background px-3 text-sm text-foreground",children:[r.jsx("option",{value:"15",children:"15"}),r.jsx("option",{value:"30",children:"30"}),r.jsx("option",{value:"50",children:"50"}),r.jsx("option",{value:"all",children:"All"})]})]})]}):r.jsx(Z,{})})]})]})}),r.jsx(X,{cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,open:N,onOpenChange:C,onSuccess:V,redirectContext:{city:n.city??null,property:n.property??null,unit:n.unit??null,page:String(S),perPage:p}}),y&&r.jsx(Y,{cities:a,properties:e,propertiesByCityId:d,unitsByPropertyId:c,allUnits:u,moveOut:{...y,move_out_date:b(y.move_out_date),date_lease_ending_on_buildium:b(y.date_lease_ending_on_buildium),date_utility_put_under_our_name:b(y.date_utility_put_under_our_name)},open:U,onOpenChange:P,onSuccess:B,redirectContext:{city:n.city??null,property:n.property??null,unit:n.unit??null,page:String(S),perPage:p}},y.id)]})}export{Ne as default};
