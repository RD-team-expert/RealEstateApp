import{r as m,b as W,j as t}from"./app-BSOlzI_M.js";import{B as U}from"./button-D2rKFPK1.js";import{D as X,a as Y,b as Z}from"./drawer-B6ZRXvIZ.js";import{DateField as $}from"./DateField-DNEKD1x6.js";import{CityField as ee}from"./CityField-B3UynTqK.js";import{PropertyField as te}from"./PropertyField-BFrCsOOR.js";import{UnitField as re}from"./UnitField-B9wXKyw_.js";import{FinancialFields as ae}from"./FinancialFields-BouOx5mm.js";import{AssistanceFields as ie}from"./AssistanceFields-DBCDY9hP.js";import{PermanentField as se}from"./PermanentField-CspMQJFU.js";import{ReversedPaymentsField as ne}from"./ReversedPaymentsField-l6yriI6s.js";import{NotesField as oe}from"./NotesField-CfaaUxrq.js";import{DebugInfo as me}from"./DebugInfo-BC3lBj4F.js";import"./app-D9zByHv3.js";import"./index-ByB7CnZO.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-09CEhTtY.js";import"./index-BK07_5Wa.js";import"./index-C5g_kYK6.js";import"./index-DIXGfQsU.js";import"./index-BLt4aHaa.js";import"./index-Eh5rTZKr.js";import"./x-V2a7Zg3Q.js";import"./createLucideIcon-BGWKpKjb.js";import"./calendar-Di5dbzoO.js";import"./format-PYUiRpxY.js";import"./chevron-left-CVo-4b8C.js";import"./chevron-right-DU-yjHU5.js";import"./chevron-down--Oeingn_.js";import"./label-ku6Bo0xE.js";import"./popover-CKsI89_0.js";import"./index-C4PIvpnm.js";import"./calendar-CthI5zTo.js";import"./command-CBR154ui.js";import"./search-BcNZ_u8M.js";import"./chevrons-up-down-D-iRWSMZ.js";import"./check-BE4k6INO.js";import"./input-DWv8_Yxn.js";import"./checkbox-CPh6jisW.js";import"./index-Dc_FVRD7.js";import"./index-C4dPa-2_.js";import"./index-D4B3QgQ6.js";import"./radioGroup-DqEJ_5sj.js";import"./index-p7EaCzMM.js";function et({units:C,cities:D,unitsByCity:A,propertiesByCity:V,open:N,onOpenChange:v,onSuccess:I,filtersContext:i}){const[O,h]=m.useState(""),[R,u]=m.useState(""),[k,l]=m.useState(""),[B,_]=m.useState(""),[z,g]=m.useState(""),[H,q]=m.useState(!1),[r,E]=m.useState(""),[n,b]=m.useState(""),[f,c]=m.useState(""),{data:a,setData:s,post:G,processing:P,errors:d,reset:w,transform:J}=W({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:""}),S=()=>r?V[r]||[]:[],x=()=>r?n?C.filter(e=>e.city===r&&e.property_name===n).map(e=>e.unit_name):A[r]||[]:[],K=(e,o,p)=>{const y=C.find(j=>j.city===e&&j.property_name===o&&j.unit_name===p);return y?y.id:null};m.useEffect(()=>{r&&n&&(S().includes(n)||(b(""),c(""),s("unit_id","")))},[r]),m.useEffect(()=>{n&&f&&(x().includes(f)||(c(""),s("unit_id","")))},[r,n]);const L=e=>{E(e),b(""),c(""),s("unit_id",""),h(""),u(""),l("")},M=e=>{b(e),c(""),s("unit_id",""),u(""),l("")},Q=e=>{if(c(e),l(""),r&&n&&e){const o=K(r,n,e);o&&s("unit_id",o.toString())}},F=e=>{e.preventDefault(),h(""),u(""),l(""),_(""),g("");let o=!1;if((!a.date||a.date.trim()==="")&&(_("Please select a date before submitting the form."),o=!0),(!r||r.trim()==="")&&(h("Please select a city before submitting the form."),o=!0),(!n||n.trim()==="")&&(u("Please select a property before submitting the form."),o=!0),(!f||f.trim()==="")&&(l("Please select a unit before submitting the form."),o=!0),(!a.owes||a.owes.trim()==="")&&(g("Please enter the amount owed before submitting the form."),o=!0),(!a.unit_id||a.unit_id.trim()==="")&&(l("Unable to identify the selected unit. Please try selecting again."),o=!0),o)return;const p={};i?.city&&(p.filter_city=i.city),i?.property&&(p.filter_property=i.property),i?.unit&&(p.filter_unit=i.unit),i?.permanent&&i.permanent.length>0&&(p.filter_permanent=i.permanent.join(",")),i?.is_hidden&&(p.filter_is_hidden="true"),i?.per_page&&(p.filter_per_page=i.per_page),i?.page&&(p.filter_page=i.page),J(y=>({...y,...p})),G(route("payments.store"),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{w(),E(""),b(""),c(""),h(""),u(""),l(""),_(""),g(""),v(!1),I?.()},onError:y=>{console.error("Form submission errors:",y)}})},T=()=>{w(),E(""),b(""),c(""),h(""),u(""),l(""),_(""),g(""),v(!1)};return t.jsx(X,{open:N,onOpenChange:v,modal:!1,children:t.jsx(Y,{size:"half",title:"Create New Payment",children:t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsxs("form",{onSubmit:F,className:"space-y-4",children:[t.jsx(ee,{cities:D,selectedCity:r,onCityChange:L,validationError:O,unitIdError:d.unit_id}),t.jsx(te,{selectedProperty:n,availableProperties:S(),onPropertyChange:M,disabled:!r,validationError:R}),t.jsx(re,{selectedUnit:f,availableUnits:x(),onUnitChange:Q,disabled:!r,validationError:k}),t.jsx($,{date:a.date,onDateChange:e=>{s("date",e),_("")},calendarOpen:H,onCalendarOpenChange:q,validationError:B,dateError:d.date}),t.jsx(ae,{owes:a.owes,paid:a.paid,onOwesChange:e=>{s("owes",e),g("")},onPaidChange:e=>s("paid",e),owesError:d.owes,paidError:d.paid,owesValidationError:z}),t.jsx(ie,{hasAssistance:a.has_assistance,assistanceAmount:a.assistance_amount,assistanceCompany:a.assistance_company,onHasAssistanceChange:e=>s("has_assistance",e),onAssistanceAmountChange:e=>s("assistance_amount",e),onAssistanceCompanyChange:e=>s("assistance_company",e),assistanceAmountError:d.assistance_amount,assistanceCompanyError:d.assistance_company}),t.jsx(se,{permanent:a.permanent,onPermanentChange:e=>s("permanent",e),error:d.permanent}),t.jsx(ne,{reversedPayments:a.reversed_payments,onReversedPaymentsChange:e=>s("reversed_payments",e),error:d.reversed_payments}),t.jsx(oe,{notes:a.notes,onNotesChange:e=>s("notes",e),error:d.notes}),t.jsx(me,{unitId:a.unit_id,selectedCity:r,selectedProperty:n,selectedUnit:f})]})}),t.jsx(Z,{className:"border-t bg-muted/50 p-4",children:t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(U,{type:"button",variant:"outline",onClick:T,disabled:P,children:"Cancel"}),t.jsx(U,{type:"submit",onClick:F,disabled:P,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:P?"Creating...":"Create Payment"})]})})]})})})}export{et as default};
