import{r as l,u as F,j as r,H as I,a as d}from"./app-p7g_f0wo.js";import{C as U,a as L,b as R}from"./card-BzYl35PS.js";import{u as H}from"./usePermissions-CJLv3dp-.js";import{A as V}from"./app-layout-DPClFEfr.js";import T from"./ApplicationCreateDrawer-CWRWxdUx.js";import B from"./ApplicationEditDrawer-BNz4Cfti.js";import M from"./ApplicationsTable-BuLEXsNn.js";import q from"./EmptyState-DlITk8tU.js";import z from"./FilterBar-CoSF0Z-T.js";import G from"./FlashMessages-CxV4iwQi.js";import J from"./PageHeader-BavIIRsh.js";import K from"./Pagination-Dk2W8BNK.js";import"./app-D9ss4c-j.js";import"./utils-CBfrqCZ4.js";import"./index-6lgmZUbB.js";import"./index-CdJFUDDL.js";import"./button-CgWb-OwV.js";import"./index-C9RY0Fne.js";import"./index-H5dANVBP.js";import"./index-DkhO7hde.js";import"./index-soOnB7Xl.js";import"./index-CiElmmUH.js";import"./index-DqXNBRMy.js";import"./x-CLgUf5rt.js";import"./createLucideIcon-DCkjgf37.js";import"./index-Dc_FVRD7.js";import"./index-DBAs5r5h.js";import"./index-DbQ0MNsB.js";import"./index-BFObTlUk.js";import"./index-BUWKjyuJ.js";import"./collapsible-D-5VlHH9.js";import"./chevron-right-DVrPLLPg.js";import"./index-BxQHv4UU.js";import"./log-out-DolkPHtZ.js";import"./chevrons-up-down-KkSb8Z31.js";import"./app-logo-icon-CpLLQQyo.js";import"./house-DG1cwSyn.js";import"./building-Dsvg2gBa.js";import"./users-DUIlRejs.js";import"./wrench-CShl7EQD.js";import"./credit-card-DD1qylaU.js";import"./dollar-sign-BuRVt3W_.js";import"./file-text-CmxpgnvI.js";import"./triangle-alert-BvRY_CAH.js";import"./bell-ZeWLA2EG.js";import"./drawer-BG8f08dK.js";import"./CityPropertyUnitSelector-DLfFpd5U.js";import"./label-DYy2JzQ2.js";import"./select-CfH1ySLB.js";import"./index-BAfRhOcu.js";import"./chevron-down-QjJMMFQo.js";import"./check-Cfkty5Qk.js";import"./chevron-up-DNYJO-3s.js";import"./ApplicantInformationSection-DEctrwQJ.js";import"./input-DiaYLKYe.js";import"./application-CnwOiERd.js";import"./StatusAndDateSection-C6NCGzAd.js";import"./calendar-BbyHMKLt.js";import"./format-PYUiRpxY.js";import"./chevron-left-DEQB7mOe.js";import"./popover-B4-HGuiv.js";import"./radioGroup-Dy3ozKpR.js";import"./calendar-C5PdxC03.js";import"./AdditionalDetailsSection-u6bJDL28.js";import"./ApplicantInformationFields-QW8N4Yly.js";import"./AttachmentField-C5fAJuAW.js";import"./rotate-ccw-B0P468a6.js";import"./CityPropertyUnitSelector-CdGU9Jo8.js";import"./CurrentSelectionDisplay-DH_slVze.js";import"./StageAndNotesFields-auFEd2CW.js";import"./StatusAndDateFields-lAqVpfMV.js";import"./table-Cs4vzKKx.js";import"./ApplicationsTableRow-CFTjtcPg.js";import"./badge-I-sz7QIO.js";import"./eye-A0EQotwc.js";import"./square-pen-Cwnx6pJj.js";import"./trash-2-B0CH3TAF.js";import"./search-BU1dLuL3.js";import"./download-B86n1ynC.js";import"./plus-Su-bBcUY.js";const Q=(s,a="applications.csv")=>{try{const e=t=>t==null?"":String(t).replace(/"/g,'""'),p=t=>!t||!/^(\d{4})-(\d{2})-(\d{2})/.exec(t)?"":t.substring(0,10),u=t=>!t||t.length===0?"":t.map(n=>n.name).join("; "),f=[["ID","City","Property","Unit","Name","Co-signer","Status","Applicant Applied From","Date","Stage in Progress","Notes","Attachments Count","Attachment Names"].join(","),...s.map(t=>{try{return[t.id||"",`"${e(t.city)}"`,`"${e(t.property)}"`,`"${e(t.unit_name)}"`,`"${e(t.name)}"`,`"${e(t.co_signer)}"`,`"${e(t.status)}"`,`"${e(t.applicant_applied_from)}"`,`"${p(t.date)}"`,`"${e(t.stage_in_progress)}"`,`"${e(t.notes)}"`,t.attachments?.length||0,`"${u(t.attachments)}"`].join(",")}catch(n){return console.error("Error processing application row:",t,n),""}}).filter(t=>t!=="")].join(`
`),m=new Blob([f],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),c=URL.createObjectURL(m);return i.setAttribute("href",c),i.setAttribute("download",a),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c),!0}catch(e){throw console.error("CSV Export Error:",e),e}};function wr({applications:s,cities:a,properties:e,units:p}){const[u,h]=l.useState(!1),[f,m]=l.useState(!1),[i,c]=l.useState(null),[t,n]=l.useState(!1),{flash:x}=F().props,{hasPermission:g,hasAnyPermission:S,hasAllPermissions:E}=H(),[y,j]=l.useState({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),w=o=>{j(o),d.get(route("applications.index"),o,{preserveState:!0,preserveScroll:!0})},A=()=>{j({city:"",property:"",unit:"",name:"",applicant_applied_from:""}),d.get(route("applications.index"),{},{preserveState:!1})},C=o=>{confirm("Are you sure you want to delete this application?")&&d.delete(route("applications.destroy",o.id))},D=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}n(!0);try{const o=`applications-${new Date().toISOString().split("T")[0]}.csv`;Q(s.data,o),console.log("Export completed successfully")}catch(o){console.error("Export failed:",o),alert(`Export failed: ${o instanceof Error?o.message:"Unknown error"}`)}finally{n(!1)}},b=()=>{d.get(route("applications.index"),y,{preserveState:!0,preserveScroll:!0})},P=()=>{d.get(route("applications.index"),y,{preserveState:!0,preserveScroll:!0}),m(!1),c(null)},v=o=>{c(o),m(!0)},$=E(["applications.create","applications.store"]),_=g("applications.show"),O=S(["applications.edit","applications.update"]),k=g("applications.destroy"),N=S(["applications.show","applications.edit","applications.update","applications.destroy"]);return r.jsxs(V,{children:[r.jsx(I,{title:"Applications"}),r.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(G,{success:x?.success,error:x?.error}),r.jsx(J,{onExport:D,onAddNew:()=>h(!0),isExporting:t,hasExportData:!!(s?.data&&s.data.length>0),hasCreatePermission:$}),r.jsxs(U,{className:"bg-card text-card-foreground shadow-lg",children:[r.jsx(L,{children:r.jsx(z,{cities:a,properties:e,units:p,onSearch:w,onClear:A})}),r.jsx(R,{children:s.data.length>0?r.jsxs(r.Fragment,{children:[r.jsx(M,{applications:s.data,onEdit:v,onDelete:C,hasViewPermission:_,hasEditPermission:O,hasDeletePermission:k,hasAnyActionPermission:N}),r.jsx(K,{links:s.links,lastPage:s.last_page})]}):r.jsx(q,{})})]})]})}),r.jsx(T,{cities:a,properties:e,units:p,open:u,onOpenChange:h,onSuccess:b}),i&&r.jsx(B,{application:i,cities:a,properties:e,units:p,open:f,onOpenChange:m,onSuccess:P})]})}export{wr as default};
