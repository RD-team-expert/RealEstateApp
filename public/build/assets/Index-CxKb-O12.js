import{r as n,u as B,j as t,H as M,a as l}from"./app-XlMZG7vD.js";import{C as z,b as G}from"./card-BeQJ7hrb.js";import{u as J}from"./usePermissions-C5sl0_76.js";import{A as K}from"./app-layout-CGrAe6KQ.js";import W from"./VendorCreateDrawer-Bvt9nlrq.js";import X from"./VendorEditDrawer-Cp8kfNjC.js";import Y from"./FlashMessages-RtdAfnME.js";import Z from"./PageHeader-Y-Fq0OWd.js";import ee from"./VendorFilters-etmyvGKz.js";import te from"./VendorTable-689LUWHl.js";import re from"./VendorPagination-BIsCHX5j.js";import"./app-D9zByHv3.js";import"./utils-CBfrqCZ4.js";import"./index-D09_T-bu.js";import"./index-CdJFUDDL.js";import"./button-D56PIbu9.js";import"./index-CUT4GDty.js";import"./index-C_K36Fy_.js";import"./index-BoN4SSkO.js";import"./index-pZGqFUGS.js";import"./index-DqP218B8.js";import"./index-D2DcuX69.js";import"./x-B-P-7DDz.js";import"./createLucideIcon-BneQKrth.js";import"./index-Dc_FVRD7.js";import"./index-DPt0Oyfm.js";import"./index-CTF06pqo.js";import"./index-BQOEcUl2.js";import"./collapsible-DAU6BZcb.js";import"./chevron-right-By2R6jNh.js";import"./index-D8BBDizX.js";import"./log-out-CCPSLMZP.js";import"./chevrons-up-down-CmSv9Nzf.js";import"./app-logo-icon-Dt6YcCTA.js";import"./house-CLbI4eTX.js";import"./building-COTQhu1p.js";import"./users-i02JtJEO.js";import"./wrench-CbvNWZyU.js";import"./credit-card-BG1I-LuS.js";import"./dollar-sign-BYwnPy6R.js";import"./file-text-BMgerFDx.js";import"./triangle-alert-Db8T1Zt_.js";import"./bell-BOsLG0px.js";import"./drawer-B7-2XtV2.js";import"./CityField-s911rzI5.js";import"./label-BKN3erGN.js";import"./popover-DR8Y8CsW.js";import"./command-DGwO2Uw9.js";import"./search-BKBHV1D6.js";import"./VendorNameField-BqBgA9SY.js";import"./input-nhBJFe9F.js";import"./PhoneNumberField-CGKRunkW.js";import"./plus-Brzm8xdb.js";import"./trash-2-CisDGbUX.js";import"./EmailField-BmOmWaOj.js";import"./ServiceTypeField-CqrC9klJ.js";import"./select-C9mJLkAA.js";import"./index-DdpYxxi8.js";import"./chevron-down-Dqt3V4Kg.js";import"./check-ZO7ekD6P.js";import"./chevron-up-COk4jH4h.js";import"./CityField-C2RmYl33.js";import"./VendorNameField-CdN6gMu2.js";import"./PhoneNumberField-CFJYb1og.js";import"./EmailField-DyGUC5C0.js";import"./ServiceTypeField-DY3M8quB.js";import"./download-AfMUchev.js";import"./table-Dsn5Ek_l.js";import"./VendorTableRow-DjIN8Euz.js";import"./square-pen-DJiq7j_0.js";const oe=(i,a="vendors.csv")=>{const c=["ID","City","Vendor Name","Number","Email","Service Type"],p=r=>!r||!Array.isArray(r)||r.length===0?"":r.join("; "),y=[c.join(","),...i.map(r=>[r.id,`"${r.city?.city||"N/A"}"`,`"${r.vendor_name}"`,`"${p(r.number)}"`,`"${p(r.email)}"`,`"${p(r.service_type)}"`].join(","))].join(`
`),u=new Blob([y],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),d=URL.createObjectURL(u);o.setAttribute("href",d),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)};function jt({vendors:i,filters:a,cities:c}){const[,p]=n.useState(a),[y,u]=n.useState(!1),[o,d]=n.useState(!1),[r,j]=n.useState(!1),[V,A]=n.useState(null),{flash:F}=B().props,{hasPermission:C,hasAllPermissions:_}=J(),[g,w]=n.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[v,N]=n.useState(a?.per_page?.toString?.()??"15"),[O,h]=n.useState(!1),f=(e,s)=>{w(m=>({...m,[e]:s}))},R=e=>{const s=e.target.value;f("city",s),h(s.length>0)},k=e=>{f("city",e.city),h(!1)},I=()=>{const e={...g,per_page:v};p(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},T=()=>{const e={city:"",vendor_name:""};w(e),p(e),h(!1),l.get(route("vendors.index"),{per_page:v},{preserveState:!0,preserveScroll:!0})},L=e=>{const s=e.target.value;N(s);const m={...g,per_page:s};l.get(route("vendors.index"),m,{preserveState:!0,preserveScroll:!0})},$=()=>{if(i.data.length===0){alert("No data to export");return}u(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{u(!1)}},U=e=>{if(!confirm("Are you sure you want to delete this vendor?"))return;const m=(()=>{try{const x=new URLSearchParams(window.location.search),S=["city","city_id","vendor_name","number","email","per_page","page"],E={};return S.forEach(P=>{const D=x.get(P);D!==null&&(E[P]=D)}),E}catch{return{}}})(),b={};[["city","filter_city"],["city_id","filter_city_id"],["vendor_name","filter_vendor_name"],["number","filter_number"],["email","filter_email"],["per_page","filter_per_page"],["page","filter_page"]].forEach(([x,S])=>{m[x]!==void 0&&(b[S]=m[x])}),l.delete(route("vendors.destroy",e.id),{preserveScroll:!0,preserveState:!0,data:b})},H=()=>{l.reload()},q=e=>{A(e),j(!0)},Q=()=>{l.reload()};return t.jsxs(K,{children:[t.jsx(M,{title:"Vendors"}),t.jsx("div",{className:"py-12",children:t.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[t.jsx(Y,{flash:F}),t.jsx(Z,{hasExportPermission:C("vendor.export"),hasCreatePermissions:_(["vendors.create","vendors.store"]),isExporting:y,onExport:$,onAddVendor:()=>d(!0)}),t.jsx(z,{children:t.jsxs(G,{className:"p-6",children:[t.jsx(ee,{tempFilters:g,cities:c,showCityDropdown:O,onTempFilterChange:f,onCityInputChange:R,onCitySelect:k,onSearchClick:I,onClearFilters:T,setShowCityDropdown:h}),t.jsx(te,{vendors:i.data,hasEditPermissions:_(["vendors.edit","vendors.update"]),hasDeletePermission:C("vendors.destroy"),onEditVendor:q,onDeleteVendor:U}),t.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page"}),t.jsxs("select",{value:v,onChange:L,className:"rounded-md border border-input bg-background px-2 py-1 text-sm shadow-sm focus:outline-none",children:[t.jsx("option",{value:"15",children:"15"}),t.jsx("option",{value:"30",children:"30"}),t.jsx("option",{value:"50",children:"50"}),t.jsx("option",{value:"all",children:"All"})]})]}),t.jsx(re,{links:i.links})]})]})})]})}),t.jsx(W,{cities:c,open:o,onOpenChange:d,onSuccess:H}),t.jsx(X,{cities:c,open:r,onOpenChange:j,vendor:V,onSuccess:Q})]})}export{jt as default};
