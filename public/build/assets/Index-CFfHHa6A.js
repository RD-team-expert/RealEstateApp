import{r as s,j as e,H as Dt,a as g}from"./app-DYme-6ST.js";import{C as jt,a as wt,b as Pt}from"./card-CWWVdt52.js";import{D as bt,a as Et,b as Nt,c as $t,d as It,e as Tt}from"./dialog-gNV8MfDI.js";import{B as G}from"./button-DygVteL_.js";import{u as Ut}from"./usePermissions-Bu-R0dRn.js";import{A as Ot}from"./app-layout-H-O_MzQ8.js";import At from"./NoticeAndEvictionsCreateDrawer-CWJjJtrG.js";import Ft from"./NoticeAndEvictionsEditDrawer-BmGFU314.js";import{FilterBar as kt}from"./FilterBar-BYDSHAD3.js";import{NoticeEvictionsTable as Ht}from"./NoticeEvictionsTable-B_3S_Z1i.js";import{PageHeader as Lt}from"./PageHeader-CKG3Kp7D.js";import{PaginationControls as Rt}from"./PaginationControls-gV3pbmOy.js";import{f as qt}from"./format-PYUiRpxY.js";import"./app-BxoA0TtB.js";import"./utils-CBfrqCZ4.js";import"./index-BPUi24BT.js";import"./index-DAeyJQLn.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./index-CdJFUDDL.js";import"./index-Dc_FVRD7.js";import"./index-DZXKY85H.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./index-B8KHhnfk.js";import"./collapsible-B7rfYKib.js";import"./chevron-right-BQBVxicn.js";import"./index-D6kz9xqy.js";import"./log-out-DTdRteS0.js";import"./chevrons-up-down-BXcz4LdZ.js";import"./app-logo-icon-BPuxn_c6.js";import"./house-DY7ohgBE.js";import"./building-AISeR_4Y.js";import"./users-Ep7o_MFV.js";import"./wrench-CsLNcSZb.js";import"./credit-card-BHCQ6mCU.js";import"./dollar-sign-DvWrdgg7.js";import"./file-text-B7N_rIF4.js";import"./triangle-alert-CPVH4lkN.js";import"./bell-CZGLRIZC.js";import"./drawer-BC2XqbDZ.js";import"./CascadingSelectionFields-BaquRu1h.js";import"./label-Cs5jgoI2.js";import"./command-CUSfKic-.js";import"./search-1yu5M8Yr.js";import"./popover-iS5_0AtM.js";import"./check-B5KXzRGR.js";import"./SelectionSummary-DClkIqnu.js";import"./NoticeFormFields-DN4iFFyv.js";import"./DateField-DcH8bhIW.js";import"./calendar-BWK2M4JP.js";import"./chevron-left-C0SnhLPd.js";import"./chevron-down-CDnjTFxC.js";import"./calendar-Bw6k_ssZ.js";import"./EvectedOrPaymentPlanField-hsfLk69D.js";import"./radioGroup-F0AlgpLY.js";import"./index-CadWMiU4.js";import"./EvictionsField-rvPY9LLJ.js";import"./input-pR7fOcUW.js";import"./HaveAnExceptionField-BAz9FRpp.js";import"./HearingDatesField-DAdSCG3J.js";import"./IfLeftField-CAP4rRAh.js";import"./NoteField-DKCz6p_d.js";import"./OtherTenantsField-Cly0rIqM.js";import"./SentToAttorneyField-DqL7U_P5.js";import"./StatusField-Bo-pSYmW.js";import"./TypeOfNoticeField-DRXo-EIN.js";import"./select-CPtJWUF5.js";import"./chevron-up-3w0W2Y4A.js";import"./WritDateField-Gh7tZSlw.js";import"./CascadingSelectionSection-hDIDQqCT.js";import"./SelectionSummary-xo_PN9Cn.js";import"./StatusSection-Q9WBjpW9.js";import"./DateSection-Bms-LpFj.js";import"./NoticeTypeSection---9nK-bE.js";import"./ExceptionSection-CXqPYY9q.js";import"./NoteSection-CZ3A4_X0.js";import"./EvictionsSection-BNIgGL96.js";import"./AttorneySection-BzpD-miB.js";import"./HearingDatesSection-CthpRrvR.js";import"./EvictionPaymentPlanSection-DpOnYxlF.js";import"./IfLeftSection-c2sHVYPc.js";import"./WritDateSection-eH7ksBWe.js";import"./OtherTenantsSection-COG17U0n.js";import"./FilterDropdown--2f3qy_R.js";import"./table-NBJhLnC1.js";import"./NoticeEvictionsTableRow-DMBVw_dD.js";import"./StatusBadge-B2Tbh_2z.js";import"./badge-DkU7s25L.js";import"./YesNoBadge-dmmte5lB.js";import"./eye-aSD_-4Al.js";import"./square-pen-CNjEA8WW.js";import"./trash-2-Dk2iLsYn.js";import"./download-DZI0PhHC.js";import"./plus-CCWmusQ4.js";const F=i=>{if(!i)return"";const c=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!c)return"";const[,r,m,l]=c;return`${r}-${m}-${l}`},k=(i,c="-")=>{if(!i)return c;const r=/^(\d{4})-(\d{2})-(\d{2})/.exec(i);if(!r)return c;const[,m,l,y]=r,p=new Date(Number(m),Number(l)-1,Number(y));return qt(p,"P")},Bt=(i,c="notice-evictions.csv")=>{try{const r=n=>n==null?"":String(n).replace(/"/g,'""'),l=[["ID","Unit Name","City Name","Property Name","Tenants Name","Other Tenants","Status","Date","Type of Notice","Have An Exception","Note","Evictions","Sent to Attorney","Hearing Dates","Evicted/Payment Plan","If Left","Writ Date"].join(","),...i.map(n=>{try{return[n.id||"",`"${r(n.unit_name)}"`,`"${r(n.city_name)}"`,`"${r(n.property_name)}"`,`"${r(n.tenants_name)}"`,`"${r(n.other_tenants)}"`,`"${r(n.status)}"`,`"${k(n.date,"")}"`,`"${r(n.type_of_notice)}"`,`"${r(n.have_an_exception)}"`,`"${r(n.note)}"`,`"${r(n.evictions)}"`,`"${r(n.sent_to_atorney)}"`,`"${k(n.hearing_dates,"")}"`,`"${r(n.evected_or_payment_plan)}"`,`"${r(n.if_left)}"`,`"${k(n.writ_date,"")}"`].join(",")}catch(I){return console.error("Error processing record row:",n,I),""}}).filter(n=>n!=="")].join(`
`),y=new Blob([l],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),D=URL.createObjectURL(y);return p.setAttribute("href",D),p.setAttribute("download",c),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(D),!0}catch(r){throw console.error("CSV Export Error:",r),r}},Fn=({paginatedRecords:i,cities:c=[],properties:r=[],units:m=[],tenants:l=[],notices:y=[],pagination:p={current_page:1,per_page:15,total:0,last_page:1}})=>{const[D,n]=s.useState(!1),[I,T]=s.useState(!1),[J,U]=s.useState(!1),[x,H]=s.useState(null),[K,j]=s.useState(!1),[w,P]=s.useState(null),[O,L]=s.useState(!1),[R,q]=s.useState(p.current_page),[_,M]=s.useState(p.per_page),[v]=s.useState(i),[a,B]=s.useState({city:"",property:"",unit:"",tenant:""}),[,Q]=s.useState({city:"",property:"",unit:"",tenant:""}),[X,b]=s.useState(!1),[Z,E]=s.useState(!1),[tt,N]=s.useState(!1),[et,$]=s.useState(!1),u=(t,o)=>{B(S=>({...S,[t]:o}))},nt=t=>{u("city",t.city),b(!1)},rt=t=>{const o=t.target.value;u("city",o),b(o.length>0)},ot=t=>{const o=t.target.value;u("property",o),E(o.length>0)},it=t=>{u("property",t.property_name),E(!1)},st=t=>{const o=t.target.value;u("unit",o),N(o.length>0)},at=t=>{u("unit",t.unit_name),N(!1)},ct=t=>{const o=t.target.value;u("tenant",o),$(o.length>0)},pt=t=>{u("tenant",t.full_name),$(!1)},C=(t=1,o=_)=>{const S=c.find(f=>f.city===a.city),h=r.find(f=>f.property_name===a.property),Y=m.find(f=>f.unit_name===a.unit),z=l.find(f=>f.full_name===a.tenant),d={page:t,per_page:o};return S?.id?d.city_id=S.id:a.city.trim()&&(d.city_name=a.city.trim()),h?.id?d.property_id=h.id:a.property.trim()&&(d.property_name=a.property.trim()),Y?.id?d.unit_id=Y.id:a.unit.trim()&&(d.unit_name=a.unit.trim()),z?.id?d.tenant_id=z.id:a.tenant.trim()&&(d.tenant_name=a.tenant.trim()),d},lt=()=>{const t=C(R,_),o=[];return Object.entries(t).forEach(([S,h])=>{h!=null&&h!==""&&o.push(`${encodeURIComponent(S)}=${encodeURIComponent(String(h))}`)}),o.length>0?"?"+o.join("&"):""},mt=()=>{Q(a);const t=C(1);g.get(route("notice_and_evictions.index"),t,{preserveState:!0})},dt=()=>{B({city:"",property:"",unit:"",tenant:""}),Q({city:"",property:"",unit:"",tenant:""}),b(!1),E(!1),N(!1),$(!1),g.get(route("notice_and_evictions.index"),{},{preserveState:!1})},ut=t=>{q(t);const o=C(t,_);g.get(route("notice_and_evictions.index"),o,{preserveState:!0})},ht=t=>{M(t),q(1);const o=C(1,t);g.get(route("notice_and_evictions.index"),o,{preserveState:!0})},A=()=>C(R,_),ft=t=>{P(t),j(!0)},gt=async()=>{if(w){L(!0);try{const t=A(),o=new URLSearchParams(t).toString();g.delete(`/notice_and_evictions/${w.id}?${o}`,{onFinish:()=>{j(!1),P(null)}})}finally{L(!1)}}},yt=t=>{H(t),U(!0)},xt=()=>{U(!1),H(null),g.reload()},St=()=>{T(!1),g.reload()},_t=()=>{if(!i.data||i.data.length===0){alert("No data to export");return}n(!0);try{const t=`notice-evictions-${new Date().toISOString().split("T")[0]}.csv`;Bt(i.data,t)}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t instanceof Error?t.message:"Unknown error"}. Please check the console for details.`)}finally{n(!1)}},{hasPermission:V,hasAnyPermission:vt,hasAllPermissions:W}=Ut(),Ct=lt();return e.jsxs(Ot,{children:[e.jsx(Dt,{title:"Notice & Evictions"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx(Lt,{title:"Notice & Evictions",onExport:_t,onAdd:()=>T(!0),isExporting:D,hasRecords:i.data&&i.data.length>0,canCreate:W(["notice-and-evictions.create","notice-and-evictions.store"])}),e.jsxs(jt,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(wt,{children:e.jsx(kt,{tempFilters:a,cities:c,properties:r,units:m,tenants:l,showCityDropdown:X,showPropertyDropdown:Z,showUnitDropdown:tt,showTenantDropdown:et,setShowCityDropdown:b,setShowPropertyDropdown:E,setShowUnitDropdown:N,setShowTenantDropdown:$,onCityInputChange:rt,onPropertyInputChange:ot,onUnitInputChange:st,onTenantInputChange:ct,onCitySelect:nt,onPropertySelect:it,onUnitSelect:at,onTenantSelect:pt,onSearch:mt,onClear:dt})}),e.jsxs(Pt,{children:[e.jsx(Ht,{records:i.data,hasShowPermission:V("notice-and-evictions.show"),hasEditPermission:W(["notice-and-evictions.edit","notice-and-evictions.update"]),hasDeletePermission:V("notice-and-evictions.destroy"),hasAnyActionPermission:vt(["notice-and-evictions.show","notice-and-evictions.edit","notice-and-evictions.update","notice-and-evictions.destroy"]),onEdit:yt,onDelete:ft,filterQueryString:Ct}),i.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),i.data.length>0&&e.jsx("div",{className:"mt-6 border-t border-border pt-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-between gap-4 md:flex-row",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",v.from," to ",v.to," of ",v.total," records"]}),e.jsx(Rt,{currentPage:v.current_page,lastPage:v.last_page,perPage:_,onPageChange:ut,onPerPageChange:ht})]})})]})]})]})}),e.jsx(At,{open:I,onOpenChange:T,cities:c,properties:r,units:m,tenants:l,notices:y,onSuccess:St,queryParams:A()}),x&&e.jsx(Ft,{record:{...x,date:F(x.date),hearing_dates:F(x.hearing_dates),writ_date:F(x.writ_date)},cities:c,properties:r,units:m,tenants:l,notices:y,open:J,onOpenChange:U,onSuccess:xt,queryParams:A()},x.id),e.jsx(bt,{open:K,onOpenChange:t=>{j(t),t||P(null)},children:e.jsxs(Et,{children:[e.jsxs(Nt,{children:[e.jsx($t,{children:"Delete Record"}),e.jsx(It,{children:"Delete this record? This cannot be undone."})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:w&&e.jsxs("p",{children:["You are deleting record ID ",e.jsx("span",{className:"font-medium text-foreground",children:w.id}),"."]})}),e.jsxs(Tt,{children:[e.jsx(G,{type:"button",variant:"secondary",onClick:()=>{j(!1),P(null)},disabled:O,children:"Cancel"}),e.jsx(G,{type:"button",variant:"destructive",onClick:gt,disabled:O,children:O?"Deletingâ€¦":"Delete"})]})]})})]})};export{Fn as default};
