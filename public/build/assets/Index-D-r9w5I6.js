import{r as a,u as ie,j as e,H as ue,L as me,a as b}from"./app-C79wt3tX.js";import{B as H}from"./badge-BxLpr-IS.js";import{B as x}from"./createLucideIcon-C1z_f29J.js";import{C as xe,a as pe,b as he}from"./card-AzpDVrLx.js";import{I as C}from"./input-BS89LrTW.js";import{P as fe,T as be,a as ge,b as V,c as d,d as je,e as l,f as Ne}from"./table-BkCbQJPV.js";import{u as ve,A as ye}from"./app-layout-CQQyJnHK.js";import we from"./ApplicationCreateDrawer-DDPmdypa.js";import Ce from"./ApplicationEditDrawer-CyGL_M_H.js";import{D as Se}from"./download-B7Wdzj8e.js";import{C as L}from"./select-4_arDXlR.js";import{S as De}from"./search-BTrBOoaV.js";import{X as Ee}from"./index-DkjncacZ.js";import{E as ke}from"./eye-CitTXmBB.js";import{S as Ae}from"./square-pen-C2yNsVP7.js";import{f as Pe}from"./popover-EABh-nYt.js";import"./app-Do7cDRzv.js";import"./index-DMpLQi-Z.js";import"./index-CkXl1I8e.js";import"./index-ChhieIKn.js";import"./index-DLJGb8q0.js";import"./chevron-right-CkaRxpST.js";import"./app-logo-icon-CJ6cgBSF.js";import"./file-text-DtifDZmy.js";import"./drawer-wgoO6h1K.js";import"./label-CArU7ATR.js";import"./radioGroup-4V0hsG5D.js";import"./index-BUbw163t.js";import"./calendar-DZOiGQZc.js";const q=(n,u="-")=>{if(!n)return u;const s=/^(\d{4})-(\d{2})-(\d{2})/.exec(n);if(!s)return u;const[,p,g,h]=s,c=new Date(Number(p),Number(g)-1,Number(h));return Pe(c,"P")},Re=(n,u="applications.csv")=>{try{const s=t=>t==null?"":String(t).replace(/"/g,'""'),g=[["ID","City","Property","Unit","Name","Co-signer","Status","Date","Stage in Progress","Notes","Attachment Name"].join(","),...n.map(t=>{try{return[t.id||"",`"${s(t.city)}"`,`"${s(t.property)}"`,`"${s(t.unit_name)}"`,`"${s(t.name)}"`,`"${s(t.co_signer)}"`,`"${s(t.status)}"`,`"${q(t.date,"")}"`,`"${s(t.stage_in_progress)}"`,`"${s(t.notes)}"`,`"${s(t.attachment_name)}"`].join(",")}catch(j){return console.error("Error processing application row:",t,j),""}}).filter(t=>t!=="")].join(`
`),h=new Blob([g],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),f=URL.createObjectURL(h);return c.setAttribute("href",f),c.setAttribute("download",u),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(f),!0}catch(s){throw console.error("CSV Export Error:",s),s}};function cr({applications:n,cities:u,properties:s,units:p}){const[g,h]=a.useState(!1),[c,f]=a.useState(!1),[t,j]=a.useState(null),[_,I]=a.useState(!1),{flash:N}=ie().props,{hasPermission:U,hasAnyPermission:S,hasAllPermissions:M}=ve(),[i,T]=a.useState({city:"",property:"",unit:"",name:""}),[$,z]=a.useState({city:"",property:"",unit:"",name:""}),[X,v]=a.useState(!1),[G,y]=a.useState(!1),[J,w]=a.useState(!1),D=a.useRef(null),E=a.useRef(null),k=a.useRef(null),A=a.useRef(null),P=a.useRef(null),R=a.useRef(null);a.useEffect(()=>{const r=o=>{D.current&&!D.current.contains(o.target)&&A.current&&!A.current.contains(o.target)&&v(!1),E.current&&!E.current.contains(o.target)&&P.current&&!P.current.contains(o.target)&&y(!1),k.current&&!k.current.contains(o.target)&&R.current&&!R.current.contains(o.target)&&w(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const m=(r,o)=>{T(ce=>({...ce,[r]:o}))},K=r=>{m("city",r.name),v(!1)},Q=r=>{const o=r.target.value;m("city",o),v(o.length>0)},W=r=>{m("property",r.name),y(!1)},Y=r=>{const o=r.target.value;m("property",o),y(o.length>0)},Z=r=>{m("unit",r.name),w(!1)},ee=r=>{const o=r.target.value;m("unit",o),w(o.length>0)},re=()=>{z(i),b.get(route("applications.index"),i,{preserveState:!0,preserveScroll:!0})},te=r=>{confirm("Are you sure you want to delete this application?")&&b.delete(route("applications.destroy",r.id))},se=()=>{if(!n||!n.data||n.data.length===0){alert("No data to export");return}I(!0);try{const r=`applications-${new Date().toISOString().split("T")[0]}.csv`;Re(n.data,r),console.log("Export completed successfully")}catch(r){console.error("Export failed:",r),alert(`Export failed: ${r instanceof Error?r.message:"Unknown error"}`)}finally{I(!1)}},oe=r=>r?e.jsx(H,{variant:"default",children:r}):e.jsx(H,{variant:"outline",children:"No Status"}),ae=()=>{b.get(route("applications.index"),$,{preserveState:!0,preserveScroll:!0})},ne=()=>{const r={city:"",property:"",unit:"",name:""};T(r),z(r),b.get(route("applications.index"),{},{preserveState:!1})},de=()=>{b.get(route("applications.index"),$,{preserveState:!0,preserveScroll:!0}),f(!1),j(null)},le=r=>{j(r),f(!0)},O=u.filter(r=>r.name.toLowerCase().includes(i.city.toLowerCase())),F=Object.values(s).flat().filter(r=>r.name.toLowerCase().includes(i.property.toLowerCase())),B=Object.values(p).flat().filter(r=>r.name.toLowerCase().includes(i.unit.toLowerCase()));return e.jsxs(ye,{children:[e.jsx(ue,{title:"Applications"}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[N?.success&&e.jsx("div",{className:"mb-4 rounded border border-chart-1 bg-chart-1/20 px-4 py-3 text-chart-1",children:N?.success}),N?.error&&e.jsx("div",{className:"mb-4 rounded border border-destructive bg-destructive/20 px-4 py-3 text-destructive",children:N?.error}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Applications"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:se,disabled:_||!n?.data||n.data.length===0,className:"flex items-center",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),_?"Exporting...":"Export CSV"]}),M(["applications.create","applications.store"])&&e.jsxs(x,{onClick:()=>h(!0),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Add Application"]})]})]}),e.jsxs(xe,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(pe,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:A,type:"text",placeholder:"City",value:i.city,onChange:Q,onFocus:()=>v(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),X&&O.length>0&&e.jsx("div",{ref:D,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:O.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>K(r),children:r.name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:P,type:"text",placeholder:"Property",value:i.property,onChange:Y,onFocus:()=>y(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),G&&F.length>0&&e.jsx("div",{ref:E,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:F.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>W(r),children:r.name},r.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{ref:R,type:"text",placeholder:"Unit",value:i.unit,onChange:ee,onFocus:()=>w(!0),className:"text-input-foreground bg-input pr-8"}),e.jsx(L,{className:"absolute top-1/2 right-2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),J&&B.length>0&&e.jsx("div",{ref:k,className:"absolute top-full right-0 left-0 z-50 mt-1 max-h-60 overflow-auto rounded-md border border-input bg-popover shadow-lg",children:B.map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground",onClick:()=>Z(r),children:r.name},r.id))})]}),e.jsx(C,{type:"text",placeholder:"Application Name",value:i.name,onChange:r=>m("name",r.target.value),className:"text-input-foreground bg-input"}),e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{onClick:re,variant:"default",className:"flex items-center",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Search"]}),e.jsxs(x,{onClick:ne,variant:"outline",className:"flex items-center",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Clear"]})]})]})}),e.jsxs(he,{children:[e.jsx("div",{className:"relative overflow-x-auto",children:e.jsxs(be,{className:"border-collapse rounded-md border border-border",children:[e.jsx(ge,{children:e.jsxs(V,{className:"border-border",children:[e.jsx(d,{className:"sticky left-0 z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"City"}),e.jsx(d,{className:"sticky left-[120px] z-10 min-w-[150px] border border-border bg-muted text-muted-foreground",children:"Property"}),e.jsx(d,{className:"sticky left-[270px] z-10 min-w-[120px] border border-border bg-muted text-muted-foreground",children:"Unit"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Name"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Co-signer"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Status"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Date"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Stage"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Note"}),e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Attachment"}),S(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(d,{className:"border border-border bg-muted text-muted-foreground",children:"Actions"})]})}),e.jsx(je,{children:n.data.map(r=>e.jsxs(V,{className:"border-border hover:bg-muted/50",children:[e.jsx(l,{className:"sticky left-0 z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.city}),e.jsx(l,{className:"sticky left-[120px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.property}),e.jsx(l,{className:"sticky left-[270px] z-10 border border-border bg-muted text-center font-medium text-foreground",children:r.unit_name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.name}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.co_signer}),e.jsx(l,{className:"border border-border text-center",children:oe(r.status)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:q(r.date)}),e.jsx(l,{className:"border border-border text-center text-foreground",children:r.stage_in_progress||"N/A"}),e.jsx(l,{className:"border border-border text-center",children:r.notes?e.jsx("div",{className:"max-w-24 truncate",title:r.notes,children:r.notes}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(l,{className:"border border-border text-center",children:r.attachment_name?e.jsx("a",{href:`/applications/${r.id}/download`,className:"text-sm text-primary hover:underline",children:r.attachment_name}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No attachment"})}),S(["applications.show","applications.edit","applications.update","applications.destroy"])&&e.jsx(l,{className:"border border-border text-center",children:e.jsxs("div",{className:"flex gap-1",children:[U("applications.show")&&e.jsx(me,{href:route("applications.show",r.id),children:e.jsx(x,{variant:"outline",size:"sm",children:e.jsx(ke,{className:"h-4 w-4"})})}),S(["applications.edit","applications.update"])&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>le(r),children:e.jsx(Ae,{className:"h-4 w-4"})}),U("applications.destroy")&&e.jsx(x,{variant:"outline",size:"sm",onClick:()=>te(r),className:"border-destructive/20 text-destructive hover:bg-destructive/10 hover:text-destructive",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},r.id))})]})}),n.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No applications found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),n.last_page>1&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("nav",{className:"flex space-x-2",children:n.links.map((r,o)=>e.jsx("button",{onClick:()=>r.url&&b.get(r.url),disabled:!r.url,className:`rounded px-3 py-2 text-sm ${r.active?"bg-primary text-primary-foreground":r.url?"bg-muted text-foreground hover:bg-accent":"cursor-not-allowed bg-muted text-muted-foreground"}`,dangerouslySetInnerHTML:{__html:r.label}},o))})})]})]})]})}),e.jsx(we,{cities:u,properties:s,units:p,open:g,onOpenChange:h,onSuccess:ae}),t&&e.jsx(Ce,{application:t,cities:u,properties:s,units:p,open:c,onOpenChange:f,onSuccess:de})]})}export{cr as default};
