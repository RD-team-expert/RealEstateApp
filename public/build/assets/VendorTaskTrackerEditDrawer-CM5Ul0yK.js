import{r as i,b as we,j as e}from"./app-BkyZySAt.js";import{B as y}from"./button-DOkiOPMq.js";import{P as L,a as Y,b as G,C as q,p as Ce}from"./popover-D_YIvH1C.js";import{D as De,a as Fe,b as Pe}from"./drawer-BQHCt03g.js";import{L as o}from"./label-BCoYkVMj.js";import{S as P,a as E,b as T,c as R,d as U}from"./select-RK3poDcU.js";import{R as de}from"./radioGroup-DeV4OTT4.js";import{C as J}from"./calendar-5wwCpl_0.js";import{f as A,i as oe}from"./format-PYUiRpxY.js";import"./app-oDNfBSri.js";import"./index-DJP-tLWC.js";import"./utils-CBfrqCZ4.js";import"./createLucideIcon-D3eUMA-Y.js";import"./chevron-right-Dq99BrXh.js";import"./chevron-down-BKwinLVR.js";import"./index-D86DOQfL.js";import"./index-CSRjvr9u.js";import"./index-CEATnq5y.js";import"./index-m091_WFs.js";import"./index-Zsm6T9Ra.js";import"./index-B2wSjM2m.js";import"./index-DCBTnY57.js";import"./index-B_abII33.js";import"./index-Dc_FVRD7.js";import"./index-DBw3aPE3.js";import"./index-DzIcFn8W.js";import"./x-B9Nlqjs5.js";import"./index-DvetPajZ.js";import"./index-DEy3YO5y.js";import"./index-DsMWzC3p.js";import"./check-MTPBeqEd.js";import"./chevron-up-CJrmsHZ1.js";function cs({task:t,cities:ce,units:me,vendors:ue,unitsByCity:O,propertiesByCity:p,unitsByProperty:m,vendorsByCity:g,open:he,onOpenChange:I,onSuccess:xe}){const S=i.useRef(null),V=i.useRef(null),k=i.useRef(null),w=i.useRef(null),C=i.useRef(null),[K,v]=i.useState(""),[Q,u]=i.useState(""),[W,x]=i.useState(""),[X,j]=i.useState(""),[Z,N]=i.useState(""),[B,h]=i.useState([]),[_e,_]=i.useState([]),[ee,f]=i.useState([]),[c,se]=i.useState(t.city||""),[te,M]=i.useState(t.property_name||""),[,D]=i.useState(t.unit_name||""),[,$]=i.useState(t.vendor_name||""),F=s=>{if(!(!s||s.trim()===""))try{const a=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(a){const[,Se,Ve,ke]=a,le=new Date(Number(Se),Number(Ve)-1,Number(ke));if(oe(le))return le}const l=Ce(s,"yyyy-MM-dd",new Date(2e3,0,1));return oe(l)?l:void 0}catch(a){console.warn("Failed to parse date:",s,a);return}},z=s=>{const a=F(s);if(!a)return"Pick a date";try{return A(a,"PPP")}catch(l){return console.warn("Failed to format date:",s,l),"Pick a date"}},[H,fe]=i.useState({task_submission_date:!1,any_scheduled_visits:!1,task_ending_date:!1}),b=(s,a)=>{fe(l=>({...l,[s]:a}))},ae=s=>{const a=ue.find(l=>l.vendor_name===s);return a?a.id.toString():""},ne=s=>{const a=me.find(l=>l.unit_name===s);return a?a.id.toString():""},{data:n,setData:d,put:be,processing:re,errors:r}=we({vendor_id:ae(t.vendor_name||""),unit_id:ne(t.unit_name||""),task_submission_date:t.task_submission_date??"",assigned_tasks:t.assigned_tasks??"",any_scheduled_visits:t.any_scheduled_visits??"",notes:t.notes??"",task_ending_date:t.task_ending_date??"",status:t.status??"",urgent:t.urgent??"No"});i.useEffect(()=>{t.city?(p[t.city]?_(p[t.city]):_([]),g[t.city]?f(g[t.city]):f([]),t.property_name&&m[t.city]&&m[t.city][t.property_name]?h(m[t.city][t.property_name]):O[t.city]?h(O[t.city]):h([])):(_([]),f([]),h([]))},[t.city,t.property_name,O,p,m,g]);const pe=s=>{se(s),M(""),D(""),$(""),d("unit_id",""),d("vendor_id",""),v(""),u(""),x(""),s?(p[s]?_(p[s]):_([]),g[s]?f(g[s]):f([])):(_([]),f([])),h([])},ge=s=>{M(s),D(""),d("unit_id",""),u(""),c&&s&&m[c]&&m[c][s]?h(m[c][s]):h([])},ve=s=>{const a=B.find(l=>l.id.toString()===s);a&&(D(a.unit_name),d("unit_id",s),u(""))},je=s=>{const a=ee.find(l=>l.id.toString()===s);a&&($(a.vendor_name),d("vendor_id",s),x(""))},Ne=s=>{d("assigned_tasks",s.target.value),N("")},ie=s=>{s.preventDefault(),v(""),u(""),x(""),j(""),N("");let a=!1;(!c||c.trim()==="")&&(v("Please select a city before submitting the form."),S.current&&(S.current.focus(),S.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.unit_id||n.unit_id.trim()==="")&&(u("Please select a unit before submitting the form."),V.current&&(V.current.focus(),V.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.vendor_id||n.vendor_id.trim()==="")&&(x("Please select a vendor before submitting the form."),k.current&&(k.current.focus(),k.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.task_submission_date||n.task_submission_date.trim()==="")&&(j("Please select a task submission date before submitting the form."),w.current&&(w.current.focus(),w.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),(!n.assigned_tasks||n.assigned_tasks.trim()==="")&&(N("Please enter assigned tasks before submitting the form."),C.current&&(C.current.focus(),C.current.scrollIntoView({behavior:"smooth",block:"center"})),a=!0),!a&&be(route("vendor-task-tracker.update",t.id),{onSuccess:()=>{v(""),u(""),x(""),j(""),N(""),I(!1),xe?.()}})},ye=()=>{d({vendor_id:ae(t.vendor_name||""),unit_id:ne(t.unit_name||""),task_submission_date:t.task_submission_date??"",assigned_tasks:t.assigned_tasks??"",any_scheduled_visits:t.any_scheduled_visits??"",notes:t.notes??"",task_ending_date:t.task_ending_date??"",status:t.status??"",urgent:t.urgent??"No"}),se(t.city||""),M(t.property_name||""),D(t.unit_name||""),$(t.vendor_name||""),v(""),u(""),x(""),j(""),N(""),I(!1)};return e.jsx(De,{open:he,onOpenChange:I,modal:!1,children:e.jsx(Fe,{size:"half",title:`Edit Vendor Task #${t.id}`,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto p-6",children:e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"city",className:"text-base font-semibold",children:"City *"})}),e.jsxs(P,{onValueChange:pe,value:c,children:[e.jsx(E,{ref:S,children:e.jsx(T,{placeholder:"Select city"})}),e.jsx(R,{children:ce?.map(s=>e.jsx(U,{value:s.city,children:s.city},s.id))||[]})]}),r.vendor_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.vendor_id}),K&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:K})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"property",className:"text-base font-semibold",children:"Property *"})}),e.jsxs(P,{onValueChange:ge,value:te,disabled:!c,children:[e.jsx(E,{children:e.jsx(T,{placeholder:"Select property"})}),e.jsx(R,{children:_e?.map(s=>e.jsx(U,{value:s.property_name,children:s.property_name},s.id))||[]})]})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-green-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"unit_name",className:"text-base font-semibold",children:"Unit Name *"})}),e.jsxs(P,{onValueChange:ve,value:n.unit_id,disabled:!te,children:[e.jsx(E,{ref:V,children:e.jsx(T,{placeholder:"Select unit"})}),e.jsx(R,{children:B?.map(s=>e.jsx(U,{value:s.id.toString(),children:s.unit_name},s.id))||[]})]}),r.unit_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.unit_id}),Q&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Q})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-purple-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"vendor_name",className:"text-base font-semibold",children:"Vendor Name *"})}),e.jsxs(P,{onValueChange:je,value:n.vendor_id,disabled:!c,children:[e.jsx(E,{ref:k,children:e.jsx(T,{placeholder:"Select vendor"})}),e.jsx(R,{children:ee?.map(s=>e.jsx(U,{value:s.id.toString(),children:s.vendor_name},s.id))||[]})]}),r.vendor_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.vendor_id}),W&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:W})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-orange-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"task_submission_date",className:"text-base font-semibold",children:"Task Submission Date *"})}),e.jsxs(L,{open:H.task_submission_date,onOpenChange:s=>b("task_submission_date",s),modal:!1,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(y,{ref:w,variant:"outline",className:`w-full justify-start text-left font-normal ${!n.task_submission_date&&"text-muted-foreground"}`,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),z(n.task_submission_date)]})}),e.jsx(G,{className:"z-[60] w-auto p-0",onOpenAutoFocus:s=>s.preventDefault(),children:e.jsx(q,{mode:"single",selected:F(n.task_submission_date),onSelect:s=>{s&&(d("task_submission_date",A(s,"yyyy-MM-dd")),b("task_submission_date",!1),j(""))},initialFocus:!0})})]}),r.task_submission_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.task_submission_date}),X&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:X})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-emerald-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"any_scheduled_visits",className:"text-base font-semibold",children:"Any Scheduled Visits"})}),e.jsxs(L,{open:H.any_scheduled_visits,onOpenChange:s=>b("any_scheduled_visits",s),modal:!1,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:`w-full justify-start text-left font-normal ${!n.any_scheduled_visits&&"text-muted-foreground"}`,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),z(n.any_scheduled_visits)]})}),e.jsx(G,{className:"z-[60] w-auto p-0",onOpenAutoFocus:s=>s.preventDefault(),children:e.jsx(q,{mode:"single",selected:F(n.any_scheduled_visits),onSelect:s=>{s&&(d("any_scheduled_visits",A(s,"yyyy-MM-dd")),b("any_scheduled_visits",!1))},initialFocus:!0})})]}),r.any_scheduled_visits&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.any_scheduled_visits})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-teal-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"task_ending_date",className:"text-base font-semibold",children:"Task Ending Date"})}),e.jsxs(L,{open:H.task_ending_date,onOpenChange:s=>b("task_ending_date",s),modal:!1,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:`w-full justify-start text-left font-normal ${!n.task_ending_date&&"text-muted-foreground"}`,children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),z(n.task_ending_date)]})}),e.jsx(G,{className:"z-[60] w-auto p-0",onOpenAutoFocus:s=>s.preventDefault(),children:e.jsx(q,{mode:"single",selected:F(n.task_ending_date),onSelect:s=>{s&&(d("task_ending_date",A(s,"yyyy-MM-dd")),b("task_ending_date",!1))},initialFocus:!0})})]}),r.task_ending_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.task_ending_date})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-indigo-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"assigned_tasks",className:"text-base font-semibold",children:"Assigned Tasks *"})}),e.jsx("textarea",{ref:C,id:"assigned_tasks",value:n.assigned_tasks,onChange:Ne,rows:3,placeholder:"Describe the assigned tasks...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.assigned_tasks&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.assigned_tasks}),Z&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:Z})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-pink-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"notes",className:"text-base font-semibold",children:"Notes"})}),e.jsx("textarea",{id:"notes",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:n.notes,onChange:s=>d("notes",s.target.value),rows:3,placeholder:"Enter any additional notes..."}),r.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.notes})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-red-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"status",className:"text-base font-semibold",children:"Status"})}),e.jsx(de,{value:n.status,onValueChange:s=>d("status",s),name:"status",options:[{value:"Pending",label:"Pending"},{value:"In Progress",label:"In Progress"},{value:"Completed",label:"Completed"},{value:"On Hold",label:"On Hold"}],className:"flex-wrap"}),r.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.status})]}),e.jsxs("div",{className:"rounded-lg border-l-4 border-l-yellow-500 p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(o,{htmlFor:"urgent",className:"text-base font-semibold",children:"Urgent"})}),e.jsx(de,{value:n.urgent,onValueChange:s=>d("urgent",s),name:"urgent",options:[{value:"Yes",label:"Yes"},{value:"No",label:"No"}]}),r.urgent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.urgent})]})]})}),e.jsx(Pe,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:ye,className:"flex-1",children:"Cancel"}),e.jsx(y,{type:"submit",onClick:ie,disabled:re,className:"flex-1",children:re?"Updating…":"Update Task"})]})})]})})})}export{cs as default};
