import{r as i,u as st,b as ot,a as g,j as e,H as it}from"./app-Y5k3mklr.js";import{B as w}from"./button-CQfb3JBO.js";import{C as at,a as nt,b as pt}from"./card-DrRiDRID.js";import{u as mt}from"./usePermissions-BhSSdkVr.js";import{A as ct}from"./app-layout-CTk7sr4u.js";import lt from"./UnitCreateDrawer-sj81XmHR.js";import dt from"./UnitEditDrawer-xrl8mMAR.js";import ut from"./Notification-C_3AZ6PK.js";import ht from"./ImportStatsCard-Ca2nTSSm.js";import ft from"./ImportModal-ChIFtt4z.js";import L from"./FlashMessage-gg_CIOTG.js";import gt from"./UnitsFilter-CFrQyPa_.js";import xt from"./UnitsTable-CgeLkkKY.js";import St from"./Pagination-oMCSJ__m.js";import{useNotification as yt}from"./useNotification-onszsyD6.js";import{f as Ct}from"./format-PYUiRpxY.js";import{D as jt}from"./download-DNhQ9Ubq.js";import{U as _t}from"./upload-DR2sYjF2.js";import{P as bt}from"./plus-COh7YTMB.js";import"./app-BZFxL5VY.js";import"./index-DeKsjAJz.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-uindsx95.js";import"./index-CVo6BqxD.js";import"./index-wwqKUVc_.js";import"./index-DLyAnWAc.js";import"./index-D1TeM0R1.js";import"./index-BwS5tYp4.js";import"./x-Nz9yRxvI.js";import"./createLucideIcon-BOWbKjUa.js";import"./index-Dc_FVRD7.js";import"./index-12wiZxBo.js";import"./index-ClDX_llA.js";import"./index-1ypBnunE.js";import"./collapsible-gNKnkPA_.js";import"./chevron-right-MFcKsrea.js";import"./index-vpTsBzNQ.js";import"./log-out-CCSYfweR.js";import"./chevrons-up-down-Dx5zMBh7.js";import"./app-logo-icon-AsZY8TzN.js";import"./house-BPvUorqd.js";import"./building-sYDUExbj.js";import"./users-Cx0WPs1m.js";import"./wrench-CUEKGXnc.js";import"./credit-card-DsM7WiA3.js";import"./dollar-sign-BwSFA-ho.js";import"./file-text-BYo38brw.js";import"./triangle-alert-CTk5zCLO.js";import"./bell-CU32QIDE.js";import"./drawer-DFF_jVi3.js";import"./CitySelection-BaSw6Zeq.js";import"./label-TGf-rOKa.js";import"./popover-DdSV75dE.js";import"./command-DZJD3kpm.js";import"./search-DjaWC1MF.js";import"./check-Dye3JuSq.js";import"./PropertySelection-BkyS8r3p.js";import"./UnitDetails-NCxaxf-3.js";import"./input-C9nWuHON.js";import"./TenantDetails-zemRe7dq.js";import"./LeaseDates-Brlkya9d.js";import"./calendar-BKoT7UuT.js";import"./chevron-left-C91HQvgE.js";import"./chevron-down-DPdXkLmR.js";import"./calendar-DEpy9fhW.js";import"./UnitSpecifications-BHjfPzg6.js";import"./LeaseStatus-DEq6b02w.js";import"./radioGroup-Dspzb7Eh.js";import"./index-BHdDvuH_.js";import"./FinancialInformation-X64JBly7.js";import"./UtilityInformation-CsgYgz-S.js";import"./InsuranceInformation-CA1Xr_Ls.js";import"./NewLease-DcKXUyds.js";import"./CityPropertySelector-BWNUrIMj.js";import"./FormSection-VO04mVGN.js";import"./UnitDetailsFields-CTlqHwG6.js";import"./LeaseInformationFields-Db4ab5HB.js";import"./DatePickerField-BHvIBUsi.js";import"./FinancialFields-CBayirAA.js";import"./UtilitiesFields-Cz1L7ZxG.js";import"./InsuranceFields-BwiNIkJg.js";import"./CalculatedValuesDisplay-CxaBZoZi.js";import"./circle-alert-C_X-Prfw.js";import"./circle-x-CnXhIMSa.js";import"./circle-check-big-DDB7DIfo.js";import"./file-spreadsheet-CiSwPl8U.js";import"./loader-circle-B5ELVvXp.js";import"./select-DH9YXgtJ.js";import"./chevron-up-CeaLGkuh.js";import"./CityAutocomplete-CxcjXeJp.js";import"./PropertyAutocomplete-BFnncPZM.js";import"./badge-wAC12PD_.js";import"./table-DpdbT0jv.js";import"./square-pen-B47UA1Qy.js";import"./trash-2-CifiXUqC.js";const N=(s,c="-")=>{if(!s)return c;const l=/^(\d{4})-(\d{2})-(\d{2})/.exec(s);if(!l)return c;const[,d,u,a]=l,f=new Date(Number(d),Number(u)-1,Number(a));return Ct(f,"P")},Pt=(s,c="units.csv")=>{const d=[["ID","City","Property","Unit Name","Tenants","Lease Start","Lease End","Beds","Baths","Lease Status","Monthly Rent","Recurring Transaction","Utility Status","Account Number","Insurance","Insurance Expiration","Vacant","Listed","Applications"].join(","),...s.map(r=>[r.id,`"${r.city}"`,`"${r.property}"`,`"${r.unit_name}"`,`"${r.tenants||""}"`,`"${N(r.lease_start,"")}"`,`"${N(r.lease_end,"")}"`,r.count_beds||"",r.count_baths||"",`"${r.lease_status||""}"`,`"${r.formatted_monthly_rent||""}"`,`"${(r.recurring_transaction||"").replace(/"/g,'""')}"`,`"${(r.utility_status||"").replace(/"/g,'""')}"`,`"${(r.account_number||"").replace(/"/g,'""')}"`,`"${r.insurance||""}"`,`"${N(r.insurance_expiration_date,"")}"`,`"${r.vacant}"`,`"${r.listed}"`,r.total_applications||0].join(","))].join(`
`),u=new Blob([d],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),f=URL.createObjectURL(u);a.setAttribute("href",f),a.setAttribute("download",c),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(f)};function ur({units:s,filters:c,cities:l,properties:d,importStats:u}){const{hasPermission:a,hasAnyPermission:f,hasAllPermissions:r}=mt(),[,E]=i.useState(c),[n,I]=i.useState(c),[x,D]=i.useState(String(s?.per_page??"15")),[U,$]=i.useState(!1),[A,C]=i.useState(!1),[O,T]=i.useState(!!u),[R,v]=i.useState(!1),[V,F]=i.useState(!1),[k,M]=i.useState(null),{flash:y}=st().props,[B,j]=i.useState(n.city||""),[H,_]=i.useState(n.property||""),{notification:b,showNotification:P,hideNotification:z}=yt(),h=ot({file:null,skip_duplicates:!0,update_existing:!1}),S=(t,o)=>{I({...n,[t]:o})},q=t=>{j(t),S("city",t)},G=t=>{j(t),S("city",t)},J=t=>{_(t),S("property",t)},K=t=>{_(t.property_name),S("property",t.property_name)},Q=()=>{E(n);const t={};Object.entries(n).forEach(([o,p])=>{p!=null&&p!==""&&(t[o]=String(p))}),t.per_page=String(x),g.get(route("units.index"),t,{preserveState:!0,preserveScroll:!0})},W=()=>{const t={city:"",property:"",unit_name:"",vacant:"",listed:"",insurance:"",is_new_lease:""};I(t),E(t),j(""),_(""),D("15"),g.get(route("units.index"),{per_page:"15"},{preserveState:!0,preserveScroll:!0})},X=t=>{if(confirm("Are you sure you want to delete this unit?")){const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),g.visit(route("units.destroy",t.id),{method:"delete",data:{redirect:{filters:o,per_page:String(x),page:String(s?.current_page??1)}},preserveState:!0,preserveScroll:!0})}},Y=t=>{M(t),F(!0)},Z=()=>{g.reload({only:["units","statistics"]})},tt=()=>{},et=()=>{if(s.data.length===0){alert("No data to export");return}$(!0);try{const t=`units-${new Date().toISOString().split("T")[0]}.csv`;Pt(s.data,t)}catch(t){console.error("Export failed:",t),alert("Export failed. Please try again.")}finally{$(!1)}},rt=i.useCallback(t=>{h.setData("file",t),g.post(route("units.import"),{file:t,skip_duplicates:h.data.skip_duplicates,update_existing:h.data.update_existing},{forceFormData:!0,onSuccess:()=>{C(!1),h.reset(),P("success","CSV file imported successfully!")},onError:o=>{const p=o.file||"Failed to import CSV file. Please try again.";P("error",p)},onFinish:()=>{h.clearErrors()}})},[h,P]);return e.jsxs(ct,{children:[e.jsx(it,{title:"Units"}),b&&e.jsx(ut,{type:b.type,message:b.message,onClose:z}),e.jsx(ft,{isOpen:A,onClose:()=>C(!1),onSubmit:rt,isLoading:h.processing}),e.jsx("div",{className:"min-h-screen bg-background py-12 text-foreground transition-colors",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx(L,{type:"success",message:y?.success}),y?.error&&e.jsx(L,{type:"error",message:y?.error}),O&&u&&e.jsx(ht,{stats:u,onClose:()=>T(!1)}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Units List"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:et,disabled:U||s.data.length===0,className:"flex items-center",children:[e.jsx(jt,{className:"mr-2 h-4 w-4"}),U?"Exporting...":"Export CSV"]}),a("units.import")&&e.jsxs(w,{onClick:()=>C(!0),variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Import CSV"]}),f(["units.store","units.create"])&&e.jsxs(w,{onClick:()=>v(!0),children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add Unit"]})]})]}),e.jsxs(at,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsx(nt,{children:e.jsx(gt,{filters:n,cities:l||[],properties:d||[],cityInput:B,propertyInput:H,onFilterChange:S,onCityInputChange:q,onCitySelect:G,onPropertyInputChange:J,onPropertySelect:K,onSearch:Q,onClear:W})}),e.jsxs(pt,{children:[e.jsx(xt,{units:s.data,hasEditPermission:r(["units.edit","units.update"]),hasDeletePermission:a("units.destroy"),onEdit:Y,onDelete:X}),s.data.length===0&&e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No units found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search filters."})]}),e.jsx(St,{links:s.links,currentPage:s.current_page,lastPage:s.last_page,from:s.from,to:s.to,total:s.total,perPage:x,onPerPageChange:t=>{D(t);const o={};Object.entries(n).forEach(([p,m])=>{m!=null&&m!==""&&(o[p]=String(m))}),o.per_page=String(t),g.get(route("units.index"),o,{preserveState:!0,preserveScroll:!0})}})]})]})]})}),e.jsx(lt,{open:R,onOpenChange:v,cities:l||[],properties:d||[],onSuccess:tt,redirectState:{filters:n,per_page:x,page:s?.current_page??1}}),k&&e.jsx(dt,{unit:k,cities:l||[],properties:d||[],open:V,onOpenChange:F,onSuccess:Z,redirectState:{filters:n,per_page:x,page:s?.current_page??1}})]})}export{ur as default};
