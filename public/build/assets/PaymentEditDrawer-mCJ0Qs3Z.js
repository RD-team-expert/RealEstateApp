import{r as i,b as ie,j as l}from"./app-DIEWn7Ix.js";import{D as se,a as oe,b as ae}from"./drawer-fqLIckn8.js";import{B}from"./button-C0qpziZb.js";import ne from"./PaymentForm-qW0HxcC9.js";import{f as ce}from"./format-PYUiRpxY.js";import"./app-ChTVGdbA.js";import"./index-DKA-WKms.js";import"./index-Bt0zfGgm.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./CityField-ClMVChQj.js";import"./label-BIgMUqDa.js";import"./command-drH0gSTA.js";import"./search-Cudh47UL.js";import"./popover-BTBKKAKu.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./chevrons-up-down-wcdr16Hr.js";import"./check-CBvn5g3p.js";import"./PropertyField-D_12sA7P.js";import"./UnitField-Bs55kdyr.js";import"./DateField-ClW6FPO5.js";import"./calendar-A7iFafDy.js";import"./chevron-left-CWUKElF8.js";import"./chevron-right-lBI-HPj1.js";import"./chevron-down-DABifuem.js";import"./calendar-BV4TAGR8.js";import"./OwesField-BeqIvXL-.js";import"./input-Dp80VBC1.js";import"./PaidField-36JWVDVQ.js";import"./AssistanceField-WLLP_OTU.js";import"./checkbox-ZhzcX3If.js";import"./index-Dc_FVRD7.js";import"./index-OmisV_7g.js";import"./index-BuLzMHmv.js";import"./PermanentField-TIL-yTRz.js";import"./radioGroup-BEE05Kck.js";import"./index-Bp33PYYw.js";import"./ReversedPaymentsField-I0HlGrQw.js";import"./NotesField-DlrVh_-0.js";import"./DebugInfo-TVlglH_K.js";function it({payment:e,units:I,cities:M,unitsByCity:O,propertiesByCity:z,open:y,onOpenChange:E,onSuccess:$,filtersContext:s}){const b=i.useRef(null),g=i.useRef(null),v=i.useRef(null),S=i.useRef(null),w=i.useRef(null),[q,N]=i.useState(""),[G,P]=i.useState(""),[H,p]=i.useState(""),[J,V]=i.useState(""),[K,j]=i.useState(""),[L,R]=i.useState(!1),[o,U]=i.useState(""),[n,f]=i.useState(""),[_,u]=i.useState(""),{data:d,setData:c,put:Q,processing:D,errors:T,transform:W}=ie({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:""});i.useEffect(()=>{e&&y&&(c({date:e.date??"",unit_id:e.unit_id?.toString()??"",owes:e.owes?.toString()??"",paid:e.paid?.toString()??"",status:e.status??"",notes:e.notes??"",reversed_payments:e.reversed_payments??"",permanent:e.permanent??"No",has_assistance:e.has_assistance??!1,assistance_amount:e.assistance_amount?.toString()??"",assistance_company:e.assistance_company??""}),U(e.city??""),f(e.property_name??""),u(e.unit_name??""),h())},[e,y]);const h=()=>{N(""),P(""),p(""),V(""),j("")},x=()=>o?z[o]||[]:[],F=()=>o?n?I.filter(r=>r.city===o&&r.property_name===n).map(r=>r.unit_name):O[o]||[]:[],X=(r,t,a)=>{const m=I.find(k=>k.city===r&&k.property_name===t&&k.unit_name===a);return m?m.id:null};i.useEffect(()=>{o&&n&&(x().includes(n)||(f(""),u(""),c(t=>({...t,unit_id:""}))))},[o]),i.useEffect(()=>{n&&_&&(F().includes(_)||(u(""),c(t=>({...t,unit_id:""}))))},[o,n]);const Y=r=>{U(r),f(""),u(""),c(t=>({...t,unit_id:""})),h()},Z=r=>{f(r),u(""),c(t=>({...t,unit_id:""})),P(""),p("")},C=r=>{if(u(r),p(""),o&&n&&r){const t=X(o,n,r);t&&c(a=>({...a,unit_id:t.toString()}))}},ee=r=>{r&&(c(t=>({...t,date:ce(r,"yyyy-MM-dd")})),V(""),R(!1))},te=r=>{c(t=>({...t,owes:r.target.value})),j("")},A=r=>{r.preventDefault(),h();let t=!1;if((!d.date||d.date.trim()==="")&&(V("Please select a date before submitting the form."),S.current&&(S.current.focus(),S.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!o||o.trim()==="")&&(N("Please select a city before submitting the form."),b.current&&(b.current.focus(),b.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!n||n.trim()==="")&&(P("Please select a property before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!_||_.trim()==="")&&(p("Please select a unit before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!d.owes||d.owes.trim()==="")&&(j("Please enter the amount owed before submitting the form."),w.current&&(w.current.focus(),w.current.scrollIntoView({behavior:"smooth",block:"center"})),t=!0),(!d.unit_id||d.unit_id.trim()==="")&&(p("Unable to identify the selected unit. Please try selecting again."),t=!0),t)return;const a={};s?.city&&(a.filter_city=s.city),s?.property&&(a.filter_property=s.property),s?.unit&&(a.filter_unit=s.unit),s?.permanent&&s.permanent.length>0&&(a.filter_permanent=s.permanent.join(",")),s?.is_hidden&&(a.filter_is_hidden="true"),s?.per_page&&(a.filter_per_page=s.per_page),s?.page&&(a.filter_page=s.page),W(m=>({...m,...a})),Q(route("payments.update",e.id),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h(),E(!1),$?.()},onError:m=>{console.error("Form submission errors:",m)}})},re=()=>{e&&(c({date:e.date??"",unit_id:e.unit_id?.toString()??"",owes:e.owes?.toString()??"",paid:e.paid?.toString()??"",status:e.status??"",notes:e.notes??"",reversed_payments:e.reversed_payments??"",permanent:e.permanent??"No",has_assistance:e.has_assistance??!1,assistance_amount:e.assistance_amount?.toString()??"",assistance_company:e.assistance_company??""}),U(e.city??""),f(e.property_name??""),u(e.unit_name??"")),h(),R(!1),E(!1)};return l.jsx(se,{open:y,onOpenChange:E,modal:!1,children:l.jsx(oe,{size:"half",title:`Edit Payment #${e.id}`,children:l.jsxs("div",{className:"flex h-full flex-col",children:[l.jsx("div",{className:"flex-1 overflow-auto p-6",children:l.jsx(ne,{data:d,setData:c,errors:T,cities:M,selectedCity:o,selectedProperty:n,selectedUnit:_,getAvailableProperties:x,getAvailableUnits:F,handleCityChange:Y,handlePropertyChange:Z,handleUnitChange:C,handleDateChange:ee,handleOwesChange:te,calendarOpen:L,setCalendarOpen:R,cityRef:b,propertyRef:g,unitNameRef:v,dateRef:S,owesRef:w,validationError:q,propertyValidationError:G,unitValidationError:H,dateValidationError:J,owesValidationError:K,payment:e,onSubmit:A})}),l.jsx(ae,{className:"border-t bg-muted/50 p-4",children:l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(B,{type:"button",variant:"outline",onClick:re,disabled:D,children:"Cancel"}),l.jsx(B,{type:"submit",onClick:A,disabled:D,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:D?"Updating...":"Update Payment"})]})})]})})})}export{it as default};
