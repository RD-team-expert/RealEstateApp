import{r as o,u as H,j as e,H as B,L as U,a as p}from"./app-CCzuXckj.js";import{B as g}from"./button-CMWBItP5.js";import{C as q,b as M}from"./card-DRu8D1Tp.js";import{I as E}from"./input-Du17bKS3.js";import{T as X,a as G,b as N,c,d as J,e as l}from"./table-CeO9TH2o.js";import{u as K,A as Q}from"./app-layout-BoNLLPeQ.js";import W from"./VendorCreateDrawer-D2f7j-Qt.js";import Y from"./VendorEditDrawer-tV3N5eIM.js";import{D as Z}from"./download-DA4WEWuy.js";import{P as ee}from"./plus-DQ_VxF2F.js";import{S as re}from"./search-CdnXWL7g.js";import{X as te}from"./x-DYjqv_U5.js";import{S as se}from"./square-pen-CZ9y11nC.js";import{T as ae}from"./trash-2-qsChcdJa.js";import"./app-BmbQfT0_.js";import"./index-ChB7U0Zf.js";import"./utils-CBfrqCZ4.js";import"./index-agTCOONj.js";import"./index-Dc_FVRD7.js";import"./index-DyliiUy6.js";import"./index-CqHfpVA2.js";import"./index-DvwIsXwg.js";import"./index-Dt7h0l9k.js";import"./index-DODHwusq.js";import"./index-wJbuxyvX.js";import"./index-DTxO9eYn.js";import"./index-vq7VqFSt.js";import"./index-5SWgZ8xG.js";import"./index-BNwgaesP.js";import"./createLucideIcon-C69XpSIN.js";import"./collapsible-CcNV7e-r.js";import"./chevron-right-C8wvZ16F.js";import"./index-D6OiOCOB.js";import"./log-out-nz5FjWG9.js";import"./app-logo-icon-atlGpzJG.js";import"./house-CQx8K8A-.js";import"./building-BN0Wz64N.js";import"./users-DybgbioK.js";import"./wrench-Cuo6Tfe4.js";import"./credit-card-sJP7HDaK.js";import"./dollar-sign-N6h4oYi4.js";import"./file-text-DuBeEt6Y.js";import"./triangle-alert-DpTJsPz5.js";import"./bell-BsA6WElf.js";import"./drawer-D037HPJn.js";import"./label-B-O3f5QY.js";import"./select-HddS9BVA.js";import"./index-wPy1uw0V.js";import"./chevron-down-CCgMrUAw.js";import"./check-Du7_omyy.js";import"./chevron-up-D8wKuaQi.js";import"./radioGroup-0S5_KQF6.js";const oe=(t,d="vendors.csv")=>{const x=[["ID","City","Vendor Name","Number","Email","Service Type"].join(","),...t.map(a=>[a.id,`"${a.city?.city||"N/A"}"`,`"${a.vendor_name}"`,`"${a.number||""}"`,`"${a.email||""}"`,`"${a.service_type||""}"`].join(","))].join(`
`),h=new Blob([x],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),u=URL.createObjectURL(h);s.setAttribute("href",u),s.setAttribute("download",d),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(u)};function ar({vendors:t,filters:d,cities:i}){const[,x]=o.useState(d),[h,s]=o.useState(!1),[u,a]=o.useState(!1),[k,v]=o.useState(!1),[D,T]=o.useState(null),{flash:y}=H().props,{hasPermission:w,hasAllPermissions:C}=K(),[b,S]=o.useState({city:d.city||"",vendor_name:d.vendor_name||""}),[A,m]=o.useState(!1),f=o.useRef(null);o.useEffect(()=>{const r=n=>{f.current&&!f.current.contains(n.target)&&m(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const j=(r,n)=>{S(z=>({...z,[r]:n}))},L=r=>{const n=r.target.value;j("city",n),m(n.length>0)},V=r=>{j("city",r.city),m(!1)},_=()=>{const r={...b};x(r),p.get(route("vendors.index"),r,{preserveState:!0,preserveScroll:!0})},I=()=>{const r={city:"",vendor_name:""};S(r),x(r),m(!1),p.get(route("vendors.index"),{},{preserveState:!0,preserveScroll:!0})},O=()=>{if(t.data.length===0){alert("No data to export");return}s(!0);try{const r=`vendors-${new Date().toISOString().split("T")[0]}.csv`;oe(t.data,r)}catch(r){console.error("Export failed:",r),alert("Export failed. Please try again.")}finally{s(!1)}},P=r=>{confirm("Are you sure you want to delete this vendor?")&&p.delete(route("vendors.destroy",r.id))},F=()=>{p.reload()},R=r=>{T(r),v(!0)},$=()=>{p.reload()};return e.jsxs(Q,{children:[e.jsx(B,{title:"Vendors"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[y?.success&&e.jsx("div",{className:"mb-4 rounded border border-chart-1 bg-chart-1/20 px-4 py-3 text-chart-1",children:y?.success}),y?.error&&e.jsx("div",{className:"mb-4 rounded border border-destructive bg-destructive/20 px-4 py-3 text-destructive",children:y?.error}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Vendor List"}),e.jsxs("div",{className:"flex gap-2",children:[w("vendor.export")&&e.jsxs(g,{onClick:O,disabled:h,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),h?"Exporting...":"Export CSV"]}),C(["vendors.create","vendors.store"])&&e.jsxs(g,{onClick:()=>a(!0),className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Add Vendor"]})]})]}),e.jsx(q,{children:e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"relative",ref:f,children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"City"}),e.jsx(E,{type:"text",placeholder:"Select or type city...",value:b.city,onChange:L,onFocus:()=>m(!0),className:"w-full"}),A&&i&&i.length>0&&e.jsx("div",{className:"absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-gray-300 bg-white shadow-lg",children:i.filter(r=>r.city.toLowerCase().includes(b.city.toLowerCase())).map(r=>e.jsx("div",{className:"cursor-pointer px-3 py-2 text-sm hover:bg-gray-100",onClick:()=>V(r),children:r.city},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Vendor Name"}),e.jsx(E,{type:"text",placeholder:"Enter vendor name...",value:b.vendor_name,onChange:r=>j("vendor_name",r.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(g,{onClick:_,className:"flex items-center justify-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Search"]}),e.jsxs(g,{onClick:I,variant:"outline",className:"flex items-center justify-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Clear"]})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs(X,{className:"min-w-full",children:[e.jsx(G,{children:e.jsxs(N,{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx(c,{className:"sticky left-0 z-10 border-r border-gray-200 bg-gray-50 px-4 py-3 text-center font-semibold text-gray-900",children:"City"}),e.jsx(c,{className:"sticky left-[120px] z-10 border-r border-gray-200 bg-gray-50 px-4 py-3 text-center font-semibold text-gray-900",children:"Vendor Name"}),e.jsx(c,{className:"border-r border-gray-200 px-4 py-3 text-center font-semibold text-gray-900",children:"Phone Number"}),e.jsx(c,{className:"border-r border-gray-200 px-4 py-3 text-center font-semibold text-gray-900",children:"Email"}),e.jsx(c,{className:"border-r border-gray-200 px-4 py-3 text-center font-semibold text-gray-900",children:"Service Type"}),e.jsx(c,{className:"px-4 py-3 text-center font-semibold text-gray-900",children:"Actions"})]})}),e.jsx(J,{children:t.data.length>0?t.data.map(r=>e.jsxs(N,{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx(l,{className:"sticky left-0 z-10 border-r border-gray-200 bg-white px-4 py-3 text-center",children:r.city?.city||"N/A"}),e.jsx(l,{className:"sticky left-[120px] z-10 border-r border-gray-200 bg-white px-4 py-3 text-center font-medium",children:r.vendor_name}),e.jsx(l,{className:"border-r border-gray-200 px-4 py-3 text-center",children:r.number||"N/A"}),e.jsx(l,{className:"border-r border-gray-200 px-4 py-3 text-center",children:r.email||"N/A"}),e.jsx(l,{className:"border-r border-gray-200 px-4 py-3 text-center",children:r.service_type||"N/A"}),e.jsx(l,{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[C(["vendors.edit","vendors.update"])&&e.jsx("button",{onClick:()=>R(r),className:"text-green-600 hover:text-green-800",children:e.jsx(se,{className:"h-4 w-4"})}),w("vendors.destroy")&&e.jsx("button",{onClick:()=>P(r),className:"text-red-600 hover:text-red-800",children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},r.id)):e.jsx(N,{children:e.jsx(l,{colSpan:6,className:"py-8 text-center text-gray-500",children:"No vendors found"})})})]})}),t.links&&t.links.length>3&&e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx("div",{className:"flex gap-2",children:t.links.map((r,n)=>e.jsx(U,{href:r.url||"#",className:`rounded px-3 py-2 text-sm ${r.active?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"} ${r.url?"":"cursor-not-allowed opacity-50"}`,dangerouslySetInnerHTML:{__html:r.label}},n))})})]})})]})}),e.jsx(W,{cities:i,open:u,onOpenChange:a,onSuccess:F}),e.jsx(Y,{cities:i,open:k,onOpenChange:v,vendor:D,onSuccess:$})]})}export{ar as default};
