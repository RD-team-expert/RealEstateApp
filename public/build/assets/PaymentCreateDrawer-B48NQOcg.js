import{r as o,b as Q,j as t}from"./app-DYme-6ST.js";import{B as F}from"./button-DygVteL_.js";import{D as T,a as W,b as X}from"./drawer-BC2XqbDZ.js";import{DateField as Y}from"./DateField-DKnAVdwU.js";import{CityField as Z}from"./CityField-Bt_yvwVA.js";import{PropertyField as $}from"./PropertyField-1azfVCMN.js";import{UnitField as ee}from"./UnitField-B7vLPrcd.js";import{FinancialFields as te}from"./FinancialFields-Y74MFPwD.js";import{AssistanceFields as re}from"./AssistanceFields-aC_WMIOh.js";import{PermanentField as ie}from"./PermanentField-DqZQvklt.js";import{HiddenField as se}from"./HiddenField-6LLYIIZf.js";import{ReversedPaymentsField as ae}from"./ReversedPaymentsField-CYBoS0zS.js";import{NotesField as ne}from"./NotesField-BtyLez79.js";import{DebugInfo as oe}from"./DebugInfo-CYXqAx35.js";import"./app-BxoA0TtB.js";import"./index-DAeyJQLn.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./index-BPUi24BT.js";import"./index-yvkaECEW.js";import"./index-B3RZid5o.js";import"./index-wTYJRjsu.js";import"./index-Dt2fvjT8.js";import"./index-DRjsfxtL.js";import"./x-xoZkVJyy.js";import"./createLucideIcon-Dwp8kkct.js";import"./calendar-BWK2M4JP.js";import"./format-PYUiRpxY.js";import"./chevron-left-C0SnhLPd.js";import"./chevron-right-BQBVxicn.js";import"./chevron-down-CDnjTFxC.js";import"./label-Cs5jgoI2.js";import"./popover-iS5_0AtM.js";import"./index-x8Nhs1r4.js";import"./index-DYyhglSa.js";import"./calendar-Bw6k_ssZ.js";import"./select-CPtJWUF5.js";import"./index-Dc_FVRD7.js";import"./index-D6kz9xqy.js";import"./index-DZXKY85H.js";import"./index-CadWMiU4.js";import"./check-B5KXzRGR.js";import"./chevron-up-3w0W2Y4A.js";import"./input-pR7fOcUW.js";import"./checkbox-DnglLfek.js";import"./index-B8KHhnfk.js";import"./radioGroup-F0AlgpLY.js";function tt({units:v,cities:U,unitsByCity:D,propertiesByCity:A,open:V,onOpenChange:b,onSuccess:N}){const[I,u]=o.useState(""),[H,p]=o.useState(""),[O,d]=o.useState(""),[R,f]=o.useState(""),[k,h]=o.useState(""),[B,z]=o.useState(!1),[i,C]=o.useState(""),[a,y]=o.useState(""),[c,l]=o.useState(""),{data:r,setData:s,post:q,processing:g,errors:m,reset:E}=Q({date:"",unit_id:"",owes:"",paid:"",status:"",notes:"",reversed_payments:"",permanent:"No",has_assistance:!1,assistance_amount:"",assistance_company:"",is_hidden:!1}),P=()=>i?A[i]||[]:[],j=()=>i?a?v.filter(e=>e.city===i&&e.property_name===a).map(e=>e.unit_name):D[i]||[]:[],G=(e,n,_)=>{const S=v.find(x=>x.city===e&&x.property_name===n&&x.unit_name===_);return S?S.id:null};o.useEffect(()=>{i&&a&&(P().includes(a)||(y(""),l(""),s("unit_id","")))},[i]),o.useEffect(()=>{a&&c&&(j().includes(c)||(l(""),s("unit_id","")))},[i,a]);const J=e=>{C(e),y(""),l(""),s("unit_id",""),u(""),p(""),d("")},K=e=>{y(e),l(""),s("unit_id",""),p(""),d("")},L=e=>{if(l(e),d(""),i&&a&&e){const n=G(i,a,e);n&&s("unit_id",n.toString())}},w=e=>{e.preventDefault(),u(""),p(""),d(""),f(""),h("");let n=!1;(!r.date||r.date.trim()==="")&&(f("Please select a date before submitting the form."),n=!0),(!i||i.trim()==="")&&(u("Please select a city before submitting the form."),n=!0),(!a||a.trim()==="")&&(p("Please select a property before submitting the form."),n=!0),(!c||c.trim()==="")&&(d("Please select a unit before submitting the form."),n=!0),(!r.owes||r.owes.trim()==="")&&(h("Please enter the amount owed before submitting the form."),n=!0),(!r.unit_id||r.unit_id.trim()==="")&&(d("Unable to identify the selected unit. Please try selecting again."),n=!0),!n&&q(route("payments.store"),{onSuccess:()=>{E(),C(""),y(""),l(""),u(""),p(""),d(""),f(""),h(""),b(!1),N?.()},onError:_=>{console.error("Form submission errors:",_)}})},M=()=>{E(),C(""),y(""),l(""),u(""),p(""),d(""),f(""),h(""),b(!1)};return t.jsx(T,{open:V,onOpenChange:b,modal:!1,children:t.jsx(W,{size:"half",title:"Create New Payment",children:t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsxs("form",{onSubmit:w,className:"space-y-4",children:[t.jsx(Z,{cities:U,selectedCity:i,onCityChange:J,validationError:I,unitIdError:m.unit_id}),t.jsx($,{selectedProperty:a,availableProperties:P(),onPropertyChange:K,disabled:!i,validationError:H}),t.jsx(ee,{selectedUnit:c,availableUnits:j(),onUnitChange:L,disabled:!i,validationError:O}),t.jsx(Y,{date:r.date,onDateChange:e=>{s("date",e),f("")},calendarOpen:B,onCalendarOpenChange:z,validationError:R,dateError:m.date}),t.jsx(te,{owes:r.owes,paid:r.paid,onOwesChange:e=>{s("owes",e),h("")},onPaidChange:e=>s("paid",e),owesError:m.owes,paidError:m.paid,owesValidationError:k}),t.jsx(re,{hasAssistance:r.has_assistance,assistanceAmount:r.assistance_amount,assistanceCompany:r.assistance_company,onHasAssistanceChange:e=>s("has_assistance",e),onAssistanceAmountChange:e=>s("assistance_amount",e),onAssistanceCompanyChange:e=>s("assistance_company",e),assistanceAmountError:m.assistance_amount,assistanceCompanyError:m.assistance_company}),t.jsx(ie,{permanent:r.permanent,onPermanentChange:e=>s("permanent",e),error:m.permanent}),t.jsx(se,{isHidden:r.is_hidden,onHiddenChange:e=>s("is_hidden",e)}),t.jsx(ae,{reversedPayments:r.reversed_payments,onReversedPaymentsChange:e=>s("reversed_payments",e),error:m.reversed_payments}),t.jsx(ne,{notes:r.notes,onNotesChange:e=>s("notes",e),error:m.notes}),t.jsx(oe,{unitId:r.unit_id,selectedCity:i,selectedProperty:a,selectedUnit:c})]})}),t.jsx(X,{className:"border-t bg-muted/50 p-4",children:t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(F,{type:"button",variant:"outline",onClick:M,disabled:g,children:"Cancel"}),t.jsx(F,{type:"submit",onClick:w,disabled:g,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:g?"Creating...":"Create Payment"})]})})]})})})}export{tt as default};
