import{r as s,u as T,j as r,H as _,a as l}from"./app-DIEWn7Ix.js";import{C as $,b as L}from"./card-D0lM0cRg.js";import{u as R}from"./usePermissions-C5kTLoeu.js";import{A as U}from"./app-layout-C9S1njiG.js";import H from"./VendorCreateDrawer-DYWi61N7.js";import B from"./VendorEditDrawer-DnFZuO44.js";import M from"./FlashMessages-CNT9Aoit.js";import q from"./PageHeader-BcIdm-c7.js";import z from"./VendorFilters-BVVFiJUl.js";import G from"./VendorTable-Sc33SM14.js";import J from"./VendorPagination-CsfBd3T6.js";import"./app-ChTVGdbA.js";import"./utils-CBfrqCZ4.js";import"./index-Bt0zfGgm.js";import"./index-CdJFUDDL.js";import"./button-C0qpziZb.js";import"./index-DKA-WKms.js";import"./index-VPuXs-fY.js";import"./index-C4fRG95q.js";import"./index-BtB4-ACe.js";import"./index-BBSsUOtm.js";import"./index-BWA9V35X.js";import"./x-imATtpBe.js";import"./createLucideIcon-lZMskSwP.js";import"./index-Dc_FVRD7.js";import"./index-DwaLeO51.js";import"./index-DWHJnJ6z.js";import"./index-B14YlqPx.js";import"./index-BuLzMHmv.js";import"./collapsible-D1_DD34n.js";import"./chevron-right-lBI-HPj1.js";import"./index-Bp33PYYw.js";import"./log-out-CE4a_W2h.js";import"./chevrons-up-down-wcdr16Hr.js";import"./app-logo-icon-BrLszCI4.js";import"./house-DKj--ObP.js";import"./building-CBRSJYqv.js";import"./users-B43C_7xE.js";import"./wrench-DwJ9zT3b.js";import"./credit-card-D-F9DsZs.js";import"./dollar-sign-CTn_hGqc.js";import"./file-text-BkIwiqXy.js";import"./triangle-alert-mmtwxqk7.js";import"./bell-CBmeO6wA.js";import"./drawer-fqLIckn8.js";import"./CityField-CwQ0dC4q.js";import"./label-BIgMUqDa.js";import"./select-DaMc0ZYU.js";import"./index-OmisV_7g.js";import"./chevron-down-DABifuem.js";import"./check-CBvn5g3p.js";import"./chevron-up-DPOsvpyl.js";import"./VendorNameField-CR_NgJ97.js";import"./input-Dp80VBC1.js";import"./PhoneNumberField-5kH7NHgB.js";import"./plus-DhhAwnw0.js";import"./trash-2-BbHlzFlW.js";import"./EmailField-jnK4irjv.js";import"./ServiceTypeField-CpxHVQTs.js";import"./CityField-BZPrhx8Y.js";import"./VendorNameField-Dv3YSrhq.js";import"./PhoneNumberField-D0_TsJa4.js";import"./EmailField-BANIr8JD.js";import"./ServiceTypeField-DK0gYn3d.js";import"./download-C1kHH7o-.js";import"./search-Cudh47UL.js";import"./table-CvyjvZRw.js";import"./VendorTableRow-D6SdYNKk.js";import"./square-pen-BESSjlPV.js";const K=(i,a="vendors.csv")=>{const p=["ID","City","Vendor Name","Number","Email","Service Type"],n=t=>!t||!Array.isArray(t)||t.length===0?"":t.join("; "),h=[p.join(","),...i.map(t=>[t.id,`"${t.city?.city||"N/A"}"`,`"${t.vendor_name}"`,`"${n(t.number)}"`,`"${n(t.email)}"`,`"${n(t.service_type)}"`].join(","))].join(`
`),d=new Blob([h],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),m=URL.createObjectURL(d);o.setAttribute("href",m),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m)};function lt({vendors:i,filters:a,cities:p}){const[,n]=s.useState(a),[h,d]=s.useState(!1),[o,m]=s.useState(!1),[t,y]=s.useState(!1),[g,j]=s.useState(null),{flash:w}=T().props,{hasPermission:f,hasAllPermissions:v}=R(),[C,S]=s.useState({city:a.city||"",vendor_name:a.vendor_name||""}),[E,c]=s.useState(!1),x=(e,u)=>{S(N=>({...N,[e]:u}))},D=e=>{const u=e.target.value;x("city",u),c(u.length>0)},b=e=>{x("city",e.city),c(!1)},V=()=>{const e={...C};n(e),l.get(route("vendors.index"),e,{preserveState:!0,preserveScroll:!0})},F=()=>{const e={city:"",vendor_name:""};S(e),n(e),c(!1),l.get(route("vendors.index"),{},{preserveState:!0,preserveScroll:!0})},A=()=>{if(i.data.length===0){alert("No data to export");return}d(!0);try{const e=`vendors-${new Date().toISOString().split("T")[0]}.csv`;K(i.data,e)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{d(!1)}},P=e=>{confirm("Are you sure you want to delete this vendor?")&&l.delete(route("vendors.destroy",e.id))},O=()=>{l.reload()},I=e=>{j(e),y(!0)},k=()=>{l.reload()};return r.jsxs(U,{children:[r.jsx(_,{title:"Vendors"}),r.jsx("div",{className:"py-12",children:r.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[r.jsx(M,{flash:w}),r.jsx(q,{hasExportPermission:f("vendor.export"),hasCreatePermissions:v(["vendors.create","vendors.store"]),isExporting:h,onExport:A,onAddVendor:()=>m(!0)}),r.jsx($,{children:r.jsxs(L,{className:"p-6",children:[r.jsx(z,{tempFilters:C,cities:p,showCityDropdown:E,onTempFilterChange:x,onCityInputChange:D,onCitySelect:b,onSearchClick:V,onClearFilters:F,setShowCityDropdown:c}),r.jsx(G,{vendors:i.data,hasEditPermissions:v(["vendors.edit","vendors.update"]),hasDeletePermission:f("vendors.destroy"),onEditVendor:I,onDeleteVendor:P}),r.jsx(J,{links:i.links})]})})]})}),r.jsx(H,{cities:p,open:o,onOpenChange:m,onSuccess:O}),r.jsx(B,{cities:p,open:t,onOpenChange:y,vendor:g,onSuccess:k})]})}export{lt as default};
