import{r as j,j as e,H as S,L as _,b as p}from"./app-DnZTfT0_.js";import{u as w,A as v}from"./app-layout-NpEgK4_T.js";import{B as l}from"./app-logo-icon-Bc2eyx79.js";import{I as D}from"./input-DQ_wq_vv.js";import{C as E,a as L,b as A,c as C}from"./card-C4RmjogZ.js";import{P as k,T,a as $,b as N,c as a,d as M,e as i,f as P}from"./table-7_H-LZJM.js";import{B as b}from"./badge-CCSbDhbi.js";import{D as B}from"./download-DrHPYDYz.js";import{S as H}from"./search-D1fLgR4z.js";import{E as R}from"./eye-Cf9la-Va.js";import{S as U}from"./square-pen-qd8CnHV4.js";import"./app-8ZSuAH30.js";import"./index-CToc1y-v.js";import"./index-D6oF8zzd.js";const F=(s,h="move-ins.csv")=>{try{const n=r=>{if(!r)return"";try{return new Date(r).toLocaleDateString()}catch{return r||""}},d=r=>r==null?"":String(r).replace(/"/g,'""'),x=[["ID","Unit Name","Signed Lease","Lease Signing Date","Move-In Date","Paid Security & First Month","Scheduled Payment Date","Handled Keys","Move in form sent On","Filled Move-In Form","Date of move in form filled in","Submitted Insurance","Date of Insurance expiration"].join(","),...s.map(r=>{try{return[r.id||"",`"${d(r.unit_name)}"`,`"${d(r.signed_lease)}"`,`"${n(r.lease_signing_date)}"`,`"${n(r.move_in_date)}"`,`"${d(r.paid_security_deposit_first_month_rent)}"`,`"${n(r.scheduled_paid_time)}"`,`"${d(r.handled_keys)}"`,`"${n(r.move_in_form_sent_date)}"`,`"${d(r.filled_move_in_form)}"`,`"${n(r.date_of_move_in_form_filled)}"`,`"${d(r.submitted_insurance)}"`,`"${n(r.date_of_insurance_expiration)}"`].join(",")}catch(u){return console.error("Error processing move-in row:",r,u),""}}).filter(r=>r!=="")].join(`
`),g=new Blob([x],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),c=URL.createObjectURL(g);return o.setAttribute("href",c),o.setAttribute("download",h),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(c),!0}catch(n){throw console.error("CSV Export Error:",n),n}};function te({moveIns:s,search:h}){const[n,d]=j.useState(h||""),[f,x]=j.useState(!1),g=t=>{t.preventDefault(),p.get(route("move-in.index"),{search:n},{preserveState:!0})},{hasPermission:o,hasAnyPermission:c,hasAllPermissions:r}=w(),u=t=>{confirm("Are you sure you want to delete this move-in record?")&&p.delete(route("move-in.destroy",t.id))},y=()=>{if(!s||!s.data||s.data.length===0){alert("No data to export");return}x(!0);try{console.log("Exporting move-in data:",s.data);const t=`move-ins-${new Date().toISOString().split("T")[0]}.csv`;F(s.data,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t.message||"Unknown error"}. Please check the console for details.`)}finally{x(!1)}},m=t=>t===null?e.jsx(b,{variant:"outline",children:"N/A"}):e.jsx(b,{variant:t==="Yes"?"default":"secondary",className:t==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t});return e.jsxs(v,{children:[e.jsx(S,{title:"Move-In Management"}),e.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs(E,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsxs(L,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{className:"text-2xl",children:"Move-In Management"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:y,disabled:f||!s?.data||s.data.length===0,className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),f?"Exporting...":"Export CSV"]}),r(["move-in.create","move-in.store"])&&e.jsx(_,{href:route("move-in.create"),children:e.jsxs(l,{children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Add Move-In Record"]})})]})]}),e.jsxs("form",{onSubmit:g,className:"flex gap-2 mt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(D,{type:"text",placeholder:"Search by unit name or status...",value:n,onChange:t=>d(t.target.value),className:"bg-input text-input-foreground"})}),e.jsx(l,{type:"submit",children:e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsxs(C,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx($,{children:e.jsxs(N,{className:"border-border",children:[e.jsx(a,{className:"text-muted-foreground",children:"Unit Name"}),e.jsx(a,{className:"text-muted-foreground",children:"Signed Lease"}),e.jsx(a,{className:"text-muted-foreground",children:"Lease Signing Date"}),e.jsx(a,{className:"text-muted-foreground",children:"Move-In Date"}),e.jsx(a,{className:"text-muted-foreground",children:"Paid Security & First Month"}),e.jsx(a,{className:"text-muted-foreground",children:"Scheduled Payment Date"}),e.jsx(a,{className:"text-muted-foreground",children:"Handled Keys"}),e.jsx(a,{className:"text-muted-foreground",children:"Move in form sent On"}),e.jsx(a,{className:"text-muted-foreground",children:"Filled Move-In Form"}),e.jsx(a,{className:"text-muted-foreground",children:"Date of move in form filled in"}),e.jsx(a,{className:"text-muted-foreground",children:"Submitted Insurance"}),e.jsx(a,{className:"text-muted-foreground",children:"Date of Insurance expiration"}),c(["move-in.show","move-in.edit","move-in.update","move-in.destroy"])&&e.jsx(a,{className:"text-muted-foreground",children:"Actions"})]})}),e.jsx(M,{children:s.data.map(t=>e.jsxs(N,{className:"hover:bg-muted/50 border-border",children:[e.jsx(i,{className:"font-medium text-foreground",children:t.unit_name}),e.jsx(i,{children:m(t.signed_lease)}),e.jsx(i,{className:"text-foreground",children:t.lease_signing_date?new Date(t.lease_signing_date).toLocaleDateString():"N/A"}),e.jsx(i,{className:"text-foreground",children:t.move_in_date?new Date(t.move_in_date).toLocaleDateString():"N/A"}),e.jsx(i,{children:m(t.paid_security_deposit_first_month_rent)}),e.jsx(i,{className:"text-foreground",children:t.scheduled_paid_time?new Date(t.scheduled_paid_time).toLocaleDateString():"N/A"}),e.jsx(i,{children:m(t.handled_keys)}),e.jsx(i,{className:"text-foreground",children:t.move_in_form_sent_date?new Date(t.move_in_form_sent_date).toLocaleDateString():"N/A"}),e.jsx(i,{children:m(t.filled_move_in_form)}),e.jsx(i,{className:"text-foreground",children:t.date_of_move_in_form_filled?new Date(t.date_of_move_in_form_filled).toLocaleDateString():"N/A"}),e.jsx(i,{children:m(t.submitted_insurance)}),e.jsx(i,{className:"text-foreground",children:t.date_of_insurance_expiration?new Date(t.date_of_insurance_expiration).toLocaleDateString():"N/A"}),c(["move-in.show","move-in.edit","move-in.update","move-in.destroy"])&&e.jsx(i,{children:e.jsxs("div",{className:"flex gap-1",children:[o("move-in.show")&&e.jsx(_,{href:route("move-in.show",t.id),children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(R,{className:"h-4 w-4"})})}),r(["move-in.edit","move-in.update"])&&e.jsx(_,{href:route("move-in.edit",t.id),children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(U,{className:"h-4 w-4"})})}),o("move-in.destroy")&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(P,{className:"h-4 w-4"})})]})})]},t.id))})]})}),s.data.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No move-in records found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),s.meta&&e.jsx("div",{className:"mt-6 flex justify-between items-center border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.meta.from||0," to ",s.meta.to||0," of ",s.meta.total||0," results"]})})]})]})})})]})}export{te as default};
