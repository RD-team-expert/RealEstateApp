import{r as N,j as e,H as k,L as p,b as S}from"./app-CAyDEZnj.js";import{u as $,A as E}from"./app-layout-DY74bARH.js";import{B as u}from"./app-logo-icon-CjN8lF6W.js";import{I as C}from"./input-B9ajaorg.js";import{C as R,a as T,b as O,c as B}from"./card-C0B-VCo5.js";import{P,T as H,a as I,b as D,c as a,d as U,e as n,f as z}from"./table-vqUsJnJJ.js";import{B as o}from"./badge-DMHCbH1W.js";import{D as F}from"./download-CaQXFYds.js";import{S as K}from"./search-DAnUxFW4.js";import{E as V}from"./eye-mISP0EBM.js";import{S as Y}from"./square-pen-CUGzDP7i.js";import"./app-DSIzZYCB.js";import"./index-DsYzNQ6z.js";import"./index-3TL2J1ZM.js";const M=(j,i,m="offers-renewals.csv")=>{try{const c=s=>{if(!s)return"";try{return new Date(s).toLocaleDateString()}catch{return s||""}},r=s=>s==null?"":String(s).replace(/"/g,'""');let x=["ID","Unit","Tenant"];(i==="offers"||i==="both")&&(x=x.concat(["Date Sent Offer","Status","Date of Acceptance","Offer Last Notice Sent","Offer Notice Kind"])),(i==="renewals"||i==="both")&&(x=x.concat(["Lease Sent","Date Sent Lease","Lease Signed","Date Signed","Renewal Last Notice Sent","Renewal Notice Kind","Notes"])),x=x.concat(["How Many Days Left","Expired"]);const h=[x.join(","),...j.map(s=>{try{let d=[s.id||"",`"${r(s.unit)}"`,`"${r(s.tenant)}"`];return(i==="offers"||i==="both")&&(d=d.concat([`"${c(s.date_sent_offer)}"`,`"${r(s.status)}"`,`"${c(s.date_of_acceptance)}"`,`"${c(s.last_notice_sent)}"`,`"${r(s.notice_kind)}"`])),(i==="renewals"||i==="both")&&(d=d.concat([`"${r(s.lease_sent)}"`,`"${c(s.date_sent_lease)}"`,`"${r(s.lease_signed)}"`,`"${c(s.date_signed)}"`,`"${c(s.last_notice_sent_2)}"`,`"${r(s.notice_kind_2)}"`,`"${r(s.notes)}"`])),d=d.concat([`"${r(s.how_many_days_left)}"`,`"${r(s.expired)}"`]),d.join(",")}catch(d){return console.error("Error processing offer row:",s,d),""}}).filter(s=>s!=="")].join(`
`),g=new Blob([h],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),f=URL.createObjectURL(g);return l.setAttribute("href",f),l.setAttribute("download",m),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(f),!0}catch(c){throw console.error("CSV Export Error:",c),c}},q=[{label:"Offers",value:"offers"},{label:"Renewals",value:"renewals"},{label:"Both",value:"both"}],oe=({offers:j,search:i})=>{const[m,c]=N.useState(i||""),[r,x]=N.useState("offers"),[h,g]=N.useState(!1),l=j.filter(t=>!0),f=t=>{t.preventDefault(),S.get(route("offers-and-renewals.index"),{search:m},{preserveState:!0})},s=t=>{window.confirm("Are you sure you want to delete this offer? This action cannot be undone.")&&S.delete(`/offers_and_renewals/${t.id}`)},d=()=>{if(!l||l.length===0){alert("No data to export");return}g(!0);try{console.log("Exporting offers and renewals data:",l);const t=`offers-renewals-${r}-${new Date().toISOString().split("T")[0]}.csv`;M(l,r,t),console.log("Export completed successfully")}catch(t){console.error("Export failed:",t),alert(`Export failed: ${t.message||"Unknown error"}. Please check the console for details.`)}finally{g(!1)}},L=t=>{if(!t)return e.jsx(o,{variant:"outline",children:"N/A"});switch(t.toLowerCase()){case"accepted":return e.jsx(o,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:t});case"pending":return e.jsx(o,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:t});case"rejected":return e.jsx(o,{variant:"destructive",children:t});default:return e.jsx(o,{variant:"default",children:t})}},w=t=>!t||t==="-"?e.jsx(o,{variant:"outline",children:"N/A"}):e.jsx(o,{variant:t==="Yes"?"default":"secondary",className:t==="Yes"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",children:t}),A=t=>{if(!t)return e.jsx(o,{variant:"outline",children:"N/A"});const v=parseInt(t);return v<=7?e.jsxs(o,{variant:"destructive",children:[t," days"]}):v<=30?e.jsxs(o,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:[t," days"]}):e.jsxs(o,{variant:"default",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:[t," days"]})},{hasPermission:_,hasAnyPermission:b,hasAllPermissions:y}=$();return e.jsxs(E,{children:[e.jsx(k,{title:"Offers and Renewals"}),e.jsx("div",{className:"py-12 bg-background text-foreground transition-colors min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs(R,{className:"bg-card text-card-foreground shadow-lg",children:[e.jsxs(T,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(O,{className:"text-2xl",children:"Offers and Renewals"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:d,disabled:h||!l||l.length===0,className:"flex items-center",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),h?"Exporting...":"Export CSV"]}),y(["offers-and-renewals.create","offers-and-renewals.store"])&&e.jsx(p,{href:"/offers_and_renewals/create",children:e.jsxs(u,{children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Add New"]})})]})]}),e.jsxs("form",{onSubmit:f,className:"flex gap-2 mt-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(C,{type:"text",placeholder:"Search by unit, tenant, or status...",value:m,onChange:t=>c(t.target.value),className:"bg-input text-input-foreground"})}),e.jsx(u,{type:"submit",children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:q.map(t=>e.jsx(u,{variant:r===t.value?"default":"outline",onClick:()=>x(t.value),children:t.label},t.value))})]}),e.jsxs(B,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(D,{className:"border-border",children:[e.jsx(a,{className:"text-muted-foreground",children:"Unit"}),e.jsx(a,{className:"text-muted-foreground",children:"Tenant"}),(r==="offers"||r==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"text-muted-foreground",children:"Date Sent Offer"}),e.jsx(a,{className:"text-muted-foreground",children:"Status"}),e.jsx(a,{className:"text-muted-foreground",children:"Date of Acceptance"}),e.jsx(a,{className:"text-muted-foreground",children:"Offer Last Notice Sent"}),e.jsx(a,{className:"text-muted-foreground",children:"Offer Notice Kind"})]}),(r==="renewals"||r==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"text-muted-foreground",children:"Lease Sent?"}),e.jsx(a,{className:"text-muted-foreground",children:"Date Sent Lease"}),e.jsx(a,{className:"text-muted-foreground",children:"Lease Signed?"}),e.jsx(a,{className:"text-muted-foreground",children:"Date Signed"}),e.jsx(a,{className:"text-muted-foreground",children:"Renewal Last Notice Sent"}),e.jsx(a,{className:"text-muted-foreground",children:"Renewal Notice Kind"}),e.jsx(a,{className:"text-muted-foreground",children:"Notes"})]}),e.jsx(a,{className:"text-muted-foreground",children:"How Many Days Left"}),e.jsx(a,{className:"text-muted-foreground",children:"Expired"}),b(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])&&e.jsx(a,{className:"text-muted-foreground",children:"Actions"})]})}),e.jsx(U,{children:l.map(t=>e.jsxs(D,{className:"hover:bg-muted/50 border-border",children:[e.jsx(n,{className:"font-medium text-foreground",children:t.unit}),e.jsx(n,{className:"text-foreground",children:t.tenant}),(r==="offers"||r==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(n,{className:"text-foreground",children:t.date_sent_offer?new Date(t.date_sent_offer).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{children:L(t.status)}),e.jsx(n,{className:"text-foreground",children:t.date_of_acceptance?new Date(t.date_of_acceptance).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{className:"text-foreground",children:t.last_notice_sent?new Date(t.last_notice_sent).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{className:"text-foreground",children:t.notice_kind||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})})]}),(r==="renewals"||r==="both")&&e.jsxs(e.Fragment,{children:[e.jsx(n,{children:w(t.lease_sent)}),e.jsx(n,{className:"text-foreground",children:t.date_sent_lease?new Date(t.date_sent_lease).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{children:w(t.lease_signed)}),e.jsx(n,{className:"text-foreground",children:t.date_signed?new Date(t.date_signed).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{className:"text-foreground",children:t.last_notice_sent_2?new Date(t.last_notice_sent_2).toLocaleDateString():e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{className:"text-foreground",children:t.notice_kind_2||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(n,{className:"max-w-xs text-foreground",children:e.jsx("div",{className:"truncate",title:t.notes||"N/A",children:t.notes||e.jsx("span",{className:"text-muted-foreground",children:"N/A"})})})]}),e.jsx(n,{children:A(t.how_many_days_left)}),e.jsx(n,{children:e.jsx(o,{variant:t.expired==="expired"?"destructive":"default",children:t.expired??e.jsx("span",{className:"text-muted-foreground",children:"N/A"})})}),b(["offers-and-renewals.show","offers-and-renewals.edit","offers-and-renewals.update","offers-and-renewals.destroy"])&&e.jsx(n,{children:e.jsxs("div",{className:"flex gap-1",children:[_("offers-and-renewals.show")&&e.jsx(p,{href:`/offers_and_renewals/${t.id}`,children:e.jsx(u,{variant:"outline",size:"sm",children:e.jsx(V,{className:"h-4 w-4"})})}),y(["offers-and-renewals.edit","offers-and-renewals.update"])&&e.jsx(p,{href:`/offers_and_renewals/${t.id}/edit`,children:e.jsx(u,{variant:"outline",size:"sm",children:e.jsx(Y,{className:"h-4 w-4"})})}),_("offers-and-renewals.destroy")&&e.jsx(u,{variant:"outline",size:"sm",onClick:()=>s(t),className:"text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/20",children:e.jsx(z,{className:"h-4 w-4"})})]})})]},t.id))})]})}),l.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{className:"text-lg",children:"No offers found."}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria."})]}),e.jsx("div",{className:"mt-6 flex justify-between items-center border-t border-border pt-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",l.length," ",r]})})]})]})})})]})};export{oe as default};
