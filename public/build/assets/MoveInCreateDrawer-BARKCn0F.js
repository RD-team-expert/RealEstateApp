import{r as o,b as $,j as t}from"./app-IncGAUEB.js";import{D as B,a as ee,b as te}from"./drawer-BabOL_dj.js";import{B as w}from"./button-BZreYh_c.js";import{CityPropertyUnitSelector as re}from"./CityPropertyUnitSelector-CZlpDCMc.js";import{LeaseInformationFields as ie}from"./LeaseInformationFields-BKGJKjOe.js";import{PaymentInformationFields as oe}from"./PaymentInformationFields-Cts1x6On.js";import{KeysAndFormsFields as ae}from"./KeysAndFormsFields-Dwlbax4v.js";import{InsuranceInformationFields as ne}from"./InsuranceInformationFields-DxL1YuSh.js";import{I as M}from"./input-BKi6rfRv.js";import{L as V}from"./label-BhALl-XJ.js";import{DatePickerField as se}from"./DatePickerField-ClweAHvh.js";import"./app-DgqXL21p.js";import"./index-CfKQ6yNG.js";import"./index-bCzQdt7o.js";import"./index-BWcAjI1y.js";import"./index-D0fQOWIr.js";import"./index-yZxLUvKN.js";import"./index-iNsZkCT-.js";import"./index-6KC1G_4u.js";import"./index-CdJFUDDL.js";import"./utils-CBfrqCZ4.js";import"./x-B_qSqN6z.js";import"./createLucideIcon-Ci0S1m_Z.js";import"./popover-D0q3r5CP.js";import"./index-DfBxMdWp.js";import"./command-AnX11QHu.js";import"./search-CFDkSiim.js";import"./chevrons-up-down-D4md56fd.js";import"./check-gd2_wZBq.js";import"./radioGroup-BhgCKDH3.js";import"./index-X0Rqfk2m.js";import"./index-DizBXXCV.js";import"./calendar-UFpA7cIJ.js";import"./format-PYUiRpxY.js";import"./chevron-left-WEUqp8UO.js";import"./chevron-right-Dv0ELFzT.js";import"./chevron-down-uas8HWR-.js";import"./calendar-CBsjNrh9.js";function He({cities:L,properties:F,unitsByProperty:s,open:C,onOpenChange:y,onSuccess:K,currentFilters:j,currentPerPage:O,currentPage:A}){const u="moveInCreateDraft",p="moveInCreateDraftSkipRestore",h=o.useRef(null),g=o.useRef(null),v=o.useRef(null),[T,l]=o.useState(""),[U,b]=o.useState(""),[Y,m]=o.useState(""),[J,d]=o.useState([]),[z,x]=o.useState([]),[c,N]=o.useState(""),[_,S]=o.useState(""),{data:r,setData:i,post:G,processing:P,errors:a,reset:H}=$({unit_id:"",signed_lease:"No",lease_signing_date:"",move_in_date:"",paid_security_deposit_first_month_rent:"No",scheduled_paid_time:"",handled_keys:"No",move_in_form_sent_date:"",filled_move_in_form:"No",date_of_move_in_form_filled:"",submitted_insurance:"No",date_of_insurance_expiration:"",first_name:"",last_name:"",last_notice_sent:""}),R=()=>{H(),l(""),b(""),m(""),d([]),x([]),N(""),S("")},q=e=>{if(N(e),S(""),i("unit_id",""),b(""),m(""),l(""),e){const n=F.filter(f=>f.city_id?.toString()===e);x(n)}else x([]);d([])},Q=e=>{S(e),i("unit_id",""),m(""),l(""),e&&s&&s[e]?d(s[e]):d([])},W=e=>{i("unit_id",parseInt(e)),l("")},k=e=>{e.preventDefault(),l(""),b(""),m("");let n=!1;(!c||c.trim()==="")&&(b("Please select a city before submitting the form."),g.current&&(g.current.focus(),g.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!_||_.trim()==="")&&(m("Please select a property before submitting the form."),v.current&&(v.current.focus(),v.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),(!r.unit_id||typeof r.unit_id=="number"&&r.unit_id<=0)&&(l("Please select a unit before submitting the form."),h.current&&(h.current.focus(),h.current.scrollIntoView({behavior:"smooth",block:"center"})),n=!0),!n&&G(route("move-in.store",{city:j.city?.trim()||void 0,property:j.property?.trim()||void 0,unit:j.unit?.trim()||void 0,perPage:O,page:A}),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{try{localStorage.removeItem(u),localStorage.setItem(p,"true")}catch{}R(),y(!1),K?.()}})},X=()=>{try{localStorage.removeItem(u),localStorage.setItem(p,"true")}catch{}R(),y(!1)};return o.useEffect(()=>{try{if(localStorage.getItem(p)==="true"){localStorage.removeItem(p);return}const n=localStorage.getItem(u);if(n){const f=JSON.parse(n);i(E=>({...E,...f.data}));const D=f.selectedCityId||"",I=f.selectedPropertyId||"";if(N(D),S(I),D){const E=F.filter(Z=>Z.city_id?.toString()===D);x(E)}I&&s&&s[I]&&d(s[I])}}catch{}},[]),o.useEffect(()=>{try{if(C){const e={data:r,selectedCityId:c,selectedPropertyId:_};localStorage.setItem(u,JSON.stringify(e))}}catch{}},[C,r,c,_]),t.jsx(B,{open:C,onOpenChange:y,modal:!1,children:t.jsx(ee,{size:"half",title:"Create New Move-In Record",children:t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx("div",{className:"flex-1 overflow-auto p-6",children:t.jsxs("form",{onSubmit:k,className:"space-y-4",children:[t.jsx(re,{cities:L,availableProperties:z,availableUnits:J,selectedCityId:c,selectedPropertyId:_,unitId:r.unit_id,cityRef:g,propertyRef:v,unitRef:h,onCityChange:q,onPropertyChange:Q,onUnitChange:W,errors:a,cityValidationError:U,propertyValidationError:Y,validationError:T}),t.jsx(ie,{signedLease:r.signed_lease,leaseSigningDate:r.lease_signing_date,moveInDate:r.move_in_date,onSignedLeaseChange:e=>i("signed_lease",e),onLeaseSigningDateChange:e=>i("lease_signing_date",e),onMoveInDateChange:e=>i("move_in_date",e),errors:a}),t.jsx(oe,{paidSecurityDeposit:r.paid_security_deposit_first_month_rent,scheduledPaidTime:r.scheduled_paid_time,onPaidSecurityDepositChange:e=>i("paid_security_deposit_first_month_rent",e),onScheduledPaidTimeChange:e=>i("scheduled_paid_time",e),errors:a}),t.jsx(ae,{handledKeys:r.handled_keys,moveInFormSentDate:r.move_in_form_sent_date,filledMoveInForm:r.filled_move_in_form,dateOfMoveInFormFilled:r.date_of_move_in_form_filled,onHandledKeysChange:e=>i("handled_keys",e),onMoveInFormSentDateChange:e=>i("move_in_form_sent_date",e),onFilledMoveInFormChange:e=>{i("filled_move_in_form",e),e!=="Yes"&&i("date_of_move_in_form_filled","")},onDateOfMoveInFormFilledChange:e=>i("date_of_move_in_form_filled",e),errors:a}),t.jsx(ne,{submittedInsurance:r.submitted_insurance,dateOfInsuranceExpiration:r.date_of_insurance_expiration,onSubmittedInsuranceChange:e=>{i("submitted_insurance",e),e!=="Yes"&&i("date_of_insurance_expiration","")},onDateOfInsuranceExpirationChange:e=>i("date_of_insurance_expiration",e),errors:a}),t.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[t.jsx("div",{className:"mb-2",children:t.jsx(V,{htmlFor:"first_name",className:"text-base font-semibold",children:"First Name"})}),t.jsx(M,{id:"first_name",name:"first_name",value:r.first_name,onChange:e=>i("first_name",e.target.value),placeholder:"Enter first name"}),a.first_name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.first_name})]}),t.jsxs("div",{className:"rounded-lg border-l-4 border-l-blue-500 p-4",children:[t.jsx("div",{className:"mb-2",children:t.jsx(V,{htmlFor:"last_name",className:"text-base font-semibold",children:"Last Name"})}),t.jsx(M,{id:"last_name",name:"last_name",value:r.last_name,onChange:e=>i("last_name",e.target.value),placeholder:"Enter last name"}),a.last_name&&t.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.last_name})]}),t.jsx(se,{label:"Last Notice Sent",value:r.last_notice_sent,onChange:e=>i("last_notice_sent",e??""),error:a.last_notice_sent,borderColor:"border-l-blue-500"})]})}),t.jsx(te,{children:t.jsxs("div",{className:"flex w-full justify-end gap-2",children:[t.jsx(w,{type:"button",variant:"outline",onClick:X,children:"Cancel"}),t.jsx(w,{type:"submit",disabled:P,onClick:k,children:P?"Creating...":"Create Move-In Record"})]})})]})})})}export{He as default};
